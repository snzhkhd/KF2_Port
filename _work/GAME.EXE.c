/* This file was generated by the Hex-Rays decompiler.
   Copyright (c) 2007-2020 Hex-Rays <info@hex-rays.com>

   Detected compiler: GNU C++
*/

#include <defs.h>

#include <stdarg.h>


//-------------------------------------------------------------------------
// Function declarations

int sub_80013A5C();
int __MainGameLoop();
// int __fastcall StopPAD(int a1, int a2, int a3, __int16 a4);
// void *InitSoundSystem();
int Music_PlaySEQ();
int Music_Stop();
int __fastcall sub_800140B4(int a1, int a2, int a3, __int16 a4);
int __fastcall PlayPositionalSound3D(__int16 id, int *a2, int a3, int min_dist, int max_dist, int flags);
int __fastcall sub_800143E0(__int16 a1, int *a2, __int16 a3, int a4);
int __fastcall PlayPositionalSound3D_Wrap(__int16 a1, int *a2, __int16 a3, int a4, int a5, int a6);
int __fastcall sub_80014448(int a1);
int __fastcall UpdatePlayerMapContext(_DWORD *, int *);
int __fastcall PlaySoundEffect(int a1, int a2);
int sub_80014594();
__int16 *__fastcall sub_800145F8(int a1);
int __fastcall PlayAudioStream(int a1, int a2, __int16 a3, int a4);
int __fastcall OnAudioStreamComplete(int task);
void ProcessCDAudioLoad();
_WORD *FindFreeAudioChannel();
int __fastcall StartAudioStream(unsigned __int16 audio_type, __int16 a2, int a3);
int __fastcall sub_80014C84(__int16 a1, __int16 a2, int a3);
int __fastcall sub_80014D48(int a1, int a2, int a3);
signed int __fastcall sub_80014DB0(_DWORD *a1, _DWORD *a2, int a3, _WORD *a4);
int __fastcall sub_80014ED4(int a1, int a2, int a3, int a4, int a5);
int __fastcall sub_80014FAC(__int16 a1, _DWORD *a2);
int __fastcall RotateMatrixCardinal(_WORD *, _WORD *, int);
int __fastcall sub_80015304(__int16 a1, int a2);
int __fastcall sub_80015378(__int16 a1, int a2);
int __fastcall sub_800153EC(__int16 a1, int a2);
unsigned __int16 *__fastcall sub_80015460(__int16 *a1, int *a2);
unsigned __int16 *__fastcall sub_800154CC(__int16 *a1, int *a2);
int __fastcall sub_80015538(_WORD *a1, _WORD *a2);
int __fastcall sub_80015614(__int16 *a1, int a2, int a3);
int __fastcall sub_8001565C(__int16 a1, int *a2);
int __fastcall sub_80015694(__int16 a1, __int16 *a2);
int __fastcall Math_IsAngleInRange(__int16 a1, __int16 a2, __int16 a3);
BOOL __fastcall sub_800157D4(__int16 a1, __int16 a2);
int __fastcall sub_800157E4(__int16, __int16);
int __fastcall Math_Atan2_Fixed(int, int);
unsigned int __fastcall CalculateDistance(int a1, int a2);
unsigned int __fastcall sub_80015990(int a1, int a2, int a3);
int __fastcall sub_800159DC(int a1, int a2, int a3, _WORD *a4);
BOOL __fastcall Math_IsTargetInVerticalRange(int entityY, int entityHeight, int targetY, int toleranceUp);
int __fastcall GetDistanceIfInRange(Vector3 *objPos, int targetX, int targetY, int targetZ, signed int maxRange, int heightLimitUp, int heightLimitDown);
int __fastcall sub_80015B74(_DWORD *a1, int a2, _DWORD *a3, signed int a4, int a5);
int __fastcall AI_GetRandomizedWeight(int base_priority);
int __fastcall sub_80015CC8(int a1);
int __fastcall FixedPointLerp(int a1, int a2, int a3);
int __fastcall sub_80015D30(__int16 a1, __int16 a2, int a3);
int __fastcall LerpRotationMatrix(__int16 *a1, __int16 *a2, _WORD *a3, __int16 a4);
int __fastcall sub_80015DD0(int a1, int a2, int a3, int a4, int a5, signed int *a6, int *a7);
int __fastcall sub_8001605C(int a1, int a2, int a3, int a4, int a5, int a6, int a7, int a8, int a9, _WORD *a10, _WORD *a11, _WORD *a12);
int __fastcall sub_80016168(_DWORD *a1, __int16 *a2, int a3, _DWORD *a4);
void nullsub_5();
int LoadGameData();
int TitleScreen();
int __fastcall sub_80016580(int a1, int a2, int a3);
int __fastcall sub_800166F8(unsigned __int8, unsigned __int8, unsigned __int8, unsigned __int8, unsigned __int8, char, char, char);
int sub_80016C6C(); // weak
int sub_80016C80(); // weak
int sub_80016C94(); // weak
int sub_80016CA8(); // weak
int sub_80016CBC(); // weak
void HandleUISequence();
int __fastcall OnCDReadComplete(int a1);
int __fastcall QueueCDReadTask(unsigned __int16, unsigned __int16);
int __fastcall CalculateNextCdChunk(int a1);
void ProcessAssetLoadQueue();
int *__fastcall MemcpyDword(_DWORD *a1, int *a2, int a3);
__int16 *__fastcall CopyToFinalBuffer(_WORD *a1, __int16 *a2, int a3);
_DWORD *__fastcall memset_0(_DWORD *, int, int);
int __fastcall sub_8001772C(unsigned __int8 *a1);
_DWORD *__fastcall sub_800177B0(int a1);
unsigned __int8 *__fastcall sub_800177D0(unsigned __int8 *a1, unsigned int a2);
int __fastcall sub_80017920(unsigned __int8 *a1);
int __fastcall sub_800179BC(unsigned __int8 *a1);
int __fastcall Heap_Init(int a1, int a2);
unsigned __int8 *__fastcall FMOAllocateBuffer(unsigned __int8 *a1, unsigned int a2, unsigned __int8 **a3);
_DWORD *__fastcall sub_80017B7C(int a1);
void __fastcall MO_Something01Set(int a1, char a2);
int __fastcall sub_80017BA4(int a1);
void __fastcall MO_Something02Set(int a1, __int16 a2);
int AllocateMemor_0();
int __fastcall AllocateMemory(int a1);
// int __fastcall PadChkVsync(int a1);
// int PadStartCom();
// int sub_80017CC8();
// int __fastcall NextCdTask(_BYTE *a1);
// int sub_80017DB4();
// int sub_80017F2C();
// int __fastcall BcdToDec(unsigned __int8 bcd);
// unsigned int __fastcall DecToBcd(unsigned __int8 dec);
// int __fastcall MsfToLba(unsigned __int8 *);
// unsigned int __fastcall LbaToMsf(_BYTE *lba, unsigned int out_bcd);
unsigned int __fastcall ConvertCdAddress(unsigned __int8 *a1, int a2, _BYTE *a3);
void WaitForCdIdle();
void __fastcall WaitForTaskComplete(_BYTE *a1);
BOOL __fastcall VerifyChecksum(int *data, int size_bytes);
int __fastcall CreateCDTask(char, _DWORD *, int, int, int);
int __fastcall ReadFromFile(unsigned __int16 a1, unsigned __int16 a2, _BYTE *a3);
int __fastcall TLoadFileASync1(unsigned __int16, unsigned __int16, int, int);
int __fastcall CreateAudioCDTask(unsigned __int16 a1, unsigned __int16 a2, int a3, int a4);
int __fastcall PrepareReadTask(unsigned __int16, unsigned __int16, int, int);
int __fastcall TGetFileSize(unsigned __int16 a1, unsigned __int16 a2);
void nullsub_1();
void __fastcall CopyFromRamBuffer(int a1, int a2, int a3);
void __fastcall CalculateSectorCount(int a1, int a2, int a3);
BOOL __fastcall ExtractFileSections(unsigned __int16 type, unsigned __int16 id, int *ptr);
int sub_80018960();
__int16 *__fastcall LoadFileByIndex(unsigned __int16 res_type, char *v1);
BOOL InitDialogueFiles();
__int16 *loadTIM();
void InitEventSystem();
void sub_80019128();
int sub_80019198();
unsigned int GameActionMenu();
int sub_80019998();
int ShowUseMenu();
int __fastcall GetInventoryItems(int InventoryCounts, ItemEntry *out_buffer, _BYTE *out_counts, _BYTE *out_ids, int start_id, int end_id);
int __fastcall CollectEquippableItems(__int8 *unlock_flags, ItemEntry *out_items, _BYTE *out_slot_counts, _BYTE *out_item_ids, int start_id, int end_id);
int __fastcall sub_80019F94(int a1, int *a2, _BYTE *a3, _BYTE *a4, int a5, int a6);
int __fastcall UseConsumableItem(int item_id);
int sub_8001A35C();
int sub_8001A3C8();
int sub_8001A3F8();
int __fastcall ShowMap(char a1);
int UseMagicMenu();
int __fastcall CollectAvailableSpells(SpellDataEntry *SpellEntryTable, PlayerSpellEntry *out_buffer, _DWORD *out_costs, _BYTE *out_ids, int start_id, int end_id);
int EquipmentMenu();
BOOL __fastcall CollectEquippedItemsData(ItemEntry *out_buffer);
int __fastcall sub_8001AEF4(int a1);
void sub_8001B480();
_BYTE *BuildUnifiedActionMenu__();
int DrawDefAtkStats();
int DropMenu();
int SaveDataMenu();
int sub_8001C068();
int __fastcall sub_8001C3A0(int a1, _BYTE *a2, _DWORD *a3, _BYTE *a4, _DWORD *a5);
BOOL __fastcall RenderStaticMenuBox(int a1, int a2, int a3, int a4, int a5, int a6, int a7, __int16 a8, __int16 a9);
int sub_8001C700();
int OptionsMenu();
int ShowLoadOrNewGameMenu();
void Menu_SelectLanguage();
int sub_8001D214();
int *__fastcall LoadMemCardErrorLabels(int a1);
int *__fastcall InitNoSaveFoundLabels(int a1);
int sub_8001D770();
int __fastcall sub_8001DAF0(int a1);
int __fastcall sub_8001DCD0(int a1);
int *__fastcall InitMenuTextCoords(int pBuffer);
int *__fastcall sub_8001E2B8(int a1);
int *__fastcall sub_8001E480(int a1);
int *__fastcall sub_8001E648(int a1);
int __fastcall sub_8001E810(int a1);
int __fastcall sub_8001E938(int a1);
int *__fastcall sub_8001EA60(int a1, int a2);
BOOL __fastcall sub_8001EDE0(int a1, int a2, int a3, int a4, int a5, int a6, __int16 a7, __int16 a8);
int __fastcall sub_8001EF38(int a1);
int __fastcall BuyItemMenu(int shop_type, unsigned __int8 a2);
int __fastcall CollectBuyData(int inventory_counts, _BYTE *out_quantities, _DWORD *out_prices, unsigned __int8 *item_ids, int start_idx, int count, int shop_type);
int __fastcall SellItemMenu_8001F46C(int a1, unsigned __int8 a2);
int __fastcall CalculateSellPrices(_DWORD *out_prices, unsigned __int8 *item_ids, int start_idx, int count, int shop_type);
int sub_8001F77C();
int sub_8001F9B8();
int sub_8001FD28();
int sub_8001FE98();
int sub_80020158();
int __fastcall sub_80020420(int a1, int a2, _DWORD *a3, _DWORD *a4, _DWORD *a5);
int __fastcall ProcessListNavigation(ListWidget *widget_ptr, int preview_callback, _DWORD *out_confirmed, _DWORD *out_cancelled);
BOOL sub_80020ABC();
BOOL sub_800213E8();
BOOL __fastcall RenderOptionsList(_WORD *a1, _WORD *a2, _BYTE *a3);
int __fastcall ShowEquipmentMenu(ListWidget *widget_ptr, int flags, int slot_id, unsigned __int8 start_idx);
int __fastcall RenderMenuFrame(int menuId, int itemCount, int cursorIndex, int isConfirmed);
void __fastcall RenderItemList(int a1, int a2);
int __fastcall ApplyViewTransforms(_WORD *a1, _WORD *a2, int a3, int a4);
int __fastcall Update3dPreview(unsigned __int8 a1);
int __fastcall sub_800234CC(int a1);
int __fastcall DrawUiFrame(ListItemStyle *visuals, UiFrameStyle *style);
int __fastcall sub_80023AE8(int a1, _WORD *a2);
int __fastcall sub_80023C94(int a1, _WORD *a2);
int __fastcall DrawUiText(_WORD *a1, UiFrameStyle *a2);
int __fastcall sub_80023FD4(int a1, int a2);
BOOL __fastcall DrawTexturedQuad(int a1, int a2, int a3, int a4, __int16 a5, __int16 a6);
void nullsub_2();
int SwapGpuCommandBuffers();
int FlushGpuCommands();
int SetupMenuUIBuffers();
int __fastcall Music_UpdateState(int a1);
int GPU_Cmd_SetupFlatGrayQuad();
int __fastcall GPU_Cmd_FinalizeAndAdvance(int a1);
int __fastcall InitListWidget(ListWidget *widget_ptr, int menu_type, int style_id);
int __fastcall ListNavigating(unsigned __int8 *a1, unsigned __int8 a2);
int __fastcall FormatNumberForUI(int stat, int a2, int a3, int a4, _BYTE *a5);
int __fastcall Draw3dPreview(unsigned __int8 item_id);
int Flush3dRender();
int __fastcall PlaySfx(int a1);
int ReadPadWithFlag();
BOOL WaitForInputStable();
int WaitForButtonRelease();
void InitBiosEvents();
void MemCard_InitSystem();
void sub_80025064();
int MemCard_CheckSlot();
BOOL __fastcall MemCard_ScanForSaves(_DWORD *a1, _DWORD *a2);
int __fastcall sub_8002536C(int a1, _DWORD *a2, _DWORD *a3, _DWORD *a4);
BOOL sub_800255B0();
int __fastcall sub_800255E0(char a1);
int __fastcall sub_80025700(int a1);
BOOL __fastcall sub_80025C3C(int a1, char a2);
int __fastcall sub_80025D40(unsigned __int8 *a1);
int sub_80025D64();
void sub_80025DE0();
int Player_CheckHeadroom();
int __fastcall sub_80025EDC(int a1, int a2, int a3, int a4, int a5);
int FinalizePlayerInit();
int LoadSave();
int __fastcall sub_800260BC(unsigned __int8 a1, unsigned __int8 a2, unsigned __int8 a3, unsigned __int8 a4, unsigned __int8 a5, int a6);
int __fastcall sub_800262C0(int a1, int a2);
int __fastcall sub_80026314(int a1);
BOOL CalculatePlayerStats();
BOOL __fastcall sub_80026AE4(int a1, __int16 a2);
BOOL __fastcall sub_80026B7C(int a1, __int16 a2);
int __fastcall sub_80026C14(__int16 a1);
int __fastcall sub_80026E38(int a1, int a2, int a3);
int __fastcall sub_80026EE0(int a1);
int __fastcall sub_80026F34(_DWORD *a1, int a2, char a3);
int __fastcall sub_80027280(char a1);
int __fastcall ApplyStatusEffect(unsigned __int16 a1, unsigned __int16 a2, unsigned __int16 a3, char a4, unsigned __int16 a5, unsigned __int16 a6, unsigned __int16 a7, unsigned __int16 a8, unsigned __int16 a9, unsigned __int16 a10, unsigned __int16 a11, _DWORD *a12);
int __fastcall sub_80027700(int *a1, int a2, signed int a3, int a4, unsigned __int16 a5, unsigned __int16 a6, unsigned __int16 a7, unsigned __int16 a8, char a9, unsigned __int16 a10, unsigned __int16 a11, unsigned __int16 a12, unsigned __int16 a13, unsigned __int16 a14, __int16 a15, unsigned __int16 a16);
int __fastcall GatherCameraContext(_DWORD *a1, _WORD *a2);
int ResetPlayerBuffers();
int InitPlayerStats();
int PlayerSetDefault();
int Player_ResetMovement();
int Player_Spawn();
int __fastcall sub_80027D54(int *a1, __int16 a2, signed int a3, int a4);
int __fastcall sub_80027E20(int a1, int a2, int a3, signed int a4, int a5);
// void __fastcall SsSetAutoKeyOffMode(char a1);
int __fastcall sub_80027E80(unsigned __int8 a1);
int __fastcall sub_80027EA8(unsigned __int8 a1);
BOOL __fastcall sub_80027ED0(char a1, char a2);
BOOL __fastcall sub_8002810C(unsigned __int8 a1);
bool __fastcall MeleeAttack_800281CC(int attack_type);
Entity **__fastcall CalculateTrajectory(__int16 a1, _DWORD *a2, __int16 *a3, int *a4);
void __fastcall SpawnMagicProjectile(int item_id, SVECTOR *vx);
int __fastcall Local2World(int local, SVECTOR *world_pos);
BOOL sub_80028E8C();
void __fastcall CheckHasWeaponMagic(int item_id, int *a2, int a3);
int __fastcall ProcessMeleeAttack(int a1, int a2, unsigned __int8 a3);
int __fastcall TryCastMagic(int spell_id);
int __fastcall sub_80029F08(int a1, int a2);
BOOL sub_8002A338();
int __fastcall sub_8002A398(int a1);
int sub_8002A3DC();
int sub_8002A964();
int sub_8002AC04();
int sub_8002AF20();
BOOL __fastcall IsConsumable(int id);
int ProcessPlayerInput();
int sub_8002B974();
int sub_8002BA60();
int PlayerDoInteract();
void sub_8002BC74();
int __fastcall sub_8002BCDC(char a1);
int __fastcall sub_8002BCF8(int a1);
unsigned __int64 __fastcall sub_8002BED0(unsigned __int8 a1);
__int64 __fastcall sub_8002BF24(__int64 *a1);
int __fastcall sub_8002BF60(_DWORD *a1, _DWORD *a2, __int16 a3);
int __fastcall sub_8002BFF4(_DWORD *a1, _DWORD *a2, __int16 a3);
int __fastcall sub_8002C06C(int *a1);
int sub_8002C0F8();
int __fastcall sub_8002C124(__int16 *a1, _WORD *a2, int a3, int a4);
int __fastcall sub_8002C1E0(int a1);
BOOL __fastcall sub_8002C24C(int a1);
int __fastcall sub_8002C29C(int a1);
int ControllerInput();
int __fastcall ResolveCurrentMetaTile(int a1, int a2, int a3);
int __fastcall Map_CalculatePhysics(__int16 worldX, int currentY, __int16 worldZ, int collisionRadius, int entityHeightPacked);
int __fastcall MAP_CollisionWithTile(int x, int y, int z, int r, int h);
int __fastcall Map_GetCellData(char layer_idx, int X, int Z, int coll_radius, int coll_height);
int __fastcall Map_MarkOccupiedTiles(Vector3 *pos, int a2, int a3, int a4);
int __fastcall CollisionWithTilemap(int a1, int a2, int a3, int a4, int a5);
int sub_8002E394();
int __fastcall sub_8002E4F4(int a1, int a2, int a3, int a4, int a5, char a6);
int PrepareRenderPrimitives();
int PrecomputeCardinalOrientations();
int __fastcall InterpolateAnimationFrame(char a1, int a2, int a3, int a4);
int __fastcall UpdateEnvironmentTint(char flags, int targetDataPtr, int interpolationFactor);
int __fastcall TriggerLightFlash(unsigned __int8 r, unsigned __int8 g, unsigned __int8 b, int intensity, __int16 factor);
int sub_8002EAFC();
int __fastcall sub_8002EB24(_DWORD *a1, _DWORD *a2, char a3);
unsigned int __fastcall sub_8002ECC0(int a1, unsigned int a2, int a3, unsigned __int8 a4);
int __fastcall sub_8002ED24(unsigned __int8 a1);
int __fastcall sub_8002EDE4(int a1);
int __fastcall sub_8002EF78(int a1, int a2, int a3, int a4, int a5, int a6);
int sub_8002F1C8();
unsigned __int8 *VRAM_FindFreeSlot();
unsigned __int8 *__fastcall VRAM_ReserveTextureSpace(__int16 vram_x, __int16 vram_y, char texture_page, char clut_index, int bpp, int width, __int16 height);
int sub_8002FA5C();
int __fastcall sub_8002FBC0(int a1);
int InitGraphicsSystem();
int sub_8002FD90();
int sub_8002FE74();
int sub_8002FF0C();
int __fastcall sub_8002FFA4(unsigned __int16 a1);
int __fastcall sub_8002FFD4(unsigned __int16 a1);
void __fastcall sub_8002FFF8(int a1);
int __fastcall sub_80030008(unsigned __int16 a1);
int __fastcall sub_80030044(int *, int *);
int __fastcall ConvertVertexCoordinates(int a1);
int __fastcall RegisterAndTransformModel(unsigned __int16 type, int data_ptr);
void __fastcall SetStateCallback(unsigned __int16, int);
int __fastcall sub_80030474(int a1);
int __fastcall sub_800305F4(int a1);
int __fastcall sub_8003073C(int a1);
int __fastcall sub_800307E8(int a1, __int16 a2);
void __fastcall sub_80030894(int a1);
int __fastcall sub_80030924(unsigned __int16 a1, int a2, __int16 a3);
int __fastcall sub_80031034(unsigned __int16 a1, int a2);
int __fastcall sub_8003171C(unsigned __int16 a1, __int16 a2, int a3);
int __fastcall sub_80031CD0(unsigned __int16 a1);
int __fastcall sub_800320BC(int a1, int a2, __int16 a3, __int16 a4, char a5, int a6);
int __fastcall sub_800322FC(unsigned __int16 a1, int a2, int a3);
int *__fastcall sub_80032A1C(int a1, int a2, int a3);
int __fastcall sub_800336D4(unsigned __int8 *a1, int a2, char a3);
int __fastcall sub_800338A0(int a1, int a2, char a3);
int sub_80033A1C();
int UpdateCamera();
unsigned int __fastcall RenderFadeOverlay(__int16 x, __int16 y, __int16 width, int height, char vram_x, char vram_y, char semi_trans, char dither, unsigned __int8 primitive_type, __int16 palette_idx, __int16 clut_addr, char r, char g, char b, int priority);
unsigned int sub_80033DB4();
unsigned int sub_80033E44();
int sub_80033ED4();
void __fastcall SetFadeColor(char a1, char a2, char a3, char a4);
unsigned int sub_80033FBC();
int __fastcall sub_80034100(int a1, int a2, int a3, int a4);
int UpdateTileLighting();
int __fastcall sub_80034304(char a1, unsigned __int16 a2, int *a3, __int16 *a4, __int16 *a5, int *a6, int *a7, unsigned __int16 a8, unsigned __int16 a9, unsigned __int8 a10, __int16 a11, unsigned __int8 a12, int a13);
int __fastcall sub_80034824(unsigned __int16 a1, __int16 *a2, int *a3, unsigned __int16 a4, unsigned __int16 a5, __int16 a6, char a7, __int16 a8);
int __fastcall sub_80034A2C(unsigned __int16 a1);
void __fastcall MOLoadedCallback(int a1);
int __fastcall sub_80034AD4(int *a1);
int __fastcall sub_80034B44(int *a1, int a2);
BOOL __fastcall sub_80034C04(int *a1, int a2, int a3);
unsigned __int8 *__fastcall sub_80034C68(unsigned __int16 a1, unsigned __int16 fileID, int slot);
BOOL __fastcall sub_80034D08(unsigned __int16 a1, int a2, int a3, int a4, unsigned __int8 *a5);
BOOL __fastcall sub_80034DFC(unsigned __int16 a1, int a2, int a3, int a4, unsigned __int8 *a5);
int sub_80034F14();
unsigned int __fastcall sub_80035ADC(int a1, __int16 a2, _BYTE *a3);
int UpdateStatusEffects();
int __fastcall MessageQueuePush(int a1, __int16 a2);
int __fastcall sub_80035D64(int a1, int a2);
int sub_80035D74();
int __fastcall UpdatePlayerSystem(int *a1, int *a2);
int sub_80036428();
int __fastcall RegisterPrimitiveTypes(unsigned __int16 primitive_type, _WORD *a2);
int __fastcall sub_8003654C(unsigned __int16 a1, int a2);
int __fastcall GetPrimitiveBuffer(unsigned __int16 a1);
_WORD *__fastcall sub_800365CC(int a1, int a2, int a3, _DWORD *a4, int *a5);
int __fastcall sub_80036690(_WORD *a1, _WORD *a2, __int16 *a3);
int __fastcall sub_80036754(_WORD *a1, __int16 *a2);
int __fastcall sub_800367D0(_WORD *a1, __int16 *a2, int a3);
__int16 *__fastcall sub_80036A8C(__int16 *a1, int a2);
int __fastcall SubmitDisplayListToGPU(int *a1, int a2, int a3, int a4, int a5);
int __fastcall sub_80036DD8(unsigned __int16 a1, int a2, int a3, int a4, _WORD *a5);
int __fastcall sub_8003706C(int a1, int a2);
int sub_800370CC();
int sub_800370FC();
_DWORD *__fastcall Resource_UnlinkAndFree(ResourceHandle *res);
int sub_80037184();
int sub_800371F4();
_WORD *sub_80037264();
int __fastcall sub_800372AC(_WORD *a1);
int __fastcall ProcessTIMContainer(int a1);
int __fastcall sub_8003744C(int a1, int a2);
int __fastcall sub_800378A0(unsigned __int16 a1, unsigned __int16 a2);
int __fastcall sub_80037A1C(char a1, int a2, int a3, int a4, unsigned __int8 *a5, int a6, int a7);
int __fastcall sub_80037C0C(char a1, int a2, int a3, int a4, int a5, int a6, int a7, int a8, char a9);
int __fastcall sub_80037F78(int a1, __int16 a2);
int InitProjectileSystem();
int __fastcall InitProjectileInstance(int a1);
int __fastcall sub_8003804C(int a1, int a2, unsigned __int16 a3);
int __fastcall sub_80038120(int a1, int a2, char a3);
int __fastcall sub_80038214(int a1);
int __fastcall sub_8003830C(int a1);
int __fastcall sub_80038AF0(int a1, int a2, int a3, int a4, int a5);
int __fastcall FindInteractableInCone(int id, VECTOR *pos, int radius, int height, __int16 param1, __int16 param2);
int __fastcall SetProjectileModel(Projectile *a1, char a2);
Entity **__fastcall FindFreeOrOldestProjectileSlot(int a1, int a2, int a3);
int __fastcall SpawnProjectile(char a1, unsigned __int8 a2, _DWORD *a3, int a4);
int __fastcall sub_80039068(__int16 a1, _DWORD *a2, int a3);
int __fastcall sub_80039190(int a1);
int __fastcall sub_80039348(int a1, int a2);
int __fastcall sub_80039448(int a1, int a2, _DWORD *a3);
int __fastcall sub_8003955C(int a1, int a2, int a3, int a4, int a5);
int __fastcall sub_800395EC(int a1, int a2, int a3, int a4, int a5, int a6);
int __fastcall FadeScreenIn(unsigned __int8 a1, int a2, int a3, int a4);
int __fastcall RenderScene(int, int, int);
unsigned __int8 *sub_8003B748();
int __fastcall Entity_UpdatePhysics(Entity *e);
int __fastcall Entity_LoadStats(Entity *e);
int __fastcall Entity_EnterCombatState(Entity *e);
int __fastcall sub_8003B984(int a1);
int sub_8003B9A8();
int __fastcall Entity_Alert(#15 *e);
BOOL InitEntitySystem();
int __fastcall sub_8003BB60(int a1, unsigned __int8 *a2);
int __fastcall sub_8003BB98(Action *action, int distance);
int __fastcall Entity_SelectAction(int a1);
int Entity_UpdateAIByDistance();
unsigned __int8 *__fastcall sub_8003C184(int a1, unsigned __int8 a2);
int __fastcall sub_8003C1CC(int a1, unsigned __int8 a2);
int sub_8003C220();
int __fastcall sub_8003C250(unsigned __int8 a1);
int __fastcall sub_8003C27C(unsigned __int8 a1);
unsigned int Entity_UpdateDetection();
int __fastcall sub_8003C69C(int a1, int a2, int a3);
int __fastcall ApplyDamage(unsigned __int16 entity_id, unsigned __int16 unk_8019B4EC, unsigned __int16 AttackStrike, unsigned __int16 AttackSlash, unsigned __int16 AttackPierce, unsigned __int16 AttackWhiteMagic, unsigned __int16 AttackFire, unsigned __int16 AttackEarth, unsigned __int16 AttackWind, unsigned __int16 AttackWater, unsigned __int16 damage_multiply, char unk_val17, _DWORD *hit_pos);
BOOL __fastcall sub_8003CD9C(_DWORD *a1, int a2, int a3, int a4, unsigned __int16 a5, unsigned __int16 a6, unsigned __int16 a7, unsigned __int16 a8, unsigned __int16 a9, unsigned __int16 a10, unsigned __int16 a11, unsigned __int16 a12, unsigned __int16 a13, unsigned __int16 a14, __int16 a15, char a16);
int __fastcall sub_8003D090(int a1, int a2, int a3, __int16 a4, unsigned __int16 a5, unsigned __int16 a6, unsigned __int16 a7, char a8);
Entity **__fastcall sub_8003D200(int *a1, __int16 a2, __int16 a3, int a4, int a5, int a6, int *a7, int a8);
int __fastcall Entity_CheckWorldCollision(int x, int y, int z, int radius, int max_dist);
int __fastcall sub_8003D5EC(int a1, int a2, int a3, int a4, int a5);
EntityDefinition **__fastcall Entity_SetContext(#15 *e);
int __fastcall sub_8003D824(int a1, __int16 a2);
int __fastcall sub_8003D858(int a1, __int16 a2);
BOOL __fastcall sub_8003D8B4(int a1, unsigned __int16 a2);
int __fastcall sub_8003D8E4(__int16 *a1, char a2);
int __fastcall sub_8003DDB0(__int16 *a1);
int __fastcall sub_8003DF98(int a1, int a2, int a3, int a4, int a5, int a6);
int sub_8003E038();
int UpdateObjectVerticalMovement();
int __fastcall sub_8003E414(int a1, char a2);
int __fastcall sub_8003E540(__int16 a1, __int16 a2, __int16 a3, char a4);
int __fastcall sub_8003E608(int a1, __int16 a2, int a3, __int16 a4);
int __fastcall sub_8003E75C(__int16 a1, __int16 a2, int a3, __int16 a4, __int16 a5, char a6);
int __fastcall sub_8003E7D0(int a1, int a2, __int16 a3, int a4, __int16 a5, __int16 a6, __int16 a7, char a8);
int __fastcall sub_8003E8E8(_WORD *a1, __int16 a2, __int16 a3, char a4);
int __fastcall sub_8003EA30(__int16 *a1, __int16 a2, int a3, __int16 a4, __int16 a5, char a6);
int __fastcall sub_8003EAC0(int a1, int a2, int a3);
int __fastcall sub_8003EBC0(int a1, _DWORD *a2);
int __fastcall sub_8003ECE8(int a1, int a2, int a3, int a4, int a5, int a6);
int __fastcall sub_8003EEB0(int a1, int *a2, int a3, _DWORD *a4, __int16 *a5, __int16 a6, __int16 a7, int a8);
int sub_8003F0F4(int a1, char a2, ...);
int __fastcall sub_8003FAE8(int a1);
int __fastcall sub_8003FB58(int a1);
int UpdateEnemyAI();
EntityDefinition **Entities_UpdateAll();
int sub_80042244();
int __fastcall sub_800422B8(int a1);
int __fastcall PlayEntitySound(Entity *e, __int16 sound_id);
int __fastcall sub_800424C8(int *a1, int a2, __int16 a3);
int __fastcall sub_800425A0(int a1, char a2, unsigned __int16 a3, unsigned __int16 a4, unsigned __int8 a5, unsigned __int16 a6, unsigned __int16 a7, unsigned __int16 a8, char a9, unsigned __int16 a10, unsigned __int16 a11, unsigned __int16 a12, unsigned __int16 a13, unsigned __int16 a14, _DWORD *a15);
int __fastcall sub_800427C8(_BYTE *a1);
int __fastcall sub_800427EC(int a1, unsigned __int16 a2, _DWORD *a3);
int __fastcall sub_800428D0(int a1);
int __fastcall sub_80042938(int *a1, int a2, signed int a3, int a4, unsigned __int16 a5, __int16 a6);
int __fastcall sub_80042AEC(int a1, int a2, int a3, __int16 *a4);
int __fastcall sub_80042BD4(_DWORD *a1, int a2, _DWORD *a3, __int16 *a4);
unsigned __int8 *AllocateParticleSlot();
int __fastcall SetupEntityAnimation(Entity *e, char a2, __int16 pos);
int __fastcall sub_80042CC8(int a1, char a2);
Entity *__fastcall SpawnParticleEntity(char a1, unsigned __int8 a2, unsigned __int8 a3, _DWORD *a4, _DWORD *a5, int a6, __int16 a7, __int16 a8, __int16 a9, __int16 a10, __int16 a11);
int __fastcall sub_80044184(__int16 a1, signed int a2, int a3, int a4, __int16 *a5);
int __fastcall sub_8004435C(signed int a1, __int16 a2, __int16 a3, int a4, int a5, int a6, __int16 a7, int a8);
int __fastcall sub_80044520(_DWORD *a1, signed int a2, __int16 a3, signed int a4, signed int a5, int a6, int a7);
int __fastcall sub_800446E0(int a1, int a2, int a3, unsigned __int16 a4, int a5);
int __fastcall sub_80044784(int a1, int a2);
int __fastcall sub_80044814(_DWORD *a1, int a2, __int16 a3, int a4);
Entity *__fastcall sub_8004489C(int a1, int a2, int a3, int a4, __int16 a5, __int16 a6, __int16 a7, __int16 a8, int a9, int a10, __int16 *a11, __int16 a12, int a13, __int16 a14);
int __fastcall sub_80044B20(_DWORD *a1, int a2, int a3, int a4, int a5, int a6);
int __fastcall sub_80044C74(int a1, __int16 a2, __int16 a3);
int sub_80044DF8();
int __fastcall sub_80044EC0(int a1, int a2, __int16 a3, __int16 a4);
void __fastcall UpdateParticleEffect(int a1);
BOOL InitParticleSystem();
BOOL __fastcall UpdateParticleSystem(int a1);
int sub_80048768();
int __fastcall sub_8004878C(int a1);
BOOL __fastcall IsFacingFountainTile(VECTOR *pos, SVECTOR *rot);
int __fastcall sub_80048874(__int16 a1, __int16 a2, __int16 a3, __int16 a4, __int16 a5, int a6, __int16 a7, _DWORD *a8);
void __fastcall sub_8004892C(int a1, int *a2, int *a3, __int16 *a4, __int16 *a5, int a6);
int __fastcall sub_800489FC(int a1, char a2, __int16 a3, int a4, unsigned __int16 a5);
int __fastcall sub_80048AB4(int a1, unsigned __int8 a2);
unsigned __int8 *__fastcall sub_80048B10(int a1);
int __fastcall sub_80048C30(int a1);
Entity **__fastcall sub_8004908C(int a1, __int16 a2);
int __fastcall UseItems_80049108(VECTOR *pos, SVECTOR *rot, int item_id);
int __fastcall InventoryRemoveItem(int a1);
int __fastcall InventoryAddItem(int a1, __int16 a2);
int __fastcall sub_80049DE4(int a1, int a2, int a3, int a4, int a5, int a6, int a7);
int __fastcall sub_80049EFC(char *a1, int a2);
int __fastcall Interact_8004A5E4(int *a1, int a2);
int InitPlayerInventory();
int ProcessCurrentMode();
int __fastcall sub_8004AD48(_DWORD *a1);
int __fastcall sub_8004AD98(int a1);
int __fastcall sub_8004AE08(int *a1);
int __fastcall sub_8004AE54(int a1);
unsigned __int8 *__fastcall sub_8004AEC4(int a1);
_DWORD *__fastcall sub_8004B31C(int a1);
__int64 __fastcall sub_8004B694(int a1);
__int64 __fastcall sub_8004BC5C(int a1);
void nullsub_3();
int start();
int __fastcall sub_8004C264(int a1);
int __fastcall sub_8004C358(int a1, int a2);
unsigned int __fastcall sub_8004C500(_DWORD *a1, unsigned int a2);
int AllocateMemor_01();
int __fastcall Mem_FreeBlock(int dataPtr);
// void card_info();
// int __fastcall InitCARD2(_DWORD); weak
// int StopCARD2(void); weak
// int StartCARD2(void); weak
// int __fastcall CdLastCom(_DWORD); weak
// int __fastcall PadStartCom_0(_DWORD, _DWORD); weak
// int __fastcall PadStopCom_0(int);
// int __fastcall CdSyncCallback(int);
// int __fastcall CdReadyCallback(_DWORD); weak
// int __fastcall CdControl(unsigned __int8 a1, char *a2, int a3);
// BOOL __fastcall sub_8004CEBC(int a1, int a2);
// int __fastcall sub_8004CEE0(int a1);
int __fastcall CdCheckStatus(int a1, _BYTE *a2);
int __fastcall CdReadWithRetry(int a1, int a2, int a3);
_BYTE *__fastcall SectorToMSF(int a1, _BYTE *a2);
int sub_8004D148();
int __fastcall InitDmaChannel(int a1);
int __fastcall sub_8004D910(int a1);
int __fastcall sub_8004DBE0(unsigned __int8 a1, char *a2, int a3, int a4);
int __fastcall sub_8004E048(_BYTE *a1);
int sub_8004E0D0();
int sub_8004E1E0();
int sub_8004E2C8();
int sub_8004E3BC();
int sub_8004E42C();
int sub_8004E73C();
int __fastcall SetupDmaTransfer(int a1, int a2, int a3);
int __fastcall CdWaitForCompletion(int a1, _BYTE *a2);
int __fastcall sub_8004EE68(int a1);
int __fastcall sub_8004EFD4(int a1, int a2);
int sub_8004F0C4(); // weak
int __fastcall sub_8004F1A4(int a1);
int sub_8004F310();
void sub_8004F3A0();
void sub_8004F3C8();
void sub_8004F3F0();
int __fastcall sub_8004F418(__int16 a1);
char *__fastcall CdSearchFile(_DWORD *a1, char *a2);
BOOL __fastcall sub_8004F794(int a1, int a2);
int CdCheckISO9660();
int __fastcall sub_8004FAAC(int a1, int a2);
int __fastcall sub_8004FB58(int a1);
BOOL __fastcall CdReadSector(int a1, int a2, int a3);
int __fastcall sub_8004FE80(_BYTE *a1, unsigned __int8 *a2, int a3);
int sub_8004FEB4();
BOOL __fastcall sub_8005082C(_DWORD *a1, int *a2, unsigned int a3);
int __fastcall sub_80050860(int a1, int a2, int a3, int a4, int a5, unsigned __int8 a6);
BOOL __fastcall sub_800509EC(int a1, unsigned int a2);
int sub_80050A2C();
BOOL __fastcall sub_80050B64(_BYTE *a1);
int __fastcall sub_80050C7C(int a1);
int __fastcall sub_800511C4(__int16 *a1, unsigned int a2);
void sub_80051508();
int __fastcall sub_800518A4(int a1, unsigned int a2, unsigned int a3);
unsigned int __fastcall sub_80051B4C(unsigned int a1, unsigned int a2, unsigned int a3);
int __fastcall sub_80051C3C(int a1, unsigned int a2, int a3);
unsigned int __fastcall sub_80051C84(int a1, unsigned int a2);
int __fastcall sub_80051D64(int a1);
void sub_80051E08();
int __fastcall sub_80051E8C(int a1);
int __fastcall sub_80051EB0(unsigned int a1, unsigned int a2, __int16 a3);
BOOL __fastcall sub_8005201C(int a1);
unsigned int __fastcall sub_80052050(unsigned int a1);
int __fastcall sub_8005208C(int a1);
int sub_800520B8();
unsigned int __fastcall sub_800520C8(unsigned int a1, unsigned int a2, unsigned int a3);
int __fastcall sub_80052154(__int16, int, __int16, __int16);
int __fastcall CDAudio_SetVolume(__int16, __int16, __int16);
int __fastcall sub_80052244(int a1);
int sub_80052358();
int sub_80052398();
int sub_800523B8();
int __fastcall SpuVoice_Trigger(int a1, __int16 a2);
int __fastcall Music_PlayTrack(__int16 a1);
int sub_800524D0();
int sub_800524F0();
int __fastcall sub_80052510(int a1);
int __fastcall sub_800525C0(__int16 a1, __int16 a2);
int __fastcall sub_8005267C(__int16 a1);
int __fastcall sub_800526BC(__int16 a1);
int __fastcall sub_800526FC(int *a1);
// int __fastcall spu_setReverbAttr(_DWORD); weak
int __fastcall sub_8005314C(int a1);
// int __fastcall SpuClearReverbWorkArea(_DWORD); weak
int __fastcall sub_80053364(int a1);
// int __fastcall SsVabOpenHead(int a1, __int16 a2);
// int __fastcall SsVabOpenHeadWithMode(int a1, int a2, int a3, int a4);
// int __fastcall SpuMalloc(_DWORD, _DWORD); weak
int sub_80053F00();
int sub_80053F50();
int sub_800541F4();
int __fastcall sub_80054214(int a1);
int __fastcall SetMasterVolume(__int16 left, __int16 right, int unused1, __int16 unused2);
int __fastcall SpuSetCommonAttr(int *, int, int, __int16);
int sub_8005476C();
int __fastcall sub_80054A10(int a1, __int16 a2);
int sub_80054EFC();
int __fastcall sub_80054FD8(int a1, int a2);
int sub_80055088();
int __fastcall sub_800552C0(unsigned __int8 a1);
int __fastcall sub_80055790(unsigned __int8 a1, __int16 a2, __int16 a3);
int __fastcall sub_80055950(unsigned __int8 a1);
int sub_8005599C();
int __fastcall sub_80055A58(__int16 a1, unsigned __int16 a2);
void __fastcall sub_80055D90(__int16 a1, int a2, __int16 a3, int a4);
int __fastcall sub_80055F60(int a1);
void __fastcall sub_80056334(__int16 a1, int a2, __int16 a3, int a4);
int __fastcall sub_80056504(int a1);
int __fastcall sub_800568CC(unsigned __int8 a1);
int __fastcall sub_80056C3C(__int16 a1, __int16 a2, int a3, unsigned __int16 a4);
int __fastcall sub_80056D94(__int16 a1, __int16 a2, __int16 a3, __int16 a4, __int16 a5);
int __fastcall sub_80056FE4(__int16 a1, __int16 a2, __int16 a3, __int16 a4);
int sub_800570D0();
int __fastcall sub_80057484(int a1, __int16 a2, __int16 a3, unsigned __int16 a4, unsigned __int16 a5, char a6);
int __fastcall sub_800579E4(__int16 a1, __int16 a2, __int16 a3, unsigned __int16 a4);
int __fastcall sub_80057C6C(int, __int16, __int16, __int16);
int __fastcall sub_80057DEC(__int16 a1, _WORD *a2, _WORD *a3);
int __fastcall sub_80057F04(__int16 a1);
int __fastcall sub_80057FA0(unsigned __int16 a1, __int16 a2, char a3);
int __fastcall sub_80058120(int a1, signed __int16 a2, __int16 a3, unsigned __int16 a4, unsigned __int8 a5);
int __fastcall SPU_PlayVoice(unsigned __int16 a1, int a2, char a3, __int16 a4, unsigned __int16 a5, __int16 a6, __int16 a7);
int __fastcall sub_80058A90(__int16 a1, __int16 a2, __int16 a3, __int16 a4, __int16 a5);
int __fastcall sub_80059720(int a1, int a2);
// int __fastcall SpuInitMalloc(_DWORD, _DWORD); weak
// int __fastcall sub_80059798(_DWORD, _DWORD, _DWORD, _DWORD); weak
int __fastcall sub_8005984C(unsigned __int16 a1, __int16 a2);
int __fastcall sub_80059920(int a1, __int16 a2, __int16 a3);
int __fastcall SEQ_InitData(int playerID, __int16 vabID, unsigned __int8 *seqData);
int __fastcall SEQ_Open(unsigned __int8 *a1, __int16 a2);
int __fastcall sub_80059EFC(int a1, int a2);
int __fastcall sub_8005A00C(__int16 a1, int a2);
int __fastcall sub_8005A2A4(__int16 a1, __int16 a2, unsigned __int8 a3, unsigned __int8 a4);
int __fastcall sub_8005A388(__int16 a1, __int16 a2, char a3);
int __fastcall sub_8005A400(int a1, __int16 a2, unsigned __int8 a3);
int __fastcall sub_8005A964(int a1, __int16 a2, unsigned __int8 a3);
int __fastcall sub_8005AAB0(__int16 a1, __int16 a2);
int __fastcall sub_8005AB78(int a1, __int16 a2, unsigned __int8 a3);
int __fastcall sub_8005ACA4(__int16 a1, __int16 a2, char a3);
int __fastcall sub_8005ADF0(__int16 a1, __int16 a2, char a3);
int __fastcall sub_8005AE68(__int16 a1, __int16 a2, char a3);
int __fastcall sub_8005AEE0(int a1, __int16 a2, unsigned __int8 a3);
int sub_8005B468(signed __int16 a1, __int16 a2, __int16 a3, ...);
int __fastcall sub_8005B73C(__int16 a1, __int16 a2);
int __fastcall sub_8005B7E8(__int16 a1, __int16 a2, char a3);
int __fastcall sub_8005BB50(int a1, __int16 a2);
unsigned int __fastcall sub_8005BC0C(__int16 a1, unsigned int a2, _WORD *a3);
unsigned int __fastcall sub_8005BC68(unsigned __int16 *a1, _WORD *a2, _WORD *a3);
int __fastcall sub_8005BCF4(signed __int16 a1, __int16 a2, int a3, int a4);
int __fastcall sub_8005BF30(signed __int16 a1, __int16 a2, int a3, int a4);
int sub_8005C0F8();
int __fastcall sub_8005C10C(int a1, __int16 a2);
int __fastcall sub_8005C214(signed __int16 a1, __int16 a2, int a3);
// int SsVmDamperOff(void); weak
int __fastcall sub_8005C32C(__int16 a1, __int16 a2, int a3, __int16 a4);
int __fastcall SEQ_Play(__int16 treckID, unsigned __int8 a2, __int16 a3);
// int __fastcall SsVabTransCompleted(_DWORD); weak
int sub_8005C58C();
int __fastcall sub_8005C634(__int16 a1, __int16 a2);
int __fastcall CDAudio_Stop(__int16 a1);
int sub_8005C7F8();
unsigned int __fastcall sub_8005CA30(__int16 a1, __int16 a2);
unsigned int __fastcall sub_8005CB30(int a1, __int16 a2);
int __fastcall sub_8005CD18(int a1, int a2);
int __fastcall sub_8005CFA8(int a1, __int16 a2);
int __fastcall FreeSPUVoice(unsigned __int16 a1);
// int __fastcall SpuFree(_DWORD); weak
int __fastcall sub_8005D174(unsigned int a1, unsigned __int16 a2);
unsigned int __fastcall sub_8005D23C(unsigned int a1, unsigned int a2, unsigned int a3);
int sub_8005D29C();
int __fastcall sub_8005D34C(__int16 a1, __int16 a2);
int __fastcall SpuVoice_Clear(__int16 a1);
int __fastcall SpuVoice_StopAll(__int16 a1);
int __fastcall sub_8005D538(int a1, int a2);
int __fastcall sub_8005D854(__int16 a1, __int16 a2);
int __fastcall PlayTrack(__int16 a1);
int __fastcall Math_CORDIC_Atan(int);
// int __fastcall SetBackColor(_DWORD, _DWORD, _DWORD); weak
// int __fastcall SetFarColor(_DWORD, _DWORD, _DWORD); weak
void __fastcall sub_8005DB84(int a1, int a2);
void __fastcall sub_8005DB9C(int _$A0);
void __fastcall sub_8005DBA8(int _$A0);
// int __fastcall SetDQB(_DWORD); weak
// unsigned int __fastcall SquareRoot0(int _$A0);
// int __fastcall sub_8005DC50(_DWORD); weak
int *__fastcall sub_8005DCEC(int *a1, unsigned __int16 *a2);
unsigned __int16 *__fastcall sub_8005DDF8(int *a1, unsigned __int16 *a2);
// int __fastcall ApplyMatrix(int *a1, int _$A1, int a3);
// int __fastcall ScaleMatrix(_DWORD, _DWORD); weak
// int __fastcall SetRotMatrix(_DWORD); weak
// int __fastcall SetLightMatrix(_DWORD); weak
// int __fastcall SetColorMatrix(_DWORD); weak
// void __fastcall SetTransMatrix(_DWORD *a1);
int __fastcall sub_8005E1AC(int *a1, int *a2, int *a3, __int16 *a4, __int16 *a5, __int16 *a6, int *a7);
int __fastcall sub_8005E234(int *a1, int *a2, int *a3, int *a4, __int16 *a5, __int16 *a6, __int16 *a7, __int16 *a8, int *a9);
int __fastcall sub_8005E2CC(int *a1, int *a2, int *a3, __int16 *a4, __int16 *a5, __int16 *a6, int *a7);
int __fastcall sub_8005E43C(int *a1, int *a2, int *a3, int *a4, __int16 *a5, __int16 *a6, __int16 *a7, __int16 *a8, int *a9);
int __fastcall sub_8005E5E8(int a1, int *a2);
int __fastcall sub_8005EE1C(int a1, int a2, int a3, int a4, int a5);
int __fastcall sub_8005EF38(int a1, int a2, int a3, int a4, int a5, int a6);
// int __fastcall LoadAverage0(int _$A0, int _$A1, int _$A2, int _$A3);
// int __fastcall LoadAverageShort12(int *a1, int *a2, int _$A2, int _$A3, int *a5);
// int __fastcall LoadAverageByte(_DWORD, _DWORD, _DWORD, _DWORD, _DWORD); weak
int __fastcall sub_8005F2C8(int _$A0, int a2, int a3, _DWORD *a4);
int __fastcall sub_8005F348(int _$A0, int a2, _DWORD *a3);
// int __fastcall DpqColor(_DWORD, _DWORD, _DWORD); weak
// int __fastcall NormalColorDpq(_DWORD, _DWORD, _DWORD, _DWORD); weak
// int __fastcall NormalColorDpq3(_DWORD, _DWORD, _DWORD, _DWORD, _DWORD, _DWORD, _DWORD, _DWORD); weak
// int __fastcall NormalColorCol(_DWORD, _DWORD, _DWORD); weak
// int __fastcall NormalColorCol3(_DWORD, _DWORD, _DWORD, _DWORD, _DWORD, _DWORD, _DWORD); weak
// int __fastcall AverageSZ3(_DWORD, _DWORD, _DWORD); weak
void sub_8005F578();
// int patch_gte(void); weak
// int __fastcall RotMatrix(_DWORD, _DWORD); weak
// int __fastcall FixedSin(int a1);
// int __fastcall sin_1(int a1);
int __fastcall FixedCos(int a1);
// int __fastcall SetFogNear(int a1, int a2);
int *__fastcall sub_800611CC(int *a1, unsigned __int16 *a2, int *a3);
// int __fastcall PadInit(int);
// int PadRead();
// int sub_80061B0C();
// int __fastcall SetVideoMode(int);
// int GsGetWorkBase();
// int ResetCallback();
// int __fastcall InterruptCallback(_DWORD, _DWORD); weak
// int DMACallback();
// int __fastcall VSyncCallback(_DWORD); weak
// int CheckCallback();
// int __fastcall SetIntrMask(__int16 a1);
// int sub_80061CEC(void); weak
int __fastcall sub_8006223C(_DWORD *a1, int a2);
int (__fastcall *sub_80062268())(int a1, int a2);
int sub_800622B8();
int __fastcall sub_8006243C(int a1, int a2);
int __fastcall sub_800624E4(_DWORD *a1, int a2);
int (__fastcall *sub_80062510())(int a1, int a2);
BOOL sub_80062568();
int __fastcall sub_800625E4(int a1, int a2);
int __fastcall sub_80062610(_DWORD *a1, int a2);
// int __fastcall VSync(int a1);
// int __fastcall v_wait(_DWORD, _DWORD); weak
// int __fastcall CloseEvent(_DWORD); weak
// void PAD_dr();
// void EnterCriticalSection();
// void close();
// int __fastcall write(_DWORD, _DWORD, _DWORD); weak
// void EnableEvent();
// int __fastcall erase(_DWORD); weak
// int StopPAD2(void); weak
// void format();
int __fastcall sub_800628B0(unsigned __int16 a1, __int16 a2, __int16 a3);
int __fastcall sub_800629F8(unsigned __int16 a1);
// void DisableEvent();
// void DeliverEvent();
// void ChangeClearPAD();
// int bu_init(void); weak
// int __fastcall nextfile(_DWORD); weak
// void OpenEvent();
// int __fastcall read(_DWORD, _DWORD, _DWORD); weak
// void TestEvent();
// void ExitCriticalSection();
// void open();
void sub_80062B20();
// int __fastcall firstfile2(_DWORD, _DWORD); weak
// int __fastcall memset(_DWORD, _DWORD, _DWORD); weak
// int __fastcall strcat(_DWORD); weak
// int printf(const char *, ...); weak
// int __fastcall strcmp(_DWORD, _DWORD); weak
// int __fastcall strcpy(_DWORD, _DWORD); weak
// int __fastcall strncmp(_DWORD, _DWORD, _DWORD); weak
// int __fastcall rand(_DWORD); weak
// int __fastcall atoi(_DWORD); weak
// void __fastcall __noreturn exit(_DWORD); weak
void sub_80062C20();
int __fastcall ResetGraph(int a1);
int sub_80062FB8();
int sub_80062FC8();
unsigned int __fastcall sub_80063034(int a1);
int __fastcall WaitForDmaComplete(int a1);
int JustReturn2();
int __fastcall ApplyVideoSettings(int a1, unsigned __int8 a2, unsigned __int8 a3, unsigned __int8 a4);
int __fastcall SubmitCdDmaTransfer(int a1, int a2);
int __fastcall GPU_SetTransferRect(int, int);
int __fastcall sub_800633C0(int a1, unsigned __int16 a2, int a3);
unsigned int *__fastcall sub_8006353C(unsigned int *a1, int a2);
int __fastcall QueueGpuDmaTransfer(int a1);
int *__fastcall sub_800636A8(int *a1);
int __fastcall sub_800637A4(int a1);
int __fastcall BuildRenderCommand(RenderCommand *out, RenderPrimitive *prim);
int __fastcall PackMaterialFlags(int a1, int a2, __int16 a3);
unsigned int __fastcall PackVertex10(__int16 a1, __int16 a2);
unsigned int __fastcall PackVertex10B(__int16 a1, __int16 a2);
unsigned int __fastcall PackVertex11(__int16 a1, __int16 a2);
unsigned int __fastcall PackColorPSX(unsigned __int8 *a1);
int __fastcall sub_8006431C(__int16 *a1);
int sub_800643D8();
int __fastcall sub_800643F0(int a1, int a2);
int __fastcall sub_800644D8(_WORD *a1, int a2);
int __fastcall sub_800646F8(int a1, int *a2);
int __fastcall sub_8006494C(int a1, _DWORD *a2);
unsigned int __fastcall sub_80064BE8(unsigned int a1);
int __fastcall sub_80064C14(int a1);
int __fastcall sub_80064C2C(int *a1, int a2);
int __fastcall TriggerGpuDma(int a1);
int __fastcall sub_80064CC8(int a1);
int __fastcall GPU_SafeExecuteWrap(void (__fastcall *a1)(int, int), int a2, int a3);
int __fastcall GPU_SafeExecute(void (__fastcall *gpuFunc)(int, int), int a2, int a3, int a4);
int sub_80065010();
int __fastcall ResetGraph_Internal(char a1);
int __fastcall sub_80065460(int a1);
int SyncVSyncStatus();
int sub_800655DC();
int __fastcall sub_80065748(char a1);
int __fastcall memset_1(_BYTE *a1, char a2, int a3);
// void GPU_cw();
// int __fastcall memcpy(_DWORD, _DWORD, _DWORD); weak
// int __fastcall OpenTIM(int a1);
// int __fastcall ReadTIM(int out_struct);
// unsigned int __fastcall ParseTIMHeader(_DWORD *tim_ptr, _DWORD *out_struct);
// int __fastcall AnalizingTMD(_DWORD *a1, int a2, _DWORD *a3, _DWORD *a4, _DWORD *a5);
// int __fastcall GetTPage(_DWORD, _DWORD, _DWORD, _DWORD); weak
// int __fastcall sub_800670D8(_DWORD, _DWORD); weak
// unsigned int __fastcall GPU_Cmd_MergeParams(unsigned int *src_template, unsigned int *dst_command);
// int __fastcall GPU_Cmd_SetBlendFlag(GpuCommandHeader *cmd, bool enable);
// int __fastcall GPU_Cmd_SetBaseParams(int a1);
// int __fastcall sub_800678F8(int a1, __int16 a2, __int16 a3, __int16 a4, __int16 a5);
int __fastcall sub_800679B8(int a1, __int16 a2, __int16 a3, __int16 a4, __int16 a5);

//-------------------------------------------------------------------------
// Data declarations

_UNKNOWN unk_80000200; // weak
char byte_800102F0; // weak
char byte_800102F8; // weak
char byte_800103F0; // weak
int dword_80011120[2] = { 0, 0 }; // weak
int dword_800679F4[2] = { 4096, 0 }; // weak
int (*off_80067A28[32])() =
{
  &nullsub_5,
  &nullsub_5,
  &nullsub_5,
  &nullsub_5,
  &nullsub_5,
  &nullsub_5,
  &nullsub_5,
  &nullsub_5,
  &nullsub_5,
  &nullsub_5,
  &nullsub_5,
  &nullsub_5,
  &nullsub_5,
  &nullsub_5,
  &nullsub_5,
  &nullsub_5,
  &nullsub_5,
  &nullsub_5,
  &nullsub_5,
  &nullsub_5,
  &nullsub_5,
  &nullsub_5,
  &nullsub_5,
  &nullsub_5,
  &nullsub_5,
  &nullsub_5,
  &nullsub_5,
  &nullsub_5,
  &nullsub_5,
  &nullsub_5,
  &nullsub_5,
  &nullsub_5
}; // weak
int dword_80067AA8[3] = { 2137260061, 240, 917511 }; // weak
int g_GPU_TextBuffer[2] = { 2137260061, 0 }; // weak
int dword_80067AC0[3] = { 2128871452, 8388736, 917518 }; // weak
int dword_80067ACC[3] = { 2141454366, 160, 1572918 }; // weak
int dword_80067AD8[3] = { 2141454366, 2097312, 1572918 }; // weak
ListItemStyle g_GPU_FrameVisuals = { 30, 32676, 0, 0, 124, 24 };
int dword_80067AF0[3] = { 2141454366, 2097152, 1572988 }; // weak
int dword_80067B08[2] = { 2141454366, 4718592 }; // weak
__int16 word_80067B12 = 14; // weak
int dword_80067B20[2] = { 2141454366, 5767168 }; // weak
__int16 word_80067B2A = 14; // weak
int dword_80067B2C[27] =
{
  2141454366,
  7864320,
  2162721,
  2141454366,
  7864360,
  2162716,
  2141454366,
  7864392,
  2162721,
  2141454366,
  10485760,
  1835041,
  2141454366,
  10485800,
  1835036,
  2141454366,
  10485832,
  1835041,
  2141454366,
  12582912,
  2162721,
  2141454366,
  12582952,
  2162716,
  2141454366,
  12582984,
  2162721
}; // weak
UiFrameStyle g_UiStyleTable[] = ;
int dword_80067CCC[7] = { 1245201, 458838, 255, 0, 0, 0, 0 }; // weak
char g_ZoneCameraTable[2] = { '\x1F', '\0' }; // weak
__int16 word_80067CEA[] = { 45 }; // weak
char byte_80067D04[2] = { '\x1F', '\0' }; // weak
__int16 word_80067D06[] = { 71 }; // weak
int dword_80069878[6] = { 370675541, 16712717, 0, 0, 0, 0 }; // weak
int dword_80069968[6] = { 255, 0, 0, 0, 0, 0 }; // weak
char byte_80069980[3] = { '\x02', '\a', '\r' }; // weak
char byte_80069984[3] = { '\0', '\x13', '\x12' }; // weak
char byte_80069988[3] = { '\xFF', '\0', '\0' }; // weak
char byte_8006998C[3] = { '\0', '\0', '\0' }; // weak
char byte_80069990[3] = { '\0', '\0', '\0' }; // weak
char byte_80069994[3] = { '\0', '\0', '\0' }; // weak
int dword_80069998[6] = { 324540757, 2139062143, 16744319, 0, 0, 0 }; // weak
int dword_800699B0[6] = { 22351640, 65328, 0, 0, 0, 0 }; // weak
int dword_800699C8[6] = { 1638407, -16317354, 0, 0, 0, 0 }; // weak
int dword_800699E0[6] = { 219021396, -8454125, 0, 0, 0, 0 }; // weak
int dword_800699F8[6] = { 318919938, 218566997, 65284, 0, 0, 0 }; // weak
int dword_80069A10[6] = { 1671039, 218824719, 16724052, 0, 0, 0 }; // weak
int dword_80069A28[6] = { 2139062143, 167793791, 16723979, 0, 0, 0 }; // weak
int dword_80069A40[6] = { 2139062143, 67927935, 16714582, 0, 0, 0 }; // weak
int dword_80069A58[6] = { 2139062143, 2139051537, 16744319, 0, 0, 0 }; // weak
int dword_80069A70[6] = { 2139062143, 68386687, 16713484, 0, 0, 0 }; // weak
int dword_80069A88[6] = { 2139062143, 1427603327, 16723983, 0, 0, 0 }; // weak
char byte_80069AA0[3] = { 'T', 'U', '\v' }; // weak
char byte_80069AA4[3] = { '\xFF', '\0', '\0' }; // weak
char byte_80069AA8[3] = { '\0', '\0', '\0' }; // weak
char byte_80069AAC[3] = { '\0', '\0', '\0' }; // weak
char byte_80069AB0[3] = { '\0', '\0', '\0' }; // weak
char byte_80069AB4[3] = { '\0', '\0', '\0' }; // weak
int g_MenuLabelTable[6] = { 253329279, 251920725, 176095242, 1477644032, 201333119, 16716561 }; // weak
int dword_80069AD0[6] = { 255, 0, 0, 0, 0, 0 }; // weak
int dword_80069AE8[6] = { 125796223, 1426226948, 117444375, 16744240, 0, 0 }; // weak
int dword_80069B00[6] = { 427786111, 805393679, 251660927, 427759635, 319884288, 255 }; // weak
int dword_80069B18[6] = { 2139062143, 1434387463, 257232915, 219349004, 65295, 0 }; // weak
int dword_80069B30[6] = { 2139062143, 72751187, 276759571, 790357, 974064915, 255 }; // weak
int dword_80069B48[6] = { 2130970495, 391447167, 805765135, 33849137, 176098571, -15528192 }; // weak
int dword_80069B60[6] = { 201333119, 2131563281, 1434387463, 257232915, 219349004, 16723983 }; // weak
int dword_80069B78[6] = { 2139062143, 209650695, 2132281685, 253187330, 2133853952, 255 }; // weak
int dword_80069B90[6] = { 2139062143, 805765206, 2130708351, 319750154, 255, 0 }; // weak
char byte_80069BA8[3] = { '\x7F', '\x7F', '\x7F' }; // weak
char byte_80069BAC[3] = { '\x04', '\x7F', 'T' }; // weak
char byte_80069BB0[3] = { '\t', '\x0F', '\x18' }; // weak
char byte_80069BB4[3] = { '0', '\x7F', '\xFF' }; // weak
char byte_80069BB8[3] = { '\0', '\0', '\0' }; // weak
char byte_80069BBC[3] = { '\0', '\0', '\0' }; // weak
char byte_80069BC0[3] = { '\x7F', '\x7F', '\x7F' }; // weak
char byte_80069BC4[3] = { '\x7F', '\x7F', '\x7F' }; // weak
char byte_80069BC8[3] = { '\x7F', '\x02', 'U' }; // weak
char byte_80069BCC[3] = { '\x0F', '\0', '\a' }; // weak
char byte_80069BD0[3] = { '\0', '\0', '\0' }; // weak
char byte_80069BD4[3] = { '\0', '\0', '\0' }; // weak
int dword_80069BD8[6] = { 2139062143, 1451164679, 1245781, 209661971, 1245700, 255 }; // weak
char byte_80069BF0[3] = { '\x7F', '\x7F', '\x7F' }; // weak
char byte_80069BF4[3] = { '\x7F', '\x7F', '\x7F' }; // weak
char byte_80069BF8[3] = { 'T', '\0', '\t' }; // weak
char byte_80069BFC[3] = { '\x18', 'T', '\n' }; // weak
char byte_80069C00[3] = { '\0', '\0', '\0' }; // weak
char byte_80069C04[3] = { '\0', '\0', '\0' }; // weak
int dword_80069C08[6] = { 255, 0, 0, 0, 0, 0 }; // weak
char byte_80069C38[3] = { '\x7F', '\x7F', '\x7F' }; // weak
char byte_80069C3C[3] = { '\0', '\a', '\a' }; // weak
char byte_80069C40[3] = { '\x04', '\x7F', 'U' }; // weak
char byte_80069C44[3] = { '0', '8', '\xFF' }; // weak
char byte_80069C48[3] = { '\0', '\0', '\0' }; // weak
char byte_80069C4C[3] = { '\0', '\0', '\0' }; // weak
int dword_80069C50[6] = { 67600255, 156568703, 2139062040, 65407, 0, 0 }; // weak
int dword_80069C68[6] = { 1426227071, 2133856023, 2136212563, 319750154, 201333119, 65328 }; // weak
int dword_80069C80[6] = { 319750154, 1670912, 219353356, 190126463, -15663097, 0 }; // weak
int dword_80069C98[6] = { 1245697, 68358657, 22349695, 176100632, 403902208, 2139062143 }; // weak
int dword_80069CB0[6] = { 255, 0, 0, 0, 0, 0 }; // weak
int dword_80069CF8[6] = { 5642367, 16744207, 0, 0, 0, 0 }; // weak
int dword_80069D10[6] = { 1394085759, 65293, 0, 0, 0, 0 }; // weak
int dword_80069D28[6] = { 5642367, 65295, 0, 0, 0, 0 }; // weak
int dword_80069D40[6] = { 724226, 5642367, 65295, 0, 0, 0 }; // weak
int dword_80069D58[6] = { 2131296268, 724226, 65407, 0, 0, 0 }; // weak
int g_ZoneLightTable_Main[6] = { -8454058, 0, 0, 0, 0, 0 }; // weak
int g_ZoneLightTable_Ambient[6] = { -15531001, 0, 0, 0, 0, 0 }; // weak
char byte_80069DA0[3] = { '\a', 'U', '\x01' }; // weak
char byte_80069DA4[3] = { '\0', '\0', '\0' }; // weak
char byte_80069DA8[3] = { '\0', '\0', '\0' }; // weak
char byte_80069DAC[3] = { '\0', '\0', '\0' }; // weak
char byte_80069DB0[] = { '\0' }; // weak
char byte_80069DB1[3] = { '\0', '\0', '\0' }; // weak
int dword_80069DB8[6] = { -16053759, 0, 0, 0, 0, 0 }; // weak
int dword_80069DD0[6] = { -16099327, 0, 0, 0, 0, 0 }; // weak
int dword_80069DE8[6] = { 806836225, 255, 0, 0, 0, 0 }; // weak
int dword_80069E00[6] = { 22304001, 16723983, 0, 0, 0, 0 }; // weak
int dword_80069E18[6] = { 184832895, 818992, -15659767, 0, 0, 0 }; // weak
int dword_80069E30[6] = { 1426675071, 209654279, -13629184, 0, 0, 0 }; // weak
int dword_80069E48[6] = { 201610367, 209654027, 286066944, 255, 0, 0 }; // weak
int dword_80069E60[6] = { 319029631, 209653508, -13629184, 0, 0, 0 }; // weak
int dword_80069E78[6] = { 1448411519, 818944, 2131823881, 255, 0, 0 }; // weak
int dword_80069E90[6] = { 2136347007, -8421505, 0, 0, 0, 0 }; // weak
int dword_80069EA8[6] = { 251942783, 818951, -15659767, 0, 0, 0 }; // weak
char byte_80069EC0[3] = { '\n', '\x0F', '\r' }; // weak
char byte_80069EC4[3] = { '\x13', '\0', '\v' }; // weak
char byte_80069EC8[3] = { '\0', '\0', '\0' }; // weak
char byte_80069ECC[3] = { '\0', '\0', '\0' }; // weak
char byte_80069ED0[3] = { '\0', '\0', '\0' }; // weak
char byte_80069ED4[3] = { '\0', '\0', '\0' }; // weak
char byte_80069ED8[3] = { '\a', 'U', '\f' }; // weak
char byte_80069EDC[3] = { '\x0F', '\x7F', '\xFF' }; // weak
char byte_80069EE0[3] = { '\0', '\0', '\0' }; // weak
char byte_80069EE4[3] = { '\0', '\0', '\0' }; // weak
char byte_80069EE8[3] = { '\0', '\0', '\0' }; // weak
char byte_80069EEC[3] = { '\0', '\0', '\0' }; // weak
ItemEntry g_ItemDataTable[6] =
{
  { 369560842, 16714496, 0, 0, 0, 0 },
  { 1427068170, 67927827, -8421545, 0, 0, 0 },
  { 350223, 209661967, 2139051780, 255, 0, 0 },
  { 806294296, 67196031, 2130728532, 255, 0, 0 },
  { 17061203, 209653077, 324340565, 65328, 0, 0 },
  { 318898259, 2136346368, 2136409100, 65407, 0, 0 }
};
SpellDataEntry g_SpellDataTable[6] =
{
  {
    '\x01',
    'U',
    'V',
    'U',
    '\x19',
    '\0',
    'V',
    '\x7F',
    32639,
    255,
    0,
    0,
    0,
    0,
    0,
    '\0',
    '\0'
  },
  {
    '\n',
    '\0',
    '\f',
    '\x04',
    '\a',
    '\xFF',
    '\0',
    '\0',
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    '\0',
    '\0'
  },
  {
    'T',
    '\x04',
    '\f',
    '\v',
    '\x04',
    '\x13',
    '\x0F',
    '\x11',
    12290,
    255,
    0,
    0,
    0,
    0,
    0,
    '\0',
    '\0'
  },
  {
    '\f',
    '\x04',
    '\x13',
    '\x04',
    'U',
    '\x0F',
    '\xFF',
    '\0',
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    '\0',
    '\0'
  },
  {
    '\x01',
    '\r',
    '\x17',
    '\x0F',
    '\x12',
    '\x7F',
    '\x7F',
    '\x7F',
    32639,
    -129,
    0,
    0,
    0,
    0,
    0,
    '\0',
    '\0'
  },
  {
    '\x02',
    '\a',
    '\x04',
    '\x16',
    '\x7F',
    'S',
    '\x18',
    '\x0F',
    -239,
    0,
    0,
    0,
    0,
    0,
    0,
    '\0',
    '\0'
  }
};
int dword_8006D388[4] = { 16777216, 256, 0, 0 }; // weak
char byte_8006D523 = '\x01'; // weak
int dword_8006D568[20] = { 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0 }; // weak
int dword_8006D5E0[26] = { 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0 }; // weak
int g_ItemBuyPrices[360] =
{
  -1018117296,
  64930640,
  186827600,
  -1018117296,
  -1018117296,
  -1018117296,
  -1018117296,
  -1018117296,
  -1018165466,
  -1018117296,
  -1018117296,
  193331880,
  -1018117296,
  -1018117296,
  -1018117296,
  -1018117296,
  -1018117296,
  51168080,
  -1018117296,
  -1018117296,
  -1018117296,
  222823600,
  -1018117296,
  -1018117296,
  -1018117296,
  -1018117296,
  -1018117296,
  -1018117296,
  -1018117296,
  -1018117296,
  -1018117296,
  -1018117296,
  -1018117296,
  -1018117296,
  -1018117296,
  21021520,
  -1018117296,
  3145751,
  -1018117296,
  -1018117296,
  -1018117296,
  -1018117296,
  -1018117296,
  -1018117296,
  -1018117296,
  -1018117296,
  -1018117296,
  -1018117296,
  -1018117296,
  -1018117296,
  -1018117296,
  -1018117296,
  -1018117296,
  -1018117296,
  -1018117296,
  -1018117296,
  -1018117296,
  -1018117296,
  -1018117296,
  -1018117296,
  11846480,
  -1018166656,
  -1018117296,
  -1018162996,
  -1018117296,
  -1018117296,
  -1018117296,
  -1018117296,
  -1018117296,
  -1018117296,
  13157200,
  -1018166516,
  -1018117296,
  -1018117296,
  62259530,
  -1018117296,
  -1018117296,
  54395030,
  -1018117296,
  -1018117296,
  17744720,
  255640400,
  -1018117296,
  22987600,
  262145800,
  -1018117296,
  -1018117296,
  -1018117296,
  -1018117296,
  -1018117296,
  -1018117296,
  -1018117296,
  -1018117296,
  -1018117296,
  -1018117296,
  21676880,
  1159987850,
  2621460,
  -1018117296,
  -1018117296,
  -1018117296,
  -1018117296,
  -1018117296,
  -1018117296,
  -1018117296,
  -1018117296,
  -1018117296,
  -1018117296,
  -1018117296,
  -1018117296,
  -1018117296,
  -1018117296,
  -1018117296,
  -1018117296,
  -1018117296,
  -1018117296,
  -1018117296,
  -1018117296,
  -1018117296,
  -1018117296,
  -1018117296,
  -1018117296,
  -1018117296,
  -1018117296,
  -1018117296,
  -1018117296,
  -1018117296,
  -1018117296,
  -1018117296,
  -1018117296,
  -1018117296,
  -1018117296,
  -1018117296,
  -1018117296,
  -1018117296,
  -1018117296,
  -1018117296,
  -1018167116,
  -1018164916,
  -1018117296,
  -1018117296,
  -1018117296,
  -1018117296,
  -1018117296,
  -1018117296,
  -1018117296,
  -1018117296,
  -1018117296,
  -1018117296,
  -1018159046,
  -1018117296,
  -1018117296,
  -1018117296,
  -1018117296,
  -1018160996,
  -1018117296,
  -1018117296,
  2162706,
  -1018117296,
  -1018117296,
  -1018117296,
  -1018117296,
  -1018117296,
  -1018162496,
  -1018117296,
  -1018117296,
  -1018117296,
  -1018117296,
  -1018117296,
  -1018117296,
  -1018117296,
  -1018117296,
  -1018117296,
  -1018117296,
  -1018117296,
  -1018117296,
  -1018117296,
  -1018117296,
  -1018117296,
  -1018117296,
  -1018117296,
  -1018117296,
  213042000,
  -1018117296,
  -1018117296,
  -1018117296,
  -1018117296,
  -1018117296,
  -1018165276,
  -1018117296,
  -1018117296,
  235979600,
  -1018117296,
  -1018117296,
  -1018117296,
  -1018117296,
  -1018117296,
  65586000,
  1297662800,
  -1018117296,
  -1018117296,
  222872400,
  -1018117296,
  -1018117296,
  275252800,
  1559806800,
  -1018117296,
  -1018117296,
  -1018117296,
  -1018117296,
  -1018117296,
  -1018117296,
  -1018117296,
  -1018117296,
  -1018117296,
  -1018117296,
  -1018117296,
  3407900,
  -1018164496,
  -1018117296,
  -1018117296,
  -1018117296,
  -1018152296,
  183550800,
  -1018117296,
  -1018117296,
  -1018117296,
  -1018117296,
  -1018117296,
  -1018117296,
  -1018117296,
  -1018117296,
  -1018117296,
  -1018117296,
  -1018117296,
  -1018117296,
  -1018117296,
  -1018117296,
  -1018117296,
  -1018117296,
  -1018117296,
  -1018117296,
  -1018117296,
  -1018117296,
  -1018117296,
  -1018117296,
  -1018117296,
  -1018117296,
  -1018117296,
  -1018117296,
  -1018117296,
  -1018117296,
  -1018117296,
  -1018117296,
  -1018117296,
  -1018117296,
  -1018117296,
  -1018117296,
  -1018117296,
  -1018117296,
  -1018117296,
  -1018117296,
  -1018117296,
  -1018117296,
  -1018117296,
  -1018117296,
  -1018117296,
  -1018117296,
  -1018117296,
  -1018117296,
  -1018117296,
  -1018117296,
  -1018117296,
  -1018117296,
  -1018117296,
  -1018117296,
  -1018117296,
  -1018117296,
  -1018117296,
  -1018117296,
  -1018117296,
  -1018167294,
  -1018117296,
  -1018117296,
  -1018117296,
  -1018117296,
  -1018117296,
  -1018117296,
  -1018117296,
  -1018117296,
  -1018117296,
  -1018117296,
  -1018117296,
  -1018117296,
  -1018117296,
  -1018117296,
  -1018117296,
  -1018117296,
  115536,
  -1018117296,
  -1018117296,
  -1018117296,
  -1018117296,
  -1018117296,
  -1018117296,
  -1018117296,
  -1018117296,
  -1018117296,
  -1018117296,
  -1018117296,
  -1018117296,
  -1018117296,
  -1018117296,
  -1018117296,
  -1018117296,
  -1018117296,
  -1018117296,
  -1018117296,
  -1018117296,
  -1018117296,
  -1018117296,
  -1018117296,
  -1018117296,
  -1018117296,
  -1018117296,
  -1018117296,
  -1018117296,
  -1018117296,
  -1018117296,
  -1018117296,
  -1018117296,
  -1018117296,
  -1018117296,
  -1018117296,
  -1018117296,
  -1018117296,
  -1018117296,
  -1018117296,
  -1018117296,
  -1018117296,
  -1018117296,
  -1018117296,
  -1018117296,
  -1018117296,
  -1018117296,
  -1018117296,
  -1018117296,
  -1018117296,
  -1018117296,
  -1018117296,
  -1018117296,
  -1018117296,
  -1018117296,
  100278430,
  -1018153796,
  -1018117296,
  -1018117296,
  -1018117296,
  -1018117296,
  -1018117296
}; // weak
int g_ItemSellPriceTable[10] =
{
  7864390,
  49152520,
  137627600,
  2700,
  884736000,
  851980800,
  1703951000,
  1966108500,
  183502550,
  0
}; // weak
int dword_8006DFB8[49] =
{
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0
}; // weak
int dword_8006E0B8[8] =
{
  1753377410,
  1719823746,
  1921148545,
  1703035009,
  1686268034,
  1669491586,
  1350713473,
  1082227841
}; // weak
char byte_8006E0D8[3] = { '\x81', '@', '\x82' }; // weak
char byte_8006E0DC[3] = { '\x82', 'w', '\x82' }; // weak
char byte_8006E0E0[3] = { '\x81', '@', '\x81' }; // weak
char byte_8006E0E4[3] = { '\x81', '@', '\x81' }; // weak
char byte_8006E0E8[3] = { '\x81', '@', '\x81' }; // weak
char byte_8006E0EC[3] = { '\x81', '@', '\x82' }; // weak
char byte_8006E0F0[3] = { '\x82', 'u', '\x81' }; // weak
char byte_8006E0F4[3] = { '\x81', '@', '\0' }; // weak
int dword_8006E1E0[8] = { 64536, 3014656, 63536, 3078192, 1000, 3014656, 2000, 3078192 }; // weak
int dword_8006E200[8] = { -26149264, 200, 26279536, 200, -26214000, 200, 26214800, 200 }; // weak
int dword_8006E220[3] = { 1111238695, 673666644, 1448362556 }; // weak
int dword_8006E22C[3] = { 1056964863, 65280, 63 }; // weak
char byte_8006E238 = '\0'; // weak
char byte_8006E239 = '\0'; // weak
char byte_8006E23A = '\0'; // weak
char byte_8006E24A = '\0'; // weak
char byte_8006E24B = '\0'; // weak
char byte_8006E24C = '\0'; // weak
char byte_8006E25C = '\0'; // weak
char byte_8006E26E = '\0'; // weak
char byte_8006E280 = '\0'; // weak
char byte_8006E292 = '\0'; // weak
char byte_8006E2B8 = '\x01'; // weak
char algn_8006E2BC[4] = { '\0', '\0', '\0', '\0' }; // weak
__int16 word_8006E2D0 = 0; // weak
__int16 word_8006E2D2 = 0; // weak
char byte_8006E2DC = '\x01'; // weak
char byte_8006E300 = '\x01'; // weak
char byte_8006E324 = '\x01'; // weak
__int16 word_8006E328 = 3; // weak
char byte_8006E348 = '\x01'; // weak
__int16 word_8006E34C = 3; // weak
char byte_8006E36C = '\x01'; // weak
__int16 word_8006E370 = 3; // weak
char byte_8006E390 = '\x01'; // weak
__int16 word_8006E394 = 3; // weak
char byte_8006E3B4 = '\x01'; // weak
__int16 word_8006E3B8 = 3; // weak
char byte_8006E3D8 = '\x01'; // weak
__int16 word_8006E3DC = 3; // weak
char byte_8006E3FC = '\x01'; // weak
__int16 word_8006E404 = 64; // weak
char byte_8006E420 = '\x01'; // weak
__int16 word_8006E428 = 64; // weak
char byte_8006E444 = '\x01'; // weak
char byte_8006E468 = '\x01'; // weak
char byte_8006E48C = '\x01'; // weak
int g_PrimitiveTable[10] = { 0, 0, 0, 0, 0, 0, 0, 0, 0, 0 }; // weak
__int16 word_8006E50E = 0; // weak
int dword_8006F2A4[7] = { 1280, -81725664, 85985568, 75500160, -81723616, 85983520, -75432064 }; // weak
int dword_8006F2C0[33] =
{
  18088193,
  -16881304,
  16842752,
  1768423700,
  16776958,
  -1,
  -1,
  1795227648,
  1768423700,
  65278,
  18115329,
  -16881304,
  -65281,
  -1,
  65535,
  387252481,
  -16881304,
  16842752,
  1768429333,
  16776958,
  -1,
  -1,
  1795227648,
  1768429333,
  65278,
  387279617,
  -16881304,
  -65281,
  -1,
  65535,
  1572864,
  -16864342,
  0
}; // weak
int dword_8006F3B0[8] = { -511, -452, -33488896, -29556737, 16777215, -1, -1, 0 }; // weak
int dword_8006F3D0[2] = { 168364039, 255 }; // weak
int dword_8006F3D8[2] = { 218107662, 255 }; // weak
int dword_8006F3E0[2] = { 50462992, 255 }; // weak
int dword_8006F3E8[2] = { 100995332, 255 }; // weak
int dword_8006F3F0[2] = { 202052370, 255 }; // weak
int dword_8006F478 = 0; // weak
int dword_8006F47C = 0; // weak
int dword_8006F488 = 0; // weak
int dword_8006F48C = 0; // weak
int dword_8006F490 = 0; // weak
char byte_8006F494[] = { '\x02' }; // weak
char byte_8006F498 = '\0'; // weak
char byte_8006F499 = '\0'; // weak
int dword_8006F5BC[3] = { 0, 0, 0 }; // weak
int dword_8006F6BC[2] = { 0, 0 }; // weak
char byte_8006F754 = '\0'; // weak
char byte_8006F755 = '\0'; // weak
char byte_8006F756 = '\0'; // weak
int g_DmaChannel = 0; // weak
int g_DmaSource = 0; // weak
int g_DmaDest = 0; // weak
int g_DmaBlockCount = 0; // weak
int g_DmaBlockSize = 0; // weak
int dword_8006F770 = 0; // weak
int dword_8006F774 = 0; // weak
int g_DmaReadCount = 0; // weak
int g_DmaErrorFlags = 0; // weak
_UNKNOWN off_8006F788; // weak
int dword_8006F7B4 = 0; // weak
int dword_8006F7B8 = -1; // weak
int dword_8006F804 = 0; // weak
int dword_8006F82C = 0; // weak
__int16 word_8006F830 = 0; // weak
int dword_8006F84C = 0; // weak
int dword_8006F850 = 0; // weak
int dword_8006F854 = 2; // weak
int dword_8006F858 = 3; // weak
int dword_8006F85C = 8; // weak
int dword_8006F860 = 7; // weak
int dword_8006F864 = 1; // weak
int dword_8006F868 = 0; // weak
int dword_8006F86C = 0; // weak
int dword_8006F870[4] = { 117901063, 117901063, 117901063, 117901063 }; // weak
int dword_8006F880 = 0; // weak
int dword_8006F884 = 0; // weak
int dword_8006F888 = 0; // weak
int dword_8006F88C = 0; // weak
int dword_8006F890 = 0; // weak
int dword_8006F894 = 0; // weak
int dword_8006F898 = 0; // weak
int dword_8006F8A0 = 0; // weak
__int16 word_8006F8A4 = 0; // weak
__int16 word_8006F8A6 = 0; // weak
int dword_8006F8A8 = 0; // weak
int dword_8006F8AC = 0; // weak
int dword_8006F8B0 = 0; // weak
int dword_8006F8E4 = 0; // weak
int dword_8006F8E8 = 0; // weak
int dword_8006FCEC = 0; // weak
int dword_8006FCF0[] = { 65534 }; // weak
int dword_8006FD40[18] = { 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0 }; // weak
int dword_8006FFE8 = 0; // weak
__int16 word_8006FFEC = -1; // weak
int dword_8006FFF0 = 0; // weak
int dword_80070000[8] = { 1073692671, 0, 0, 0, 0, 0, 0, 0 }; // weak
int dword_8007002C = 60; // weak
int dword_80070030 = 1; // weak
int dword_80070038 = 0; // weak
char byte_8007003C = '\0'; // weak
char byte_8007003D = '\0'; // weak
char byte_8007003E = '\xFF'; // weak
int dword_80070040 = 0; // weak
int dword_80070048[97] =
{
  269357056,
  271323165,
  273289275,
  275255385,
  277287032,
  279253142,
  281284789,
  283316436,
  285413619,
  287445267,
  289542450,
  291639634,
  293736818,
  295899539,
  298062259,
  300224980,
  302387701,
  304550422,
  306778680,
  309006938,
  311235196,
  313463454,
  315757249,
  318051043,
  320344838,
  322704170,
  324997965,
  327357297,
  329716629,
  332141498,
  334566366,
  336991235,
  339416104,
  341840974,
  344331379,
  346821785,
  349377727,
  351868134,
  354424077,
  356980020,
  359601499,
  362222979,
  364844459,
  367465939,
  370152955,
  372774436,
  375526989,
  378214006,
  380966560,
  383719114,
  386537204,
  389289759,
  392107850,
  394991477,
  397809569,
  400693196,
  403642361,
  406525989,
  409475154,
  412489855,
  415439020,
  418453722,
  421468424,
  424548663,
  427628901,
  430709141,
  433854916,
  437000692,
  440146468,
  443357781,
  446569093,
  449780407,
  453057256,
  456334106,
  459676492,
  462953343,
  466361266,
  469703653,
  473111577,
  476519501,
  479992962,
  483466423,
  487005420,
  490544418,
  494083416,
  497622414,
  501226949,
  504897020,
  508567092,
  512237164,
  515972772,
  519708381,
  523443990,
  527245136,
  531046282,
  534912965,
  8192
}; // weak
int g_CORDIC_AtanTable[12] = { 511, 302, 159, 81, 41, 20, 10, 5, 3, 1, 0, 0 }; // weak
int dword_8007037C = 0; // weak
int dword_80072B8C[512] =
{
  -189467472,
  -189139797,
  -188877657,
  -188549982,
  -188287842,
  -188025702,
  -187698027,
  -187435887,
  -187108212,
  -186846072,
  -186518396,
  -186256257,
  -185928581,
  -185600905,
  -185338766,
  -185011090,
  -184748951,
  -184421275,
  -184159135,
  -183831459,
  -183569320,
  -183241644,
  -182913968,
  -182651829,
  -182324153,
  -182062013,
  -181734337,
  -181406662,
  -181144522,
  -180816846,
  -180489170,
  -180227031,
  -179899355,
  -179571679,
  -179309539,
  -178981864,
  -178654188,
  -178392048,
  -178064372,
  -177736696,
  -177474556,
  -177146881,
  -176819205,
  -176491529,
  -176229389,
  -175901713,
  -175574037,
  -175246361,
  -174984222,
  -174656546,
  -174328870,
  -174001194,
  -173739054,
  -173411378,
  -173083702,
  -172756026,
  -172428350,
  -172166210,
  -171838534,
  -171510858,
  -171183182,
  -170855506,
  -170527830,
  -170200154,
  -169938014,
  -169610338,
  -169282662,
  -168954986,
  -168627310,
  -168299634,
  -167971958,
  -167644282,
  -167382142,
  -167054466,
  -166726790,
  -166399114,
  -166071438,
  -165743761,
  -165416085,
  -165088409,
  -164760733,
  -164433057,
  -164105381,
  -163777705,
  -163450028,
  -163122352,
  -162794676,
  -162467000,
  -162139324,
  -161811648,
  -161483971,
  -161156295,
  -160828619,
  -160500943,
  -160173266,
  -159845590,
  -159517914,
  -159190238,
  -158862561,
  -158534885,
  -158207209,
  -157879533,
  -157551856,
  -157158644,
  -156830968,
  -156503291,
  -156175615,
  -155847939,
  -155520262,
  -155192586,
  -154864910,
  -154537233,
  -154144021,
  -153816344,
  -153488668,
  -153160992,
  -152833315,
  -152505639,
  -152112426,
  -151784750,
  -151457074,
  -151129397,
  -150801721,
  -150408508,
  -150080832,
  -149753155,
  -149425479,
  -149097802,
  -148704590,
  -148376913,
  -148049237,
  -147721560,
  -147328348,
  -147000671,
  -146672994,
  -146345318,
  -145952105,
  -145624429,
  -145296752,
  -144969076,
  -144575863,
  -144248186,
  -143920510,
  -143527297,
  -143199621,
  -142871944,
  -142478731,
  -142151055,
  -141823378,
  -141430165,
  -141102489,
  -140774812,
  -140381599,
  -140053922,
  -139726246,
  -139333033,
  -139005356,
  -138677680,
  -138284467,
  -137956790,
  -137563577,
  -137235900,
  -136908224,
  -136515011,
  -136187334,
  -135794121,
  -135466444,
  -135073232,
  -134745555,
  -134417878,
  -134024665,
  -133696988,
  -133303775,
  -132976099,
  -132582886,
  -132255209,
  -131861996,
  -131534319,
  -131141106,
  -130813429,
  -130485752,
  -130092539,
  -129764862,
  -129371649,
  -129043972,
  -128650759,
  -128257546,
  -127929869,
  -127536656,
  -127208979,
  -126815766,
  -126488089,
  -126094876,
  -125767199,
  -125373986,
  -125046309,
  -124653096,
  -124325419,
  -123932206,
  -123538993,
  -123211316,
  -122818103,
  -122490426,
  -122097212,
  -121703999,
  -121376322,
  -120983109,
  -120655432,
  -120262219,
  -119869005,
  -119541328,
  -119148115,
  -118754902,
  -118427225,
  -118034011,
  -117706334,
  -117313121,
  -116919908,
  -116592230,
  -116199017,
  -115805804,
  -115478127,
  -115084913,
  -114691700,
  -114364023,
  -113970809,
  -113577596,
  -113249919,
  -112856705,
  -112463492,
  -112070279,
  -111742601,
  -111349388,
  -110956175,
  -110628497,
  -110235284,
  -109842070,
  -109448857,
  -109121179,
  -108727966,
  -108334753,
  -107941539,
  -107613862,
  -107220648,
  -106827435,
  -106434221,
  -106106544,
  -105713330,
  -105320117,
  -104926903,
  -104533690,
  -104206012,
  -103812799,
  -103419585,
  -103026371,
  -102633158,
  -102305480,
  -101912267,
  -101519053,
  -101125839,
  -100732626,
  -100404948,
  -100011734,
  -99618521,
  -99225307,
  -98832093,
  -98438880,
  -98111202,
  -97717988,
  -97324775,
  -96931561,
  -96538347,
  -96145134,
  -95751920,
  -95424242,
  -95031028,
  -94637815,
  -94244601,
  -93851387,
  -93458173,
  -93064959,
  -92671746,
  -92278532,
  -91950854,
  -91557640,
  -91164426,
  -90771212,
  -90377998,
  -89984785,
  -89591571,
  -89198357,
  -88805143,
  -88411929,
  -88018715,
  -87625501,
  -87232287,
  -86904609,
  -86511395,
  -86118181,
  -85724967,
  -85331753,
  -84938539,
  -84545325,
  -84152111,
  -83758897,
  -83365683,
  -82972469,
  -82579255,
  -82186041,
  -81792827,
  -81399613,
  -81006399,
  -80613185,
  -80219971,
  -79826757,
  -79433542,
  -79040328,
  -78647114,
  -78253900,
  -77860686,
  -77467472,
  -77074257,
  -76681043,
  -76287829,
  -75894615,
  -75501401,
  -75108186,
  -74714972,
  -74321758,
  -73928544,
  -73535329,
  -73142115,
  -72748901,
  -72355687,
  -71962472,
  -71503722,
  -71110508,
  -70717293,
  -70324079,
  -69930865,
  -69537650,
  -69144436,
  -68751222,
  -68358007,
  -67964793,
  -67571578,
  -67178364,
  -66785149,
  -66391935,
  -65933185,
  -65539970,
  -65146756,
  -64753541,
  -64360327,
  -63967112,
  -63573898,
  -63180683,
  -62787469,
  -62394254,
  -61935504,
  -61542289,
  -61149075,
  -60755860,
  -60362645,
  -59969431,
  -59576216,
  -59183002,
  -58724251,
  -58331036,
  -57937822,
  -57544607,
  -57151393,
  -56758178,
  -56364963,
  -55906213,
  -55512998,
  -55119783,
  -54726568,
  -54333354,
  -53940139,
  -53546924,
  -53088174,
  -52694959,
  -52301744,
  -51908529,
  -51515315,
  -51122100,
  -50663349,
  -50270134,
  -49876919,
  -49483704,
  -49090490,
  -48697275,
  -48238524,
  -47845309,
  -47452094,
  -47058879,
  -46665664,
  -46206914,
  -45813699,
  -45420484,
  -45027269,
  -44634054,
  -44175303,
  -43782088,
  -43388873,
  -42995658,
  -42602443,
  -42143692,
  -41750477,
  -41357262,
  -40964047,
  -40570832,
  -40112081,
  -39718866,
  -39325651,
  -38932436,
  -38539221,
  -38080469,
  -37687254,
  -37294039,
  -36900824,
  -36442073,
  -36048858,
  -35655643,
  -35262428,
  -34869212,
  -34410461,
  -34017246,
  -33624031,
  -33230816,
  -32772064,
  -32378849,
  -31985634,
  -31592419,
  -31133667,
  -30740452,
  -30347237,
  -29954022,
  -29495270,
  -29102055,
  -28708840,
  -28315624,
  -27856873,
  -27463658,
  -27070442,
  -26677227,
  -26218476,
  -25825260,
  -25432045,
  -25038829,
  -24580078,
  -24186863,
  -23793647,
  -23400432,
  -22941680,
  -22548465,
  -22155249,
  -21762034,
  -21303282,
  -20910067,
  -20516851,
  -20123636,
  -19664884,
  -19271669,
  -18878453,
  -18485238,
  -18026486,
  -17633271,
  -17240055,
  -16781304,
  -16388088,
  -15994872,
  -15601657,
  -15142905,
  -14749689,
  -14356474,
  -13963258,
  -13504506,
  -13111291,
  -12718075,
  -12259323,
  -11866108,
  -11472892,
  -11079676,
  -10620924,
  -10227709,
  -9834493,
  -9375741,
  -8982525,
  -8589310,
  -8196094,
  -7737342,
  -7344126,
  -6950910,
  -6557695,
  -6098943,
  -5705727,
  -5312511,
  -4853759,
  -4460543,
  -4067327,
  -3674112,
  -3215360,
  -2822144,
  -2428928,
  -1970176,
  -1576960,
  -1183744,
  -790528,
  -331776,
  61440
}; // weak
int dword_80073B8C[512] =
{
  189854900,
  190182585,
  190444733,
  190772418,
  191034566,
  191296714,
  191624399,
  191886547,
  192214232,
  192476380,
  192738529,
  193066213,
  193328362,
  193590511,
  193918195,
  194180344,
  194508028,
  194770177,
  195032325,
  195294474,
  195622158,
  195884307,
  196146456,
  196474140,
  196736289,
  196998437,
  197260586,
  197588271,
  197850419,
  198112568,
  198374717,
  198702401,
  198964550,
  199226699,
  199488847,
  199816532,
  200078681,
  200340829,
  200602978,
  200865127,
  201127275,
  201454960,
  201717109,
  201979258,
  202241406,
  202503555,
  202765704,
  203027853,
  203355537,
  203617686,
  203879835,
  204141984,
  204404132,
  204666281,
  204928430,
  205190579,
  205452728,
  205714876,
  205977025,
  206239174,
  206501323,
  206763472,
  207025621,
  207287770,
  207549918,
  207812067,
  208074216,
  208336365,
  208598514,
  208860663,
  209122812,
  209384961,
  209647109,
  209909258,
  210171407,
  210433556,
  210695705,
  210892318,
  211154467,
  211416616,
  211678765,
  211940914,
  212203063,
  212465212,
  212661825,
  212923974,
  213186123,
  213448272,
  213710421,
  213972570,
  214169183,
  214431332,
  214693481,
  214955630,
  215152243,
  215414392,
  215676541,
  215938690,
  216135303,
  216397452,
  216659601,
  216921750,
  217118363,
  217380513,
  217642662,
  217839275,
  218101424,
  218363573,
  218560186,
  218822335,
  219084484,
  219281097,
  219543247,
  219739860,
  220002009,
  220264158,
  220460771,
  220722920,
  220919534,
  221181683,
  221443832,
  221640445,
  221902594,
  222099208,
  222361357,
  222557970,
  222820119,
  223016732,
  223278882,
  223475495,
  223737644,
  223934257,
  224196407,
  224393020,
  224589633,
  224851782,
  225048396,
  225310545,
  225507158,
  225769307,
  225965921,
  226162534,
  226424683,
  226621297,
  226883446,
  227080059,
  227276673,
  227538822,
  227735435,
  227932049,
  228194198,
  228390811,
  228587425,
  228784038,
  229046187,
  229242801,
  229439414,
  229701563,
  229898177,
  230094790,
  230291404,
  230488017,
  230750166,
  230946780,
  231143393,
  231340007,
  231536620,
  231798770,
  231995383,
  232191996,
  232388610,
  232585223,
  232781837,
  233043986,
  233240600,
  233437213,
  233633827,
  233830440,
  234027054,
  234223667,
  234420280,
  234616894,
  234813507,
  235010121,
  235206734,
  235403348,
  235599962,
  235796575,
  235993189,
  236189802,
  236386416,
  236583029,
  236779643,
  236976256,
  237172870,
  237369483,
  237566097,
  237762710,
  237959324,
  238155938,
  238352551,
  238549165,
  238745778,
  238876856,
  239073470,
  239270083,
  239466697,
  239663310,
  239859924,
  239991002,
  240187615,
  240384229,
  240580843,
  240777456,
  240908534,
  241105147,
  241301761,
  241498375,
  241629452,
  241826066,
  242022680,
  242219293,
  242350371,
  242546985,
  242743598,
  242874676,
  243071290,
  243267903,
  243398981,
  243595595,
  243792209,
  243923286,
  244119900,
  244316514,
  244447591,
  244644205,
  244775283,
  244971897,
  245102974,
  245299588,
  245496202,
  245627280,
  245823893,
  245954971,
  246151585,
  246282663,
  246479276,
  246610354,
  246806968,
  246938046,
  247134660,
  247265737,
  247462351,
  247593429,
  247724507,
  247921121,
  248052198,
  248248812,
  248379890,
  248510968,
  248707582,
  248838659,
  248969737,
  249166351,
  249297429,
  249428507,
  249625121,
  249756198,
  249887276,
  250083890,
  250214968,
  250346046,
  250542660,
  250673738,
  250804815,
  250935893,
  251132507,
  251263585,
  251394663,
  251525741,
  251656819,
  251853433,
  251984511,
  252115588,
  252246666,
  252377744,
  252508822,
  252639900,
  252836514,
  252967592,
  253098670,
  253229748,
  253360826,
  253491904,
  253622982,
  253754060,
  253885137,
  254016215,
  254147293,
  254278371,
  254409449,
  254540527,
  254671605,
  254802683,
  254933761,
  255064839,
  255195917,
  255326995,
  255458073,
  255589151,
  255720229,
  255851307,
  255982385,
  256113463,
  256244541,
  256310083,
  256441161,
  256572239,
  256703317,
  256834395,
  256965473,
  257031015,
  257162093,
  257293171,
  257424249,
  257555327,
  257620869,
  257751947,
  257883025,
  258014103,
  258079645,
  258210723,
  258341801,
  258472879,
  258538421,
  258669500,
  258800578,
  258866120,
  258997198,
  259128276,
  259193818,
  259324896,
  259455974,
  259521516,
  259652594,
  259718136,
  259849214,
  259914756,
  260045834,
  260176913,
  260242455,
  260373533,
  260439075,
  260570153,
  260635695,
  260766773,
  260832315,
  260963393,
  261028935,
  261160014,
  261225556,
  261356634,
  261422176,
  261487718,
  261618796,
  261684338,
  261815416,
  261880959,
  261946501,
  262077579,
  262143121,
  262274199,
  262339741,
  262405283,
  262536362,
  262601904,
  262667446,
  262732988,
  262864066,
  262929608,
  262995150,
  263126229,
  263191771,
  263257313,
  263322855,
  263453933,
  263519475,
  263585018,
  263650560,
  263716102,
  263781644,
  263912722,
  263978264,
  264043807,
  264109349,
  264174891,
  264240433,
  264305975,
  264437054,
  264502596,
  264568138,
  264633680,
  264699222,
  264764765,
  264830307,
  264895849,
  264961391,
  265026933,
  265092476,
  265158018,
  265223560,
  265289102,
  265354644,
  265420187,
  265485729,
  265551271,
  265616813,
  265682355,
  265682362,
  265747904,
  265813446,
  265878988,
  265944531,
  266010073,
  266075615,
  266141157,
  266141163,
  266206706,
  266272248,
  266337790,
  266403332,
  266403339,
  266468881,
  266534423,
  266599965,
  266599972,
  266665514,
  266731056,
  266796598,
  266796605,
  266862147,
  266927689,
  266927695,
  266993238,
  267058780,
  267058786,
  267124328,
  267189871,
  267189877,
  267255419,
  267255425,
  267320968,
  267386510,
  267386516,
  267452058,
  267452065,
  267517607,
  267517613,
  267583155,
  267583162,
  267648704,
  267648710,
  267714252,
  267714259,
  267779801,
  267779807,
  267845349,
  267845356,
  267910898,
  267910904,
  267976447,
  267976453,
  267976459,
  268042001,
  268042008,
  268042014,
  268107556,
  268107562,
  268107569,
  268173111,
  268173117,
  268173124,
  268238666,
  268238672,
  268238678,
  268238685,
  268304227,
  268304233,
  268304240,
  268304246,
  268369788,
  268369794,
  268369801,
  268369807,
  268369813,
  268435355,
  268435362,
  268435368,
  268435374,
  268435381,
  268435387,
  268435393,
  268500935,
  268500942,
  268500948,
  268500954,
  268500961,
  268500967,
  268500973,
  268500979,
  268500986,
  268435456
}; // weak
int dword_8007438C[512] =
{
  393216,
  1245197,
  2031641,
  2883622,
  3735602,
  4522047,
  5374027,
  6160472,
  7012453,
  7798897,
  8650878,
  9437322,
  10289303,
  11141283,
  11927728,
  12779708,
  13566153,
  14418134,
  15204578,
  16056559,
  16843003,
  17694984,
  18546964,
  19333409,
  20185389,
  20971834,
  21823814,
  22610259,
  23462239,
  24248684,
  25100664,
  25887109,
  26739089,
  27525534,
  28377514,
  29163959,
  30015939,
  30802384,
  31654364,
  32440809,
  33292789,
  34079234,
  34931214,
  35717659,
  36504103,
  37356084,
  38142528,
  38994509,
  39780953,
  40632933,
  41419378,
  42205822,
  43057803,
  43844247,
  44696227,
  45482672,
  46269116,
  47121097,
  47907541,
  48759521,
  49545966,
  50332410,
  51184390,
  51970835,
  52757279,
  53609259,
  54395704,
  55182148,
  55968592,
  56820573,
  57607017,
  58393461,
  59245441,
  60031886,
  60818330,
  61604774,
  62456754,
  63243199,
  64029643,
  64816087,
  65602531,
  66454511,
  67240956,
  68027400,
  68813844,
  69600288,
  70386732,
  71173176,
  72025156,
  72811601,
  73598045,
  74384489,
  75170933,
  75957377,
  76743821,
  77530265,
  78316709,
  79103153,
  79889597,
  80676041,
  81462485,
  82248929,
  83035373,
  83821817,
  84608261,
  85394705,
  86181149,
  86967593,
  87688500,
  88474944,
  89261388,
  90047832,
  90834276,
  91620720,
  92341628,
  93128071,
  93914515,
  94700959,
  95487403,
  96208310,
  96994754,
  97781198,
  98502106,
  99288549,
  100074993,
  100795901,
  101582344,
  102368788,
  103089695,
  103876139,
  104597047,
  105383490,
  106169934,
  106890841,
  107677285,
  108398192,
  109184636,
  109905543,
  110691987,
  111412894,
  112133802,
  112920245,
  113641153,
  114427596,
  115148503,
  115869411,
  116655854,
  117376761,
  118097669,
  118818576,
  119605019,
  120325926,
  121046834,
  121767741,
  122554184,
  123275091,
  123995998,
  124716906,
  125437813,
  126158720,
  126879627,
  127600534,
  128321441,
  129107884,
  129828791,
  130549698,
  131205069,
  131925976,
  132646883,
  133367790,
  134088697,
  134809604,
  135530510,
  136251417,
  136972324,
  137627695,
  138348602,
  139069509,
  139790415,
  140445786,
  141166693,
  141887599,
  142542970,
  143263877,
  143984783,
  144640154,
  145361061,
  146016431,
  146737338,
  147392708,
  148113615,
  148768985,
  149489892,
  150145262,
  150866168,
  151521539,
  152176909,
  152897816,
  153553186,
  154208556,
  154929463,
  155584833,
  156240203,
  156895573,
  157616479,
  158271850,
  158927220,
  159582590,
  160237960,
  160893330,
  161548700,
  162204070,
  162859440,
  163514810,
  164170180,
  164825550,
  165480920,
  166136290,
  166791660,
  167447030,
  168036863,
  168692233,
  169347603,
  170002973,
  170592806,
  171248176,
  171903546,
  172493380,
  173148749,
  173804119,
  174393952,
  175049322,
  175639155,
  176294525,
  176884358,
  177539728,
  178129561,
  178719395,
  179374764,
  179964597,
  180554431,
  181209800,
  181799633,
  182389467,
  182979300,
  183634669,
  184224502,
  184814335,
  185404168,
  185994001,
  186583835,
  187173668,
  187763501,
  188353334,
  188943166,
  189532999,
  190122832,
  190712665,
  191236962,
  191826795,
  192416628,
  193006460,
  193530757,
  194120590,
  194710423,
  195234719,
  195824552,
  196414384,
  196938681,
  197528513,
  198052810,
  198642642,
  199166939,
  199756771,
  200281068,
  200805364,
  201395196,
  201919493,
  202443789,
  202968085,
  203557918,
  204082214,
  204606510,
  205130806,
  205655102,
  206179398,
  206703694,
  207227990,
  207752286,
  208276582,
  208800878,
  209325174,
  209849470,
  210373766,
  210832526,
  211356821,
  211881117,
  212405413,
  212864172,
  213388468,
  213912764,
  214371523,
  214895819,
  215354578,
  215878874,
  216337633,
  216861929,
  217320688,
  217779448,
  218303743,
  218762502,
  219221262,
  219680021,
  220204316,
  220663075,
  221121834,
  221580594,
  222039353,
  222498112,
  222956871,
  223415630,
  223874389,
  224333148,
  224791906,
  225250665,
  225709424,
  226102647,
  226561406,
  227020165,
  227478923,
  227872146,
  228330905,
  228724127,
  229182886,
  229641644,
  230034867,
  230428089,
  230886848,
  231280070,
  231738828,
  232132051,
  232525273,
  232984031,
  233377254,
  233770476,
  234163698,
  234556920,
  234950142,
  235343364,
  235736586,
  236129808,
  236523030,
  236916252,
  237309474,
  237702696,
  238095918,
  238489140,
  238816826,
  239210047,
  239603269,
  239930955,
  240324176,
  240717398,
  241045083,
  241438305,
  241765990,
  242159212,
  242486897,
  242814583,
  243207804,
  243535489,
  243863175,
  244256396,
  244584081,
  244911766,
  245239451,
  245567137,
  245894822,
  246222507,
  246550192,
  246877877,
  247205562,
  247533247,
  247860931,
  248188616,
  248450765,
  248778450,
  249106134,
  249368283,
  249695968,
  250023652,
  250285801,
  250613486,
  250875634,
  251203319,
  251465467,
  251793151,
  252055300,
  252317448,
  252579596,
  252907281,
  253169429,
  253431577,
  253693725,
  253955873,
  254218021,
  254480169,
  254742317,
  255004465,
  255266613,
  255528761,
  255790909,
  256053057,
  256249669,
  256511816,
  256773964,
  256970576,
  257232723,
  257494871,
  257691482,
  257953630,
  258150241,
  258412389,
  258609000,
  258805612,
  259067759,
  259264370,
  259460982,
  259657593,
  259854204,
  260116351,
  260312962,
  260509573,
  260706184,
  260902795,
  261099406,
  261296017,
  261427092,
  261623703,
  261820314,
  262016924,
  262213535,
  262344610,
  262541221,
  262672295,
  262868906,
  263065516,
  263196591,
  263393201,
  263524276,
  263655350,
  263851960,
  263983035,
  264114109,
  264245183,
  264441794,
  264572868,
  264703942,
  264835016,
  264966090,
  265097164,
  265228238,
  265359312,
  265490386,
  265621460,
  265686997,
  265818071,
  265949145,
  266080219,
  266145756,
  266276830,
  266342368,
  266473441,
  266538979,
  266670052,
  266735590,
  266866663,
  266932200,
  266997738,
  267128811,
  267194348,
  267259885,
  267325423,
  267390960,
  267456497,
  267522034,
  267587571,
  267653108,
  267718645,
  267784182,
  267849719,
  267915256,
  267980792,
  267980793,
  268046330,
  268111866,
  268111867,
  268177404,
  268177404,
  268242941,
  268242941,
  268308478,
  268308478,
  268374014,
  268374015,
  268374015,
  268374015,
  268439552,
  268439552,
  268439552,
  268439552,
  268439552
}; // weak
int dword_800760E4[8] = { 0, 0, 0, 0, 0, 0, 0, 0 }; // weak
int dword_80076108[8] = { 0, 0, 0, 0, 0, 0, 0, 0 }; // weak
int dword_80076128 = 0; // weak
char *off_80076158 = "$Id: sys.c,v 1.116 1995/12/01 07:03:58 suzu Exp $"; // weak
char byte_800761A0 = '\0'; // weak
char byte_800761A1 = '\0'; // weak
__int16 word_800761A4 = 0; // weak
__int16 word_800761A6 = 0; // weak
int g_GpuLockFlag = 0; // weak
int dword_800761B0[23] = { 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0 }; // weak
int dword_8007620C = 0; // weak
int dword_80076248[2] = { 83886079, 2147483648 }; // weak
int dword_80076250 = 0; // weak
int dword_80076254 = 0; // weak
int dword_80076258 = 0; // weak
int dword_8007625C[5] = { 83886079, 0, 0, 0, 0 }; // weak
int g_LastGpuCmd = 0; // weak
int dword_80076298 = 0; // weak
int dword_8007629C = 0; // weak
int dword_800762A4 = 0; // weak
int dword_800762A8 = 0; // weak
int dword_800762AC = 0; // weak
int dword_800762B0 = 0; // weak
int dword_800762B4 = 0; // weak
int dword_800762B8 = 0; // weak
int dword_800762BC = 0; // weak
int dword_8007634C[2] = { 18416192, 65552 }; // weak
int dword_80076354[2] = { 18285120, 65552 }; // weak
int dword_8007635C[2] = { 18481728, 65552 }; // weak
int dword_80076364[2] = { 18350656, 65552 }; // weak
int dword_8007636C[3] = { 8421504, 0, 0 }; // weak
int dword_80076378[2] = { 320, 15728960 }; // weak
int dword_80076380[2] = { -93323264, 0 }; // weak
int dword_80076388[2] = { -59768832, 0 }; // weak
int dword_80076390[2] = { -6553600, 300 }; // weak
int dword_80076398 = 0; // weak
int dword_800763A4[2] = { 0, 0 }; // weak
int g_MenuDrawEnv[4] = { 0, 0, 0, 0 }; // weak
int dword_800763CC[12] = { 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0 }; // weak
int dword_800763FC[2] = { 0, 0 }; // weak
int dword_80076404 = 0; // weak
int dword_8007640C = 0; // weak
int dword_80076414 = 0; // weak
int dword_8007641C = 0; // weak
int dword_80076460 = 0; // weak
__int16 word_8007646A = 0; // weak
__int16 word_8007646C = 0; // weak
int dword_80076478 = 0; // weak
int dword_8007647C = 0; // weak
int dword_80076480 = 0; // weak
int dword_80076484 = 0; // weak
int dword_80076488 = 0; // weak
int dword_8007648C = 0; // weak
int dword_80076490[2] = { 0, 0 }; // weak
int g_CdStatusRegisters[2] = { 0, 0 }; // weak
int dword_800764A0[2] = { 0, 0 }; // weak
int dword_800764A8 = 0; // weak
int dword_800764AC = 0; // weak
int dword_800764B0 = 0; // weak
char byte_800764B4 = '\0'; // weak
int dword_800764B8[] = { 0 }; // weak
int dword_800764BC[209] =
{
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0,
  0
}; // weak
_UNKNOWN unk_80076A90; // weak
_UNKNOWN unk_80076AB4; // weak
_UNKNOWN unk_80076AB8; // weak
_UNKNOWN unk_80076ABC; // weak
_BYTE byte_80076AC0[5620]; // weak
_UNKNOWN unk_800780B4; // weak
_UNKNOWN unk_800780B5; // weak
int dword_80078140; // weak
int dword_800788B4; // weak
_WORD word_800788B8[1]; // weak
_UNKNOWN unk_800788BA; // weak
_UNKNOWN unk_800788BC; // weak
_WORD word_800788BE[1]; // weak
_WORD word_800788C0[1]; // weak
_WORD word_800788C2[187]; // weak
_BYTE byte_80078A38[24]; // weak
_UNKNOWN unk_80078A50; // weak
_UNKNOWN unk_80078A52; // weak
_UNKNOWN unk_80078A54; // weak
_UNKNOWN unk_80078A56; // weak
_UNKNOWN unk_80078A58; // weak
_BYTE byte_80078A5A[2]; // weak
_UNKNOWN unk_80078A5C; // weak
_UNKNOWN unk_80078A5E; // weak
_UNKNOWN unk_80078A60; // weak
_UNKNOWN unk_80078A62; // weak
_UNKNOWN unk_80078A64; // weak
_UNKNOWN unk_80078A66; // weak
_UNKNOWN unk_80078A68; // weak
_UNKNOWN unk_80078A6B; // weak
_UNKNOWN unk_80078A6C; // weak
_UNKNOWN unk_80078A6E; // weak
_UNKNOWN unk_80078A70; // weak
_UNKNOWN unk_80078A72; // weak
_UNKNOWN unk_80078A74; // weak
_UNKNOWN unk_80078A76; // weak
_UNKNOWN unk_80078A78; // weak
_UNKNOWN unk_80078A7A; // weak
_UNKNOWN unk_80078A7C; // weak
_UNKNOWN unk_80078A7E; // weak
_UNKNOWN unk_80078A80; // weak
_UNKNOWN unk_80078A82; // weak
int dword_80078F30; // weak
_UNKNOWN unk_80078F38; // weak
_UNKNOWN unk_80078F80; // weak
int dword_8007900C; // weak
int dword_80079010; // weak
int dword_80079014; // weak
int dword_80079018; // weak
int dword_8007901C; // weak
int dword_80079020; // weak
int dword_80079024; // weak
int dword_80079028; // weak
int dword_8007902C; // weak
int dword_80079030; // weak
int dword_80079034; // weak
int dword_80079038; // weak
_BYTE byte_8007904C[256]; // weak
__int16 word_80079160; // weak
__int16 word_80079168; // weak
__int16 word_80079170; // weak
__int16 word_80079178; // weak
int dword_80079180; // weak
LevelStatEntry g_LevelStatEntry;
__int16 maxHp_word_80079196; // weak
__int16 word_80079198; // weak
__int16 word_8007919A; // weak
int dword_8007919C; // weak
__int16 word_8007962C; // weak
__int16 word_8007962E; // weak
int dword_80079634; // weak
__int16 word_80079638; // weak
__int16 word_8007963A; // weak
__int16 word_8007963C; // weak
__int16 word_8007963E; // weak
int dword_80079640; // weak
_UNKNOWN unk_80079644; // weak
_DWORD g_ExtendedPrimitiveDefs[21504]; // weak
int dword_8009DE44; // weak
int dword_8009DE48; // weak
__int16 word_8009DE4C; // weak
__int16 word_8009DE4E; // weak
int dword_8009DE50; // weak
int dword_8009DE54; // weak
__int16 word_8009DE5C; // weak
int dword_8009DE60; // weak
int dword_8009DE64; // weak
char g_InventoryCounts[15]; // weak
char byte_8009DE7F; // weak
char byte_8009DEA3; // weak
char byte_8009DEBC; // weak
char byte_8009DEC2; // weak
char byte_8009DEC3; // weak
char byte_8009DED0; // weak
char byte_8009DED1; // weak
_UNKNOWN unk_8009DEE0; // weak
char byte_8009DEE5; // weak
char byte_8009DEE6; // weak
int (*dword_8009DEE8)(void); // weak
int (*dword_8009DEEC)(void); // weak
_DWORD dword_8009DEF0[16]; // weak
int dword_8009E088; // weak
_DWORD dword_8009E08C[16]; // weak
__int16 word_8009E0CC; // weak
_UNKNOWN unk_8009E0D4; // weak
int g_ResourceBuffer[];
int dword_8009E120[97279]; // weak
_DWORD g_BasicPrimitiveDefs[1625]; // weak
_UNKNOWN unk_800FEA80; // weak
_UNKNOWN unk_80117A80; // weak
int dword_80130A80; // weak
int dword_80130A84; // weak
__int16 word_80130A88; // weak
_UNKNOWN unk_80130A90; // weak
int dword_8016DA90; // weak
__int16 word_8016DA98; // weak
int dword_8016DAA0; // weak
int dword_8016DAB0; // weak
int dword_8016E5F8; // weak
int dword_8016E600; // weak
Entity *g_ObjectArray[200];
_UNKNOWN unk_8016E611; // weak
_UNKNOWN unk_8016E620; // weak
_UNKNOWN unk_8016E626; // weak
_UNKNOWN unk_8016E630; // weak
_UNKNOWN unk_8016E634; // weak
_UNKNOWN unk_8016E638; // weak
_UNKNOWN unk_8016E64A; // weak
_UNKNOWN unk_8016E664; // weak
_UNKNOWN unk_80174210; // weak
EntityDefinition *g_ObjectTypeTable[300];
_UNKNOWN unk_801746F4; // weak
_DWORD dword_80174720[1186]; // weak
_UNKNOWN unk_801759A8; // weak
char byte_801779A8; // weak
int dword_801779AC; // weak
EntityDefinition *g_CurrentEntityDef;
Entity *g_CurrentEntityPtr;
int dword_801779B8; // weak
int dword_801779BC; // weak
int dword_801779C0; // weak
int dword_801779C4; // weak
int dword_801779C8; // weak
int g_FrameCounter; // weak
int dword_801779D0; // weak
__int16 g_bStartKeyState; // weak
__int16 g_TitleSeqState; // weak
int g_TitleColor; // weak
char g_TitleBrightness; // weak
char byte_801779DD; // weak
MapScriptPointer *g_CurrentStateVTable;
char g_TitleAnimFrame; // weak
char byte_801779E5; // weak
char byte_801779E6; // weak
char byte_801779E7; // weak
char byte_801779E8; // weak
char byte_801779E9; // weak
char byte_801779EA; // weak
char g_TitleRGB_R; // weak
char g_TitleRGB_G; // weak
char g_TitleRGB_B; // weak
__int16 g_AudioFadeTimer; // weak
_DWORD GameDB01ObjectClassDeclaration[]; // weak
unsigned __int16 word_801779F4[3838]; // weak
Entity *ObjectInstances[];
_UNKNOWN unk_8017FCE0; // weak
int dword_80180124; // weak
int dword_80180128; // weak
__int16 word_8018012E; // weak
__int16 word_80180130; // weak
__int16 word_80180132; // weak
int dword_80180134; // weak
char byte_80180138; // weak
int dword_8018013C; // weak
int dword_80180140[]; // weak
int dword_80180144; // weak
int dword_80180148; // weak
int dword_8018014C; // weak
int dword_80180150; // weak
int dword_80180154; // weak
int g_GpuCmdBufferMirror; // weak
unsigned int dword_8018015C[16384]; // weak
int g_GpuCommandBuffer; // weak
_UNKNOWN unk_80190160; // weak
char byte_80190176; // weak
char byte_80190177; // weak
char byte_80190178; // weak
char byte_80190179; // weak
char byte_8019017A; // weak
char byte_8019017B; // weak
_UNKNOWN unk_801901BC; // weak
char byte_801901D2; // weak
char byte_801901D3; // weak
char byte_801901D4; // weak
char byte_801901D5; // weak
char byte_801901D6; // weak
char byte_801901D7; // weak
_UNKNOWN unk_80190218; // weak
__int16 word_80190220; // weak
__int16 word_80190222; // weak
_UNKNOWN unk_8019022C; // weak
__int16 word_80190234; // weak
__int16 word_80190236; // weak
_DWORD dword_80190240[3]; // weak
int dword_8019024C; // weak
int g_CurrentPrimitiveBuffer; // weak
_DWORD g_PrimitiveTypeTable[385]; // weak
int dword_80190858; // weak
int dword_80190B54; // weak
_UNKNOWN unk_80190B58; // weak
_UNKNOWN unk_80190C48; // weak
_UNKNOWN unk_80190C4C; // weak
_UNKNOWN unk_80190C4E; // weak
_WORD word_80192B8C[4000]; // weak
int dword_80194ACC; // weak
int dword_80194AD0; // weak
int dword_80194AD4; // weak
_UNKNOWN unk_80194B1C; // weak
unsigned __int8 byte_80194DDC[8]; // weak
_WORD word_80194DE4[8]; // weak
char byte_80194DF4; // weak
char byte_80194DF5; // weak
char byte_80194DF6[]; // weak
char byte_80194DF7; // weak
char byte_80194DF8; // weak
char byte_80194DF9; // weak
char byte_80194DFA; // weak
char byte_80194DFB; // weak
char byte_80194DFC; // weak
char byte_80194DFD; // weak
__int16 word_80194DFE; // weak
__int16 word_80194E00; // weak
__int16 word_80194E02; // weak
int dword_80194E04; // weak
int dword_80194E08; // weak
_UNKNOWN unk_80194E0C; // weak
_UNKNOWN unk_80194E0E; // weak
_WORD word_80194ECC[16]; // weak
int dword_80194EEC[16]; // weak
int dword_80194F2C; // weak
int dword_80194F30; // weak
int dword_80194F34; // weak
int dword_80194F38; // weak
int dword_80194F3C; // weak
int dword_80194F40; // weak
int dword_80194F44; // weak
int dword_80194F48; // weak
int dword_80194F4C; // weak
int dword_80194F50; // weak
int dword_80194F54; // weak
int dword_80194F58; // weak
int dword_80194F5C; // weak
_BYTE byte_80194F60[576]; // weak
int g_RecalculateOrientationCache; // weak
_UNKNOWN g_DynamicPrimitiveTable; // weak
_UNKNOWN unk_8019520A; // weak
int dword_80197224; // weak
_UNKNOWN unk_80197228; // weak
_UNKNOWN unk_8019722D; // weak
int dword_8019A628; // weak
__int16 g_MenuTrackID; // weak
int g_IsAudioPlaying; // weak
int g_ExitTitleScreen; // weak
int dword_8019A638; // weak
int dword_8019A63C; // weak
int dword_8019A640; // weak
int dword_8019A644; // weak
__int16 word_8019A648; // weak
_UNKNOWN unk_8019A64A; // weak
__int16 word_8019A64C; // weak
_UNKNOWN unk_8019A64E; // weak
_UNKNOWN pSfxSlot; // weak
_UNKNOWN unk_8019A658; // weak
__int16 word_8019A65C; // weak
int dword_8019A660; // weak
_UNKNOWN unk_8019AA64; // weak
__int16 word_8019AA8C[1180]; // weak
__int16 word_8019B3C4; // weak
__int16 word_8019B3E2; // weak
_UNKNOWN g_StreamContexts; // weak
_UNKNOWN unk_8019B4B4; // weak
_UNKNOWN unk_8019B4BC; // weak
int dword_8019B4C4; // weak
int dword_8019B4C8; // weak
char byte_8019B4CC; // weak
char byte_8019B4CD; // weak
char g_PhysicsReady; // weak
char byte_8019B4CF; // weak
char byte_8019B4D1; // weak
__int16 word_8019B4D2; // weak
__int16 word_8019B4D4; // weak
__int16 g_MaxHP; // weak
__int16 g_CurrentHP; // weak
__int16 g_MaxMP; // weak
__int16 g_CurrentMP; // weak
__int16 g_Stamina_8019B4DE; // weak
__int16 g_AttackStartStamina; // weak
__int16 g_MagicStamina_8019B4E2; // weak
__int16 word_8019B4E4; // weak
__int16 word_8019B4E6; // weak
__int16 g_Strength; // weak
__int16 g_MagicPower; // weak
__int16 g_unk_8019B4EC; // weak
__int16 g_unk_8019B4EE; // weak
int g_PlayerGold; // weak
__int16 g_AttackStrike; // weak
__int16 g_AttackSlash; // weak
__int16 g_AttackPierce; // weak
__int16 g_AttackWhiteMagic; // weak
__int16 g_AttackFire; // weak
__int16 g_AttackEarth; // weak
__int16 g_AttackWind; // weak
__int16 g_AttackWater; // weak
__int16 g_DefenseStrike; // weak
__int16 g_DefenseSlash; // weak
__int16 g_DefensePierce; // weak
__int16 g_DefensePoison; // weak
__int16 g_DefenseBlackMagic; // weak
__int16 g_DefenseFire; // weak
__int16 g_DefenseEarth; // weak
__int16 g_DefenseWind; // weak
__int16 g_DefenseWater; // weak
__int16 g_PoisenStatus; // weak
__int16 word_8019B51A; // weak
__int16 word_8019B51C; // weak
__int16 word_8019B51E; // weak
__int16 word_8019B520; // weak
__int16 word_8019B522; // weak
__int16 g_AttackCooldown; // weak
__int16 word_8019B526; // weak
__int16 word_8019B528; // weak
__int16 word_8019B52A; // weak
__int16 word_8019B52C; // weak
__int16 word_8019B52E; // weak
__int16 word_8019B530; // weak
__int16 word_8019B532; // weak
int g_PlayerJumpState; // weak
int dword_8019B53C; // weak
SpellDataEntry g_ActiveWeaponSpell;
__int16 g_AttackHitRange; // weak
char byte_8019B55A; // weak
char g_EquippedMagic; // weak
__int16 g_QuickSlotItem; // weak
char g_CurrentAttackDir; // weak
char g_EquippedWeapon; // weak
char byte_8019B560; // weak
char byte_8019B562; // weak
char g_FullStaminaBonus; // weak
char byte_8019B564; // weak
int dword_8019B568; // weak
int dword_8019B56C; // weak
int dword_8019B570; // weak
int dword_8019B574; // weak
int dword_8019B578; // weak
int dword_8019B57C; // weak
int dword_8019B580; // weak
char g_EquippedHead; // weak
char g_EquippedBody; // weak
char g_EquippedShield; // weak
char g_EquippedArms; // weak
char g_EquippedLegs; // weak
char g_EquipAccessory1; // weak
char g_EquipAccessory2; // weak
char g_Option_Sound; // weak
char g_Option_Music; // weak
char g_Option_ShowHPMP; // weak
char g_Option_ShowCompass; // weak
char g_Option_ShowPreviewItem3D; // weak
char g_Option_WalkEffect; // weak
char byte_8019B591; // weak
char g_PlayerIsMoving; // weak
char g_CastReadyFlag; // weak
char g_SpellEffectType; // weak
char g_SpellPowerLevel; // weak
char byte_8019B598; // weak
char byte_8019B599; // weak
LanguageBlock g_LanguageID[];
__int16 word_8019B5C6; // weak
__int16 word_8019B5C8; // weak
__int16 word_8019B5CA; // weak
int dword_8019B5CC; // weak
int dword_8019B5D0; // weak
__int16 word_8019B5D4; // weak
__int16 word_8019B5D6; // weak
__int16 word_8019B5D8; // weak
int g_MagicParticlePos; // weak
int g_MagicParticleRadius; // weak
int dword_8019B5E4; // weak
int dword_8019B5E8; // weak
__int16 word_8019B5EC; // weak
__int16 word_8019B5EE; // weak
__int16 word_8019B5F0; // weak
__int16 word_8019B5F2; // weak
__int16 word_8019B5F4; // weak
__int16 word_8019B5F6; // weak
__int16 word_8019B5F8; // weak
__int16 word_8019B5FA; // weak
__int16 word_8019B5FC; // weak
__int16 word_8019B5FE; // weak
__int16 word_8019B600; // weak
__int16 word_8019B602; // weak
__int16 g_PadKey; // weak
__int16 g_PadKey_Alt; // weak
int dword_8019B60C; // weak
int dword_8019B610; // weak
_UNKNOWN unk_8019B614; // weak
_UNKNOWN unk_8019B615; // weak
__int16 word_8019B616; // weak
__int16 word_8019B618; // weak
_UNKNOWN unk_8019B61A; // weak
__int16 word_8019B61C; // weak
__int16 word_8019B61E; // weak
int dword_8019B620; // weak
char byte_8019B628; // weak
_UNKNOWN unk_8019E630; // weak
_UNKNOWN unk_8019E634; // weak
__int16 word_8019E6C0; // weak
int dword_8019E6C8; // weak
char byte_8019E6D0; // weak
char byte_8019E6D1; // weak
char byte_8019E6D2; // weak
char byte_8019E6D3; // weak
char byte_8019E6D4; // weak
char byte_8019E6D5; // weak
char byte_8019E6D6; // weak
char byte_8019E6D7; // weak
char byte_8019E6DA; // weak
char byte_8019E6DB; // weak
char byte_8019E6DC; // weak
char byte_8019E6DD; // weak
char byte_8019E6DE; // weak
char byte_8019E6DF; // weak
char byte_8019E6E0; // weak
char byte_8019E6E1; // weak
char byte_8019E6E2; // weak
char byte_8019E6E3; // weak
char byte_8019E6E4; // weak
__int16 word_8019E6E6; // weak
__int16 word_8019E6E8; // weak
__int16 word_8019E6EA; // weak
__int16 word_8019E6EC; // weak
__int16 word_8019E6EE; // weak
_BYTE g_SPUVoiceActive[16]; // weak
SpellDataEntry g_SpellEntryTable[255];
_UNKNOWN g_ParticleArray; // weak
_UNKNOWN unk_8019ED87; // weak
_UNKNOWN unk_8019ED89; // weak
_UNKNOWN unk_8019ED8E; // weak
_UNKNOWN unk_8019ED94; // weak
_UNKNOWN unk_8019ED98; // weak
_UNKNOWN unk_8019EDA4; // weak
_UNKNOWN unk_8019EDAC; // weak
_UNKNOWN unk_8019EDBC; // weak
int dword_801A1180; // weak
int dword_801A1184; // weak
int dword_801A1188; // weak
int dword_801A118C; // weak
_UNKNOWN unk_801A1190; // weak
char byte_801B5190; // weak
int dword_801B5198; // weak
char byte_801B519C[]; // weak
char byte_801B519D; // weak
_BYTE byte_801B519E[26]; // weak
char byte_801B51B8; // weak
__int16 word_801B51C4; // weak
__int16 word_801B51C8; // weak
__int16 word_801B51CC; // weak
char byte_801B51DB; // weak
_BYTE byte_801B51DC[192]; // weak
char byte_801B529C[14336]; // weak
int dword_801B8A9C; // weak
int dword_801B8AA0; // weak
int dword_801B8AA4; // weak
__int64 qword_801B8AA8; // weak
int dword_801B8AB0; // weak
int dword_801B8AB4; // weak
char byte_801B8AB8; // weak
char byte_801B8AB9; // weak
int dword_801B8ABC; // weak
int dword_801B8AC0; // weak
int dword_801B8AC4; // weak
int dword_801B8AC8; // weak
int dword_801B8ACC; // weak
int (__fastcall *byte_801B8AD0)(_DWORD, _DWORD); // weak
int dword_801BA2D0; // weak
int dword_801BA2D8; // weak
int dword_801BA2DC; // weak
int dword_801BA2E8[]; // weak
int dword_801BA2EC; // weak
__int16 word_801BA308; // weak
int dword_801BA314; // weak
int dword_801BA318; // weak
__int16 word_801BA334; // weak
int dword_801BA340; // weak
int dword_801BA344; // weak
__int16 word_801BA360; // weak
int dword_801BA36C; // weak
int dword_801BA370; // weak
__int16 word_801BA38C; // weak
int dword_801BA5A8; // weak
int dword_801BA5AC; // weak
int dword_801BA5B0; // weak
int dword_801BA5B4; // weak
int dword_801BA5B8; // weak
int dword_801BA5C0; // weak
_UNKNOWN unk_801BA5C4; // weak
int g_CDTaskQueue; // weak
int g_ActiveCdStream; // weak
FileDescriptor g_FileDescriptors[9];
int dword_801BA870; // weak
int dword_801BA874; // weak
int dword_801BA878; // weak
int dword_801BA894; // weak
int dword_801BA898; // weak
int dword_801BA89C; // weak
int g_CDReadBuffer; // weak
int dword_801BA8B0[17407]; // weak
_DWORD g_EquipmentDatabase[306]; // weak
_DWORD g_MapData[]; // weak
_UNKNOWN unk_801CBD78; // weak
_UNKNOWN unk_801CBD7B; // weak
_DWORD g_CollisionMeshBuffer[1385]; // weak
_UNKNOWN unk_801DD318; // weak
MetaTile *g_CurrentMetaTile;
Tile *MapTileSlice;
__int16 g_TileLayerOffset; // weak
int g_CurrentFloorBaseHeight; // weak
int g_FinalResultHeight; // weak
int g_CurrentWallTopY; // weak
int g_CeilingHeight; // weak
int g_StepHeight; // weak
int dword_801DD594; // weak
int dword_801DD598; // weak
int dword_801DD59C; // weak
int dword_801DD5A4; // weak
int dword_801DD5A8; // weak
int dword_801DD5AC; // weak
int dword_801DD5B0; // weak
__int16 word_801DD5B4; // weak
__int16 word_801DD5B6; // weak
_DWORD dword_801DD5B8[512]; // weak
_DWORD dword_801DDDB8[32]; // weak
_DWORD dword_801DDE38[512]; // weak
__int16 word_801DE638; // weak
__int16 word_801DE640; // weak
int dword_801DE648; // weak
int dword_801DE64C; // weak
int dword_801DE650; // weak
_UNKNOWN unk_801DE654; // weak
int dword_801DEF54; // weak
int dword_801DEF58; // weak
_DWORD dword_801DEF5C[16]; // weak
__int16 g_ActiveVoiceCount; // weak
_DWORD dword_801DEFA4[16]; // weak
int dword_801DF024; // weak
__int16 word_801DF028; // weak
__int16 word_801DF030; // weak
_DWORD dword_801DF038[25586]; // weak
_UNKNOWN unk_801F8000; // weak


//----- (80013A5C) --------------------------------------------------------
int sub_80013A5C()
{
  nullsub_3();
  sub_8004C500(dword_801DF038, &unk_801F8000 - dword_801DF038);
  SetVideoMode(1);
  sub_8004F310();
  PadInit(0);
  InitCARD2(1);
  ChangeClearPAD();
  ExitCriticalSection();
  return __MainGameLoop();
}
// 8004C8C4: using guessed type int __fastcall InitCARD2(_DWORD);
// 801DF038: using guessed type _DWORD dword_801DF038[25586];

//----- (80013ACC) --------------------------------------------------------
int __MainGameLoop()
{
  int v0; // $gp
  int v1; // $gp
  int v2; // $a2
  __int16 v3; // $a3
  int v5; // $a0
  int v6; // $a1
  int v7; // $a2
  int v8; // $a0
  int v9; // $a0
  int v10; // $a1
  int v11; // $a2
  __int16 v12; // $a3
  int v13; // $gp
  int v14; // $gp
  GameState *v15; // $v1 MAPDST
  int result; // $v0
  __int16 ScreenSetting[4]; // [sp+20h] [-20h] BYREF
  int v18[4]; // [sp+28h] [-18h] BYREF
  int v19[2]; // [sp+38h] [-8h] BYREF

  memset_0(&g_bStartKeyState, 0, 7);
  memset_0(&byte_80180138, 0, 24380);
  memset_0(&dword_8019B4C4, 0, 89);
  memset_0(&dword_801B5198, 0, 3654);
  memset_0(g_MapData, 0, 17937);
  memset_0(GameDB01ObjectClassDeclaration, 0, 8657);
  memset_0(g_ObjectArray, 0, 9459);
  memset_0(g_SpellEntryTable, 0, 2723);
  memset_0(&dword_8019A628, 0, 935);
  *(v0 + 384) = 1;
  InitEventSystem();
  InitGraphicsSystem();
  InitSoundSystem();
  InitProjectileSystem();
  InitEntitySystem();
  InitParticleSystem();
  LoadGameData();
  InitPlayerInventory();
  InitBiosEvents();
  PrepareRenderPrimitives();
  g_RecalculateOrientationCache = 1;
  PrecomputeCardinalOrientations();
  ScreenSetting[2] = 320;
  *(v1 + 384) = 0;
  ScreenSetting[0] = 0;
  ScreenSetting[1] = 0;
  ScreenSetting[3] = 480;
  ApplyVideoSettings(ScreenSetting, 0, 0, 0);
  SetMasterVolume(127, 127, v2, v3);
  if ( ShowLoadOrNewGameMenu() != -1 )
    LoadSave();
  InitDialogueFiles();                          // load - COM\\TALK0.T 
  if ( *g_LanguageID[0].header - 1 < 2 )
    loadTIM();
  TitleScreen();
  Player_Spawn();
  VRAM_ReserveTextureSpace(320, 256, 0, 1, 1, 64, 64);
  VRAM_ReserveTextureSpace(408, 448, 0, 1, 1, 32, 32);
  VRAM_ReserveTextureSpace(416, 448, 0, 4, 1, 32, 32);
  VRAM_ReserveTextureSpace(336, 320, 0, 2, 1, 64, 64);
  VRAM_ReserveTextureSpace(336, 256, 0, 4, 1, 64, 64);
  Heap_Init(g_ResourceBuffer, 389120);          // 389120  (~380 KB)
  FadeScreenIn(130u, 0x1000, 0, 4294967168);
  v15->Exit = 0;
  do
  {
    PrepareRenderPrimitives();
    RenderScene(v5, v6, v7);
    ControllerInput();
    Entities_UpdateAll();
    UpdateParticleSystem(v8);
    g_PhysicsReady = 0;
    ProcessCurrentMode();
    HandleUISequence();
    GatherCameraContext(v18, v19);
    UpdatePlayerMapContext(v18, v19);
    PrecomputeCardinalOrientations();
    ProcessAssetLoadQueue();
    ProcessCDAudioLoad();
    UpdatePlayerSystem(v18, v19);
  }
  while ( !*(v13 + 0x1A0) );
  StopPAD(v9, v10, v11, v12);
  v15 = *(v14 + 416);
  result = 9;
  if ( v15 == 1 )
  {
    result = 2;
    byte_800102F0 = 2;
    byte_800102F8 = g_LanguageID[0].header[0];
  }
  else if ( v15 == 9 )
  {
    byte_800102F0 = 0;
    byte_800102F8 = 1;
  }
  return result;
}
// 80013BA0: variable 'v0' is possibly undefined
// 80013C20: variable 'v1' is possibly undefined
// 80013C38: variable 'v2' is possibly undefined
// 80013C38: variable 'v3' is possibly undefined
// 80013D70: variable 'v15' is possibly undefined
// 80013D7C: variable 'v5' is possibly undefined
// 80013D7C: variable 'v6' is possibly undefined
// 80013D7C: variable 'v7' is possibly undefined
// 80013D94: variable 'v8' is possibly undefined
// 80013DE8: variable 'v13' is possibly undefined
// 80013DF8: variable 'v9' is possibly undefined
// 80013DF8: variable 'v10' is possibly undefined
// 80013DF8: variable 'v11' is possibly undefined
// 80013DF8: variable 'v12' is possibly undefined
// 80013E00: variable 'v14' is possibly undefined
// 800102F0: using guessed type char byte_800102F0;
// 800102F8: using guessed type char byte_800102F8;
// 801779D4: using guessed type __int16 g_bStartKeyState;
// 801779F0: using guessed type _DWORD GameDB01ObjectClassDeclaration[];
// 80180138: using guessed type char byte_80180138;
// 801951A0: using guessed type int g_RecalculateOrientationCache;
// 8019A628: using guessed type int dword_8019A628;
// 8019B4C4: using guessed type int dword_8019B4C4;
// 8019B4CE: using guessed type char g_PhysicsReady;
// 801B5198: using guessed type int dword_801B5198;
// 801CBD74: using guessed type _DWORD g_MapData[];
// 80013ACC: using guessed type _DWORD var_18[4];

//----- (80013FC0) --------------------------------------------------------
int Music_PlaySEQ()
{
  int result; // $v0
  int v1; // $a2
  __int16 v2; // $a3

  result = g_Option_Music;
  if ( g_Option_Music )
  {
    result = g_ExitTitleScreen;
    if ( g_ExitTitleScreen )
    {
      g_MenuTrackID = SEQ_Open(dword_8019A628, word_8019A65C);//   ?
      CDAudio_SetVolume(g_MenuTrackID, 60, 60);
      SEQ_Play(g_MenuTrackID, 1u, 0);
      g_IsAudioPlaying = 1;
      return SetMasterVolume(127, 127, v1, v2);
    }
  }
  return result;
}
// 80014040: variable 'v1' is possibly undefined
// 80014040: variable 'v2' is possibly undefined
// 8019A628: using guessed type int dword_8019A628;
// 8019A62C: using guessed type __int16 g_MenuTrackID;
// 8019A630: using guessed type int g_IsAudioPlaying;
// 8019A634: using guessed type int g_ExitTitleScreen;
// 8019A65C: using guessed type __int16 word_8019A65C;
// 8019B58C: using guessed type char g_Option_Music;

//----- (80014058) --------------------------------------------------------
int Music_Stop()
{
  int result; // $v0

  result = 1;
  if ( g_IsAudioPlaying == 1 )
  {
    CDAudio_Stop(g_MenuTrackID);
    result = SpuVoice_StopAll(g_MenuTrackID);
    g_IsAudioPlaying = 0;
  }
  return result;
}
// 8019A62C: using guessed type __int16 g_MenuTrackID;
// 8019A630: using guessed type int g_IsAudioPlaying;

//----- (800140B4) --------------------------------------------------------
int __fastcall sub_800140B4(int a1, int a2, int a3, __int16 a4)
{
  __int16 *v4; // $s1
  int i; // $s0
  int v6; // $a0

  SetMasterVolume(0, 0, a3, a4);
  v4 = &pSfxSlot;
  if ( g_IsAudioPlaying == 1 )
  {
    CDAudio_SetVolume(g_MenuTrackID, 0, 0);
    CDAudio_Stop(g_MenuTrackID);
    SpuVoice_StopAll(g_MenuTrackID);
  }
  for ( i = 129; i != -1; --i )
  {
    v6 = *v4;
    v4 += 4;
    if ( v6 != -1 )
      FreeSPUVoice(v6);
  }
  return sub_8005D29C();
}
// 8019A62C: using guessed type __int16 g_MenuTrackID;
// 8019A630: using guessed type int g_IsAudioPlaying;

//----- (80014170) --------------------------------------------------------
int __fastcall PlayPositionalSound3D(__int16 id, int *a2, int a3, int min_dist, int max_dist, int flags)
{
  int v9; // $s7
  int sound_id; // $s4
  unsigned int distance; // $v0
  BOOL v12; // $s0
  int v13; // $v0
  int v14; // $v0
  int v15; // $s3
  int v16; // $lo
  int volume; // $s2
  BOOL v18; // $v0
  int angle; // $s0
  BOOL v21; // $v0
  int v22; // $s0
  int vol_left; // $s1
  int vol_right; // $a2

  v9 = id & 0x8000;
  sound_id = id & 0xFFF;
  distance = SquareRoot0(
               ((*a2 - dword_8019A638) >> 3) * ((*a2 - dword_8019A638) >> 3)
             + ((a2[1] - dword_8019A63C) >> 3) * ((a2[1] - dword_8019A63C) >> 3)
             + ((a2[2] - dword_8019A640) >> 3) * ((a2[2] - dword_8019A640) >> 3));
  //  :   ?
  v12 = (8 * distance) < min_dist;
  v13 = max_dist - 8 * distance;
  if ( !v12 )
    return 0;
  v14 = v13 << 7;
  if ( !max_dist )
    _break(7u, 0);
  if ( max_dist == -1 && v14 == 0x80000000 )
    _break(6u, 0);
  v15 = v14 / max_dist;
  v16 = v14 / max_dist * a3;
  volume = v16 >> 7;
  ResolveCurrentMetaTile(*a2, a2[1], a2[2]);
  v18 = v16 >> 7 < 20;
  if ( g_TileLayerOffset != word_8019A648 )
  {
    volume = v16 >> 8;
    v18 = v16 >> 8 < 20;
  }
  if ( v18 )
    return 0;
  if ( volume >= 128 )
    volume = 127;
  //    -
  angle = (Math_Atan2_Fixed(*a2 - dword_8019A638, a2[2] - dword_8019A640) - (word_8019A64C - 1024)) & 0xFFF;
  v21 = v15 < 64;
  //     (  "")
  if ( angle >= 0x800 )
  {
    angle = 4096 - angle;
    v21 = v15 < 64;
  }
  v22 = angle >> 1;
  if ( !v21 && !v9 )
    v22 = (((v22 - 512) * (256 - 2 * v15)) >> 7) + 512;
  //  L/R   /
  vol_left = volume * FixedSin(v22) / 3400;
  if ( vol_left >= 128 )
    vol_left = 127;
  vol_right = volume * FixedCos(v22) / 3400;
  if ( vol_right >= 128 )
    LOWORD(vol_right) = 127;
  PlayAudioStream(sound_id, vol_left, vol_right, flags);
  return 1;
}
// 8019A638: using guessed type int dword_8019A638;
// 8019A63C: using guessed type int dword_8019A63C;
// 8019A640: using guessed type int dword_8019A640;
// 8019A648: using guessed type __int16 word_8019A648;
// 8019A64C: using guessed type __int16 word_8019A64C;
// 801DD57E: using guessed type __int16 g_TileLayerOffset;

//----- (800143E0) --------------------------------------------------------
int __fastcall sub_800143E0(__int16 a1, int *a2, __int16 a3, int a4)
{
  return PlayPositionalSound3D(a1, a2, a3, 18432, 24576, a4);
}

//----- (80014414) --------------------------------------------------------
int __fastcall PlayPositionalSound3D_Wrap(__int16 a1, int *a2, __int16 a3, int a4, int a5, int a6)
{
  return PlayPositionalSound3D(a1, a2, a3, a4, a5, a6);
}

//----- (80014448) --------------------------------------------------------
int __fastcall sub_80014448(int a1)
{
  __int16 *v1; // $a3
  int v2; // $a1
  int result; // $v0

  v1 = &word_8019AA8C[5 * *(a1 + 2)];
  v2 = word_8019AA8C[4 * *v1 - 540];
  result = 254;
  if ( v2 != -1 && v2 != 254 )
    return sub_80058A90(*a1, v2, v1[1], v1[2], v1[3]);
  return result;
}
// 8019AA8C: using guessed type __int16 word_8019AA8C[1180];

//----- (800144C0) --------------------------------------------------------
int __fastcall UpdatePlayerMapContext(_DWORD *a1, int *a2)
{
  int v4; // $v1
  int v5; // $a0
  int result; // $v0
  int v7; // $v1

  if ( a1 )
  {
    v4 = a1[1];
    v5 = a1[2];
    dword_8019A638 = *a1;
    dword_8019A63C = v4;
    dword_8019A640 = v5;
    dword_8019A644 = a1[3];
    ResolveCurrentMetaTile(*a1, a1[1], a1[2]);
    result = g_TileLayerOffset;
    word_8019A648 = g_TileLayerOffset;
  }
  if ( a2 )
  {
    result = *a2;
    v7 = a2[1];
    unk_8019A64A = *a2;
    unk_8019A64E = v7;
  }
  return result;
}
// 8019A638: using guessed type int dword_8019A638;
// 8019A63C: using guessed type int dword_8019A63C;
// 8019A640: using guessed type int dword_8019A640;
// 8019A644: using guessed type int dword_8019A644;
// 8019A648: using guessed type __int16 word_8019A648;
// 801DD57E: using guessed type __int16 g_TileLayerOffset;

//----- (80014570) --------------------------------------------------------
int __fastcall PlaySoundEffect(int a1, int a2)
{
  return PlayAudioStream(a1, a2, a2, 0);
}

//----- (80014594) --------------------------------------------------------
int sub_80014594()
{
  __int16 *v0; // $v1
  int i; // $a0
  int result; // $v0
  char v3[24]; // [sp+10h] [-18h] BYREF

  sub_80050B64(v3);
  v0 = &unk_8019AA64;
  for ( i = 9; i != -1; --i )
  {
    result = *v0;
    if ( result != -1 )
    {
      result = v3[result];
      if ( !result )
        *v0 = -1;
    }
    v0 += 2;
  }
  return result;
}
// 80014594: using guessed type char var_18[24];

//----- (800145F8) --------------------------------------------------------
__int16 *__fastcall sub_800145F8(int a1)
{
  _WORD *v1; // $s2
  __int16 *v3; // $s0
  int i; // $a1
  _WORD *v6; // $s0
  int j; // $a1
  int v8; // $a2
  int v9; // $a1
  _WORD *v10; // $a0

  sub_80014594();
  v3 = &unk_8019AA64;
  for ( i = 9; i != -1; --i )
  {
    if ( *v3 == -1 )
      return v3;
    v3 += 2;
  }
  v6 = &unk_8019AA64;
  for ( j = 9; j != -1; --j )
  {
    if ( v6[1] == a1 )
    {
      sub_80014448(v6);
      *v6 = -1;
      return v6;
    }
    v6 += 2;
  }
  v8 = 0x10000;
  v9 = 9;
  v10 = &unk_8019AA64;
  do
  {
    --v9;
    if ( word_8019AA8C[5 * *(v10 + 2) + 4] < v8 )
    {
      v8 = word_8019AA8C[5 * *(v10 + 2) + 4];
      v1 = v10;
    }
    v10 += 2;
  }
  while ( v9 != -1 );
  sub_80014448(v1);
  *v1 = -1;
  return v1;
}
// 800146DC: variable 'v1' is possibly undefined
// 8019AA8C: using guessed type __int16 word_8019AA8C[1180];

//----- (80014710) --------------------------------------------------------
int __fastcall PlayAudioStream(int a1, int a2, __int16 a3, int a4)
{
  __int16 v4; // $s2
  int result; // $v0
  __int16 *v9; // $s1
  int v10; // $v1
  bool v11; // dc
  int v12; // $v1
  unsigned __int16 *v13; // $s3
  int v14; // $v1
  __int16 *v15; // $v0
  int v16; // $s0
  __int16 *v17; // $s4
  int v18; // $v0

  v4 = a1;
  result = 255;
  if ( a1 != 255 )
  {
    result = g_Option_Sound;
    if ( g_Option_Sound )
    {
      result = 10 * a1;
      v9 = (word_8019AA8C + result);
      v10 = *(word_8019AA8C + result);
      v11 = v10 == -1;
      v12 = 8 * v10;
      if ( !v11 )
      {
        v13 = (&pSfxSlot + v12);
        v14 = *(&pSfxSlot + v12);
        result = 254;
        if ( v14 != -1 && v14 != 254 )
        {
          v15 = sub_800145F8(a1);
          v16 = a4 + v9[3];
          v17 = v15;
          if ( v16 >= 0 )
          {
            v18 = a2 << 16;
            if ( v16 < 128 )
            {
LABEL_11:
              result = SPU_PlayVoice(*v13, v9[1], v9[2], v16, 0, SHIWORD(v18), a3);
              *v17 = result;
              v17[1] = v4;
              return result;
            }
            LOWORD(v16) = 127;
          }
          else
          {
            LOWORD(v16) = 0;
          }
          v18 = a2 << 16;
          goto LABEL_11;
        }
      }
    }
  }
  return result;
}
// 8019AA8C: using guessed type __int16 word_8019AA8C[1180];
// 8019B58B: using guessed type char g_Option_Sound;

//----- (80014844) --------------------------------------------------------
int __fastcall OnAudioStreamComplete(int task)
{
  int result; // $v0
  __int16 *v3; // $s1
  int v4; // $a0
  __int16 v5; // $v0

  if ( *(task + 24) )                           // task->status
  {
    result = 2;
    if ( *(task + 24) == 1 )
      *(task + 24) = 2;
  }
  else
  {
    v3 = (&pSfxSlot + 8 * *(task + 26));
    if ( VerifyChecksum(*(*(task + 28) + 4), *(task + 16)) )
    {
      *(task + 1) = 0;                          //     
      do
        result = CdControl(0x16u, (task + 6), 0);
      while ( !result );
    }
    else
    {
      v4 = *v3;
      if ( v4 != -1 )
        FreeSPUVoice(v4);
      v5 = SsVabOpenHead(*(*(task + 28) + 4), -1);
      *v3 = v5;
      if ( v5 == -1 )
      {
        return NextCdTask(task);
      }
      else
      {
        ConvertCdAddress((task + 2), *(task + 16), (task + 2));
        *(task + 24) = 1;
        *(task + 12) = &g_CDReadBuffer;
        *(task + 1) = 0;
        *(task + 16) = 18;
        do
          result = CdControl(0x16u, (task + 2), 0);
        while ( !result );
      }
    }
  }
  return result;
}
// 801BA8AC: using guessed type int g_CDReadBuffer;

//----- (80014988) --------------------------------------------------------
void ProcessCDAudioLoad()
{
  int v0; // $s0
  __int16 *v1; // $s1
  int v2; // $v1
  int v3; // $a1

  EnterCriticalSection();
  v0 = g_ActiveCdStream;                        // //      InitEventSystem()
  if ( *g_ActiveCdStream == 48 && *(g_ActiveCdStream + 24) == 2 )// 48 (0x30)   = CD Audio, 2  =  
  {
    ExitCriticalSection();
    v1 = (&pSfxSlot + 8 * *(v0 + 26));
    while ( 1 )
    {
      v2 = sub_80051EB0(*(v0 + 12), 0x9000u, *v1);// //   DMA
      if ( v2 != -1 )                           // // -1 =   
        break;
      FreeSPUVoice(*v1);                        //  
      NextCdTask(v0);                           //   
    }
    if ( v2 == -2 )
    {
      v3 = *(v0 + 16);
      *(v0 + 1) = 0;
      *(v0 + 24) = 1;
      ConvertCdAddress((v0 + 2), v3, (v0 + 2));
      while ( !CdControl(0x16u, (v0 + 2), 0) )
        ;
      SsVabTransCompleted(1);
    }
    else if ( v2 == *v1 )
    {
      NextCdTask(v0);
      SsVabTransCompleted(1);
      **(v0 + 28) = 1;
      *(v0 + 16) = 0;
    }
  }
  else
  {
    ExitCriticalSection();
  }
}
// 8005C564: using guessed type int __fastcall SsVabTransCompleted(_DWORD);
// 801BA848: using guessed type int g_ActiveCdStream;

//----- (80014AD0) --------------------------------------------------------
_WORD *FindFreeAudioChannel()
{
  _WORD *v0; // $s1
  int i; // $a1
  _WORD *v3; // $s1
  int v4; // $a1
  __int16 *v5; // $s0
  int v6; // $a1
  int v7; // $a0

  v0 = &g_StreamContexts;                       //   5 
  for ( i = 4; i != -1; --i )
  {
    if ( !*v0 )
      return v0;                                //   !
    v0 += 4;
  }                                             //        2 ()
  v3 = &g_StreamContexts;
  v4 = 4;
  while ( 1 )
  {
    --v4;
    if ( *v3 == 2 )
      break;                                    //  
    v3 += 4;
    if ( v4 == -1 )
      return 0;
  }
  v5 = &pSfxSlot;
  v6 = 129;
  while ( 1 )
  {
    v7 = *v5;
    --v6;
    if ( v7 != -1 && *(v5 + 1) == v3 )
      break;
    v5 += 4;
    if ( v6 == -1 )
      goto LABEL_11;
  }
  FreeSPUVoice(v7);                             //    SpuFree()
  *v5 = -1;
  *(v5 + 1) = 0;
LABEL_11:
  *v3 = 0;
  return v3;
}

//----- (80014BB0) --------------------------------------------------------
int __fastcall StartAudioStream(unsigned __int16 audio_type, __int16 a2, int a3)
{
  __int16 v5; // $s2
  char *v6; // $s0
  _DWORD *v7; // $s1
  _WORD *FreeAudioChannel; // $v0
  bool v9; // dc
  int result; // $v0
  int v11; // $s0

  v5 = a3;
  v6 = &pSfxSlot + 8 * a3;                      //    (129 !)
  if ( !a3 )
  {
    v7 = &unk_8019B4BC;                         //  0
    goto LABEL_7;
  }
  v7 = &unk_8019B4B4;                           //  1
  if ( a3 == 1 )
  {
LABEL_7:
    *(v6 + 1) = v7;
    *v7 = 3;
    v11 = g_CDTaskQueue;
    WaitForTaskComplete(g_CDTaskQueue);
    *(v11 + 24) = 0;
    *(v11 + 28) = v7;
    *(v11 + 26) = v5;
    return CreateAudioCDTask(audio_type, 2 * a2, v7[1], OnAudioStreamComplete);
  }
  FreeAudioChannel = FindFreeAudioChannel();    //   
  v7 = FreeAudioChannel;
  v9 = FreeAudioChannel == 0;
  result = 254;
  if ( !v9 )
  {
    *v6 = 254;
    goto LABEL_7;
  }
  return result;
}
// 801BA844: using guessed type int g_CDTaskQueue;

//----- (80014C84) --------------------------------------------------------
int __fastcall sub_80014C84(__int16 a1, __int16 a2, int a3)
{
  int v3; // $a0
  int v4; // $a1
  __int16 v5; // $v0
  int v6; // $a0
  BOOL v7; // $v0
  int v8; // $a0
  int v9; // $v0
  BOOL v10; // $v0
  __int16 v11; // $v0
  bool v12; // dc
  int result; // $v0

  v3 = a1 & 0xFFF;
  v4 = a2 & 0xFFF;
  if ( v4 == v3 )
    return v4;
  if ( v3 >= v4 )
  {
    v11 = v3 - a3;
    if ( v3 - v4 < 2049 )
    {
      v6 = v3 - a3;
      v7 = v11 < v4;
LABEL_9:
      v12 = !v7;
      v9 = v6 << 16;
      if ( !v12 )
        return v4;
      return v9 >> 16;
    }
    v8 = (v3 + a3) & 0xFFF;
    v10 = v8 < v4;
    if ( v8 >= 2049 )
      goto LABEL_13;
    goto LABEL_12;
  }
  v5 = v3 + a3;
  if ( v4 - v3 < 2049 )
  {
    v6 = v3 + a3;
    v7 = v4 < v5;
    goto LABEL_9;
  }
  v8 = (v3 - a3) & 0xFFF;
  v9 = v8 << 16;
  if ( v8 >= 2048 )
  {
    v10 = v4 < v8;
LABEL_12:
    v12 = !v10;
    result = v4;
    if ( v12 )
      return result;
LABEL_13:
    v9 = v8 << 16;
  }
  return v9 >> 16;
}

//----- (80014D48) --------------------------------------------------------
int __fastcall sub_80014D48(int a1, int a2, int a3)
{
  BOOL v3; // $v0

  if ( a3 <= 0 )
  {
    if ( a2 < a1 )
    {
      a1 += a3;
      v3 = a1 < a2;
      goto LABEL_11;
    }
    if ( a1 >= a2 )
      return a1;
    a1 -= a3;
    goto LABEL_10;
  }
  if ( a1 < a2 )
  {
    a1 += a3;
LABEL_10:
    v3 = a2 < a1;
    goto LABEL_11;
  }
  if ( a2 >= a1 )
    return a1;
  a1 -= a3;
  v3 = a1 < a2;
LABEL_11:
  if ( v3 )
    return a2;
  return a1;
}

//----- (80014DB0) --------------------------------------------------------
signed int __fastcall sub_80014DB0(_DWORD *a1, _DWORD *a2, int a3, _WORD *a4)
{
  int v6; // $s0
  int v7; // $s1
  int v8; // $s2
  signed int result; // $v0

  v6 = *a2 - *a1;
  v7 = a2[1] - a1[1];
  v8 = a2[2] - a1[2];
  result = sub_80015990(v6, v7, v8);
  if ( result == -1 && v6 * a3 == 0x80000000 )
    _break(6u, 0);
  if ( result == -1 && v7 * a3 == 0x80000000 )
    _break(6u, 0);
  if ( result == -1 && v8 * a3 == 0x80000000 )
    _break(6u, 0);
  *a4 = v6 * a3 / result;
  a4[1] = v7 * a3 / result;
  a4[2] = v8 * a3 / result;
  return result;
}
// 80014E14: conditional instruction was optimized away because $v0.4!=0
// 80014E48: conditional instruction was optimized away because $v0.4!=0
// 80014E7C: conditional instruction was optimized away because $v0.4!=0

//----- (80014ED4) --------------------------------------------------------
int __fastcall sub_80014ED4(int a1, int a2, int a3, int a4, int a5)
{
  int result; // $v0

  if ( !Math_IsAngleInRange(a1, a2, a4 >> 1) || a4 < a3 || (result = a1 - a2, a3 < -a4) )
  {
    if ( a2 != a1 )
    {
      if ( sub_800157D4(a2, a1) )
        a3 -= a4;
      else
        a3 += a4;
    }
    if ( a3 > 0 )
      return a3 - a5;
    result = a3;
    if ( a3 >= 0 )
      return result;
    return a3 + a5;
  }
  return result;
}

//----- (80014FAC) --------------------------------------------------------
int __fastcall sub_80014FAC(__int16 a1, _DWORD *a2)
{
  int v3; // $s1
  int result; // $v0

  v3 = a1;
  *a2 = -FixedSin(a1);
  result = FixedCos(v3);
  a2[1] = result;
  return result;
}

//----- (80014FFC) --------------------------------------------------------
int __fastcall RotateMatrixCardinal(_WORD *a1, _WORD *a2, int a3)
{
  int result; // $v0

  result = a3 < 2;
  if ( a3 == 1 )
  {
    *a2 = -a1[2];
    a2[1] = a1[1];
    a2[2] = *a1;
    a2[3] = -a1[5];
    a2[4] = a1[4];
    a2[5] = a1[3];
    a2[6] = -a1[8];
    a2[7] = a1[7];
    result = a1[6];
    a2[8] = result;
    return result;
  }
  if ( a3 >= 2 )
  {
    result = 3;
    if ( a3 == 2 )
    {
      *a2 = -*a1;
      a2[1] = a1[1];
      a2[2] = -a1[2];
      a2[3] = -a1[3];
      a2[4] = a1[4];
      a2[5] = -a1[5];
      a2[6] = -a1[6];
      a2[7] = a1[7];
      result = -a1[8];
    }
    else
    {
      if ( a3 != 3 )
        return result;
      *a2 = a1[2];
      a2[1] = a1[1];
      a2[2] = -*a1;
      a2[3] = a1[5];
      a2[4] = a1[4];
      a2[5] = -a1[3];
      a2[6] = a1[8];
      a2[7] = a1[7];
      result = -a1[6];
    }
    a2[8] = result;
    return result;
  }
  if ( !a3 )
  {
    *a2 = *a1;
    a2[1] = a1[1];
    a2[2] = a1[2];
    a2[3] = a1[3];
    a2[4] = a1[4];
    a2[5] = a1[5];
    a2[6] = a1[6];
    a2[7] = a1[7];
    result = a1[8];
    a2[8] = result;
  }
  return result;
}

//----- (80015304) --------------------------------------------------------
int __fastcall sub_80015304(__int16 a1, int a2)
{
  int v3; // $s0
  __int16 v4; // $v0
  int v5; // $a0
  int result; // $v0

  v3 = a1;
  v4 = FixedSin(a1);
  v5 = v3;
  LOWORD(v3) = v4;
  result = FixedCos(v5);
  *a2 = 4096;
  *(a2 + 2) = 0;
  *(a2 + 4) = 0;
  *(a2 + 6) = 0;
  *(a2 + 8) = result;
  *(a2 + 10) = -v3;
  *(a2 + 14) = v3;
  *(a2 + 16) = result;
  return result;
}

//----- (80015378) --------------------------------------------------------
int __fastcall sub_80015378(__int16 a1, int a2)
{
  int v3; // $s0
  __int16 v4; // $v0
  int v5; // $a0
  int result; // $v0

  v3 = a1;
  v4 = FixedSin(a1);
  v5 = v3;
  LOWORD(v3) = v4;
  result = FixedCos(v5);
  *(a2 + 4) = -v3;
  *a2 = result;
  *(a2 + 2) = 0;
  *(a2 + 6) = 0;
  *(a2 + 8) = 4096;
  *(a2 + 12) = v3;
  *(a2 + 14) = 0;
  *(a2 + 16) = result;
  return result;
}

//----- (800153EC) --------------------------------------------------------
int __fastcall sub_800153EC(__int16 a1, int a2)
{
  int v3; // $s0
  __int16 v4; // $v0
  int v5; // $a0
  __int16 v6; // $v0
  int result; // $v0

  v3 = a1;
  v4 = FixedSin(a1);
  v5 = v3;
  LOWORD(v3) = v4;
  v6 = FixedCos(v5);
  *a2 = v6;
  *(a2 + 8) = v6;
  result = 4096;
  *(a2 + 2) = -v3;
  *(a2 + 6) = v3;
  *(a2 + 10) = 0;
  *(a2 + 12) = 0;
  *(a2 + 14) = 0;
  *(a2 + 16) = 4096;
  return result;
}

//----- (80015460) --------------------------------------------------------
unsigned __int16 *__fastcall sub_80015460(__int16 *a1, int *a2)
{
  int v5[8]; // [sp+10h] [-20h] BYREF

  sub_800153EC(a1[2], v5);
  sub_80015304(*a1, a2);
  sub_8005DCEC(a2, v5);
  sub_80015378(a1[1], v5);
  return sub_8005DDF8(v5, a2);
}
// 80015460: using guessed type int var_20[8];

//----- (800154CC) --------------------------------------------------------
unsigned __int16 *__fastcall sub_800154CC(__int16 *a1, int *a2)
{
  int v5[8]; // [sp+10h] [-20h] BYREF

  sub_80015378(a1[1], v5);
  sub_800153EC(a1[2], a2);
  sub_8005DCEC(a2, v5);
  sub_80015304(*a1, v5);
  return sub_8005DDF8(v5, a2);
}
// 800154CC: using guessed type int var_20[8];

//----- (80015538) --------------------------------------------------------
int __fastcall sub_80015538(_WORD *a1, _WORD *a2)
{
  int result; // $v0
  int v5[8]; // [sp+10h] [-58h] BYREF
  int v6[8]; // [sp+30h] [-38h] BYREF
  __int16 v7; // [sp+50h] [-18h] BYREF
  __int16 v8; // [sp+52h] [-16h]
  unsigned __int16 v9; // [sp+54h] [-14h]
  __int16 v10; // [sp+58h] [-10h] BYREF
  __int16 v11; // [sp+5Ch] [-Ch]
  unsigned __int16 v12; // [sp+60h] [-8h]

  v7 = 0;
  v8 = 0;
  v9 = 4096;
  sub_80015304(-*a1, v5);
  ApplyMatrix(v5, &v7, &v10);
  v7 = v10;
  v8 = v11;
  v9 = v12;
  sub_80015378(a1[1], v6);
  ApplyMatrix(v6, &v7, &v10);
  *a2 = v10;
  a2[1] = v11;
  result = v12;
  a2[2] = v12;
  return result;
}
// 80015538: using guessed type int var_58[8];
// 80015538: using guessed type int var_38[8];

//----- (80015614) --------------------------------------------------------
int __fastcall sub_80015614(__int16 *a1, int a2, int a3)
{
  int v6[8]; // [sp+10h] [-20h] BYREF

  sub_80015460(a1, v6);
  return ApplyMatrix(v6, a2, a3);
}
// 80015614: using guessed type int var_20[8];

//----- (8001565C) --------------------------------------------------------
int __fastcall sub_8001565C(__int16 a1, int *a2)
{
  int v2; // $v1
  int result; // $v0

  v2 = a2[1];
  *a2 = (a1 * *a2) >> 11;
  result = (a1 * v2) >> 11;
  a2[1] = result;
  return result;
}

//----- (80015694) --------------------------------------------------------
int __fastcall sub_80015694(__int16 a1, __int16 *a2)
{
  int v2; // $v1
  int v3; // $lo
  int result; // $v0

  v2 = a2[1] * a1;
  v3 = a2[2] * a1;
  *a2 = (*a2 * a1) >> 12;
  a2[1] = v2 >> 12;
  result = v3 >> 12;
  a2[2] = v3 >> 12;
  return result;
}

//----- (80015798) --------------------------------------------------------
int __fastcall Math_IsAngleInRange(__int16 a1, __int16 a2, __int16 a3)
{
  int v3; // $a0
  int v4; // $v1

  v3 = (a1 - a2) & 0xFFF;
  v4 = 0;
  if ( a3 >= v3 || v3 >= 4096 - a3 )
    return 1;
  return v4;
}

//----- (800157D4) --------------------------------------------------------
BOOL __fastcall sub_800157D4(__int16 a1, __int16 a2)
{
  return ((a1 - a2) & 0xFFFu) < 0x801;
}

//----- (800157E4) --------------------------------------------------------
int __fastcall sub_800157E4(__int16 a1, __int16 a2)
{
  int v2; // $a0
  int result; // $v0

  v2 = (a2 - a1) & 0xFFF;
  result = v2;
  if ( v2 >= 2049 )
    return v2 - 4096;
  return result;
}

//----- (80015804) --------------------------------------------------------
int __fastcall Math_Atan2_Fixed(int a1, int a2)
{
  int v3; // $v1
  int v4; // $v0
  int v5; // $a0
  int v7; // $a0

  v3 = a1;
  if ( a1 < 0 )
    v3 = -a1;
  v4 = a2;
  if ( a2 < 0 )
    v4 = -a2;
  if ( v4 < v3 )
  {
    v7 = a2 << 12;
    if ( a1 >= 0 )
    {
      if ( !a1 )
        _break(7u, 0);
      return Math_CORDIC_Atan(v7 / a1) + 3072;
    }
    else
    {
      if ( a1 == -1 && v7 == 0x80000000 )
        _break(6u, 0);
      return Math_CORDIC_Atan(v7 / a1) + 1024;
    }
  }
  else
  {
    v5 = a1 << 12;
    if ( a2 <= 0 )
    {
      if ( a2 >= 0 )
      {
        return 0;
      }
      else
      {
        if ( a2 == -1 && v5 == 0x80000000 )
          _break(6u, 0);
        return 2048 - Math_CORDIC_Atan(v5 / a2);
      }
    }
    else
    {
      return -Math_CORDIC_Atan(v5 / a2) & 0xFFF;
    }
  }
}
// 8001583C: conditional instruction was optimized away because $a1.4>=1
// 8001584C: conditional instruction was optimized away because $a1.4>=1
// 80015884: conditional instruction was optimized away because $a1.4<0
// 800158D4: conditional instruction was optimized away because $a2.4<0
// 80015920: conditional instruction was optimized away because $a2.4>=1

//----- (80015954) --------------------------------------------------------
unsigned int __fastcall CalculateDistance(int a1, int a2)
{
  return 8 * SquareRoot0((a1 >> 3) * (a1 >> 3) + (a2 >> 3) * (a2 >> 3));
}

//----- (80015990) --------------------------------------------------------
unsigned int __fastcall sub_80015990(int a1, int a2, int a3)
{
  return 8 * SquareRoot0((a1 >> 3) * (a1 >> 3) + (a2 >> 3) * (a2 >> 3) + (a3 >> 3) * (a3 >> 3));
}

//----- (800159DC) --------------------------------------------------------
int __fastcall sub_800159DC(int a1, int a2, int a3, _WORD *a4)
{
  int v8; // $v0
  int result; // $v0

  a4[1] = Math_Atan2_Fixed(a1, a3);
  v8 = CalculateDistance(a1, a3);
  result = -Math_Atan2_Fixed(a2, v8) & 0xFFF;
  *a4 = result;
  a4[2] = 0;
  return result;
}

//----- (80015A58) --------------------------------------------------------
BOOL __fastcall Math_IsTargetInVerticalRange(int entityY, int entityHeight, int targetY, int toleranceUp)
{
  BOOL v4; // $v0

  // a1:  (Y) 
  // a2:    ( )
  // a3:  (Y)  (  )
  // a4:   ( 2100)

  //    
  if ( targetY >= entityY )
    // ,      (  2100 )
    v4 = entityY < targetY - toleranceUp;
  else
    // ,     ( ,    )
    v4 = targetY < entityY - entityHeight;
  return !v4;
}

//----- (80015A88) --------------------------------------------------------
int __fastcall GetDistanceIfInRange(
        Vector3 *objPos,
        int targetX,
        int targetY,
        int targetZ,
        signed int maxRange,
        int heightLimitUp,
        int heightLimitDown)
{
  signed int dx; // $v1
  int result; // $v0
  signed int dz; // $a3
  int dy; // $a0
  int v11; // $v1
  signed int v12; // $v1

  dx = objPos->X - targetX;
  result = -1;
  if ( dx >= -maxRange )
  {
    result = -1;
    if ( maxRange >= dx )
    {
      dz = objPos->Z - targetZ;
      result = -1;
      if ( dz >= -maxRange )
      {
        result = -1;
        if ( maxRange >= dz )
        {
          if ( targetY != 0xFFFF )
          {
            dy = objPos->Y;
            if ( dy < targetY )
            {
              v11 = dx >> 3;
              if ( dy < targetY - heightLimitDown )
                return -1;
              goto LABEL_11;
            }
            result = -1;
            if ( targetY < dy - heightLimitUp )
              return result;
          }
          v11 = dx >> 3;
LABEL_11:
          v12 = 8 * SquareRoot0(v11 * v11 + (dz >> 3) * (dz >> 3));
          result = -1;
          if ( maxRange >= v12 )
            return v12;
        }
      }
    }
  }
  return result;
}

//----- (80015B74) --------------------------------------------------------
int __fastcall sub_80015B74(_DWORD *a1, int a2, _DWORD *a3, signed int a4, int a5)
{
  int v6; // $s0
  int v7; // $a3
  int v8; // $t0
  int v9; // $a1
  int v10; // $a0
  signed int v11; // $v1
  int result; // $v0

  v6 = a2 + a4;
  v7 = -(a2 + a4);
  v8 = *a3 - *a1;
  if ( v8 < v7 )
    return -9999999;
  if ( v6 < v8 )
    return -9999999;
  v9 = a3[2] - a1[2];
  if ( v9 < v7 )
    return -9999999;
  if ( v6 < v9 )
    return -9999999;
  v10 = a3[1] - a1[1] - (a5 >> 1);
  if ( v10 < v7 )
    return -9999999;
  if ( v6 < v10 )
    return -9999999;
  v11 = 8 * SquareRoot0((v8 >> 3) * (v8 >> 3) + (v9 >> 3) * (v9 >> 3) + (v10 >> 3) * (v10 >> 3));
  if ( v6 < v11 )
    return -9999999;
  result = v11 - a4;
  if ( a4 >= v11 )
    return 0;
  return result;
}

//----- (80015C80) --------------------------------------------------------
int __fastcall AI_GetRandomizedWeight(int base_priority)
{
  int v2; // $a0
  int v3; // $s1

  v3 = rand(base_priority);
  return ((v3 + rand(v2)) * base_priority) >> 15;
}
// 80015C98: variable 'v2' is possibly undefined
// 80062BF0: using guessed type int __fastcall rand(_DWORD);

//----- (80015CC8) --------------------------------------------------------
int __fastcall sub_80015CC8(int a1)
{
  int v2; // $a0
  int v3; // $s0

  v3 = rand(a1);
  return ((v3 + rand(v2) - 0x8000) * a1) >> 15;
}
// 80015CE0: variable 'v2' is possibly undefined
// 80062BF0: using guessed type int __fastcall rand(_DWORD);

//----- (80015D18) --------------------------------------------------------
int __fastcall FixedPointLerp(int a1, int a2, int a3)
{
  return (((a2 - a1) * a3) >> 12) + a1;
}

//----- (80015D30) --------------------------------------------------------
int __fastcall sub_80015D30(__int16 a1, __int16 a2, int a3)
{
  int v3; // $a1
  int v4; // $lo

  v3 = (a2 - a1) & 0xFFF;
  v4 = v3 * a3;
  if ( v3 >= 2049 )
    v4 = (v3 - 4096) * a3;
  return (a1 + (v4 >> 12)) & 0xFFF;
}

//----- (80015D70) --------------------------------------------------------
int __fastcall LerpRotationMatrix(__int16 *a1, __int16 *a2, _WORD *a3, __int16 a4)
{
  int i; // $t0
  __int16 v6; // $a0
  int v7; // $v1
  int result; // $v0

  for ( i = 8; i != -1; --i )
  {
    v6 = *a1;
    v7 = *a2++ - *a1++;
    result = (v7 * a4) >> 12;
    *a3++ = v6 + result;
  }
  return result;
}

//----- (80015DD0) --------------------------------------------------------
int __fastcall sub_80015DD0(int a1, int a2, int a3, int a4, int a5, signed int *a6, int *a7)
{
  int v8; // $s0
  int v12; // $a0
  unsigned int v13; // $a0
  int v14; // $v1
  int v15; // $v0
  int v16; // $a2
  int v17; // $v1
  int v18; // $lo
  int v19; // $v1
  BOOL v21; // $v0
  int v22; // $s0
  signed int v23; // $v0
  int v24; // $a0
  int v25; // $lo
  int v26; // $a0
  int v27; // $lo

  v8 = a4 * a4;
  v12 = ((a5 * a5) >> 6) * ((a5 * a5) >> 6)
      - ((a4 * a4 * a2) >> 10) * (a2 >> 2)
      - ((a4 * ((a5 * a5) >> 6)) >> 3) * (a3 >> 2);
  if ( v12 < 0 )
    return -1;
  v13 = 4 * SquareRoot0(16 * v12);
  v14 = ((a5 * a5) >> 2) - ((a3 * a4) >> 2);
  v15 = 2 * (v14 + v13);
  if ( !v8 )
    _break(7u, 0);
  if ( v8 == -1 && v15 == 0x80000000 )
    _break(6u, 0);
  v16 = v15 / v8;
  v17 = 2 * (v14 - v13);
  if ( v8 == -1 && v17 == 0x80000000 )
    _break(6u, 0);
  v18 = v17 / v8;
  v19 = v17 / v8;
  if ( v16 <= 0 && v18 <= 0 )
    return -1;
  v21 = v16 < v18;
  if ( a1 )
  {
    v22 = v18;
LABEL_17:
    if ( !v21 )
      v22 = v16;
    goto LABEL_19;
  }
  v22 = v18;
  if ( v16 > 0 )
  {
    v21 = v19 < v16;
    goto LABEL_17;
  }
LABEL_19:
  v23 = SquareRoot0(v22 << 14);
  if ( !a5 )
    _break(7u, 0);
  if ( a5 == -1 && a2 << 14 == 0x80000000 )
    _break(6u, 0);
  if ( !v23 )
    _break(7u, 0);
  if ( v23 == -1 && (a2 << 14) / a5 == 0x80000000 )
    _break(6u, 0);
  v24 = (a3 + 2 * a4 * v22) << 12;
  v25 = v24 / (a5 >> 1);
  if ( !(a5 >> 1) )
    _break(7u, 0);
  if ( a5 >> 1 == -1 && v24 == 0x80000000 )
    _break(6u, 0);
  v26 = v24 / (a5 >> 1);
  v27 = v25 / (v23 >> 1);
  if ( !(v23 >> 1) )
    _break(7u, 0);
  if ( v23 >> 1 == -1 && v26 == 0x80000000 )
    _break(6u, 0);
  *a6 = v23;
  *a7 = Math_Atan2_Fixed(v27, (a2 << 14) / a5 / v23);
  return 0;
}
// 80015ED4: conditional instruction was optimized away because $s0.4!=0

//----- (8001605C) --------------------------------------------------------
int __fastcall sub_8001605C(
        int a1,
        int a2,
        int a3,
        int a4,
        int a5,
        int a6,
        int a7,
        int a8,
        int a9,
        _WORD *a10,
        _WORD *a11,
        _WORD *a12)
{
  int v14; // $v0
  int result; // $v0
  signed int v16; // [sp+20h] [-8h] BYREF
  int v17; // [sp+24h] [-4h] BYREF

  v14 = CalculateDistance(a5 - a2, a7 - a4);
  result = sub_80015DD0(a1, v14, a3 - a6, a8, a9, &v16, &v17);
  if ( !result )
  {
    *a11 = (a9 * FixedCos(v17)) >> 12;
    *a12 = (a9 * -FixedSin(v17)) >> 12;
    *a10 = v16;
    return 0;
  }
  return result;
}

//----- (80016168) --------------------------------------------------------
int __fastcall sub_80016168(_DWORD *a1, __int16 *a2, int a3, _DWORD *a4)
{
  int result; // $v0

  *a4 = *a2 * a3 + *a1;
  a4[1] = a2[1] * a3 + a1[1];
  result = a2[2] * a3 + a1[2];
  a4[2] = result;
  return result;
}

//----- (800161C0) --------------------------------------------------------
void nullsub_5()
{
  ;
}

//----- (800161C8) --------------------------------------------------------
int LoadGameData()
{
  _DWORD *v0; // $s0
  _DWORD *v1; // $s0
  _DWORD *v2; // $s0
  _DWORD *v3; // $s0
  _DWORD *v4; // $s0
  _DWORD *v5; // $s0
  _DWORD *v6; // $s0
  _DWORD *v7; // $s0

  g_bStartKeyState = 0;
  g_TitleSeqState = 0;
  g_TitleColor = 0;
  g_TitleBrightness = 0;
  byte_801779DD = 0;
  LoadFileByIndex(RES_MO, "COM\\MO.T");         // MO
  LoadFileByIndex(RES_TALK, "COM\\TALK0.T");    // TALK0
  LoadFileByIndex(RES_VAB, "COM\\VAB.T");       // VAB
  LoadFileByIndex(RES_FDAT, "COM\\FDAT.T");     // FDAT
  LoadFileByIndex(RES_RTIM, "COM\\RTIM.T");     // RTIM
  LoadFileByIndex(RES_RTMD, "COM\\RTMD.T");     // RTMD
  LoadFileByIndex(RES_ITEM, "COM\\ITEM0.T");    // 6 - ITEM
  ExtractFileSections(RES_FDAT, 0x30u, g_ResourceBuffer);
  QueueCDReadTask(RES_FDAT, 0x2Fu);
  StartAudioStream(RES_VAB, 0, 0);
  MemcpyDword(GameDB01ObjectClassDeclaration, dword_8009E120, g_ResourceBuffer[0] >> 2);
  v0 = (&g_ResourceBuffer[1] + g_ResourceBuffer[0]);
  MemcpyDword(g_EquipmentDatabase, v0 + 1, *v0 >> 2);
  v1 = (v0 + *v0 + 4);
  MemcpyDword(dword_801DD5B8, v1 + 1, *v1 >> 2);
  v2 = (v1 + *v1 + 4);
  MemcpyDword(&g_LevelStatEntry, v2 + 1, *v2 >> 2);
  v3 = (v2 + *v2 + 4);
  MemcpyDword(g_SpellEntryTable, v3 + 1, *v3 >> 2);
  v4 = (v3 + *v3 + 4);
  MemcpyDword(g_PrimitiveTable, v4 + 1, *v4 >> 2);
  v5 = (v4 + *v4 + 4);
  MemcpyDword(word_8019AA8C, v5 + 1, *v5 >> 2);
  v6 = (v5 + *v5 + 4);
  MemcpyDword(g_BasicPrimitiveDefs, v6 + 1, *v6 >> 2);
  v7 = (v6 + *v6 + 4);
  RegisterPrimitiveTypes(0, g_BasicPrimitiveDefs);// 0-39 (40 )  
  MemcpyDword(g_ExtendedPrimitiveDefs, v7 + 1, *v7 >> 2);
  RegisterPrimitiveTypes(0x28u, g_ExtendedPrimitiveDefs);// 40-79 (40 )  
  return PlayerSetDefault();
}
// 8006E4E4: using guessed type int g_PrimitiveTable[10];
// 80088E44: using guessed type _DWORD g_ExtendedPrimitiveDefs[21504];
// 8009E120: using guessed type int dword_8009E120[97279];
// 800FD11C: using guessed type _DWORD g_BasicPrimitiveDefs[1625];
// 801779D4: using guessed type __int16 g_bStartKeyState;
// 801779D6: using guessed type __int16 g_TitleSeqState;
// 801779D8: using guessed type int g_TitleColor;
// 801779DC: using guessed type char g_TitleBrightness;
// 801779DD: using guessed type char byte_801779DD;
// 801779F0: using guessed type _DWORD GameDB01ObjectClassDeclaration[];
// 8019AA8C: using guessed type __int16 word_8019AA8C[1180];
// 801CB8AC: using guessed type _DWORD g_EquipmentDatabase[306];
// 801DD5B8: using guessed type _DWORD dword_801DD5B8[512];

//----- (8001646C) --------------------------------------------------------
int TitleScreen()
{
  char v0; // $v1
  char v1; // $a0
  char v2; // $a1
  char v3; // $a2
  char v4; // $a3

  v0 = g_TitleColor;
  v1 = BYTE1(g_TitleColor);
  v2 = BYTE2(g_TitleColor);
  v3 = HIBYTE(g_TitleColor);
  v4 = g_TitleBrightness;
  g_bStartKeyState = 1;                         // 0 -  , 1 - 
  g_TitleColor = 0x63636363;
  g_TitleBrightness = 0x63;
  g_TitleSeqState = 0;
  g_TitleRGB_R = 127;
  g_TitleRGB_G = 127;
  g_TitleRGB_B = 127;
  g_TitleAnimFrame = v0;
  byte_801779E5 = v1;
  byte_801779E6 = v2;
  byte_801779E7 = v3;
  byte_801779E8 = v4;
  do
  {
    // ProcessCDAudioLoad();
    //   ProcessAssetLoadQueue();
    //   WaitForDmaComplete(0);
    //   return VSync(0);
    PadStartCom();
    HandleUISequence();
  }
  while ( g_bStartKeyState );
  SetStateCallback(0, &unk_80130A90);           //  dword_80190240[a1] = a2;   
  return (*&g_CurrentStateVTable->gap0[20])();  // CallVTableFunction(g_CurrentStateVTable + 20);
}
// 801779D4: using guessed type __int16 g_bStartKeyState;
// 801779D6: using guessed type __int16 g_TitleSeqState;
// 801779D8: using guessed type int g_TitleColor;
// 801779DC: using guessed type char g_TitleBrightness;
// 801779E4: using guessed type char g_TitleAnimFrame;
// 801779E5: using guessed type char byte_801779E5;
// 801779E6: using guessed type char byte_801779E6;
// 801779E7: using guessed type char byte_801779E7;
// 801779E8: using guessed type char byte_801779E8;
// 801779EB: using guessed type char g_TitleRGB_R;
// 801779EC: using guessed type char g_TitleRGB_G;
// 801779ED: using guessed type char g_TitleRGB_B;

//----- (80016580) --------------------------------------------------------
int __fastcall sub_80016580(int a1, int a2, int a3)
{
  unsigned __int8 *v3; // $t0
  int v4; // $t1
  int *v5; // $a3
  int v6; // $v0
  int v7; // $v1
  int v8; // $v0
  bool v9; // dc
  int v10; // $t0
  Entity **v11; // $a3
  Entity *v12; // $v1
  Entity *v13; // $v0
  Entity **v14; // $t0
  int v15; // $t1
  int *v16; // $a3
  int v17; // $v0
  int v18; // $v1
  int v19; // $v0
  int result; // $v0

  v3 = &g_ParticleArray;
  v4 = 127;
  v5 = &unk_8019ED98;
  *&g_LanguageID[0].header[2] += a1;
  *&g_LanguageID[0].menus[0].header.posY += a3;
  *&g_LanguageID[0].header[6] += a2;
  do
  {
    v6 = *v3;
    v3 += 72;
    if ( v6 != 255 && (*(v5 - 4) & 0xC) != 12 )
    {
      v7 = *v5;
      *(v5 - 1) += a1;
      v8 = v5[1];
      *v5 = a2 + v7;
      v5[1] = a3 + v8;
    }
    v5 += 18;
    v9 = v4 != 0;
    v4 += 0xFFFF;
  }
  while ( v9 );
  v10 = 395;
  v11 = &ObjectInstances[6];
  do
  {
    if ( *(v11 - 9) != 255 )
    {
      v12 = *v11;
      *(v11 - 1) = (*(v11 - 1) + a1);
      v13 = v11[1];
      *v11 = (v12 + a2);
      v11[1] = (v13 + a3);
    }
    v11 += 17;
    v9 = v10 != 0;
    v10 += 0xFFFF;
  }
  while ( v9 );
  v14 = g_ObjectArray;
  v15 = 199;
  v16 = &unk_8016E638;
  do
  {
    v17 = *v14;
    v14 += 31;
    if ( v17 != 255 )
    {
      v18 = *v16;
      *(v16 - 1) += a1;
      v19 = v16[1];
      *v16 = a2 + v18;
      v16[1] = a3 + v19;
    }
    v16 += 31;
    result = v15;
    v9 = v15 != 0;
    v15 += 0xFFFF;
  }
  while ( v9 );
  return result;
}

//----- (800166F8) --------------------------------------------------------
int __fastcall sub_800166F8(
        unsigned __int8 a1,
        unsigned __int8 a2,
        unsigned __int8 a3,
        unsigned __int8 a4,
        unsigned __int8 a5,
        char a6,
        char a7,
        char a8)
{
  int v8; // $s7
  int v9; // $fp
  int result; // $v0
  unsigned __int8 v15; // $t4
  unsigned __int8 v16; // $s4
  unsigned __int8 v17; // $t3
  unsigned __int8 v18; // $t2
  unsigned __int8 v19; // $t1
  unsigned __int8 v20; // $a3
  unsigned __int8 v21; // $t0
  unsigned __int8 v22; // $a1
  unsigned __int8 v23; // $a2
  unsigned __int8 v24; // $a0

  LOBYTE(v8) = a6;
  LOBYTE(v9) = a7;
  if ( a5 == 200 )
  {
    result = g_IsAudioPlaying;
    if ( !g_IsAudioPlaying )
      return Music_PlaySEQ();
    return result;
  }
  v15 = a1;
  if ( a1 == 255 )
  {
    v16 = g_TitleColor;
    v15 = g_TitleAnimFrame;
    v17 = a2;
    if ( a2 == 255 )
    {
      v18 = BYTE1(g_TitleColor);
      v17 = byte_801779E5;
    }
    else
    {
      v18 = a2;
    }
    v19 = a3;
    if ( a3 == 255 )
    {
      v20 = BYTE2(g_TitleColor);
      v19 = byte_801779E6;
    }
    else
    {
      v20 = a3;
    }
    v21 = a4;
    if ( a4 == 255 )
    {
      v22 = HIBYTE(g_TitleColor);
      v21 = byte_801779E7;
    }
    else
    {
      v22 = a4;
    }
    v23 = a5;
    if ( a5 == 255 )
    {
      v24 = g_TitleBrightness;
      v23 = byte_801779E8;
    }
    else
    {
      v24 = a5;
    }
  }
  else
  {
    v16 = a1;
    v23 = a1;
    v21 = a1;
    v19 = a1;
    v17 = a1;
    v18 = BYTE1(g_TitleColor);
    v20 = BYTE2(g_TitleColor);
    v22 = HIBYTE(g_TitleColor);
    v24 = g_TitleBrightness;
  }
  if ( g_bStartKeyState )
  {
    if ( (g_bStartKeyState != 1 || g_TitleAnimFrame == v15) && byte_801779E5 == v17 && byte_801779E6 == v19 )
    {
      result = v23;
      if ( byte_801779E7 == v21 && byte_801779E8 == v23 )
        return result;
    }
    result = v16;
    if ( g_TitleAnimFrame == 255 && g_TitleColor == v16 )
      return result;
    result = a2;
    if ( byte_801779E5 == 255 && BYTE1(g_TitleColor) == a2 )
      return result;
    result = a3;
    if ( byte_801779E6 == 255 && BYTE2(g_TitleColor) == a3 )
      return result;
    result = a4;
    if ( byte_801779E7 == 255 && HIBYTE(g_TitleColor) == a4 )
      return result;
    if ( byte_801779E8 == 255 )
    {
      result = g_TitleBrightness;
      if ( g_TitleBrightness == a5 )
        return result;
    }
    if ( (g_TitleAnimFrame == 255 || a1 != 255)
      && (byte_801779E5 == 255 || a2 != 255)
      && (byte_801779E6 == 255 || a3 != 255)
      && (byte_801779E7 == 255 || a4 != 255)
      && (byte_801779E8 == 255 || a5 != 255) )
    {
      while ( 1 )
      {
        EnterCriticalSection();
        if ( g_TitleSeqState != 240 )
          break;
        ExitCriticalSection();
        PadStartCom();
      }
    }
    else
    {
      while ( g_bStartKeyState )
      {
        PadStartCom();
        HandleUISequence();
      }
    }
    ExitCriticalSection();
    if ( byte_801779E9 && a1 != 255 && a6 == 127 && g_TitleAnimFrame != a1 )
    {
      v8 = -g_TitleRGB_R;
      v9 = -g_TitleRGB_G;
      a8 = -g_TitleRGB_B;
    }
  }
  else if ( g_TitleColor == v16 && BYTE1(g_TitleColor) == v18 && BYTE2(g_TitleColor) == v20 )
  {
    result = v24;
    if ( HIBYTE(g_TitleColor) == v22 && g_TitleBrightness == v24 )
      return result;
  }
  if ( g_TitleColor != 99 && g_TitleColor != v16 )
    sub_8004AEC4(g_TitleColor);
  if ( byte_801B519C[0] < v16 )
    byte_801B519C[0] = v16;
  g_bStartKeyState = 1;
  result = 255;
  g_TitleSeqState = 0;
  g_TitleAnimFrame = a1;
  byte_801779E5 = a2;
  byte_801779E6 = a3;
  byte_801779E7 = a4;
  byte_801779E8 = a5;
  g_TitleRGB_R = v8;
  g_TitleRGB_G = v9;
  byte_801779E9 = 0;
  g_TitleRGB_B = a8;
  if ( a2 == 255 )
  {
    byte_801779EA = 0;
  }
  else
  {
    result = 1;
    byte_801779EA = 1;
  }
  return result;
}
// 801779D4: using guessed type __int16 g_bStartKeyState;
// 801779D6: using guessed type __int16 g_TitleSeqState;
// 801779D8: using guessed type int g_TitleColor;
// 801779DC: using guessed type char g_TitleBrightness;
// 801779E4: using guessed type char g_TitleAnimFrame;
// 801779E5: using guessed type char byte_801779E5;
// 801779E6: using guessed type char byte_801779E6;
// 801779E7: using guessed type char byte_801779E7;
// 801779E8: using guessed type char byte_801779E8;
// 801779E9: using guessed type char byte_801779E9;
// 801779EA: using guessed type char byte_801779EA;
// 801779EB: using guessed type char g_TitleRGB_R;
// 801779EC: using guessed type char g_TitleRGB_G;
// 801779ED: using guessed type char g_TitleRGB_B;
// 8019A630: using guessed type int g_IsAudioPlaying;

//----- (80016C6C) --------------------------------------------------------
int sub_80016C6C()
{
  int result; // $v0

  result = 1;
  g_TitleSeqState = 1;
  return result;
}
// 80016C6C: using guessed type int sub_80016C6C();
// 801779D6: using guessed type __int16 g_TitleSeqState;

//----- (80016C80) --------------------------------------------------------
int sub_80016C80()
{
  int result; // $v0

  result = 3;
  g_TitleSeqState = 3;
  return result;
}
// 80016C80: using guessed type int sub_80016C80();
// 801779D6: using guessed type __int16 g_TitleSeqState;

//----- (80016C94) --------------------------------------------------------
int sub_80016C94()
{
  int result; // $v0

  result = 2;
  g_TitleSeqState = 2;
  return result;
}
// 80016C94: using guessed type int sub_80016C94();
// 801779D6: using guessed type __int16 g_TitleSeqState;

//----- (80016CA8) --------------------------------------------------------
int sub_80016CA8()
{
  int result; // $v0

  result = 4;
  g_TitleSeqState = 4;
  return result;
}
// 80016CA8: using guessed type int sub_80016CA8();
// 801779D6: using guessed type __int16 g_TitleSeqState;

//----- (80016CBC) --------------------------------------------------------
int sub_80016CBC()
{
  int result; // $v0

  result = 6;
  g_TitleSeqState = 6;
  return result;
}
// 80016CBC: using guessed type int sub_80016CBC();
// 801779D6: using guessed type __int16 g_TitleSeqState;

//----- (80016CD0) --------------------------------------------------------
void HandleUISequence()
{
  Entity **v0; // $v0
  int i; // $s1
  Entity **v2; // $s0
  int v3; // $s1
  ResourceHandle *res; // $a0
  int v5; // $s1
  char *v6; // $s0
  ResourceHandle *v7; // $a0
  int v8; // $s1
  _BYTE *v9; // $a0
  char v10; // $v1
  _DWORD *v11; // $s2
  _DWORD *v12; // $s2
  int v13; // $v0

  if ( g_bStartKeyState && g_bStartKeyState == 1 )
  {
    switch ( g_TitleSeqState )
    {
      case 0:
        if ( g_TitleAnimFrame == 255 )
          goto LABEL_12;
        g_TitleSeqState = 240;
        v0 = ObjectInstances;
        for ( i = 395; i != -1; --i )
        {
          *(v0 + 4) = -1;
          v0 += 17;
        }
        TLoadFileASync1(5u, 3 * g_TitleAnimFrame, &g_CDReadBuffer, sub_80016C6C);
        return;
      case 1:
        g_TitleSeqState = 240;
        g_CurrentStateVTable = off_80067A28;
        TLoadFileASync1(5u, 3 * g_TitleAnimFrame + 2, &unk_801A1190, sub_80016C94);
        MemcpyDword(g_MapData, dword_801BA8B0, 16000);
        MemcpyDword(g_CollisionMeshBuffer, (&g_CDReadBuffer + g_CDReadBuffer + 8), 1536);
        if ( g_TitleRGB_R != 127 )
        {
          byte_801779E9 = 1;
          sub_80016580(g_TitleRGB_R << 11, -128 * g_TitleRGB_B, g_TitleRGB_G << 11);
        }
        byte_801779DD = g_TitleAnimFrame;
        return;
      case 2:
        g_TitleSeqState = 240;
        TLoadFileASync1(5u, 3 * g_TitleAnimFrame + 1, &g_CDReadBuffer, sub_80016C80);
        g_CurrentStateVTable = &unk_801A1190;
        return;
      case 3:
LABEL_12:
        if ( byte_801779E5 != 255 )
        {
          g_TitleSeqState = 240;
          TLoadFileASync1(1u, byte_801779E5, &unk_80130A90, sub_80016CA8);
        }
        if ( g_TitleAnimFrame != 255 )
        {
          v2 = g_ObjectArray;
          v3 = 199;
          do
          {
            res = v2[23];
            --v3;
            if ( res )
              Resource_UnlinkAndFree(res);
            *v2 = -1;
            v2 += 31;
          }
          while ( v3 != -1 );
          v5 = 395;
          v6 = &ObjectInstances[1] + 2;
          do
          {
            v7 = *(v6 + 46);
            if ( v7 )
              Resource_UnlinkAndFree(v7);
            --v5;
            if ( *(v6 - 2) == 32 )
            {
              PadChkVsync(*(v6 + 58));
              *(v6 - 2) = -1;
            }
            *v6 = 255;
            v6 += 68;
          }
          while ( v5 != -1 );
          if ( g_TitleRGB_R != 127 )
          {
            v8 = 6400;
            v9 = &unk_801CBD7B;
            do
            {
              --v8;
              v10 = *v9 & 3;
              *(v9 - 5) &= 3u;
              *v9 = v10;
              v9 += 10;
            }
            while ( v8 );
            Map_MarkOccupiedTiles(*&g_LanguageID[0].header[2], *&g_LanguageID[0].menus[0].header.posY, 800, 1);
          }
          MemcpyDword(g_ObjectTypeTable, dword_801BA8B0, 3248);
          sub_80042244();
          v11 = (&g_CDReadBuffer + g_CDReadBuffer + 4);
          sub_800422B8((v11 + 1));
          v12 = (v11 + *v11 + 4);
          sub_8003830C((v12 + 1));
          sub_800372AC((v12 + *v12 + 8));
          sub_8004B31C(g_TitleAnimFrame);
          (*&g_CurrentStateVTable->gap0[20])();
          g_PhysicsReady = 1;
        }
        if ( byte_801779E5 == 255 )
          goto LABEL_31;
        return;
      case 4:
LABEL_31:
        if ( byte_801779E6 != 255 )
          QueueCDReadTask(2u, byte_801779E6);
        byte_801779EA = 0;
        if ( byte_801779E7 == 255 && byte_801779E8 == byte_801779E7 )
          goto LABEL_35;
        g_TitleSeqState = 5;
        g_AudioFadeTimer = 60;
        g_ExitTitleScreen = 0;
        goto LABEL_47;
      case 5:
LABEL_47:
        if ( !g_IsAudioPlaying )
          goto LABEL_52;
        v13 = g_AudioFadeTimer - 2;
        g_AudioFadeTimer -= 2;
        if ( v13 << 16 <= 0 )
          g_AudioFadeTimer = 0;
        CDAudio_SetVolume(g_MenuTrackID, g_AudioFadeTimer, g_AudioFadeTimer);
        if ( !g_AudioFadeTimer )
        {
          CDAudio_Stop(g_MenuTrackID);
          SpuVoice_StopAll(g_MenuTrackID);
          g_IsAudioPlaying = 0;
LABEL_52:
          if ( word_8019A65C != -1 )
            dword_8019A660 = 0;
          if ( byte_801779E7 != 255 )
            StartAudioStream(4u, byte_801779E7 + 1, 1);
          if ( byte_801779E8 == 255 )
          {
LABEL_35:
            if ( g_TitleAnimFrame != 255 )
              LOBYTE(g_TitleColor) = g_TitleAnimFrame;
            if ( byte_801779E5 != 255 )
              BYTE1(g_TitleColor) = byte_801779E5;
            if ( byte_801779E6 != 255 )
              BYTE2(g_TitleColor) = byte_801779E6;
            if ( byte_801779E7 != 255 )
              HIBYTE(g_TitleColor) = byte_801779E7;
            if ( byte_801779E8 != 255 )
              g_TitleBrightness = byte_801779E8;
            g_bStartKeyState = 0;
          }
          else
          {
            TLoadFileASync1(4u, byte_801779E8 % 0x64u + 320, dword_8019A628, sub_80016CBC);
            g_TitleSeqState = 240;
          }
        }
        break;
      case 6:
        if ( byte_801779E8 < 0x64u )
        {
          g_ExitTitleScreen = 1;
          Music_PlaySEQ();
        }
        goto LABEL_35;
      default:
        return;
    }
  }
}
// 80016C6C: using guessed type int sub_80016C6C();
// 80016C80: using guessed type int sub_80016C80();
// 80016C94: using guessed type int sub_80016C94();
// 80016CA8: using guessed type int sub_80016CA8();
// 80016CBC: using guessed type int sub_80016CBC();
// 80067A28: using guessed type int (*off_80067A28[32])();
// 801779D4: using guessed type __int16 g_bStartKeyState;
// 801779D6: using guessed type __int16 g_TitleSeqState;
// 801779D8: using guessed type int g_TitleColor;
// 801779DC: using guessed type char g_TitleBrightness;
// 801779DD: using guessed type char byte_801779DD;
// 801779E4: using guessed type char g_TitleAnimFrame;
// 801779E5: using guessed type char byte_801779E5;
// 801779E6: using guessed type char byte_801779E6;
// 801779E7: using guessed type char byte_801779E7;
// 801779E8: using guessed type char byte_801779E8;
// 801779E9: using guessed type char byte_801779E9;
// 801779EA: using guessed type char byte_801779EA;
// 801779EB: using guessed type char g_TitleRGB_R;
// 801779EC: using guessed type char g_TitleRGB_G;
// 801779ED: using guessed type char g_TitleRGB_B;
// 801779EE: using guessed type __int16 g_AudioFadeTimer;
// 8019A628: using guessed type int dword_8019A628;
// 8019A62C: using guessed type __int16 g_MenuTrackID;
// 8019A630: using guessed type int g_IsAudioPlaying;
// 8019A634: using guessed type int g_ExitTitleScreen;
// 8019A65C: using guessed type __int16 word_8019A65C;
// 8019A660: using guessed type int dword_8019A660;
// 8019B4CE: using guessed type char g_PhysicsReady;
// 801BA8AC: using guessed type int g_CDReadBuffer;
// 801BA8B0: using guessed type int dword_801BA8B0[17407];
// 801CBD74: using guessed type _DWORD g_MapData[];
// 801DBD74: using guessed type _DWORD g_CollisionMeshBuffer[1385];

//----- (80017370) --------------------------------------------------------
int __fastcall OnCDReadComplete(int a1)
{
  int result; // $v0

  result = 1;
  *(a1 + 36) = 1;
  return result;
}

//----- (8001737C) --------------------------------------------------------
int __fastcall QueueCDReadTask(unsigned __int16 a1, unsigned __int16 a2)
{
  return PrepareReadTask(a1, a2, &g_CDReadBuffer, OnCDReadComplete);
}
// 801BA8AC: using guessed type int g_CDReadBuffer;

//----- (800173B0) --------------------------------------------------------
int __fastcall CalculateNextCdChunk(int a1)
{
  int v1; // $v1
  int result; // $v0
  int v3; // $v0

  v1 = *(a1 + 34);
  result = v1 < 17;
  if ( v1 < 17 )
  {
    *(a1 + 16) = v1;
    *(a1 + 34) = 0;
  }
  else
  {
    v3 = *(a1 + 34);
    *(a1 + 16) = 16;
    result = v3 - 16;
    *(a1 + 34) = result;
  }
  return result;
}

//----- (800173EC) --------------------------------------------------------
void ProcessAssetLoadQueue()
{
  int v0; // $s1
  int v1; // $s4
  unsigned __int16 *v2; // $s0
  signed int v3; // $v1
  __int16 v4; // $s3
  int v5; // $a0
  int v6; // $s2
  int v7; // $lo
  int v8; // $s2
  __int16 v9; // $v1
  unsigned __int8 *v10; // $a0
  int v11; // $a1
  __int16 v12; // $v0
  unsigned __int16 v13; // $v0

  EnterCriticalSection();
  v0 = g_ActiveCdStream;
  if ( *g_ActiveCdStream == 64 && (v1 = 0, *(g_ActiveCdStream + 36) == 1) )
  {
    v2 = *(g_ActiveCdStream + 12);
    *(g_ActiveCdStream + 36) = 0;
    ExitCriticalSection();
    while ( 1 )
    {
      while ( 1 )
      {
        v3 = 0x8000 - v1;
        v4 = *(v0 + 30);
        if ( !v4 )
          break;
        v5 = *(v0 + 28);
        v6 = 2 * *(v0 + 30) * v5;
        if ( v3 < v6 )
        {
          v7 = v3 / v5;
          if ( !*(v0 + 28) )
            _break(7u, 0);
          if ( v5 == -1 && v3 == 0x80000000 )
            _break(6u, 0);
          v8 = v7 >> 1;
          if ( v7 >> 1 << 16 )
          {
            *(v0 + 30) = v7 >> 1;
            SubmitCdDmaTransfer(v0 + 24, v2);
            v9 = *(v0 + 26);
            *(v0 + 30) = v4 - v8;
            *(v0 + 26) = v8 + v9;
          }
          v10 = (v0 + 2);
LABEL_27:
          ConvertCdAddress(v10, *(v0 + 16), v10);
          CalculateNextCdChunk(v0);
          *(v0 + 1) = 0;
          WaitForDmaComplete(0);
          while ( !CdControl(0x16u, (v0 + 2), 0) )
            ;
          return;
        }
        *(v0 + 30) = v4;
        SubmitCdDmaTransfer(v0 + 24, v2);
        v1 += v6;
        v2 = (v2 + v6);
        *(v0 + 30) = 0;
      }
      v10 = (v0 + 2);
      if ( v3 < 0x10 )
        goto LABEL_27;
      v11 = *v2;
      if ( v11 != v2[4] || v2[1] != v2[5] || v2[2] != v2[6] || v2[3] != v2[7] || !v2[2] || !v2[3] )
        break;
      v1 += 16;
      if ( v11 == 0xFFFF )
      {
        WaitForDmaComplete(0);
        *(v0 + 16) = 0;
        NextCdTask(v0);
        return;
      }
      *(v0 + 24) = *v2;
      *(v0 + 26) = v2[1];
      *(v0 + 28) = v2[2];
      v13 = v2[3];
      v2 += 8;
      *(v0 + 30) = v13;
    }
    v12 = *(v0 + 32);
    *(v0 + 30) = 0;
    *(v0 + 36) = 0;
    *(v0 + 34) = v12;
    *(v0 + 2) = *(v0 + 6);
    CalculateNextCdChunk(v0);
    *(v0 + 1) = 0;
    while ( !CdControl(0x16u, (v0 + 2), 0) )
      ;
  }
  else
  {
    ExitCriticalSection();
  }
}
// 801BA848: using guessed type int g_ActiveCdStream;

//----- (80017684) --------------------------------------------------------
int *__fastcall MemcpyDword(_DWORD *a1, int *a2, int a3)
{
  bool v3; // dc
  int v4; // $a2
  int v5; // $v0
  int v6; // $v1

  v3 = a3 == 0;
  v4 = a3 - 1;
  if ( !v3 )
  {
    do
    {
      v5 = *a2++;
      v6 = v4--;
      *a1++ = v5;
    }
    while ( v6 );
  }
  return a2;
}

//----- (800176B4) --------------------------------------------------------
__int16 *__fastcall CopyToFinalBuffer(_WORD *a1, __int16 *a2, int a3)
{
  bool v3; // dc
  int v4; // $a2
  __int16 v5; // $v0
  int v6; // $v1

  v3 = a3 == 0;
  v4 = a3 - 1;
  if ( !v3 )
  {
    do
    {
      v5 = *a2++;
      v6 = v4--;
      *a1++ = v5;
    }
    while ( v6 );
  }
  return a2;
}

//----- (800176E4) --------------------------------------------------------
_DWORD *__fastcall memset_0(_DWORD *a1, int a2, int a3)
{
  int i; // $v0

  for ( i = a3; ; i = a3 )
  {
    --a3;
    if ( !i )
      break;
    *a1++ = a2;
  }
  return a1;
}

//----- (8001772C) --------------------------------------------------------
int __fastcall sub_8001772C(unsigned __int8 *a1)
{
  int result; // $v0
  unsigned __int8 *v2; // $a1

  result = 255;
  v2 = a1;
  if ( *a1 != 255 )
  {
    result = *a1;
    do
    {
      if ( result )
      {
        a1 += *(a1 + 1) + 12;
      }
      else
      {
        a1 += *(a1 + 1) + 12;
        result = *a1;
        if ( *a1 )
          return result;
        *(v2 + 1) += 12 + *(a1 + 1);
      }
      result = *a1;
    }
    while ( result != 255 );
  }
  return result;
}

//----- (800177B0) --------------------------------------------------------
_DWORD *__fastcall sub_800177B0(int a1)
{
  _DWORD *result; // $v0

  result = *(a1 + 8);
  *a1 = 0;
  if ( result )
  {
    *result = 0;
    *(a1 + 8) = 0;
  }
  return result;
}

//----- (800177D0) --------------------------------------------------------
unsigned __int8 *__fastcall sub_800177D0(unsigned __int8 *a1, unsigned int a2)
{
  unsigned __int8 *v2; // $s0
  int v3; // $v0
  unsigned __int8 *result; // $v0
  unsigned __int8 *v5; // $s1
  int i; // $s0

  v2 = a1;
  if ( *a1 != 255 )
  {
    v3 = *a1;
    do
    {
      if ( !v3 )
      {
        result = v2;
        if ( *(v2 + 1) >= a2 )
          return result;
      }
      v2 += *(v2 + 1) + 12;
      v3 = *v2;
    }
    while ( v3 != 255 );
    v2 = a1;
  }
  result = 0;
  if ( *v2 == 255 )
    return result;
  while ( 1 )
  {
    v5 = v2;
    if ( *v2 == 1 )
      break;
    v2 += *(v2 + 1) + 12;
LABEL_15:
    result = 0;
    if ( *v2 == 255 )
      return result;
  }
  do
    v2 += *(v2 + 1) + 12;
  while ( *v2 == 1 );
  if ( v2 - v5 - 12 < a2 )
    goto LABEL_15;
  for ( i = v5; *i == 1; i += *(i + 4) + 12 )
    sub_800177B0(i);
  sub_8001772C(v5);
  return v5;
}

//----- (80017920) --------------------------------------------------------
int __fastcall sub_80017920(unsigned __int8 *a1)
{
  unsigned __int8 *v1; // $s0
  int result; // $v0

  v1 = a1;
  result = 255;
  if ( *a1 != 255 )
  {
    result = *a1;
    do
    {
      if ( result == 3 )
      {
        do
          WaitForCdIdle();
        while ( *v1 == 3 );
      }
      v1 += *(v1 + 1) + 12;
      result = *v1;
    }
    while ( result != 255 );
  }
  return result;
}

//----- (800179BC) --------------------------------------------------------
int __fastcall sub_800179BC(unsigned __int8 *a1)
{
  unsigned __int8 *v1; // $s1
  unsigned __int8 *v2; // $s0
  int v3; // $v0
  int v4; // $v1
  unsigned __int8 *v5; // $s2
  unsigned __int8 *v6; // $a0
  unsigned __int8 *v7; // $a1
  unsigned int v8; // $v1
  int v9; // $v0
  unsigned __int8 *v10; // $v1
  unsigned __int8 **v11; // $v0
  int result; // $v0

  v1 = a1;
  v2 = a1;
  sub_80017920(a1);
  v3 = v2 - v1;
  if ( *v1 != 255 )
  {
    do
    {
      v4 = *v2;
      v5 = &v2[*(v2 + 1) + 12];
      if ( v4 == 1 )
      {
        sub_800177B0(v2);
        v4 = *v2;
      }
      if ( v4 == 2 )
      {
        v6 = v2;
        if ( v2 == v1 )
        {
          v1 = v5;
        }
        else
        {
          v7 = v1;
          v8 = (*(v2 + 1) + 12) >> 2;
          do
          {
            v9 = *v6;
            v6 += 4;
            --v8;
            *v7 = v9;
            v7 += 4;
          }
          while ( v8 );
          v10 = v1 + 12;
          v11 = *(v1 + 2);
          v1 = v7;
          *v11 = v10;
        }
      }
      v2 = v5;
      v3 = v5 - v1;
    }
    while ( *v5 != 255 );
  }
  result = v3 - 12;
  *v1 = 0;
  *(v1 + 1) = result;
  return result;
}

//----- (80017AA4) --------------------------------------------------------
int __fastcall Heap_Init(int a1, int a2)
{
  int result; // $v0

  *a1 = 0;
  *(a1 + 4) = a2 - 16;
  result = 255;
  *(a1 + a2 - 4) = -1;
  return result;
}

//----- (80017AC4) --------------------------------------------------------
unsigned __int8 *__fastcall FMOAllocateBuffer(unsigned __int8 *a1, unsigned int a2, unsigned __int8 **a3)
{
  unsigned int v4; // $s1
  unsigned __int8 *v6; // $v1
  unsigned __int8 *result; // $v0
  int v8; // $a0
  unsigned __int8 *v9; // $v0

  v4 = a2;
  v6 = sub_800177D0(a1, a2);
  if ( v6 || (sub_800179BC(a1), v6 = sub_800177D0(a1, v4), result = 0, v6) )
  {
    v8 = *(v6 + 1) - 12 - v4;
    v9 = &v6[v4];
    if ( v8 < 2060 )
    {
      v4 = *(v6 + 1);
    }
    else
    {
      v9[12] = 0;
      *(v9 + 4) = v8;
      *(v9 + 5) = 0;
    }
    *v6 = 2;
    result = v6 + 12;
    *(v6 + 1) = v4;
    *(v6 + 2) = a3;
    if ( a3 )
      *a3 = result;
  }
  return result;
}

//----- (80017B7C) --------------------------------------------------------
_DWORD *__fastcall sub_80017B7C(int a1)
{
  return sub_800177B0(a1 - 12);
}

//----- (80017B9C) --------------------------------------------------------
void __fastcall MO_Something01Set(int a1, char a2)
{
  *(a1 - 12) = a2;
}

//----- (80017BA4) --------------------------------------------------------
int __fastcall sub_80017BA4(int a1)
{
  return *(a1 - 12);
}

//----- (80017BC4) --------------------------------------------------------
void __fastcall MO_Something02Set(int a1, __int16 a2)
{
  *(a1 - 10) = a2;
}

//----- (80017BD8) --------------------------------------------------------
int AllocateMemor_0()
{
  int Memor_01; // $v0

  Memor_01 = AllocateMemor_01();
  return Memor_01 + 0x80000000 <= 0x1FFFFF ? Memor_01 : 0;
}

//----- (80017C18) --------------------------------------------------------
int __fastcall AllocateMemory(int a1)
{
  return AllocateMemor_0();
}

//----- (80018150) --------------------------------------------------------
unsigned int __fastcall ConvertCdAddress(unsigned __int8 *a1, int a2, _BYTE *a3)
{
  int v4; // $v0

  v4 = MsfToLba(a1);
  return LbaToMsf(a3, v4 + a2);
}

//----- (80018190) --------------------------------------------------------
void WaitForCdIdle()
{                                               // EnterCriticalSection();
  while ( 1 )
  {
    EnterCriticalSection();
    if ( g_ActiveCdStream == g_CDTaskQueue && !*g_ActiveCdStream )
      break;
    ExitCriticalSection();
    PadStartCom();
  }
  ExitCriticalSection();
}
// 801BA844: using guessed type int g_CDTaskQueue;
// 801BA848: using guessed type int g_ActiveCdStream;

//----- (80018244) --------------------------------------------------------
void __fastcall WaitForTaskComplete(_BYTE *a1)
{
  while ( 1 )
  {
    EnterCriticalSection();
    if ( !*a1 )
      break;
    ExitCriticalSection();
    PadStartCom();
  }
  ExitCriticalSection();
}

//----- (800182A0) --------------------------------------------------------
BOOL __fastcall VerifyChecksum(int *data, int size_bytes)
{
  int v2; // $a3
  int *v3; // $a2
  int v4; // $a1
  int v5; // $v1
  bool v6; // dc
  int v7; // $a1
  int v8; // $v0

  v2 = 0x12345678;
  v3 = data;
  v4 = size_bytes << 9;
  v5 = v4 - 2;
  v6 = v4 == 1;
  v7 = v4 - 1;
  if ( !v6 )
  {
    do
    {
      v8 = *v3++;
      --v5;
      v2 += v8;
    }
    while ( v5 != -1 );
  }
  return v2 != data[v7];
}

//----- (800182F4) --------------------------------------------------------
int __fastcall CreateCDTask(char a1, _DWORD *a2, int a3, int a4, int a5)
{
  int v9; // $s5
  int v10; // $v1

  v9 = g_CDTaskQueue;
  WaitForTaskComplete(g_CDTaskQueue);
  EnterCriticalSection();
  *v9 = a1;
  *(v9 + 1) = 0;
  *(v9 + 2) = *a2;
  *(v9 + 6) = *(v9 + 2);
  *(v9 + 12) = a4;
  *(v9 + 16) = (a3 + 2047) >> 11;
  *(v9 + 20) = a5;
  v10 = g_CDTaskQueue;
  g_CDTaskQueue += 40;
  if ( g_CDTaskQueue == &g_CDTaskQueue )
    *(v10 + 40) = v10 - 600;
  if ( g_ActiveCdStream == v9 )
  {
    ExitCriticalSection();
    while ( !CdControl(0x16u, a2, 0) )
      ;
    return v9;
  }
  else
  {
    ExitCriticalSection();
    return v9;
  }
}
// 801BA844: using guessed type int g_CDTaskQueue;
// 801BA848: using guessed type int g_ActiveCdStream;

//----- (80018418) --------------------------------------------------------
int __fastcall ReadFromFile(unsigned __int16 a1, unsigned __int16 a2, _BYTE *a3)
{
  FileDescriptor *v3; // $s0
  int v4; // $s2
  unsigned __int16 *v5; // $v0
  int v6; // $s1

  v3 = &g_FileDescriptors[a1];
  v4 = 2 * a2;
  v5 = (v4 + v3->ram_buffer);
  v6 = *v5;
  if ( a3 )
    ConvertCdAddress(&v3->cd_sector_low, *v5, a3);
  return (*(v4 + v3->ram_buffer + 2) - v6) << 11;
}

//----- (800184A4) --------------------------------------------------------
int __fastcall TLoadFileASync1(unsigned __int16 a1, unsigned __int16 a2, int a3, int a4)
{
  int v6; // $v0
  int v8[2]; // [sp+18h] [-8h] BYREF

  v6 = ReadFromFile(a1, a2, v8);
  return CreateCDTask(16, v8, v6, a3, a4);
}
// 800184A4: using guessed type _DWORD var_8[2];

//----- (80018554) --------------------------------------------------------
int __fastcall CreateAudioCDTask(unsigned __int16 a1, unsigned __int16 a2, int a3, int a4)
{
  int v6; // $v0
  int v8[2]; // [sp+18h] [-8h] BYREF

  v6 = ReadFromFile(a1, a2, v8);
  return CreateCDTask(48, v8, v6, a3, a4);
}
// 80018554: using guessed type _DWORD var_8[2];

//----- (800185AC) --------------------------------------------------------
int __fastcall PrepareReadTask(unsigned __int16 a1, unsigned __int16 a2, int a3, int a4)
{
  int v4; // $s2
  unsigned int v9; // $a2
  int v10; // $v0
  int v11; // $a3
  int v13[4]; // [sp+18h] [-10h] BYREF

  v4 = g_CDTaskQueue;
  WaitForTaskComplete(g_CDTaskQueue);
  *(v4 + 30) = 0;
  *(v4 + 36) = 0;
  v9 = ReadFromFile(a1, a2, v13);
  *(v4 + 34) = v9 >> 11;
  v10 = *(v4 + 34);
  *(v4 + 32) = v9 >> 11;
  if ( v10 >= 17 )
  {
    v9 = 0x8000;
    v11 = a3;
    *(v4 + 34) = v10 - 16;
  }
  else
  {
    v11 = a3;
    *(v4 + 34) = 0;
  }
  return CreateCDTask(64, v13, v9, v11, a4);
}
// 801BA844: using guessed type int g_CDTaskQueue;
// 800185AC: using guessed type _DWORD var_10[4];

//----- (80018674) --------------------------------------------------------
int __fastcall TGetFileSize(unsigned __int16 a1, unsigned __int16 a2)
{
  unsigned __int16 *v2; // $a1

  v2 = (2 * a2 + g_FileDescriptors[a1].ram_buffer);
  return (v2[1] - *v2) << 11;
}

//----- (800186B8) --------------------------------------------------------
void nullsub_1()
{
  ;
}

//----- (800186C0) --------------------------------------------------------
void __fastcall CopyFromRamBuffer(int a1, int a2, int a3)
{
  int v6; // $s1
  int v7; // $s5
  int v8; // $a0
  int v9; // $v0
  int v10; // $s0

  WaitForCdIdle();                              //  while ( 1 ) EnterCriticalSection(); PadStartCom(); return ExitCriticalSection();
  v6 = 0;
  DisableEvent();
  v7 = 1;
  DisableEvent();
  DisableEvent();
  CdControl(9u, 0, 0);
  while ( 1 )
  {
    while ( !CdControl(2u, a1, 0) )
      ;
    v8 = a3;
    do
    {
      v9 = CdReadWithRetry(v8, a2, 128);
      v8 = a3;
    }
    while ( !v9 );
    do
      v10 = CdCheckStatus(1, 0);
    while ( v10 > 0 );
    CdControl(9u, 0, 0);
    if ( !v10 )
      break;
    if ( ++v6 >= 3 )
      goto LABEL_9;
  }
  v7 = 0;
LABEL_9:
  EnableEvent();
  EnableEvent();
  EnableEvent();
  if ( v7 == 1 )
    nullsub_1();
}
// 801BA5B4: using guessed type int dword_801BA5B4;
// 801BA5B8: using guessed type int dword_801BA5B8;
// 801BA5C0: using guessed type int dword_801BA5C0;

//----- (80018890) --------------------------------------------------------
void __fastcall CalculateSectorCount(int a1, int a2, int a3)
{
  if ( !a3 )
    a3 = *(a2 + 4);
  CopyFromRamBuffer(a2, a1, (a3 + 2047) >> 11);
}

//----- (800188CC) --------------------------------------------------------
BOOL __fastcall ExtractFileSections(unsigned __int16 type, unsigned __int16 id, int *ptr)
{
  FileDescriptor *fd; // $v0
  unsigned __int16 *v5; // $v1
  int v6; // $a1
  int v7; // $s0
  char v9[8]; // [sp+10h] [-8h] BYREF

  fd = &g_FileDescriptors[type];
  v5 = (2 * id + fd->ram_buffer);
  v6 = *v5;
  v7 = v5[1] - v6;
  ConvertCdAddress(&fd->cd_sector_low, v6, v9);
  CopyFromRamBuffer(v9, ptr, v7);               //    dword_8009E11C!
  return VerifyChecksum(ptr, v7);               //   !
}

//----- (80018960) --------------------------------------------------------
int sub_80018960()
{
  int v0; // $gp
  char v1; // $v1
  unsigned int v2; // $s1
  int Memory; // $v0
  int v4; // $s0
  int v6; // [sp+10h] [-58h] BYREF
  char v7; // [sp+14h] [-54h]
  _DWORD v8[6]; // [sp+50h] [-18h] BYREF

  v1 = *(v0 + 92);
  v6 = *(v0 + 88);
  v7 = v1;
  strcat(&v6);
  strcat(&v6);
  // int sub_80018190()
  // {                                            
  //   while ( 1 )
  //   {
  //     EnterCriticalSection();
  //     if ( g_ActiveCdStream == g_CDTaskQueue && !*(_BYTE *)g_ActiveCdStream )
  //       break;
  //     ExitCriticalSection();
  //     PadStartCom();
  //   }
  //   return ExitCriticalSection();
  // }
  WaitForCdIdle();
  if ( !CdSearchFile(v8, &v6) )
    nullsub_1();
  v2 = (v8[1] + 2047) & 0xFFFFF800;
  Memory = AllocateMemory(v2);
  v4 = Memory;
  if ( !Memory )
    return 0;
  CopyFromRamBuffer(v8, Memory, v2 >> 11);
  return v4;
}
// 8001897C: variable 'v0' is possibly undefined
// 80062B90: using guessed type int __fastcall strcat(_DWORD);

//----- (80018AD8) --------------------------------------------------------
__int16 *__fastcall LoadFileByIndex(unsigned __int16 res_type, char *v1)
{
  int v2; // $gp
  char v3; // $v1
  FileDescriptor *fd; // $s1
  int Memory; // $v0
  int v6; // $a1
  unsigned __int16 v8; // [sp+10h] [-898h] BYREF
  char v9[2110]; // [sp+12h] [-896h] BYREF
  int v10[6]; // [sp+850h] [-58h] BYREF
  int v11; // [sp+868h] [-40h] BYREF
  char v12; // [sp+86Ch] [-3Ch]

  v3 = *(v2 + 92);
  v11 = *(v2 + 88);
  v12 = v3;
  fd = &g_FileDescriptors[res_type];            // 
                                                // v3[0] = RAM  ( )
                                                // v3[1] =   CD ( )
                                                // v3[2] =   CD ( )
  strcat(&v11);
  strcat(&v11);
  //     ( \COM\ITEM0.T)
  while ( !CdSearchFile(v10, &v11) )
    printf("\nCdSearchFile error  FileName=%s ", &v11);
  //   (low)
  fd->cd_sector_low = v10[0];
  //   (high)
  fd->cd_sector_high = v10[1];
  CalculateSectorCount(&v8, &fd->cd_sector_low, 2048);//   !
  //    
  Memory = AllocateMemory(2 * (v8 + 1));
  v6 = v8;
  fd->ram_buffer = Memory;
  printf("\n==== aloc size : %d", 2 * (v6 + 1));
  //    
  return CopyToFinalBuffer(fd->ram_buffer, v9, v8 + 1);
}
// 80018AEC: variable 'v2' is possibly undefined
// 80062B90: using guessed type int __fastcall strcat(_DWORD);
// 80062BA0: using guessed type int printf(const char *, ...);
// 80018AD8: using guessed type char var_896[2110];

//----- (80018BE0) --------------------------------------------------------
BOOL InitDialogueFiles()
{
  int v0; // $gp
  char *v1; // $a3
  int *v2; // $a2
  int v3; // $v1
  int v4; // $a0
  int v5; // $a1
  int v6; // $v1
  int v7; // $a0
  int v8; // $a1
  int v9; // $v1
  int v10; // $s2
  int v11; // $s0
  char *v12; // $s1
  char v13; // $v1
  _DWORD *i; // $a0
  BOOL result; // $v0
  int v16; // [sp+10h] [-B8h] BYREF
  char v17; // [sp+14h] [-B4h]
  char v18[120]; // [sp+50h] [-78h] BYREF

  v1 = v18;
  v2 = "COM\\TALK0.T";
  if ( ((v18 | "COM\\TALK0.T") & 3) != 0 )
  {
    do
    {
      v3 = v2[1];
      v4 = v2[2];
      v5 = v2[3];
      *v1 = *v2;
      *(v1 + 1) = v3;
      *(v1 + 2) = v4;
      *(v1 + 3) = v5;
      v2 += 4;
      v1 += 16;
    }
    while ( v2 != dword_80011120 );
  }
  else
  {
    do
    {
      v6 = v2[1];
      v7 = v2[2];
      v8 = v2[3];
      *v1 = *v2;
      *(v1 + 1) = v6;
      *(v1 + 2) = v7;
      *(v1 + 3) = v8;
      v2 += 4;
      v1 += 16;
    }
    while ( v2 != dword_80011120 );
  }
  v9 = v2[1];
  *v1 = *v2;
  *(v1 + 1) = v9;
  v10 = 0;
  v11 = 0;
  v12 = v18;
  do
  {
    v13 = *(v0 + 92);
    v16 = *(v0 + 88);
    v17 = v13;
    strcat(&v16);
    strcat(&v16);
    for ( i = (&unk_8019E630 + v11); !CdSearchFile(i, &v16); i = (&unk_8019E630 + v11) )
      printf("\nCdSearchFile error fn=%s ", &v16);
    printf("\neuro file pos save %s ", &v16);
    v11 += 24;
    result = ++v10 < 6;
    v12 += 20;
  }
  while ( v10 < 6 );
  return result;
}
// 80018CD8: variable 'v0' is possibly undefined
// 80011120: using guessed type int dword_80011120[2];
// 80062B90: using guessed type int __fastcall strcat(_DWORD);
// 80062BA0: using guessed type int printf(const char *, ...);

//----- (80018D74) --------------------------------------------------------
__int16 *loadTIM()
{
  int v0; // $v0
  int v1; // $s0
  int v2; // $v0
  int v3; // $v1
  unsigned __int16 v5; // [sp+10h] [-860h] BYREF
  __int16 v6[1055]; // [sp+12h] [-85Eh] BYREF
  _BYTE v7[19]; // [sp+850h] [-20h] BYREF
  char v8; // [sp+863h] [-Dh]
  char v9[12]; // [sp+864h] [-Ch] BYREF

  strcpy(v7, "MSG0.TIM");
  v7[9] = 0;
  strcpy(&v7[10], "MSG1.TIM");
  v8 = 0;
  strcpy(v9, "MSG2.TIM");
  v9[9] = 0;
  v0 = sub_80018960();
  v1 = v0;
  if ( v0 )
  {
    ProcessTIMContainer(v0);
    PadChkVsync(v1);
  }
  v2 = 48 * *g_LanguageID[0].header;
  dword_801BA874 = *(&unk_8019E630 + v2);
  dword_801BA878 = *(&unk_8019E634 + v2);
  CalculateSectorCount(&v5, &dword_801BA874, 2048);
  printf("\n==== realoc read : %d", 2 * (v5 + 1));
  PadChkVsync(dword_801BA870);
  dword_801BA870 = AllocateMemory(2 * (v5 + 1));
  CopyToFinalBuffer(dword_801BA870, v6, v5 + 1);
  v3 = 24 * (2 * *g_LanguageID[0].header + 1);
  dword_801BA898 = *(&unk_8019E630 + v3);
  dword_801BA89C = *(&unk_8019E634 + v3);
  CalculateSectorCount(&v5, &dword_801BA898, 2048);
  printf("\n==== realoc read : %d", 2 * (v5 + 1));
  PadChkVsync(dword_801BA894);
  dword_801BA894 = AllocateMemory(2 * (v5 + 1));
  return CopyToFinalBuffer(dword_801BA894, v6, v5 + 1);
}
// 80062BA0: using guessed type int printf(const char *, ...);
// 801BA870: using guessed type int dword_801BA870;
// 801BA874: using guessed type int dword_801BA874;
// 801BA878: using guessed type int dword_801BA878;
// 801BA894: using guessed type int dword_801BA894;
// 801BA898: using guessed type int dword_801BA898;
// 801BA89C: using guessed type int dword_801BA89C;
// 80018D74: using guessed type __int16 var_85E[1055];

//----- (80018FE8) --------------------------------------------------------
void InitEventSystem()
{
  int v0; // $v0
  _BYTE *v1; // $s0
  int v2; // $v1
  int v3; // $v0
  int v4; // $v0
  int v5; // $v0

  EnterCriticalSection();
  dword_801BA5AC = 0;
  OpenEvent();
  dword_801BA5A8 = v0;
  v1 = &unk_801BA5C4;
  EnableEvent();
  v2 = 0;
  dword_801BA5B0 = 0;
  do
  {
    ++v2;
    *v1 = 0;
    v1[1] = 0;
    v1 += 40;
  }
  while ( v2 < 16 );
  g_ActiveCdStream = &unk_801BA5C4;
  g_CDTaskQueue = &unk_801BA5C4;
  OpenEvent();
  dword_801BA5B4 = v3;
  OpenEvent();
  dword_801BA5B8 = v4;
  OpenEvent();
  dword_801BA5C0 = v5;
  EnableEvent();
  EnableEvent();
  EnableEvent();
  ExitCriticalSection();
}
// 80019024: variable 'v0' is possibly undefined
// 800190A0: variable 'v3' is possibly undefined
// 800190C4: variable 'v4' is possibly undefined
// 800190DC: variable 'v5' is possibly undefined
// 801BA5A8: using guessed type int dword_801BA5A8;
// 801BA5AC: using guessed type int dword_801BA5AC;
// 801BA5B0: using guessed type int dword_801BA5B0;
// 801BA5B4: using guessed type int dword_801BA5B4;
// 801BA5B8: using guessed type int dword_801BA5B8;
// 801BA5C0: using guessed type int dword_801BA5C0;
// 801BA844: using guessed type int g_CDTaskQueue;
// 801BA848: using guessed type int g_ActiveCdStream;

//----- (80019128) --------------------------------------------------------
void sub_80019128()
{
  EnterCriticalSection();
  CloseEvent(dword_801BA5A8);
  CloseEvent(dword_801BA5B4);
  CloseEvent(dword_801BA5B8);
  CloseEvent(dword_801BA5C0);
  ExitCriticalSection();
}
// 80062820: using guessed type int __fastcall CloseEvent(_DWORD);
// 801BA5A8: using guessed type int dword_801BA5A8;
// 801BA5B4: using guessed type int dword_801BA5B4;
// 801BA5B8: using guessed type int dword_801BA5B8;
// 801BA5C0: using guessed type int dword_801BA5C0;

//----- (80019198) --------------------------------------------------------
int sub_80019198()
{
  int v0; // $gp
  int v1; // $v1
  __int16 v2; // $v1
  __int16 v3; // $t0
  int *v4; // $gp
  int v5; // $v1
  int v6; // $v0
  int v7; // $a1
  int v8; // $a2
  __int16 v9; // $v0
  __int16 v10; // $v1
  __int16 v11; // $t0
  int *v12; // $gp
  int v13; // $v1
  int v14; // $v0
  __int16 v15; // $v1
  __int16 v16; // $t0
  int *v17; // $gp
  int v18; // $v1
  int v19; // $v0
  __int16 v20; // $v1
  __int16 v21; // $t0
  int *v22; // $gp
  int v23; // $v1
  int v24; // $v0
  int v25; // $a1
  int v26; // $a2
  int v27; // $a3
  int v28; // $a1
  int v29; // $a2
  int v30; // $v1
  __int16 v31; // $t0
  int v32; // $a2
  int v33; // $v0
  __int16 v34; // $v1
  int v35; // $v1
  int v36; // $a1
  int v37; // $a2
  int v38; // $v1
  int v39; // $a1
  int v40; // $a2
  int v41; // $gp
  int v42; // $v1
  int v43; // $gp
  int result; // $v0
  __int16 v45; // [sp+10h] [-8h] BYREF
  __int16 v46; // [sp+12h] [-6h]
  __int16 v47; // [sp+14h] [-4h]
  __int16 v48; // [sp+16h] [-2h]

  if ( (*(v0 + 76) - 5) < 0x16 )
    goto LABEL_32;
  v1 = *(v0 + 72) % 32;
  if ( v1 == 8 )
  {
    v10 = *(v0 + 80);
    v11 = *(v0 + 84);
    v47 = 32;
    v48 = 32;
    v45 = v10;
    v46 = v11;
    ApplyVideoSettings(&v45, 0, 0, 0);
    v13 = v12[20];
    if ( v13 < 288 )
    {
      if ( v12[19] >= 5 )
        v14 = v13 + 5;
      else
        v14 = v13 + 3;
      v12[20] = v14;
    }
    v7 = v12[20];
    v8 = v12[21];
    v45 = 992;
    v9 = 256;
    goto LABEL_26;
  }
  if ( v1 < 9 )
  {
    if ( v1 )
      goto LABEL_32;
    v2 = *(v0 + 80);
    v3 = *(v0 + 84);
    v47 = 32;
    v48 = 32;
    v45 = v2;
    v46 = v3;
    ApplyVideoSettings(&v45, 0, 0, 0);
    v5 = v4[20];
    if ( v5 < 288 )
    {
      if ( v4[19] >= 5 )
        v6 = v5 + 5;
      else
        v6 = v5 + 3;
      v4[20] = v6;
    }
    v7 = v4[20];
    v8 = v4[21];
    v45 = 960;
    v9 = 256;
    goto LABEL_26;
  }
  if ( v1 == 16 )
  {
    v15 = *(v0 + 80);
    v16 = *(v0 + 84);
    v47 = 32;
    v48 = 32;
    v45 = v15;
    v46 = v16;
    ApplyVideoSettings(&v45, 0, 0, 0);
    v18 = v17[20];
    if ( v18 < 288 )
    {
      v19 = v18 + 3;
      if ( v17[19] >= 5 )
        v19 = v18 + 5;
      v17[20] = v19;
    }
    v7 = v17[20];
    v8 = v17[21];
    v45 = 960;
    v9 = 288;
LABEL_26:
    v46 = v9;
    v47 = 32;
    v48 = 32;
    sub_800633C0(&v45, v7, v8);
    goto LABEL_32;
  }
  if ( v1 == 24 )
  {
    v20 = *(v0 + 80);
    v21 = *(v0 + 84);
    v47 = 32;
    v48 = 32;
    v45 = v20;
    v46 = v21;
    ApplyVideoSettings(&v45, 0, 0, 0);
    v23 = v22[20];
    if ( v23 < 288 )
    {
      v24 = v23 + 3;
      if ( v22[19] >= 5 )
        v24 = v23 + 5;
      v22[20] = v24;
    }
    v25 = v22[20];
    v26 = v22[21];
    v45 = 992;
    v46 = 288;
    v47 = 32;
    v48 = 32;
    sub_800633C0(&v45, v25, v26);
    ++*(v0 + 76);
  }
LABEL_32:
  v27 = *(v0 + 76) - 5;
  if ( v27 < 0xA && (*(v0 + 72) & 7) == 0 )
  {
    v28 = *(v0 + 80);
    v29 = *(v0 + 84);
    v45 = 32 * (v27 % 2) + 960;
    v46 = 32 * (v27 / 2) + 320;
    v47 = 32;
    v48 = 32;
    sub_800633C0(&v45, v28, v29);
    ++*(v0 + 76);
  }
  v30 = *(v0 + 76);
  if ( (v30 - 14) < 0xA && (*(v0 + 72) & 3) == 0 )
  {
    if ( v30 != 14 )
    {
      v47 = 64;
      v48 = 52;
      v31 = *(v0 + 84) - 10;
      v45 = *(v0 + 80) + 20 * (v30 - 14);
      v46 = v31;
      ApplyVideoSettings(&v45, 0, 0, 0);
    }
    v32 = *(v0 + 84);
    v45 = 992;
    v46 = 480;
    v33 = *(v0 + 76);
    v47 = 32;
    v48 = 32;
    sub_800633C0(&v45, 20 * (v33 - 14) + 32 + *(v0 + 80), v32);
    v30 = ++*(v0 + 76);
  }
  if ( v30 == 24 && (*(v0 + 72) & 3) == 0 )
  {
    v34 = *(v0 + 84);
    *(v0 + 76) = 25;
    *(v0 + 72) = 1;
    v45 = 256;
    v47 = 64;
    v48 = 32;
    v46 = v34;
    ApplyVideoSettings(&v45, 0, 0, 0);
  }
  v35 = *(v0 + 76);
  if ( v35 == 25 && (*(v0 + 72) & 7) == 0 )
  {
    v36 = *(v0 + 80);
    v37 = *(v0 + 84);
    v45 = 992;
    v46 = 448;
    v47 = 32;
    v48 = 32;
    sub_800633C0(&v45, v36, v37);
    v38 = *(v0 + 72) + 1;
    ++*(v0 + 76);
    *(v0 + 72) = v38;
    v35 = *(v0 + 76);
  }
  if ( v35 == 26 && (*(v0 + 72) & 7) == 0 )
  {
    v39 = *(v0 + 80);
    v40 = *(v0 + 84);
    v45 = 960;
    v46 = 480;
    v47 = 32;
    v48 = 32;
    sub_800633C0(&v45, v39, v40);
    v42 = *(v41 + 72) + 1;
    ++*(v41 + 76);
    *(v41 + 72) = v42;
  }
  WaitForDmaComplete(0);
  VSync(0);
  result = *(v43 + 72) + 1;
  *(v43 + 72) = result;
  return result;
}
// 80019198: variable 'v0' is possibly undefined
// 8001923C: variable 'v4' is possibly undefined
// 800192C0: variable 'v12' is possibly undefined
// 80019344: variable 'v17' is possibly undefined
// 800193D4: variable 'v22' is possibly undefined
// 800196B0: variable 'v41' is possibly undefined
// 800196D4: variable 'v43' is possibly undefined

//----- (800196F4) --------------------------------------------------------
unsigned int GameActionMenu()
{
  int v0; // $s2
  int v1; // $s0
  int v2; // $v0
  char v3; // $s1
  int v4; // $s0
  int v6; // [sp+18h] [-10h] BYREF
  int v7; // [sp+1Ch] [-Ch] BYREF
  unsigned int v8; // [sp+20h] [-8h] BYREF

  v0 = 0;
  v8 = -99;
  v7 = 0;
  v6 = -1;
  SetupMenuUIBuffers();
  v1 = 0;
  do
  {
    ++v1;
    SwapGpuCommandBuffers();
    sub_80020ABC();                             //   FormatNumberForUI
    RenderMenuFrame(0, 8, 0, v7);               //  v7 = &g_UiStyleTable[616 * g_CurrentZoneOrMode + 77 * a1];
    FlushGpuCommands();
  }
  while ( v1 < 2 );
  PlaySfx(SFX_MENU_MOVE);
  WaitForButtonRelease();
  while ( 1 )
  {
    if ( v6 != -1 || v8 != -99 )
      WaitForButtonRelease();
    switch ( v6 )
    {
      case 0:
        v2 = ShowUseMenu();                     // v1 = CollectInventoryItems((int)g_InventoryCounts, v11, v12, v13, 67, 119); + 3 
        goto LABEL_14;
      case 1:
        v2 = UseMagicMenu();                    //  v0 = CollectAvailableSpells((int)g_SpellEntryTable, v10, v11, v12, 14, 19);
        goto LABEL_14;
      case 2:
        EquipmentMenu();                        //  v1 = &dword_80069878[420 * g_CurrentZoneOrMode];
        break;
      case 3:
        DrawDefAtkStats();                      //  while    SwapGpuCommandBuffers(); sub_800213E8(); FlushGpuCommands();
                                                //  sub_800213E8  FormatNumberForUI
        break;
      case 4:
        DropMenu();
        break;
      case 5:
        v2 = SaveDataMenu();
LABEL_14:
        v8 = v2;
        if ( v2 == -1 )
          v8 = -99;
        break;
      case 6:
        OptionsMenu();
        break;
      default:
        break;                                  // return to game
    }
    if ( v8 != -99 )
      break;
    v0 = sub_80020420(v0, 7, &v6, &v7, &v8);
    v3 = PadRead();
    v4 = 0;
    do
    {
      SwapGpuCommandBuffers();
      if ( (v3 & 8) != 0 && (v3 & 4) != 0 )
        sub_80019998();
      ++v4;
      sub_80020ABC();
      RenderMenuFrame(0, 8, v0, v7);
      FlushGpuCommands();
    }
    while ( v4 < 2 );
  }
  if ( v8 == -1 )
    PlaySfx(0);
  Music_UpdateState(v8 + 3 < 2);
  if ( v8 < 0xFFFFFFFE && v8 != -3 && (v8 & 0x1000) != 0 )
  {
    TryCastMagic(v8 & 0xFFF);
    return -1;
  }
  return v8;
}

//----- (80019998) --------------------------------------------------------
int sub_80019998()
{
  __int16 v1[2]; // [sp+18h] [-20h] BYREF
  char v2[28]; // [sp+1Ch] [-1Ch] BYREF

  v1[0] = 252;
  v1[1] = 205;
  FormatNumberForUI(
    100000 * byte_801779DD
  + 10000 * word_8019B5EC
  + 100 * (*&g_LanguageID[0].header[2] >> 11)
  + (*&g_LanguageID[0].menus[0].header.posY >> 11),
    6,
    1,
    0,
    v2);
  return sub_80023FD4(dword_80067AA8, v1);
}
// 80067AA8: using guessed type int dword_80067AA8[3];
// 801779DD: using guessed type char byte_801779DD;
// 8019B5EC: using guessed type __int16 word_8019B5EC;
// 80019998: using guessed type char var_1C[28];

//----- (80019A70) --------------------------------------------------------
int ShowUseMenu()
{
  int v0; // $s3
  char count; // $s0
  int v2; // $gp
  unsigned __int8 v3; // $a1
  char *v5; // $v1
  int v6; // $gp
  int v7; // $s0
  ListWidget wdg; // [sp+18h] [-5C0h] BYREF
  ItemEntry *items_copy; // [sp+3Ch] [-59Ch]
  char *v10; // [sp+44h] [-594h]
  ItemEntry items[54]; // [sp+50h] [-588h] BYREF
  char counts[56]; // [sp+560h] [-78h] BYREF
  char ids[56]; // [sp+598h] [-40h] BYREF
  int PadKey; // [sp+5D0h] [-8h] BYREF
  int selected_itemId; // [sp+5D4h] [-4h] BYREF

  selected_itemId = -99;
  PadKey = 0;
  //   67  119.  ? ?
  //   Type     ?
  count = GetInventoryItems(g_InventoryCounts, items, counts, ids, 67, 119);
  InitListWidget(&wdg, 0, 0);
  v3 = *(v2 + 120);
  wdg.visible_count = count;
  items_copy = items;
  v10 = counts;
  wdg.viewport_bottom = 24;
  ListNavigating(&wdg, v3);
  if ( wdg.visible_count && Draw3dPreview(ids[wdg.viewport_top]) )
    return -1;
  while ( 1 )
  {
    if ( PadKey || selected_itemId != -99 )
      // 1  , 0 
      WaitForButtonRelease();
    if ( PadKey == 1 )
    {
      // ListWidget *widget_ptr, int flags, int slot_id, unsigned __int8 start_idx
      selected_itemId = ShowEquipmentMenu(&wdg, 0, 1, v0);
      if ( selected_itemId == -1 )
        selected_itemId = -99;
      else
        selected_itemId = v0;
    }
    if ( selected_itemId != -99 )
      break;
    ProcessListNavigation(&wdg, ids, &PadKey, &selected_itemId);
    v5 = &ids[wdg.viewport_top];
    *(v6 + 120) = wdg.viewport_top;
    v0 = *v5;
    v7 = 0;
    if ( PadKey == 1 )
    {
      PlaySfx(SFX_MENU_SELECT);
      if ( (v0 - ItemPiratesMap) < 2 || (v7 = 0, v0 == ItemNecronsMap) )
      {
        Flush3dRender();
        ShowMap(v0);
        PlaySfx(SFX_MENU_CANCEL);
        v7 = 0;
        if ( Draw3dPreview(v0) )
          return -1;
        PadKey = 0;
      }
    }
    do
    {
      SwapGpuCommandBuffers();
      if ( wdg.visible_count )
        Update3dPreview(v0);
      RenderItemList(&wdg, 1);
      ++v7;
      FlushGpuCommands();
    }
    while ( v7 < 2 );
  }
  Flush3dRender();
  if ( (selected_itemId - 71) < 0xA )
    UseConsumableItem(selected_itemId);
  return selected_itemId;
}
// 80019AE4: variable 'v2' is possibly undefined
// 80019B88: variable 'v0' is possibly undefined
// 80019BD4: variable 'v6' is possibly undefined
// 80019A70: using guessed type char ids[56];

//----- (80019CD0) --------------------------------------------------------
int __fastcall GetInventoryItems(
        int InventoryCounts,
        ItemEntry *out_buffer,
        _BYTE *out_counts,
        _BYTE *out_ids,
        int start_id,
        int end_id)
{
  int v8; // $t5
  int v9; // $a2
  ItemEntry *next; // $t1
  _BYTE *i; // $t0
  int name_ptr; // $v1
  int desc_ptr; // $a0
  int mesh_id; // $a1
  int stat_bonus; // $v1

  v8 = 0;
  v9 = start_id;
  next = &g_ItemDataTable[120 * *g_LanguageID[0].header + start_id];
  for ( i = (InventoryCounts + start_id); v9 < end_id + 1; ++next )
  {
    if ( *i )                                   //   ?
    {
      //  6     
      name_ptr = next->name_ptr;
      desc_ptr = next->desc_ptr;
      mesh_id = next->mesh_id;
      out_buffer->item_id = next->item_id;
      out_buffer->name_ptr = name_ptr;
      out_buffer->desc_ptr = desc_ptr;
      out_buffer->mesh_id = mesh_id;
      stat_bonus = next->stat_bonus;
      out_buffer->flags = next->flags;
      out_buffer->stat_bonus = stat_bonus;
      ++out_buffer;
      ++v8;
      *out_counts++ = *i;
      *out_ids++ = v9;
    }
    ++i;
    ++v9;
  }
  return v8;
}

//----- (80019DD4) --------------------------------------------------------
int __fastcall CollectEquippableItems(
        __int8 *unlock_flags,
        ItemEntry *out_items,
        _BYTE *out_slot_counts,
        _BYTE *out_item_ids,
        int start_id,
        int end_id)
{
  int items_found; // $t6
  int slot_index; // $a2
  ItemEntry *item; // $t3
  __int8 *i; // $t1
  int name; // $v1
  int desc; // $a0
  int mesh; // $a1
  int stat_bonus; // $v1

  items_found = 0;
  slot_index = start_id;
  item = &g_ItemDataTable[120 * *g_LanguageID[0].header + start_id];
  for ( i = &unlock_flags[start_id]; slot_index < end_id + 1; ++item )
  {
    if ( *i )
    {
      *out_slot_counts = *i;
      if ( slot_index == g_EquippedWeapon
        || slot_index == g_EquippedHead
        || slot_index == g_EquippedBody
        || slot_index == g_EquippedShield
        || slot_index == g_EquippedArms
        || slot_index == g_EquippedLegs
        || slot_index == g_EquipAccessory1
        || slot_index == g_EquipAccessory2
        || slot_index == HIBYTE(g_QuickSlotItem) )
      {
        --*out_slot_counts;
      }
      if ( *out_slot_counts )
      {
        name = item->name_ptr;
        desc = item->desc_ptr;
        mesh = item->mesh_id;
        out_items->item_id = item->item_id;
        out_items->name_ptr = name;
        out_items->desc_ptr = desc;
        out_items->mesh_id = mesh;
        stat_bonus = item->stat_bonus;
        out_items->flags = item->flags;
        out_items->stat_bonus = stat_bonus;
        *out_item_ids = slot_index;
        ++out_items;
        ++out_slot_counts;
        ++out_item_ids;
        ++items_found;
      }
    }
    ++i;
    ++slot_index;
  }
  return items_found;
}
// 8019B55C: using guessed type __int16 g_QuickSlotItem;
// 8019B55F: using guessed type char g_EquippedWeapon;
// 8019B584: using guessed type char g_EquippedHead;
// 8019B585: using guessed type char g_EquippedBody;
// 8019B586: using guessed type char g_EquippedShield;
// 8019B587: using guessed type char g_EquippedArms;
// 8019B588: using guessed type char g_EquippedLegs;
// 8019B589: using guessed type char g_EquipAccessory1;
// 8019B58A: using guessed type char g_EquipAccessory2;

//----- (80019F94) --------------------------------------------------------
int __fastcall sub_80019F94(int a1, int *a2, _BYTE *a3, _BYTE *a4, int a5, int a6)
{
  int v8; // $t6
  int v9; // $a2
  ItemData *v10; // $t2
  _BYTE *v11; // $t0
  unsigned __int16 *v12; // $t1
  int vram_x; // $v1
  int vram_y; // $a0
  int value; // $a1
  int flags; // $v1

  v8 = 0;
  v9 = a5;
  v10 = &g_ItemDataTable[120 * *g_LanguageID[0].header + a5];
  v11 = (a1 + a5);
  if ( a5 < a6 + 1 )
  {
    v12 = dword_8006DFB8 + a5;
    do
    {
      if ( *v11 && *v12 != 50000 )
      {
        vram_x = v10->vram_x;
        vram_y = v10->vram_y;
        value = v10->value;
        *a2 = v10->item_id;
        a2[1] = vram_x;
        a2[2] = vram_y;
        a2[3] = value;
        flags = v10->flags;
        a2[4] = v10->param;
        a2[5] = flags;
        a2 += 6;
        ++v8;
        *a3++ = *v11;
        *a4++ = v9;
      }
      ++v11;
      ++v10;
      ++v9;
      ++v12;
    }
    while ( v9 < a6 + 1 );
  }
  return v8;
}
// 8006DFB8: using guessed type int dword_8006DFB8[49];

//----- (8001A0BC) --------------------------------------------------------
int __fastcall UseConsumableItem(int item_id)
{
  int result; // $v0
  __int16 *v3; // $v1
  __int16 final_val; // $v0

  result = ItemBloodStone;
  if ( !g_InventoryCounts[item_id] )            // if (item_count[item_id] == 0)
    return result;
  if ( item_id == ItemBloodStone )
  {
    if ( g_AttackCooldown > 0 )
      g_AttackCooldown = 0;
    if ( word_8019B522 >= 65 )
      word_8019B522 = 64;
    sub_8001A3F8();
    sub_8001A3C8();
  }
  else
  {
    switch ( item_id )
    {
      case ItemMoonStone:
        v3 = &g_CurrentMP;
        final_val = g_CurrentMP + 40;
        break;
      case ItemVerdite:
        ++g_MagicPower;
        CalculatePlayerStats();
        goto LABEL_23;
      case ItemEarthHerb:                       //  
        v3 = &g_CurrentHP;
        final_val = g_CurrentHP + 40;
        break;
      case ItemAntidote:                        //   (  )
        v3 = &g_CurrentHP;
        g_PoisenStatus = 0;
        final_val = g_CurrentHP + 15;
        break;
      case ItemDragonCrystal:
        g_CurrentHP = g_MaxHP;
        g_CurrentMP = g_MaxMP;
        sub_8001A35C();
        goto LABEL_23;
      case ItemBluePotion:                      //   
        v3 = &g_CurrentHP;
        final_val = g_CurrentHP + 100;
        break;
      case ItemRedPotion:                       //   
        v3 = &g_CurrentMP;
        final_val = g_CurrentMP + 50;
        break;
      default:
        goto LABEL_23;
    }
    *v3 = final_val;
  }
LABEL_23:
  if ( item_id == ItemGreenPotion )
  {
LABEL_26:
    sub_8001A35C();
    goto LABEL_27;
  }
  if ( item_id == ItemGoldPotion )              //   
  {
    g_CurrentHP += 100;
    g_CurrentMP += 50;
    goto LABEL_26;
  }
LABEL_27:
  if ( g_MaxHP < g_CurrentHP )
    g_CurrentHP = g_MaxHP;
  if ( g_MaxMP < g_CurrentMP )
    g_CurrentMP = g_MaxMP;
  --g_InventoryCounts[item_id];                 // item_count[item_id]--
  if ( (item_id - 77) < 2 || (item_id - 79) < 2 )
    ++byte_8009DEC2;
  return PlaySfx(SFX_MENU_CONFIRM);
}
// 8009DEC2: using guessed type char byte_8009DEC2;
// 8019B4D6: using guessed type __int16 g_MaxHP;
// 8019B4D8: using guessed type __int16 g_CurrentHP;
// 8019B4DA: using guessed type __int16 g_MaxMP;
// 8019B4DC: using guessed type __int16 g_CurrentMP;
// 8019B4EA: using guessed type __int16 g_MagicPower;
// 8019B518: using guessed type __int16 g_PoisenStatus;
// 8019B522: using guessed type __int16 word_8019B522;
// 8019B524: using guessed type __int16 g_AttackCooldown;

//----- (8001A35C) --------------------------------------------------------
int sub_8001A35C()
{
  if ( g_AttackCooldown > 0 )
    g_AttackCooldown = 0;
  if ( word_8019B522 >= 0x41 )
    word_8019B522 = 0x40;
  g_PoisenStatus = 0;
  sub_8001A3F8();
  return sub_8001A3C8();
}
// 8019B518: using guessed type __int16 g_PoisenStatus;
// 8019B522: using guessed type __int16 word_8019B522;
// 8019B524: using guessed type __int16 g_AttackCooldown;

//----- (8001A3C8) --------------------------------------------------------
int sub_8001A3C8()
{
  int result; // $v0

  result = 64;
  if ( word_8019B51E >= 65 )
  {
    word_8019B51E = 64;
    word_8019B520 = 0;
  }
  return result;
}
// 8019B51E: using guessed type __int16 word_8019B51E;
// 8019B520: using guessed type __int16 word_8019B520;

//----- (8001A3F8) --------------------------------------------------------
int sub_8001A3F8()
{
  int result; // $v0

  result = 64;
  if ( word_8019B51A >= 65 )
  {
    word_8019B51A = 64;
    word_8019B51C = 0;
  }
  return result;
}
// 8019B51A: using guessed type __int16 word_8019B51A;
// 8019B51C: using guessed type __int16 word_8019B51C;

//----- (8001A428) --------------------------------------------------------
int __fastcall ShowMap(char a1)
{
  int v1; // $s3
  unsigned __int16 v2; // $s0
  int v3; // $v0
  int *Memory; // $v0
  unsigned __int16 v5; // $a1
  int v6; // $s0
  int v7; // $gp
  int v8; // $v1
  int v9; // $a0
  int v10; // $gp
  int v11; // $a0
  int v12; // $v1
  char v13; // $v1
  char v14; // $a1

  v1 = 0;
  v2 = 8 * (a1 - 67) + byte_801779DD + 480;
  v3 = ReadFromFile(RES_ITEM, v2, 0);
  Memory = AllocateMemory(v3);
  v5 = v2;
  v6 = Memory;
  ExtractFileSections(6u, v5, Memory);
  ProcessTIMContainer(v6);
  // / (  )
  do
  {
    SwapGpuCommandBuffers();
    GPU_Cmd_SetupFlatGrayQuad();
    *(*(v7 + 240) + 4) = 95;
    *(*(v7 + 240) + 5) = 95;
    *(*(v7 + 240) + 6) = 95;
    v8 = *(v7 + 240);
    *(v8 + 12) = 0;
    v9 = *(v7 + 240);
    *(v8 + 22) = 31;
    *(v8 + 14) = 32740;
    *(v8 + 10) = 20;
    *(v8 + 18) = 20;
    *(v8 + 8) = 60;
    *(v8 + 16) = 260;
    *(v8 + 24) = 60;
    *(v8 + 26) = 220;
    *(v8 + 32) = 260;
    *(v8 + 34) = 220;
    *(v9 + 13) = 0;
    *(*(v7 + 240) + 20) = 200;
    *(*(v7 + 240) + 28) = 0;
    *(*(v7 + 240) + 29) = -56;
    *(*(v7 + 240) + 36) = -56;
    *(*(v7 + 240) + 37) = -56;
    GPU_Cmd_FinalizeAndAdvance(10);
    GPU_Cmd_SetupFlatGrayQuad();
    *(*(v10 + 240) + 4) = 127;
    *(*(v10 + 240) + 5) = 127;
    *(*(v10 + 240) + 6) = 127;
    v11 = *(v10 + 240);
    *(v11 + 22) = 28;
    *(v11 + 14) = 32037;
    *(v11 + 8) = *&g_LanguageID[0].header[2] / 819 + 52;
    *(v11 + 10) = 212 - g_LanguageID[0].menus[0].header.posY / 819;
    *(v11 + 16) = *&g_LanguageID[0].header[2] / 819 + 67;
    *(v11 + 18) = 212 - g_LanguageID[0].menus[0].header.posY / 819;
    *(v11 + 24) = *&g_LanguageID[0].header[2] / 819 + 52;
    *(v11 + 26) = 227 - g_LanguageID[0].menus[0].header.posY / 819;
    *(v11 + 32) = *&g_LanguageID[0].header[2] / 819 + 67;
    *(v11 + 34) = 227 - g_LanguageID[0].menus[0].header.posY / 819;
    v12 = ((*&g_LanguageID[0].menus[0].header.extra[4] & 0xFFF) + 256) >> 9;
    ++v1;
    if ( v12 == 8 )
      LOBYTE(v12) = 0;
    v13 = 16 * v12;
    v14 = v13 + 0x80;
    *(v11 + 12) = v13 + 0x80;
    *(*(v10 + 240) + 13) = -112;
    v13 -= 113;
    *(*(v10 + 240) + 20) = v13;
    *(*(v10 + 240) + 21) = -112;
    *(*(v10 + 240) + 28) = v14;
    *(*(v10 + 240) + 29) = -97;
    *(*(v10 + 240) + 36) = v13;
    *(*(v10 + 240) + 37) = -97;
    GPU_Cmd_FinalizeAndAdvance(9);
    //    ( ) ?
    DrawTexturedQuad(54, 14, 212, 212, 2, 2);
    FlushGpuCommands();
  }
  while ( v1 < 2 );
  WaitForButtonRelease();
  while ( !PadRead() )
    ;
  WaitForButtonRelease();
  return PadChkVsync(v6);
}
// 8001A4D4: variable 'v7' is possibly undefined
// 8001A598: variable 'v10' is possibly undefined
// 801779DD: using guessed type char byte_801779DD;

//----- (8001A824) --------------------------------------------------------
int UseMagicMenu()
{
  char v0; // $s0
  int v1; // $gp
  unsigned __int8 v2; // $a1
  int v3; // $v1
  int v4; // $gp
  int v5; // $s0
  ListWidget v7; // [sp+18h] [-288h] BYREF
  int *v8; // [sp+3Ch] [-264h]
  int *v9; // [sp+48h] [-258h]
  int v10[120]; // [sp+50h] [-250h] BYREF
  int v11[20]; // [sp+230h] [-70h] BYREF
  char v12[24]; // [sp+280h] [-20h] BYREF
  int v13; // [sp+298h] [-8h] BYREF
  int v14; // [sp+29Ch] [-4h] BYREF

  v14 = -99;
  v13 = 0;
  v0 = CollectAvailableSpells(g_SpellEntryTable, v10, v11, v12, 14, 19);
  InitListWidget(&v7, 0, 1);
  v2 = *(v1 + 121);
  v7.scroll_offset = 6;
  v7.selected_idx = -125;
  v7.visible_count = v0;
  v8 = v10;
  v9 = v11;
  v7.viewport_bottom = 24;
  ListNavigating(&v7, v2);
  while ( 1 )
  {
    if ( v13 || v14 != -99 )
      WaitForButtonRelease();
    if ( v13 == 1 )
    {
      v14 = ShowEquipmentMenu(&v7, 0, 2, 0xFFu);
      if ( v14 == -1 )
        v14 = -99;
      else
        v14 = v12[v7.viewport_top];
    }
    if ( v14 != -99 )
      break;
    ProcessListNavigation(&v7, 0, &v13, &v14);
    v3 = v13;
    *(v4 + 121) = v7.viewport_top;
    v5 = 0;
    if ( v3 == 1 )
      PlaySfx(17);
    do
    {
      ++v5;
      SwapGpuCommandBuffers();
      RenderItemList(&v7, 2);
      FlushGpuCommands();
    }
    while ( v5 < 2 );
  }
  if ( v14 != -1 )
    return v14 | 0x1000;
  return v14;
}
// 8001A89C: variable 'v1' is possibly undefined
// 8001A964: variable 'v4' is possibly undefined
// 8001A824: using guessed type int var_250[120];
// 8001A824: using guessed type _DWORD var_70[20];
// 8001A824: using guessed type char var_20[24];

//----- (8001A9E4) --------------------------------------------------------
int __fastcall CollectAvailableSpells(
        SpellDataEntry *SpellEntryTable,
        PlayerSpellEntry *out_buffer,
        _DWORD *out_costs,
        _BYTE *out_ids,
        int start_id,
        int end_id)
{
  int v9; // $t5
  int v10; // $a3
  SpellDataEntry *ent; // $t0
  PlayerSpellEntry *spl; // $a2
  int range; // $v1
  int v14; // $a0
  int v15; // $a1
  int v16; // $v1

  v9 = 0;
  v10 = start_id;
  ent = (SpellEntryTable + 26 * start_id);
  //   = 20  ( /?)
  for ( spl = &g_SpellDataTable[20 * *g_LanguageID[0].header + start_id]; v10 < end_id + 1; spl = (spl + 24) )
  {
    if ( ent->PlayerHas == 1 )                  // PlayerHas
    {
      //  s   
      range = *&spl->ActiveEffect;
      v14 = *(&spl->unk3 + 1);
      v15 = *(&spl->BonusDmgMagic + 1);
      *&out_buffer->PlayerHas = *&spl->PlayerHas;
      *&out_buffer->ActiveEffect = range;
      *(&out_buffer->unk3 + 1) = v14;
      *(&out_buffer->BonusDmgMagic + 1) = v15;
      v16 = *(&spl->WaterDmg + 1);
      *(&out_buffer->EarthDmg + 1) = *(&spl->EarthDmg + 1);
      *(&out_buffer->WaterDmg + 1) = v16;
      out_buffer = (out_buffer + 24);
      ++v9;
      *out_costs++ = *&ent->manaCost;
      *out_ids++ = v10;
    }
    ent = (ent + 26);
    ++v10;
  }
  return v9;
}

//----- (8001AAF4) --------------------------------------------------------
int EquipmentMenu()
{
  ItemEntry *v0; // $a3
  int *v1; // $a2
  int *v2; // $t0
  int v3; // $v1
  int v4; // $a0
  int v5; // $a1
  int v6; // $v1
  int v7; // $a0
  int v8; // $a1
  int result; // $v0
  int v10; // $s0
  ListWidget v11; // [sp+10h] [-220h] BYREF
  ItemEntry *v12; // [sp+34h] [-1FCh]
  ItemEntry *v13; // [sp+38h] [-1F8h]
  ItemEntry var1E8[21]; // [sp+48h] [-1E8h] BYREF

  v0 = var1E8;
  var1E8[20].item_id = 0;
  var1E8[20].name_ptr = -99;
  v1 = &dword_80069878[420 * *g_LanguageID[0].header];
  v2 = v1 + 60;
  if ( ((v1 | var1E8) & 3) != 0 )
  {
    do
    {
      v3 = v1[1];
      v4 = v1[2];
      v5 = v1[3];
      v0->item_id = *v1;
      v0->name_ptr = v3;
      v0->desc_ptr = v4;
      v0->mesh_id = v5;
      v1 += 4;
      v0 = (v0 + 16);
    }
    while ( v1 != v2 );
  }
  else
  {
    do
    {
      v6 = v1[1];
      v7 = v1[2];
      v8 = v1[3];
      v0->item_id = *v1;
      v0->name_ptr = v6;
      v0->desc_ptr = v7;
      v0->mesh_id = v8;
      v1 += 4;
      v0 = (v0 + 16);
    }
    while ( v1 != v2 );
  }
  // 10    24     = 240 
  CollectEquippedItemsData(&var1E8[10]);
  InitListWidget(&v11, 0, 2);
  v11.visible_count = 10;
  v11.scroll_offset = 10;
  v12 = var1E8;
  v11.selected_idx = 39;
  v13 = &var1E8[10];
  v11.viewport_bottom = 24;
  while ( 1 )
  {
    if ( var1E8[20].item_id || var1E8[20].name_ptr != -99 )
      WaitForButtonRelease();
    if ( var1E8[20].item_id == 1 )
    {
      if ( v11.viewport_top == 1 )
      {
        sub_8001B480();
      }
      else if ( v11.viewport_top == 9 )
      {
        BuildUnifiedActionMenu__();
      }
      else
      {
        sub_8001AEF4(v11.viewport_top);
      }
      CollectEquippedItemsData(&var1E8[10]);
    }
    result = var1E8[20].name_ptr;
    if ( var1E8[20].name_ptr != -99 )
      break;
    ProcessListNavigation(&v11, 0, &var1E8[20].item_id, &var1E8[20].name_ptr);
    v10 = 0;
    if ( var1E8[20].item_id == 1 )
      PlaySfx(17);
    do
    {
      ++v10;
      SwapGpuCommandBuffers();
      RenderItemList(&v11, 3);
      FlushGpuCommands();
    }
    while ( v10 < 2 );
  }
  return result;
}
// 80069878: using guessed type int dword_80069878[6];

//----- (8001AD20) --------------------------------------------------------
BOOL __fastcall CollectEquippedItemsData(ItemEntry *out_buffer)
{
  char *slots; // $t0
  int slot_index; // $a3
  int slots_copy; // $v1
  int v5; // $a0
  int v6; // $v0
  char *spell; // $v1
  int v8; // $v0
  ItemEntry *data; // $a0
  int name; // $v1
  int desc; // $a1
  int mesh; // $a2
  int stats; // $v1
  BOOL result; // $v0
  char equipped_items[9]; // [sp+0h] [-10h] BYREF
  char v16; // [sp+9h] [-7h]

  equipped_items[SLOT_MAGIC] = g_EquippedMagic;
  equipped_items[0] = g_EquippedWeapon;         // SLOT_WEAPON ( 0    enum, )
  equipped_items[SLOT_SHIELD] = g_EquippedShield;
  equipped_items[SLOT_HEAD] = g_EquippedHead;
  equipped_items[SLOT_BODY] = g_EquippedBody;
  equipped_items[SLOT_ARMS] = g_EquippedArms;
  equipped_items[SLOT_LEGS] = g_EquippedLegs;
  equipped_items[SLOT_ACCESSORY1] = g_EquipAccessory1;
  equipped_items[SLOT_ACCESSORY2] = g_EquipAccessory2;
  if ( g_QuickSlotItem == 255 )
    v16 = HIBYTE(g_QuickSlotItem);
  else
    v16 = g_QuickSlotItem;
  slots = equipped_items;
  slot_index = 0;
  do
  {
    slots_copy = *slots;
    if ( slots_copy == 255 )                    // == null?
    {
      LOBYTE(out_buffer->item_id) = -1;
    }
    else
    {
      if ( slot_index == 1 || slot_index == 9 && g_QuickSlotItem != 255 )
      {
        // 20 ()  24 () = 480 ! 
        // EquipSlotData = 24 
        v5 = 480 * *g_LanguageID[0].header;
        v6 = 3 * slots_copy;
        spell = g_SpellDataTable;
        v8 = 8 * v6;
      }
      else
      {
        v5 = 2880 * *g_LanguageID[0].header;
        v8 = 24 * *slots;
        spell = g_ItemDataTable;
      }
      data = &spell[v8 + v5];
      name = data->name_ptr;
      desc = data->desc_ptr;
      mesh = data->mesh_id;
      out_buffer->item_id = data->item_id;
      out_buffer->name_ptr = name;
      out_buffer->desc_ptr = desc;
      out_buffer->mesh_id = mesh;
      stats = data->stat_bonus;
      out_buffer->flags = data->flags;
      out_buffer->stat_bonus = stats;
      out_buffer->stat_bonus = stats;
    }
    ++out_buffer;
    result = ++slot_index < 10;
    ++slots;
  }
  while ( slot_index < 10 );
  return result;
}
// 8019B55B: using guessed type char g_EquippedMagic;
// 8019B55C: using guessed type __int16 g_QuickSlotItem;
// 8019B55F: using guessed type char g_EquippedWeapon;
// 8019B584: using guessed type char g_EquippedHead;
// 8019B585: using guessed type char g_EquippedBody;
// 8019B586: using guessed type char g_EquippedShield;
// 8019B587: using guessed type char g_EquippedArms;
// 8019B588: using guessed type char g_EquippedLegs;
// 8019B589: using guessed type char g_EquipAccessory1;
// 8019B58A: using guessed type char g_EquipAccessory2;

//----- (8001AEF4) --------------------------------------------------------
int __fastcall sub_8001AEF4(int a1)
{
  int v1; // $v1
  int v2; // $t0
  unsigned __int8 v3; // $s7
  unsigned __int8 v5; // $s4
  unsigned __int8 v6; // $fp
  int InventoryItems; // $v0
  char *v8; // $t0
  char *v9; // $t1
  int v10; // $s0
  int v11; // $s3
  int *v12; // $a3
  int v13; // $v0
  int v14; // $t2
  int v15; // $t3
  int v16; // $t4
  int v17; // $t2
  int v18; // $s0
  char *v19; // $v1
  int result; // $v0
  int v21; // $s3
  unsigned int v22; // $v0
  char v23; // $a0
  char v24; // $a1
  bool v25; // dc
  ListWidget v26; // [sp+18h] [-330h] BYREF
  int *v27; // [sp+3Ch] [-30Ch]
  char *v28; // [sp+44h] [-304h]
  int v29[168]; // [sp+50h] [-2F8h] BYREF
  char v30[32]; // [sp+2F0h] [-58h] BYREF
  char v31[32]; // [sp+310h] [-38h] BYREF
  int v32; // [sp+330h] [-18h] BYREF
  int v33; // [sp+334h] [-14h] BYREF
  unsigned __int8 v34; // [sp+338h] [-10h] BYREF

  v5 = 0;
  v6 = 0;
  v33 = -99;
  v32 = 0;
  switch ( a1 )
  {
    case 0:
      v2 = 0;
      v5 = g_EquippedWeapon;
      v1 = 20;
      break;
    case 2:
      v2 = 34;
      v5 = g_EquippedShield;
      v1 = 40;
      break;
    case 3:
      v2 = 21;
      v5 = g_EquippedHead;
      v1 = 27;
      break;
    case 4:
      v2 = 28;
      v5 = g_EquippedBody;
      v1 = 33;
      break;
    case 5:
      v2 = 41;
      v5 = g_EquippedArms;
      v1 = 46;
      break;
    case 6:
      v2 = 47;
      v5 = g_EquippedLegs;
      v1 = 52;
      break;
    case 7:
    case 8:
      if ( a1 == 7 )
        v5 = g_EquipAccessory1;
      else
        v5 = g_EquipAccessory2;
      if ( a1 == 7 )
        v34 = g_EquipAccessory2;
      else
        v34 = g_EquipAccessory1;
      v2 = 53;
      if ( v34 != 255 )
        --g_InventoryCounts[v34];
      v1 = 59;
      break;
    default:
      break;
  }
  InventoryItems = GetInventoryItems(g_InventoryCounts, v29, v30, v31, v2, v1);
  v8 = &v30[InventoryItems];
  v9 = &v31[InventoryItems];
  v10 = InventoryItems + 1;
  v11 = 0;
  v12 = &v29[6 * InventoryItems];
  v13 = 1680 * *g_LanguageID[0].header;
  v14 = *&byte_80069984[v13];
  v15 = *&byte_80069988[v13];
  v16 = *&byte_8006998C[v13];
  *v12 = *&byte_80069980[v13];
  v12[1] = v14;
  v12[2] = v15;
  v12[3] = v16;
  v17 = *&byte_80069994[v13];
  v12[4] = *&byte_80069990[v13];
  v12[5] = v17;
  *v8 = -1;
  *v9 = -1;
  InitListWidget(&v26, 0, 2);
  v26.visible_count = v10;
  v18 = v10 - 1;
  v27 = v29;
  v28 = v30;
  v26.viewport_bottom = 24;
  if ( v18 > 0 )
  {
    v19 = v31;
    do
    {
      if ( *v19 == v5 )
      {
        v6 = v11;
        v19 = &v34;
        v11 = 40;
      }
      ++v11;
      ++v19;
    }
    while ( v11 < v18 );
  }
  ListNavigating(&v26, v6);
  if ( !v26.visible_count || (result = Draw3dPreview(v31[v26.viewport_top])) == 0 )
  {
    while ( 1 )
    {
      if ( v32 || v33 != -99 )
        WaitForButtonRelease();
      if ( v32 == 1 )
      {
        v33 = ShowEquipmentMenu(&v26, 5, 5, v3);
        if ( v33 == -1 )
          v33 = -99;
        else
          v33 = v3;
      }
      if ( v33 != -99 )
        break;
      ProcessListNavigation(&v26, v31, &v32, &v33);
      v3 = v31[v26.viewport_top];
      v21 = 0;
      if ( v32 == 1 )
        PlaySfx(17);
      do
      {
        SwapGpuCommandBuffers();
        if ( v26.visible_count )
          Update3dPreview(v3);
        RenderItemList(&v26, 5);
        ++v21;
        FlushGpuCommands();
      }
      while ( v21 < 2 );
    }
    Flush3dRender();
    if ( v33 != -1 )
    {
      switch ( a1 )
      {
        case 0:
          sub_8002810C(v33);
          v22 = a1 - 7;
          goto LABEL_50;
        case 2:
          v23 = v33;
          v24 = 4;
          goto LABEL_48;
        case 3:
          v23 = v33;
          v24 = 0;
          goto LABEL_48;
        case 4:
          v23 = v33;
          v24 = 1;
          goto LABEL_48;
        case 5:
          v23 = v33;
          v24 = 2;
          goto LABEL_48;
        case 6:
          v23 = v33;
          v24 = 3;
          goto LABEL_48;
        case 7:
          v23 = v33;
          v24 = 5;
          goto LABEL_48;
        case 8:
          v23 = v33;
          v24 = 6;
LABEL_48:
          sub_80027ED0(v23, v24);
          break;
        default:
          break;
      }
    }
    v22 = a1 - 7;
LABEL_50:
    v25 = v22 >= 2;
    result = 255;
    if ( !v25 && v34 != 255 )
    {
      result = g_InventoryCounts[v34] + 1;
      g_InventoryCounts[v34] = result;
    }
  }
  return result;
}
// 8001B084: variable 'v2' is possibly undefined
// 8001B084: variable 'v1' is possibly undefined
// 8001B2B4: variable 'v3' is possibly undefined
// 8019B55F: using guessed type char g_EquippedWeapon;
// 8019B584: using guessed type char g_EquippedHead;
// 8019B585: using guessed type char g_EquippedBody;
// 8019B586: using guessed type char g_EquippedShield;
// 8019B587: using guessed type char g_EquippedArms;
// 8019B588: using guessed type char g_EquippedLegs;
// 8019B589: using guessed type char g_EquipAccessory1;
// 8019B58A: using guessed type char g_EquipAccessory2;
// 8001AEF4: using guessed type int var_2F8[168];
// 8001AEF4: using guessed type _BYTE var_58[32];
// 8001AEF4: using guessed type char var_38[32];

//----- (8001B480) --------------------------------------------------------
void sub_8001B480()
{
  int v0; // $v0
  char *v1; // $t1
  int v2; // $s0
  int v3; // $s3
  int *v4; // $a3
  char *v5; // $t0
  int v6; // $v0
  int v7; // $t2
  int v8; // $t3
  int v9; // $t4
  int v10; // $t2
  int v11; // $s0
  char *v12; // $a0
  int v13; // $s3
  ListWidget v14; // [sp+18h] [-290h] BYREF
  int *v15; // [sp+3Ch] [-26Ch]
  int *v16; // [sp+48h] [-260h]
  int v17[120]; // [sp+50h] [-258h] BYREF
  int v18[20]; // [sp+230h] [-78h] BYREF
  char v19[20]; // [sp+280h] [-28h] BYREF
  int v20; // [sp+294h] [-14h] BYREF
  int v21; // [sp+298h] [-10h] BYREF
  int v22[3]; // [sp+29Ch] [-Ch] BYREF

  v22[0] = -99;
  v21 = 0;
  v0 = CollectAvailableSpells(g_SpellEntryTable, v17, v18, v19, 0, 13);
  v1 = &v19[v0];
  v2 = v0 + 1;
  v3 = 0;
  v4 = &v17[6 * v0];
  v5 = &v14 + 4 * v0;
  v6 = 1680 * *g_LanguageID[0].header;
  v7 = *&byte_80069984[v6];
  v8 = *&byte_80069988[v6];
  v9 = *&byte_8006998C[v6];
  *v4 = *&byte_80069980[v6];
  v4[1] = v7;
  v4[2] = v8;
  v4[3] = v9;
  v10 = *&byte_80069994[v6];
  v4[4] = *&byte_80069990[v6];
  v4[5] = v10;
  *(v5 + 134) = -1;
  *v1 = -1;
  InitListWidget(&v14, 0, 2);
  v14.scroll_offset = 6;
  v14.selected_idx = -125;
  v14.visible_count = v2;
  v11 = v2 - 1;
  v15 = v17;
  v16 = v18;
  v14.viewport_bottom = 24;
  if ( v11 > 0 )
  {
    v12 = v19;
    do
    {
      if ( *v12 == g_EquippedMagic )
      {
        ListNavigating(&v14, v3);
        v12 = &v20;
        v3 = 20;
      }
      ++v3;
      ++v12;
    }
    while ( v3 < v11 );
  }
  while ( 1 )
  {
    if ( v21 || v22[0] != -99 )
      WaitForButtonRelease();
    if ( v21 == 1 )
    {
      v22[0] = ShowEquipmentMenu(&v14, 5, 4, 0xFFu);
      if ( v22[0] == -1 )
        v22[0] = -99;
      else
        v22[0] = v19[v14.viewport_top];
    }
    if ( v22[0] != -99 )
      break;
    ProcessListNavigation(&v14, 0, &v21, v22);
    v13 = 0;
    if ( v21 == 1 )
      PlaySfx(17);
    do
    {
      ++v13;
      SwapGpuCommandBuffers();
      RenderItemList(&v14, 4);
      FlushGpuCommands();
    }
    while ( v13 < 2 );
  }
  if ( v22[0] != -1 )
    SsSetAutoKeyOffMode(v22[0]);
}
// 8019B55B: using guessed type char g_EquippedMagic;
// 8001B480: using guessed type int var_258[120];
// 8001B480: using guessed type _DWORD var_78[20];
// 8001B480: using guessed type char var_28[20];
// 8001B480: using guessed type int var_C[3];
// 8001B480: using guessed type unsigned __int8 var_290[29];

//----- (8001B7C0) --------------------------------------------------------
_BYTE *BuildUnifiedActionMenu__()
{
  unsigned __int8 v0; // $s7
  int v1; // $s0
  char *v2; // $a2
  char *v3; // $a1
  ListWidget *v4; // $a0
  char *v5; // $v1
  char v6; // $s4
  char v7; // $s5
  int InventoryItems; // $s0
  int v9; // $s0
  int *v10; // $a3
  int v11; // $v0
  int v12; // $t0
  int v13; // $t1
  int v14; // $t2
  int v15; // $t0
  int i; // $s0
  int v17; // $v1
  _BYTE *v18; // $v0
  int v19; // $v0
  _BYTE *result; // $v0
  int v21; // $s0
  _BYTE v22[16]; // [sp+0h] [-960h] BYREF
  ListWidget v23; // [sp+18h] [-948h] BYREF
  int *v24; // [sp+3Ch] [-924h]
  char *v25; // [sp+44h] [-91Ch]
  int *v26; // [sp+48h] [-918h]
  int v27[444]; // [sp+50h] [-910h] BYREF
  char v28[80]; // [sp+740h] [-220h] BYREF
  int v29[74]; // [sp+790h] [-1D0h] BYREF
  char v30[80]; // [sp+8B8h] [-A8h] BYREF
  char v31[80]; // [sp+908h] [-58h] BYREF
  int v32; // [sp+958h] [-8h] BYREF
  int viewport_top; // [sp+95Ch] [-4h] BYREF

  v1 = 0;
  v2 = v31;
  v3 = v30;
  v4 = &v23;
  v5 = v28;
  v32 = 0;
  viewport_top = -99;
  do
  {
    *v5 = -1;
    *v4[53].frame_style = -1;
    *v3 = -1;
    *v2++ = -1;
    ++v3;
    v4 = (v4 + 4);
    ++v1;
    ++v5;
  }
  while ( v1 < 74 );
  v6 = byte_8009DED0;
  v7 = byte_8009DED1;
  byte_8009DED0 = 0;
  byte_8009DED1 = 0;
  InventoryItems = GetInventoryItems(g_InventoryCounts, v27, v28, v30, 70, 116);
  byte_8009DED0 = v6;
  byte_8009DED1 = v7;
  v9 = InventoryItems
     + CollectAvailableSpells(
         g_SpellEntryTable,
         &v27[6 * InventoryItems],
         &v29[InventoryItems],
         &v31[InventoryItems],
         0,
         19);
  v10 = &v27[6 * v9];
  v11 = 1680 * *g_LanguageID[0].header;
  v12 = *&byte_80069984[v11];
  v13 = *&byte_80069988[v11];
  v14 = *&byte_8006998C[v11];
  *v10 = *&byte_80069980[v11];
  v10[1] = v12;
  v10[2] = v13;
  v10[3] = v14;
  v15 = *&byte_80069994[v11];
  v10[4] = *&byte_80069990[v11];
  v10[5] = v15;
  InitListWidget(&v23, 0, 2);
  v23.viewport_bottom = 24;
  v23.visible_count = v9 + 1;
  v24 = v27;
  v25 = v28;
  v26 = v29;
  if ( g_QuickSlotItem != 0xFFFF )
  {
    for ( i = 0; i < 74; ++i )
    {
      v17 = g_QuickSlotItem;
      v18 = &v22[i];
      if ( g_QuickSlotItem == 255 )
      {
        v17 = v18[2232];
        v19 = HIBYTE(g_QuickSlotItem);
      }
      else
      {
        v19 = v18[2312];
      }
      if ( v19 == v17 )
      {
        ListNavigating(&v23, i);
        i = 74;
      }
    }
  }
  if ( !v23.visible_count || (result = Draw3dPreview(v30[v23.viewport_top])) == 0 )
  {
    while ( 1 )
    {
      if ( v32 || viewport_top != -99 )
        WaitForButtonRelease();
      if ( v32 == 1 )
      {
        viewport_top = ShowEquipmentMenu(&v23, 5, 16, v0);
        if ( viewport_top == -1 )
          viewport_top = -99;
        else
          viewport_top = v23.viewport_top;
      }
      if ( viewport_top != -99 )
        break;
      ProcessListNavigation(&v23, v30, &v32, &viewport_top);
      v0 = v30[v23.viewport_top];
      v21 = 0;
      if ( v32 == 1 )
        PlaySfx(17);
      do
      {
        SwapGpuCommandBuffers();
        if ( v23.visible_count )
          Update3dPreview(v0);
        RenderItemList(&v23, 16);
        ++v21;
        FlushGpuCommands();
      }
      while ( v21 < 2 );
    }
    result = &v22[viewport_top];
    if ( viewport_top != -1 )
    {
      sub_80027E80(result[2312]);
      return sub_80027EA8(v30[viewport_top]);
    }
  }
  return result;
}
// 8001BB00: variable 'v0' is possibly undefined
// 8009DED0: using guessed type char byte_8009DED0;
// 8009DED1: using guessed type char byte_8009DED1;
// 8019B55C: using guessed type __int16 g_QuickSlotItem;
// 8001B7C0: using guessed type _BYTE var_58[80];
// 8001B7C0: using guessed type char var_A8[80];
// 8001B7C0: using guessed type int var_910[444];
// 8001B7C0: using guessed type _DWORD var_1D0[74];

//----- (8001BC14) --------------------------------------------------------
int DrawDefAtkStats()
{
  int v0; // $s0

  v0 = -99;
  while ( v0 == -99 )
  {
    WaitForInputStable();
    if ( ReadPadWithFlag() )
    {
      PlaySfx(18);
      v0 = -1;
    }
    SwapGpuCommandBuffers();
    sub_800213E8();
    FlushGpuCommands();
  }
  return WaitForButtonRelease();
}

//----- (8001BCA0) --------------------------------------------------------
int DropMenu()
{
  unsigned __int8 val0; // $s4
  char v1; // $s0
  int v2; // $gp
  unsigned __int8 v3; // $a1
  int result; // $v0
  unsigned __int8 *v5; // $v1
  int v6; // $gp
  int v7; // $s0
  ListWidget widget_ptr; // [sp+18h] [-C70h] BYREF
  int *v9; // [sp+3Ch] [-C4Ch]
  char *v10; // [sp+44h] [-C44h]
  int v11[720]; // [sp+50h] [-C38h] BYREF
  char v12[120]; // [sp+B90h] [-F8h] BYREF
  char v13[120]; // [sp+C08h] [-80h] BYREF
  int v14; // [sp+C80h] [-8h] BYREF
  int v15; // [sp+C84h] [-4h] BYREF

  v15 = -99;
  v14 = 0;
  v1 = CollectEquippableItems(g_InventoryCounts, v11, v12, v13, 0, 119);
  InitListWidget(&widget_ptr, 0, 4);
  v3 = *(v2 + 122);
  widget_ptr.visible_count = v1;
  v9 = v11;
  v10 = v12;
  widget_ptr.viewport_bottom = 24;
  ListNavigating(&widget_ptr, v3);
  if ( !widget_ptr.visible_count || (result = Draw3dPreview(v13[widget_ptr.viewport_top])) == 0 )
  {
    while ( 1 )
    {
      if ( v14 || v15 != -99 )
        WaitForButtonRelease();                 // v14 = WaitForButtonRelease();
      if ( v14 == 1 )
      {
        v15 = ShowEquipmentMenu(&widget_ptr, 1, 7, v13[widget_ptr.viewport_top]);
        if ( v15 == -1 )
          v15 = -99;
        else
          v15 = val0;
      }
      if ( v15 != -99 )
        break;
      ProcessListNavigation(&widget_ptr, v13, &v14, &v15);
      v5 = &v13[widget_ptr.viewport_top];
      *(v6 + 122) = widget_ptr.viewport_top;
      val0 = *v5;
      v7 = 0;
      if ( v14 == 1 )
        PlaySfx(17);
      do
      {
        SwapGpuCommandBuffers();
        if ( widget_ptr.visible_count )
          Update3dPreview(val0);
        RenderItemList(&widget_ptr, 7);
        ++v7;
        FlushGpuCommands();
      }
      while ( v7 < 2 );
    }
    Flush3dRender();
    result = -1;
    if ( v15 != -1 )
    {
      result = g_InventoryCounts[v15] - 1;
      g_InventoryCounts[v15] = result;
    }
  }
  return result;
}
// 8001BD14: variable 'v2' is possibly undefined
// 8001BDD0: variable 'val0' is possibly undefined
// 8001BE00: variable 'v6' is possibly undefined
// 8001BCA0: using guessed type int var_C38[720];
// 8001BCA0: using guessed type char var_80[120];

//----- (8001BEC0) --------------------------------------------------------
int SaveDataMenu()
{
  int v0; // $s1
  int v1; // $v0
  int v2; // $v0
  int v3; // $s0
  int i; // $s0
  int v6; // [sp+50h] [-10h] BYREF
  int v7; // [sp+54h] [-Ch] BYREF
  int v8; // [sp+58h] [-8h] BYREF

  v0 = 0;
  v8 = -99;
  v7 = 0;
  v6 = -1;
  while ( 1 )
  {
    if ( v6 != -1 || v8 != -99 )
      WaitForButtonRelease();
    if ( !v6 )
    {
      v8 = sub_8001C068();
      if ( v8 )
        goto LABEL_13;
      v1 = -3;
      goto LABEL_12;
    }
    if ( v6 == 1 )
    {
      v8 = sub_8001C700();
      if ( !v8 )
      {
        v1 = -2;
LABEL_12:
        v8 = v1;
      }
    }
LABEL_13:
    if ( v6 != -1 )
    {
      v2 = v8;
      if ( v8 != -1 )
        goto LABEL_17;
      v8 = -99;
    }
    v2 = v8;
LABEL_17:
    if ( v2 != -99 )
      break;
    v0 = sub_80020420(v0, 2, &v6, &v7, &v8);
    v3 = 0;
    do
    {
      ++v3;
      SwapGpuCommandBuffers();
      RenderMenuFrame(1, 3, v0, v7);
      FlushGpuCommands();
    }
    while ( v3 < 2 );
  }
  if ( v8 == -2 )
  {
    for ( i = 0; i < 30; ++i )
      VSync(0);
    CDAudio_SetVolume(g_MenuTrackID, 0, 0);
    byte_800103F0 = 1;
  }
  return v8;
}
// 800103F0: using guessed type char byte_800103F0;
// 8019A62C: using guessed type __int16 g_MenuTrackID;

//----- (8001C068) --------------------------------------------------------
int sub_8001C068()
{
  int v0; // $s0
  char v1; // $s0
  int v2; // $s0
  int v3; // $v0
  int result; // $v0
  int v5[150]; // [sp+28h] [-3E0h] BYREF
  ListWidget v6; // [sp+280h] [-188h] BYREF
  char *v7; // [sp+2A4h] [-164h]
  char *v8; // [sp+2ACh] [-15Ch]
  int *v9; // [sp+2B0h] [-158h]
  char v10[160]; // [sp+2B8h] [-150h] BYREF
  int v11[8]; // [sp+358h] [-B0h] BYREF
  char v12[8]; // [sp+378h] [-90h] BYREF
  int v13[8]; // [sp+380h] [-88h] BYREF
  char v14[88]; // [sp+3A0h] [-68h] BYREF
  int v15; // [sp+3F8h] [-10h] BYREF
  int v16; // [sp+3FCh] [-Ch] BYREF
  int v17; // [sp+400h] [-8h] BYREF

  v16 = 0;
  v17 = -99;
  InitMenuTextCoords(v14);
  RenderStaticMenuBox(4, v14, 2, 56, 87, 206, 66, 2, 0);
  WaitForCdIdle();
  while ( g_bStartKeyState )
  {
    PadStartCom();
    HandleUISequence();
  }
  v0 = 9;
  MemCard_InitSystem();
  do
  {
    MemCard_ScanForSaves(v5, &v15);
    if ( v15 )
      break;
    --v0;
  }
  while ( v0 != -1 );
  v1 = sub_8001C3A0(v5, v10, v11, v12, v13);
  InitListWidget(&v6, 1, 0);
  v6.scroll_offset = 6;
  v6.selected_idx = -125;
  v6.visible_count = v1;
  v7 = v10;
  v8 = v12;
  v9 = v11;
  while ( 1 )
  {
    if ( v16 || v17 != -99 )
      WaitForButtonRelease();
    if ( v16 == 1 )
    {
      v17 = ShowEquipmentMenu(&v6, 6, 8, 0xFFu);
      if ( v17 == -1 )
        v17 = -99;
      else
        v17 = v13[v6.viewport_top];
    }
    if ( v17 != -99 )
      break;
    ProcessListNavigation(&v6, 0, &v16, &v17);
    v2 = 0;
    if ( v16 == 1 )
      PlaySfx(16);
    do
    {
      ++v2;
      SwapGpuCommandBuffers();
      RenderItemList(&v6, 8);
      FlushGpuCommands();
    }
    while ( v2 < 2 );
  }
  if ( v17 != -1 )
  {
    sub_8001E938(v14);
    RenderStaticMenuBox(4, v14, 1, 56, 87, 206, 66, 2, 0);
    v3 = sub_800255E0(v17);
    if ( v3 )
    {
      sub_8001EA60(v14, v3);
      RenderStaticMenuBox(4, v14, 3, 56, 80, 206, 80, 2, 0);
      WaitForButtonRelease();
      while ( !PadRead() )
        ;
      WaitForButtonRelease();
      v17 = -1;
    }
    else
    {
      v17 = 0;
    }
  }
  sub_80025064();
  result = v17;
  if ( !v17 )
  {
    loadTIM();
    return v17;
  }
  return result;
}
// 801779D4: using guessed type __int16 g_bStartKeyState;
// 8001C068: using guessed type _DWORD var_3E0[150];
// 8001C068: using guessed type _DWORD var_B0[8];
// 8001C068: using guessed type int var_88[8];

//----- (8001C3A0) --------------------------------------------------------
int __fastcall sub_8001C3A0(int a1, _BYTE *a2, _DWORD *a3, _BYTE *a4, _DWORD *a5)
{
  int v9; // $s6
  int v10; // $s1
  int v11; // $t1
  int v13; // $t0
  int v14; // $v0
  _BYTE *v15; // $s0
  _BYTE *v16; // $s0
  _BYTE *v17; // $s0
  int v19; // [sp+10h] [-18h] BYREF
  int v20; // [sp+14h] [-14h] BYREF
  int v21; // [sp+18h] [-10h] BYREF
  int v22; // [sp+20h] [-8h]
  int v23; // [sp+24h] [-4h]

  v9 = 0;
  v10 = 0;
  v11 = 3;
  v13 = 255;
  do
  {
    v22 = v13;
    v23 = v11;
    v14 = sub_8002536C(a1, &v19, &v20, &v21);
    v13 = v22;
    v11 = v23;
    if ( !v14 )
    {
      if ( *g_LanguageID[0].header )
      {
        if ( *g_LanguageID[0].header == 1 )
        {
          *a2 = v23;
          v16 = a2 + 1;
          *v16++ = 14;
          *v16++ = 13;
          *v16++ = 13;
          *v16++ = 4;
          *v16++ = 4;
          *v16++ = 18;
          *v16++ = v21 + 32;
          *v16 = v13;
          a2 = v16 + 12;
        }
        else
        {
          *a2 = v23;
          v17 = a2 + 1;
          *v17++ = 0;
          *v17++ = 19;
          *v17++ = 4;
          *v17++ = 13;
          *v17++ = v21 + 32;
          *v17 = v13;
          a2 = v17 + 14;
        }
      }
      else
      {
        *a2 = v23;
        v15 = a2 + 1;
        *v15++ = 0;
        *v15++ = 19;
        *v15++ = 0;
        *v15++ = v21 + 32;
        *v15 = v13;
        a2 = v15 + 15;
      }
      ++v9;
      *a3++ = v19;
      *a4++ = v20;
      *a5++ = v21;
    }
    ++v10;
    a1 += 40;
  }
  while ( v10 < 15 );
  return v9;
}

//----- (8001C58C) --------------------------------------------------------
BOOL __fastcall RenderStaticMenuBox(int a1, int a2, int a3, int a4, int a5, int a6, int a7, __int16 a8, __int16 a9)
{
  int v11; // $s2
  int v12; // $s4
  int v13; // $s0
  UiFrameStyle *v14; // $s1
  BOOL result; // $v0

  v11 = 0;
  v12 = 28 * a1 + 28;
  do
  {
    SwapGpuCommandBuffers();
    v13 = 0;
    if ( a1 < 6 )
    {
      DrawUiFrame(&g_GPU_FrameVisuals, (&dword_80067CCC[616 * *g_LanguageID[0].header] + v12));
      DrawUiText(g_GPU_TextBuffer, (&dword_80067CCC[616 * *g_LanguageID[0].header] + v12));
    }
    v14 = a2;
    if ( a3 > 0 )
    {
      do
      {
        DrawUiText(g_GPU_TextBuffer, v14);
        ++v13;
        ++v14;
      }
      while ( v13 < a3 );
    }
    DrawTexturedQuad(a4, a5, a6, a7, a8, a9);
    ++v11;
    FlushGpuCommands();
    result = v11 < 2;
  }
  while ( v11 < 2 );
  return result;
}
// 80067AB4: using guessed type int g_GPU_TextBuffer[2];
// 80067CCC: using guessed type int dword_80067CCC[7];

//----- (8001C700) --------------------------------------------------------
int sub_8001C700()
{
  int v0; // $s2
  int *v1; // $v0
  int v2; // $a3
  int v3; // $t0
  int v4; // $t1
  int v5; // $a3
  int *v6; // $v0
  int v7; // $a0
  int v8; // $a1
  int v9; // $a2
  int v10; // $a0
  int v11; // $s1
  int v12; // $gp
  int v13; // $s0
  int v14; // $a3
  int v15; // $gp
  __int16 v17[2]; // [sp+18h] [-48h] BYREF
  int v18; // [sp+1Ch] [-44h]
  int v19; // [sp+20h] [-40h]
  int v20; // [sp+24h] [-3Ch]
  int v21; // [sp+28h] [-38h]
  int v22; // [sp+2Ch] [-34h]
  int v23; // [sp+30h] [-30h]
  __int16 v24[2]; // [sp+34h] [-2Ch] BYREF
  int v25; // [sp+38h] [-28h]
  int v26; // [sp+3Ch] [-24h]
  int v27; // [sp+40h] [-20h]
  int v28; // [sp+44h] [-1Ch]
  int v29; // [sp+48h] [-18h]
  int v30; // [sp+4Ch] [-14h]
  int v31; // [sp+50h] [-10h] BYREF
  int v32; // [sp+54h] [-Ch] BYREF
  int v33; // [sp+58h] [-8h] BYREF

  v0 = 0;
  v33 = -99;
  v32 = 0;
  v31 = -1;
  v17[0] = 101;
  v17[1] = 123;
  v1 = &dword_80069DE8[420 * *g_LanguageID[0].header];
  v2 = v1[1];
  v3 = v1[2];
  v4 = v1[3];
  v18 = *v1;
  v19 = v2;
  v20 = v3;
  v21 = v4;
  v5 = v1[5];
  v22 = v1[4];
  v23 = v5;
  v24[0] = 101;
  v24[1] = 149;
  v6 = &dword_80069E00[420 * *g_LanguageID[0].header];
  v7 = v6[1];
  v8 = v6[2];
  v9 = v6[3];
  v25 = *v6;
  v26 = v7;
  v27 = v8;
  v28 = v9;
  v10 = v6[5];
  v29 = v6[4];
  v30 = v10;
  while ( 1 )
  {
    if ( v31 != -1 || v33 != -99 )
      WaitForButtonRelease();
    if ( v31 )
    {
      if ( v31 == 1 )
        v33 = -1;
    }
    else
    {
      v33 = 0;
    }
    if ( v33 != -99 )
      break;
    v0 = sub_80020420(v0, 1, &v31, &v32, &v33);
    v11 = 0;
    do
    {
      ++v11;
      SwapGpuCommandBuffers();
      v13 = *(v12 + 112);
      *(v12 + 112) = 0;
      RenderMenuFrame(1, 3, 1, 1);
      v14 = v32;
      *(v15 + 112) = v13;
      ApplyViewTransforms(v17, v24, v0, v14);
      FlushGpuCommands();
    }
    while ( v11 < 2 );
  }
  return v33;
}
// 8001C8FC: variable 'v12' is possibly undefined
// 8001C918: variable 'v15' is possibly undefined
// 80069DE8: using guessed type int dword_80069DE8[6];
// 80069E00: using guessed type int dword_80069E00[6];

//----- (8001C968) --------------------------------------------------------
int OptionsMenu()
{
  int v0; // $s1
  int v1; // $s3
  int *v2; // $v0
  int v3; // $a1
  int v4; // $a2
  int v5; // $a3
  int v6; // $a1
  int *v7; // $v0
  int v8; // $a0
  int v9; // $a1
  int v10; // $a2
  int v11; // $a0
  int v12; // $s2
  __int16 PadWithFlag; // $v0
  int v14; // $gp
  __int16 v15; // $a0
  bool v16; // dc
  BOOL v17; // $v0
  int v18; // $s0
  int result; // $v0
  unsigned __int8 v20; // [sp+10h] [-40h] BYREF
  char v21; // [sp+11h] [-3Fh]
  char v22; // [sp+12h] [-3Eh]
  char v23; // [sp+13h] [-3Dh]
  char v24; // [sp+14h] [-3Ch]
  char v25; // [sp+15h] [-3Bh]
  __int16 v26[2]; // [sp+18h] [-38h] BYREF
  int v27; // [sp+1Ch] [-34h]
  int v28; // [sp+20h] [-30h]
  int v29; // [sp+24h] [-2Ch]
  int v30; // [sp+28h] [-28h]
  int v31; // [sp+2Ch] [-24h]
  int v32; // [sp+30h] [-20h]
  __int16 v33[2]; // [sp+34h] [-1Ch] BYREF
  int v34; // [sp+38h] [-18h]
  int v35; // [sp+3Ch] [-14h]
  int v36; // [sp+40h] [-10h]
  int v37; // [sp+44h] [-Ch]
  int v38; // [sp+48h] [-8h]
  int v39; // [sp+4Ch] [-4h]

  v0 = 0;
  v1 = -99;
  v26[0] = 180;
  v26[1] = 45;
  v20 = g_Option_Sound;
  v21 = g_Option_Music;
  v2 = &dword_80069DB8[420 * *g_LanguageID[0].header];
  v22 = g_Option_ShowHPMP;
  v23 = g_Option_ShowCompass;
  v24 = g_Option_ShowPreviewItem3D;
  v25 = g_Option_WalkEffect;
  v3 = v2[1];
  v4 = v2[2];
  v5 = v2[3];
  v27 = *v2;
  v28 = v3;
  v29 = v4;
  v30 = v5;
  v6 = v2[5];
  v31 = v2[4];
  v32 = v6;
  v33[0] = 254;
  v33[1] = 45;
  v7 = &dword_80069DD0[420 * *g_LanguageID[0].header];
  v8 = v7[1];
  v9 = v7[2];
  v10 = v7[3];
  v34 = *v7;
  v35 = v8;
  v36 = v9;
  v37 = v10;
  v11 = v7[5];
  v38 = v7[4];
  v39 = v11;
  while ( v1 == -99 )
  {
    v12 = 0;
    WaitForInputStable();
    PadWithFlag = ReadPadWithFlag();
    v15 = PadWithFlag;
    if ( (PadWithFlag & PAD_UP) != 0 )
    {
      *(v14 + 116) = 0;
      PlaySfx(16);
      v16 = v0-- != 0;
      if ( !v16 )
        v0 = 6;
      goto LABEL_20;
    }
    if ( (PadWithFlag & PAD_DOWN) != 0 )
    {
      *(v14 + 116) = 0;
      PlaySfx(16);
      v16 = v0++ != 6;
      if ( !v16 )
        v0 = 0;
      goto LABEL_20;
    }
    v17 = v0 < 6;
    if ( (v15 & PAD_CIRCLE) != 0 || (v17 = v0 < 6, (v15 & 0x2000) != 0) || (v17 = v0 < 6, (v15 & 0x8000) != 0) )// right - left?
    {
      if ( v17 )
      {
        PlaySfx(17);
        v12 = 1;
        *(&v20 + v0) = *(&v20 + v0) == 0;
LABEL_20:
        v18 = 0;
        goto LABEL_21;
      }
      v18 = 0;
      if ( (v15 & PAD_CIRCLE) != 0 )
      {
        PlaySfx(17);
        v1 = -1;
        v12 = 1;
        goto LABEL_20;
      }
    }
    else if ( (v15 & PAD_TRIANGLE) != 0 || (v18 = 0, (v15 & PAD_START) != 0) )
    {
      PlaySfx(18);
      v1 = -1;
      goto LABEL_20;
    }
    do
    {
LABEL_21:
      ++v18;
      SwapGpuCommandBuffers();
      RenderMenuFrame(2, 7, v0, v12);           // v7 = &g_UiStyleTable[616 * g_CurrentZoneOrMode + 77 * a1];
      RenderOptionsList(v26, v33, &v20);        //   ?? while ( v6 < 6 );    7  (7    0 - 6 )   
      FlushGpuCommands();
    }
    while ( v18 < 2 );
  }
  WaitForButtonRelease();
  result = v20;
  g_Option_Sound = v20;
  g_Option_Music = v21;
  g_Option_ShowHPMP = v22;
  g_Option_ShowCompass = v23;
  g_Option_ShowPreviewItem3D = v24;
  g_Option_WalkEffect = v25;
  return result;
}
// 8001CB44: variable 'v14' is possibly undefined
// 80069DB8: using guessed type int dword_80069DB8[6];
// 80069DD0: using guessed type int dword_80069DD0[6];
// 8019B58B: using guessed type char g_Option_Sound;
// 8019B58C: using guessed type char g_Option_Music;
// 8019B58D: using guessed type char g_Option_ShowHPMP;
// 8019B58E: using guessed type char g_Option_ShowCompass;
// 8019B58F: using guessed type char g_Option_ShowPreviewItem3D;
// 8019B590: using guessed type char g_Option_WalkEffect;

//----- (8001CD28) --------------------------------------------------------
int ShowLoadOrNewGameMenu()
{
  int cursor; // $s1
  int v1; // $s5
  int v2; // $s2
  int v3; // $s3
  int v4; // $s0
  int v5; // $v0
  int v6; // $s0
  BOOL v7; // $a0
  __int16 PadWithFlag; // $v0
  int v10; // $gp
  int v11; // $s0
  char g_MemCardFileBuffer[600]; // [sp+28h] [-2D0h] BYREF
  char v13[112]; // [sp+280h] [-78h] BYREF
  int g_KF_SaveCount; // [sp+2F0h] [-8h] BYREF

  cursor = 0;
  v1 = 0;
  v2 = -99;
  v3 = -1;
  SetupMenuUIBuffers();
  InitMenuTextCoords(v13);
  RenderStaticMenuBox(9, v13, 2, 56, 87, 206, 66, 2, 0);
  v4 = 9;
  MemCard_InitSystem();
  while ( 1 )
  {
    v5 = MemCard_CheckSlot();
    --v4;
    if ( !v5 )
      break;
    if ( v4 == -1 )
    {
      if ( v5 != 2 )
      {
        LoadMemCardErrorLabels(v13);
        RenderStaticMenuBox(9, v13, 2, 56, 87, 206, 66, 2, 0);
        WaitForButtonRelease();
        while ( !PadRead() )
          ;
        goto LABEL_14;
      }
      break;
    }
  }
  v6 = 9;
  while ( 1 )
  {
    v7 = MemCard_ScanForSaves(g_MemCardFileBuffer, &g_KF_SaveCount);
    if ( g_KF_SaveCount )
      break;
    if ( --v6 == -1 )
    {
      if ( v7 )
      {
        InitNoSaveFoundLabels(v13);
        RenderStaticMenuBox(9, v13, 3, 56, 80, 206, 80, 2, 0);
        WaitForButtonRelease();
        while ( !PadRead() )
          ;
LABEL_14:
        WaitForButtonRelease();
      }
      sub_80025064();
      Menu_SelectLanguage();
      Music_UpdateState(0);
      return -1;
    }
  }
  PlaySfx(SFX_MENU_MOVE);
  WaitForButtonRelease();
  while ( 1 )
  {
    if ( v3 != -1 )
      WaitForButtonRelease();
    if ( v3 )
    {
      if ( v3 == 1 )
      {
        v2 = sub_8001D214();
        if ( v2 == -1 )
        {
          v2 = -99;
          v3 = -1;
        }
      }
    }
    else
    {
      v2 = -1;
      Menu_SelectLanguage();
    }
    if ( v2 != -99 )
      break;
    WaitForInputStable();
    PadWithFlag = ReadPadWithFlag();
    if ( (PadWithFlag & PAD_UP) != 0 || (PadWithFlag & PAD_DOWN) != 0 )
    {
      *(v10 + 116) = 0;
      PlaySfx(SFX_MENU_MOVE);
      cursor = cursor == 0;
LABEL_31:
      v11 = 0;
      goto LABEL_32;
    }
    v11 = 0;
    if ( (PadWithFlag & PAD_CIRCLE) != 0 )
    {
      PlaySfx(SFX_MENU_SELECT);
      v1 = 1;
      v3 = cursor;
      goto LABEL_31;
    }
    do
    {
LABEL_32:
      ++v11;
      SwapGpuCommandBuffers();
      RenderMenuFrame(6, 2, cursor, v1);
      FlushGpuCommands();
    }
    while ( v11 < 2 );
  }
  sub_80025064();
  Music_UpdateState(0);
  return v2;
}
// 8001CF94: variable 'v10' is possibly undefined
// 8001CD28: using guessed type char g_MemCardFileBuffer[600];

//----- (8001D050) --------------------------------------------------------
void Menu_SelectLanguage()
{
  int cursorIndex; // $s1
  int isSelectionConfirmed; // $s4
  int exitRequest; // $s2
  int selectedLanguage; // $s3
  __int16 padInputKey; // $v0
  int g_MenuState; // $gp
  bool v6; // dc
  int vsyncCounter; // $s0

  cursorIndex = 0;
  isSelectionConfirmed = 0;
  exitRequest = -99;
  selectedLanguage = -1;
  while ( 1 )
  {
    if ( selectedLanguage != -1 || exitRequest != -99 )
      WaitForButtonRelease();
    if ( selectedLanguage != -1 )
      break;
    if ( exitRequest != -99 )
      exitRequest = -99;
    WaitForInputStable();
    padInputKey = ReadPadWithFlag();
    if ( (padInputKey & PAD_UP) != 0 )
    {
      *(g_MenuState + 0x74) = 0;
      PlaySfx(SFX_MENU_MOVE);
      v6 = cursorIndex-- != 0;
      if ( !v6 )
        cursorIndex = 2;
      goto LABEL_20;
    }
    if ( (padInputKey & PAD_DOWN) != 0 )
    {
      *(g_MenuState + 0x74) = 0;
      PlaySfx(SFX_MENU_MOVE);
      v6 = cursorIndex++ != 2;
      if ( !v6 )
        cursorIndex = 0;
      goto LABEL_20;
    }
    if ( (padInputKey & PAD_CIRCLE) != 0 )
    {
      PlaySfx(SFX_MENU_SELECT);
      selectedLanguage = cursorIndex;
      isSelectionConfirmed = 1;
LABEL_20:
      vsyncCounter = 0;
      goto LABEL_21;
    }
    if ( (padInputKey & PAD_TRIANGLE) != 0 || (vsyncCounter = 0, (padInputKey & PAD_START) != 0) )
    {
      PlaySfx(SFX_MENU_CANCEL);
      exitRequest = -1;
      goto LABEL_20;
    }
    do
    {
LABEL_21:
      ++vsyncCounter;
      SwapGpuCommandBuffers();
      // 7 - ? , 3 - - 
      RenderMenuFrame(7, 3, cursorIndex, isSelectionConfirmed);
      FlushGpuCommands();
    }
    while ( vsyncCounter < 2 );
  }
  *g_LanguageID[0].header = selectedLanguage;
}
// 8001D0F0: variable 'g_MenuState' is possibly undefined

//----- (8001D214) --------------------------------------------------------
int sub_8001D214()
{
  char v0; // $s0
  int v1; // $s0
  int v2; // $v0
  int v4[150]; // [sp+28h] [-3E0h] BYREF
  ListWidget v5; // [sp+280h] [-188h] BYREF
  char *v6; // [sp+2A4h] [-164h]
  char *v7; // [sp+2ACh] [-15Ch]
  int *v8; // [sp+2B0h] [-158h]
  char v9[160]; // [sp+2B8h] [-150h] BYREF
  int v10[8]; // [sp+358h] [-B0h] BYREF
  char v11[8]; // [sp+378h] [-90h] BYREF
  int v12[8]; // [sp+380h] [-88h] BYREF
  char v13[88]; // [sp+3A0h] [-68h] BYREF
  int v14; // [sp+3F8h] [-10h] BYREF
  int v15; // [sp+3FCh] [-Ch] BYREF
  int v16; // [sp+400h] [-8h] BYREF

  v15 = 0;
  v16 = -99;
  MemCard_ScanForSaves(v4, &v14);
  v0 = sub_8001C3A0(v4, v9, v10, v11, v12);
  InitListWidget(&v5, 1, 0);
  v5.scroll_offset = 6;
  v5.selected_idx = -125;
  v5.visible_count = v0;
  v6 = v9;
  v7 = v11;
  v8 = v10;
  while ( 1 )
  {
    if ( v15 || v16 != -99 )
      WaitForButtonRelease();
    if ( v15 == 1 )
    {
      v16 = ShowEquipmentMenu(&v5, 6, 8, 0xFFu);
      if ( v16 == -1 )
        v16 = -99;
      else
        v16 = v12[v5.viewport_top];
    }
    if ( v16 != -99 )
      break;
    ProcessListNavigation(&v5, 0, &v15, &v16);
    v1 = 0;
    if ( v15 == 1 )
      PlaySfx(16);
    do
    {
      ++v1;
      SwapGpuCommandBuffers();
      RenderItemList(&v5, 8);
      FlushGpuCommands();
    }
    while ( v1 < 2 );
  }
  if ( v16 != -1 )
  {
    sub_8001E938(v13);
    RenderStaticMenuBox(9, v13, 1, 56, 87, 206, 66, 2, 0);
    v2 = sub_800255E0(v16);
    if ( v2 )
    {
      sub_8001EA60(v13, v2);
      RenderStaticMenuBox(9, v13, 3, 56, 80, 206, 80, 2, 0);
      WaitForButtonRelease();
      while ( !PadRead() )
        ;
      WaitForButtonRelease();
    }
  }
  return v16;
}
// 8001D214: using guessed type _DWORD var_3E0[150];
// 8001D214: using guessed type _DWORD var_B0[8];
// 8001D214: using guessed type int var_88[8];

//----- (8001D474) --------------------------------------------------------
int *__fastcall LoadMemCardErrorLabels(int a1)
{
  int *v1; // $v0
  int v2; // $t0
  int v3; // $t1
  int v4; // $t2
  int v5; // $t0
  int v6; // $a0
  int *result; // $v0
  int v8; // $a1
  int v9; // $a2
  int v10; // $a3
  int v11; // $a1

  *a1 = 74;
  *(a1 + 2) = 105;
  v1 = &dword_80069C50[420 * *g_LanguageID[0].header];
  v2 = v1[1];
  v3 = v1[2];
  v4 = v1[3];
  *(a1 + 4) = *v1;
  *(a1 + 8) = v2;
  *(a1 + 12) = v3;
  *(a1 + 16) = v4;
  v5 = v1[5];
  *(a1 + 20) = v1[4];
  *(a1 + 24) = v5;
  v6 = a1 + 28;
  *v6 = 74;
  *(v6 + 2) = 120;
  result = &dword_80069C68[420 * *g_LanguageID[0].header];
  v8 = result[1];
  v9 = result[2];
  v10 = result[3];
  *(v6 + 4) = *result;
  *(v6 + 8) = v8;
  *(v6 + 12) = v9;
  *(v6 + 16) = v10;
  v11 = result[5];
  *(v6 + 20) = result[4];
  *(v6 + 24) = v11;
  return result;
}
// 80069C50: using guessed type int dword_80069C50[6];
// 80069C68: using guessed type int dword_80069C68[6];

//----- (8001D5A8) --------------------------------------------------------
int *__fastcall InitNoSaveFoundLabels(int a1)
{
  int *v1; // $v0
  int v2; // $t0
  int v3; // $t1
  int v4; // $t2
  int v5; // $t0
  int v6; // $a0
  int *v7; // $v0
  int v8; // $t0
  int v9; // $t1
  int v10; // $t2
  int v11; // $t0
  int *result; // $v0
  int v13; // $a1
  int v14; // $a2
  int v15; // $a3
  int v16; // $a1

  *a1 = 74;
  *(a1 + 2) = 98;
  v1 = &dword_80069BD8[420 * *g_LanguageID[0].header];
  v2 = v1[1];
  v3 = v1[2];
  v4 = v1[3];
  *(a1 + 4) = *v1;
  *(a1 + 8) = v2;
  *(a1 + 12) = v3;
  *(a1 + 16) = v4;
  v5 = v1[5];
  *(a1 + 20) = v1[4];
  *(a1 + 24) = v5;
  v6 = a1 + 28;
  *v6 = 74;
  *(v6 + 2) = 113;
  v7 = &dword_80069B78[420 * *g_LanguageID[0].header];
  v8 = v7[1];
  v9 = v7[2];
  v10 = v7[3];
  *(v6 + 4) = *v7;
  *(v6 + 8) = v8;
  *(v6 + 12) = v9;
  *(v6 + 16) = v10;
  v11 = v7[5];
  *(v6 + 20) = v7[4];
  *(v6 + 24) = v11;
  v6 += 28;
  *v6 = 74;
  *(v6 + 2) = 128;
  result = &dword_80069B90[420 * *g_LanguageID[0].header];
  v13 = result[1];
  v14 = result[2];
  v15 = result[3];
  *(v6 + 4) = *result;
  *(v6 + 8) = v13;
  *(v6 + 12) = v14;
  *(v6 + 16) = v15;
  v16 = result[5];
  *(v6 + 20) = result[4];
  *(v6 + 24) = v16;
  return result;
}
// 80069B78: using guessed type int dword_80069B78[6];
// 80069B90: using guessed type int dword_80069B90[6];
// 80069BD8: using guessed type int dword_80069BD8[6];

//----- (8001D770) --------------------------------------------------------
int sub_8001D770()
{
  int v0; // $s0
  int v1; // $s0
  int v2; // $v0
  int v3; // $t0
  char *v4; // $t1
  char v5; // $s0
  char *v6; // $a3
  int v7; // $v0
  int v8; // $t2
  int v9; // $t3
  int v10; // $t4
  int *v11; // $t0
  int v12; // $s0
  int v14[150]; // [sp+20h] [-3C0h] BYREF
  ListWidget v15; // [sp+278h] [-168h] BYREF
  char *v16; // [sp+29Ch] [-144h]
  char *v17; // [sp+2A4h] [-13Ch]
  int *v18; // [sp+2A8h] [-138h]
  char v19[160]; // [sp+2B0h] [-130h] BYREF
  int v20[8]; // [sp+350h] [-90h] BYREF
  char v21[8]; // [sp+370h] [-70h] BYREF
  int v22[8]; // [sp+378h] [-68h] BYREF
  char v23[56]; // [sp+398h] [-48h] BYREF
  int v24; // [sp+3D0h] [-10h] BYREF
  int v25; // [sp+3D4h] [-Ch] BYREF
  int viewport_top; // [sp+3D8h] [-8h] BYREF

  v25 = 0;
  viewport_top = -99;
  SetupMenuUIBuffers();
  InitMenuTextCoords(v23);
  sub_8001EDE0(v23, 2, 56, 87, 206, 66, 2, 0);
  v0 = 9;
  WaitForCdIdle();
  MemCard_InitSystem();
  do
    --v0;
  while ( MemCard_CheckSlot() && v0 != -1 );
  v1 = 4;
  do
  {
    if ( !MemCard_ScanForSaves(v14, &v24) )
      break;
    --v1;
    if ( v24 )
      break;
  }
  while ( v1 != -1 );
  v2 = sub_8001C3A0(v14, v19, v20, v21, v22);
  v3 = v2;
  v4 = &v21[v2];
  v5 = v2 + 1;
  v6 = &v19[20 * v2];
  v7 = 1680 * *g_LanguageID[0].header;
  v8 = *&byte_80069DA4[v7];
  v9 = *&byte_80069DA8[v7];
  v10 = *&byte_80069DAC[v7];
  *v6 = *&byte_80069DA0[v7];
  *(v6 + 1) = v8;
  *(v6 + 2) = v9;
  *(v6 + 3) = v10;
  LOBYTE(v8) = byte_80069DB1[v7];
  v6[16] = byte_80069DB0[v7];
  v6[17] = v8;
  v11 = &v14[v3];
  v11[204] = -1;
  *v4 = -1;
  v11[214] = 255;
  InitListWidget(&v15, 1, 3);
  v15.scroll_offset = 6;
  v15.selected_idx = -125;
  v15.visible_count = v5;
  v16 = v19;
  v17 = v21;
  v18 = v20;
  PlaySfx(16);
  WaitForButtonRelease();
  while ( 1 )
  {
    if ( v25 || viewport_top != -99 )
      WaitForButtonRelease();
    if ( v25 == 1 )
    {
      viewport_top = ShowEquipmentMenu(&v15, 7, 9, 0xFFu);
      if ( viewport_top == -1 )
        viewport_top = -99;
      else
        viewport_top = v15.viewport_top;
    }
    if ( viewport_top != -99 )
      break;
    ProcessListNavigation(&v15, 0, &v25, &viewport_top);
    v12 = 0;
    if ( v25 == 1 )
      PlaySfx(16);
    do
    {
      ++v12;
      SwapGpuCommandBuffers();
      RenderItemList(&v15, 9);
      FlushGpuCommands();
    }
    while ( v12 < 2 );
  }
  if ( viewport_top != -1 )
    sub_8001DAF0(v22[viewport_top]);
  sub_80025064();
  return Music_UpdateState(0);
}
// 8001D770: using guessed type _DWORD var_3C0[150];
// 8001D770: using guessed type _BYTE var_130[160];
// 8001D770: using guessed type _DWORD var_90[8];
// 8001D770: using guessed type _BYTE var_70[8];
// 8001D770: using guessed type int var_68[8];

//----- (8001DAF0) --------------------------------------------------------
int __fastcall sub_8001DAF0(int a1)
{
  int v2; // $s0
  int v3; // $v0
  int v4; // $v1
  int result; // $v0
  char v6[112]; // [sp+20h] [-70h] BYREF

  v2 = 9;
  while ( 1 )
  {
    v3 = MemCard_CheckSlot();
    --v2;
    if ( !v3 )
      break;
    if ( v2 == -1 )
    {
      if ( v3 != 2 )
      {
        sub_8001E2B8(v6);
        sub_8001EDE0(v6, 3, 56, 80, 206, 80, 2, 0);
        WaitForButtonRelease();
        while ( !PadRead() )
          ;
        return WaitForButtonRelease();
      }
      if ( sub_8001DCD0(1) )
      {
        sub_8001E480(v6);
        sub_8001EDE0(v6, 3, 56, 80, 206, 80, 2, 0);
        WaitForButtonRelease();
        while ( !PadRead() )
          ;
        return WaitForButtonRelease();
      }
      sub_800255B0();                           // <-----
      break;
    }
  }
  sub_8001E810(v6);
  sub_8001EDE0(v6, 1, 56, 87, 206, 66, 2, 0);
  v4 = sub_80025700(a1);
  result = 1;
  if ( !v4 )
    return result;
  if ( v4 == 1 )
    sub_8001E2B8(v6);
  else
    sub_8001E648(v6);
  sub_8001EDE0(v6, 3, 56, 80, 206, 80, 2, 0);
  WaitForButtonRelease();
  while ( !PadRead() )
    ;
  return WaitForButtonRelease();
}

//----- (8001DCD0) --------------------------------------------------------
int __fastcall sub_8001DCD0(int a1)
{
  int v2; // $v0
  __int16 v3; // $a1
  __int16 v4; // $v1
  int *v5; // $v0
  int v6; // $a1
  int v7; // $a2
  int v8; // $a3
  int v9; // $a1
  int v10; // $v0
  int v11; // $s2
  int *v12; // $v0
  int v13; // $a0
  int v14; // $a1
  int v15; // $a2
  int v16; // $a0
  int *v17; // $v0
  int v18; // $a0
  int v19; // $a2
  int v20; // $a3
  int v21; // $a0
  int *v22; // $v0
  int v23; // $a0
  int v24; // $a1
  int v25; // $a2
  int v26; // $a0
  int i; // $s0
  __int16 v29[2]; // [sp+18h] [-D8h] BYREF
  int v30; // [sp+1Ch] [-D4h]
  int v31; // [sp+20h] [-D0h]
  int v32; // [sp+24h] [-CCh]
  int v33; // [sp+28h] [-C8h]
  int v34; // [sp+2Ch] [-C4h]
  int v35; // [sp+30h] [-C0h]
  __int16 v36[2]; // [sp+34h] [-BCh] BYREF
  int v37; // [sp+38h] [-B8h]
  int v38; // [sp+3Ch] [-B4h]
  int v39; // [sp+40h] [-B0h]
  int v40; // [sp+44h] [-ACh]
  int v41; // [sp+48h] [-A8h]
  int v42; // [sp+4Ch] [-A4h]
  UiFrameStyle v43; // [sp+50h] [-A0h] BYREF
  UiFrameStyle v44; // [sp+6Ch] [-84h] BYREF
  int v45; // [sp+E0h] [-10h] BYREF
  int v46; // [sp+E4h] [-Ch] BYREF
  int v47; // [sp+E8h] [-8h] BYREF

  v46 = 0;
  v2 = 1232 * *g_LanguageID[0].header;
  v3 = *&g_ZoneCameraTable[v2 * 2];
  v47 = -99;
  v29[0] = v3;
  v4 = word_80067CEA[v2];
  v45 = -1;
  v29[1] = v4;
  v5 = &g_ZoneLightTable_Main[420 * *g_LanguageID[0].header];
  v6 = v5[1];
  v7 = v5[2];
  v8 = v5[3];
  v30 = *v5;
  v31 = v6;
  v32 = v7;
  v33 = v8;
  v9 = v5[5];
  v34 = v5[4];
  v35 = v9;
  v10 = 1232 * *g_LanguageID[0].header;
  v11 = 1;
  v36[0] = *&byte_80067D04[v10 * 2];
  v36[1] = word_80067D06[v10];
  v12 = &g_ZoneLightTable_Ambient[420 * *g_LanguageID[0].header];
  v13 = v12[1];
  v14 = v12[2];
  v15 = v12[3];
  v37 = *v12;
  v38 = v13;
  v39 = v14;
  v40 = v15;
  v16 = v12[5];
  v41 = v12[4];
  v42 = v16;
  if ( a1 == 1 )
  {
    v43.posX = 74;
    v43.posY = 109;
    v17 = &dword_80069B18[420 * *g_LanguageID[0].header];
    v18 = v17[1];
    v19 = v17[2];
    v20 = v17[3];
    *&v43.width = *v17;
    *&v43.colorBase = v18;
    *&v43.refX = v19;
    *v43.extra = v20;
    v21 = v17[5];
    *&v43.extra[4] = v17[4];
    *&v43.extra[8] = v21;
    v44.posX = 74;
    v44.posY = 124;
    v22 = &dword_80069B30[420 * *g_LanguageID[0].header];
    v23 = v22[1];
    v24 = v22[2];
    v25 = v22[3];
    *&v44.width = *v22;
    *&v44.colorBase = v23;
    *&v44.refX = v24;
    *v44.extra = v25;
    v26 = v22[5];
    *&v44.extra[4] = v22[4];
    *&v44.extra[8] = v26;
  }
  while ( 1 )
  {
    if ( v45 != -1 || v47 != -99 )
      WaitForButtonRelease();
    if ( v45 )
    {
      if ( v45 == 1 )
        v47 = -1;
    }
    else
    {
      v47 = 0;
    }
    if ( v47 != -99 )
      break;
    v11 = sub_80020420(v11, 1, &v45, &v46, &v47);
    for ( i = 0; i < 2; ++i )
    {
      SwapGpuCommandBuffers();
      ApplyViewTransforms(v29, v36, v11, v46);
      DrawUiFrame(&g_GPU_FrameVisuals, &dword_80067CCC[616 * *g_LanguageID[0].header + 28]);
      DrawUiText(g_GPU_TextBuffer, &dword_80067CCC[616 * *g_LanguageID[0].header + 28]);
      if ( a1 == 1 )
      {
        DrawUiText(g_GPU_TextBuffer, &v43);
        DrawUiText(g_GPU_TextBuffer, &v44);
        DrawTexturedQuad(56, 91, 206, 66, 2, 0);
      }
      FlushGpuCommands();
    }
  }
  return v47;
}
// 80067AB4: using guessed type int g_GPU_TextBuffer[2];
// 80067CCC: using guessed type int dword_80067CCC[7];
// 80067CEA: using guessed type __int16 word_80067CEA[];
// 80067D06: using guessed type __int16 word_80067D06[];
// 80069B18: using guessed type int dword_80069B18[6];
// 80069B30: using guessed type int dword_80069B30[6];
// 80069D70: using guessed type int g_ZoneLightTable_Main[6];
// 80069D88: using guessed type int g_ZoneLightTable_Ambient[6];

//----- (8001E184) --------------------------------------------------------
int *__fastcall InitMenuTextCoords(int pBuffer)
{
  int *v1; // $v0
  int v2; // $t0
  int v3; // $t1
  int v4; // $t2
  int v5; // $t0
  int v6; // $a0
  int *result; // $v0
  int v8; // $a1
  int v9; // $a2
  int v10; // $a3
  int v11; // $a1

  *pBuffer = 74;
  *(pBuffer + 2) = 105;
  v1 = &g_MenuLabelTable[420 * *g_LanguageID[0].header];
  v2 = v1[1];
  v3 = v1[2];
  v4 = v1[3];
  *(pBuffer + 4) = *v1;
  *(pBuffer + 8) = v2;
  *(pBuffer + 12) = v3;
  *(pBuffer + 16) = v4;
  v5 = v1[5];
  *(pBuffer + 20) = v1[4];
  *(pBuffer + 24) = v5;
  v6 = pBuffer + 28;
  *v6 = 74;
  *(v6 + 2) = 120;
  result = &dword_80069AD0[420 * *g_LanguageID[0].header];
  v8 = result[1];
  v9 = result[2];
  v10 = result[3];
  *(v6 + 4) = *result;
  *(v6 + 8) = v8;
  *(v6 + 12) = v9;
  *(v6 + 16) = v10;
  v11 = result[5];
  *(v6 + 20) = result[4];
  *(v6 + 24) = v11;
  return result;
}
// 80069AB8: using guessed type int g_MenuLabelTable[6];
// 80069AD0: using guessed type int dword_80069AD0[6];

//----- (8001E2B8) --------------------------------------------------------
int *__fastcall sub_8001E2B8(int a1)
{
  int *v1; // $v0
  int v2; // $t0
  int v3; // $t1
  int v4; // $t2
  int v5; // $t0
  int v6; // $a0
  int *v7; // $v0
  int v8; // $t0
  int v9; // $t1
  int v10; // $t2
  int v11; // $t0
  int *result; // $v0
  int v13; // $a1
  int v14; // $a2
  int v15; // $a3
  int v16; // $a1

  *a1 = 74;
  *(a1 + 2) = 98;
  v1 = &dword_80069AE8[420 * *g_LanguageID[0].header];
  v2 = v1[1];
  v3 = v1[2];
  v4 = v1[3];
  *(a1 + 4) = *v1;
  *(a1 + 8) = v2;
  *(a1 + 12) = v3;
  *(a1 + 16) = v4;
  v5 = v1[5];
  *(a1 + 20) = v1[4];
  *(a1 + 24) = v5;
  v6 = a1 + 28;
  *v6 = 74;
  *(v6 + 2) = 113;
  v7 = &dword_80069B00[420 * *g_LanguageID[0].header];
  v8 = v7[1];
  v9 = v7[2];
  v10 = v7[3];
  *(v6 + 4) = *v7;
  *(v6 + 8) = v8;
  *(v6 + 12) = v9;
  *(v6 + 16) = v10;
  v11 = v7[5];
  *(v6 + 20) = v7[4];
  *(v6 + 24) = v11;
  v6 += 28;
  *v6 = 74;
  *(v6 + 2) = 128;
  result = &dword_80069968[420 * *g_LanguageID[0].header];
  v13 = result[1];
  v14 = result[2];
  v15 = result[3];
  *(v6 + 4) = *result;
  *(v6 + 8) = v13;
  *(v6 + 12) = v14;
  *(v6 + 16) = v15;
  v16 = result[5];
  *(v6 + 20) = result[4];
  *(v6 + 24) = v16;
  return result;
}
// 80069968: using guessed type int dword_80069968[6];
// 80069AE8: using guessed type int dword_80069AE8[6];
// 80069B00: using guessed type int dword_80069B00[6];

//----- (8001E480) --------------------------------------------------------
int *__fastcall sub_8001E480(int a1)
{
  int *v1; // $v0
  int v2; // $t0
  int v3; // $t1
  int v4; // $t2
  int v5; // $t0
  int v6; // $a0
  int *v7; // $v0
  int v8; // $t0
  int v9; // $t1
  int v10; // $t2
  int v11; // $t0
  int *result; // $v0
  int v13; // $a1
  int v14; // $a2
  int v15; // $a3
  int v16; // $a1

  *a1 = 74;
  *(a1 + 2) = 98;
  v1 = &dword_80069B48[420 * *g_LanguageID[0].header];
  v2 = v1[1];
  v3 = v1[2];
  v4 = v1[3];
  *(a1 + 4) = *v1;
  *(a1 + 8) = v2;
  *(a1 + 12) = v3;
  *(a1 + 16) = v4;
  v5 = v1[5];
  *(a1 + 20) = v1[4];
  *(a1 + 24) = v5;
  v6 = a1 + 28;
  *v6 = 74;
  *(v6 + 2) = 113;
  v7 = &dword_80069B60[420 * *g_LanguageID[0].header];
  v8 = v7[1];
  v9 = v7[2];
  v10 = v7[3];
  *(v6 + 4) = *v7;
  *(v6 + 8) = v8;
  *(v6 + 12) = v9;
  *(v6 + 16) = v10;
  v11 = v7[5];
  *(v6 + 20) = v7[4];
  *(v6 + 24) = v11;
  v6 += 28;
  *v6 = 74;
  *(v6 + 2) = 128;
  result = &dword_80069C08[420 * *g_LanguageID[0].header];
  v13 = result[1];
  v14 = result[2];
  v15 = result[3];
  *(v6 + 4) = *result;
  *(v6 + 8) = v13;
  *(v6 + 12) = v14;
  *(v6 + 16) = v15;
  v16 = result[5];
  *(v6 + 20) = result[4];
  *(v6 + 24) = v16;
  return result;
}
// 80069B48: using guessed type int dword_80069B48[6];
// 80069B60: using guessed type int dword_80069B60[6];
// 80069C08: using guessed type int dword_80069C08[6];

//----- (8001E648) --------------------------------------------------------
int *__fastcall sub_8001E648(int a1)
{
  int *v1; // $v0
  int v2; // $t0
  int v3; // $t1
  int v4; // $t2
  int v5; // $t0
  int v6; // $a0
  int *v7; // $v0
  int v8; // $t0
  int v9; // $t1
  int v10; // $t2
  int v11; // $t0
  int *result; // $v0
  int v13; // $a1
  int v14; // $a2
  int v15; // $a3
  int v16; // $a1

  *a1 = 74;
  *(a1 + 2) = 98;
  v1 = &dword_80069C80[420 * *g_LanguageID[0].header];
  v2 = v1[1];
  v3 = v1[2];
  v4 = v1[3];
  *(a1 + 4) = *v1;
  *(a1 + 8) = v2;
  *(a1 + 12) = v3;
  *(a1 + 16) = v4;
  v5 = v1[5];
  *(a1 + 20) = v1[4];
  *(a1 + 24) = v5;
  v6 = a1 + 28;
  *v6 = 74;
  *(v6 + 2) = 113;
  v7 = &dword_80069C98[420 * *g_LanguageID[0].header];
  v8 = v7[1];
  v9 = v7[2];
  v10 = v7[3];
  *(v6 + 4) = *v7;
  *(v6 + 8) = v8;
  *(v6 + 12) = v9;
  *(v6 + 16) = v10;
  v11 = v7[5];
  *(v6 + 20) = v7[4];
  *(v6 + 24) = v11;
  v6 += 28;
  *v6 = 74;
  *(v6 + 2) = 128;
  result = &dword_80069CB0[420 * *g_LanguageID[0].header];
  v13 = result[1];
  v14 = result[2];
  v15 = result[3];
  *(v6 + 4) = *result;
  *(v6 + 8) = v13;
  *(v6 + 12) = v14;
  *(v6 + 16) = v15;
  v16 = result[5];
  *(v6 + 20) = result[4];
  *(v6 + 24) = v16;
  return result;
}
// 80069C80: using guessed type int dword_80069C80[6];
// 80069C98: using guessed type int dword_80069C98[6];
// 80069CB0: using guessed type int dword_80069CB0[6];

//----- (8001E810) --------------------------------------------------------
int __fastcall sub_8001E810(int a1)
{
  int result; // $v0
  int v2; // $a1
  int v3; // $a2
  int v4; // $a3
  int v5; // $a1

  *a1 = 74;
  *(a1 + 2) = 112;
  result = 1680 * *g_LanguageID[0].header;
  v2 = *&byte_80069BC4[result];
  v3 = *&byte_80069BC8[result];
  v4 = *&byte_80069BCC[result];
  *(a1 + 4) = *&byte_80069BC0[result];
  *(a1 + 8) = v2;
  *(a1 + 12) = v3;
  *(a1 + 16) = v4;
  v5 = *&byte_80069BD4[result];
  *(a1 + 20) = *&byte_80069BD0[result];
  *(a1 + 24) = v5;
  return result;
}

//----- (8001E938) --------------------------------------------------------
int __fastcall sub_8001E938(int a1)
{
  int result; // $v0
  int v2; // $a1
  int v3; // $a2
  int v4; // $a3
  int v5; // $a1

  *a1 = 74;
  *(a1 + 2) = 112;
  result = 1680 * *g_LanguageID[0].header;
  v2 = *&byte_80069BF4[result];
  v3 = *&byte_80069BF8[result];
  v4 = *&byte_80069BFC[result];
  *(a1 + 4) = *&byte_80069BF0[result];
  *(a1 + 8) = v2;
  *(a1 + 12) = v3;
  *(a1 + 16) = v4;
  v5 = *&byte_80069C04[result];
  *(a1 + 20) = *&byte_80069C00[result];
  *(a1 + 24) = v5;
  return result;
}

//----- (8001EA60) --------------------------------------------------------
int *__fastcall sub_8001EA60(int a1, int a2)
{
  int v3; // $v0
  int v4; // $a0
  int v5; // $a1
  int v6; // $a2
  int v7; // $v1
  int v8; // $a0
  int v9; // $t2
  int v10; // $a0
  int v11; // $a1
  int v12; // $a2
  int *v13; // $v0
  int v14; // $a3
  int v15; // $t0
  int v16; // $t1
  int v17; // $a3
  int *result; // $v0
  int v19; // $a0
  int v20; // $a1
  int v21; // $a2
  int v22; // $a0

  *a1 = 74;
  *(a1 + 2) = 98;
  v3 = 1680 * *g_LanguageID[0].header;
  if ( a2 == 1 )
  {
    v4 = *&byte_80069BAC[1680 * *g_LanguageID[0].header];
    v5 = *&byte_80069BB0[1680 * *g_LanguageID[0].header];
    v6 = *&byte_80069BB4[1680 * *g_LanguageID[0].header];
    *(a1 + 4) = *&byte_80069BA8[1680 * *g_LanguageID[0].header];
    *(a1 + 8) = v4;
    *(a1 + 12) = v5;
    *(a1 + 16) = v6;
    v7 = *&byte_80069BB8[v3];
    v8 = *&byte_80069BBC[v3];
  }
  else
  {
    v10 = *&byte_80069C3C[1680 * *g_LanguageID[0].header];
    v11 = *&byte_80069C40[1680 * *g_LanguageID[0].header];
    v12 = *&byte_80069C44[1680 * *g_LanguageID[0].header];
    *(a1 + 4) = *&byte_80069C38[1680 * *g_LanguageID[0].header];
    *(a1 + 8) = v10;
    *(a1 + 12) = v11;
    *(a1 + 16) = v12;
    v7 = *&byte_80069C48[v3];
    v8 = *&byte_80069C4C[v3];
  }
  *(a1 + 20) = v7;
  *(a1 + 24) = v8;
  v9 = a1 + 28;
  *v9 = 74;
  *(v9 + 2) = 113;
  v13 = &dword_80069B00[420 * *g_LanguageID[0].header];
  v14 = v13[1];
  v15 = v13[2];
  v16 = v13[3];
  *(v9 + 4) = *v13;
  *(v9 + 8) = v14;
  *(v9 + 12) = v15;
  *(v9 + 16) = v16;
  v17 = v13[5];
  *(v9 + 20) = v13[4];
  *(v9 + 24) = v17;
  v9 += 28;
  *v9 = 74;
  *(v9 + 2) = 128;
  result = &dword_80069968[420 * *g_LanguageID[0].header];
  v19 = result[1];
  v20 = result[2];
  v21 = result[3];
  *(v9 + 4) = *result;
  *(v9 + 8) = v19;
  *(v9 + 12) = v20;
  *(v9 + 16) = v21;
  v22 = result[5];
  *(v9 + 20) = result[4];
  *(v9 + 24) = v22;
  return result;
}
// 80069968: using guessed type int dword_80069968[6];
// 80069B00: using guessed type int dword_80069B00[6];

//----- (8001EDE0) --------------------------------------------------------
BOOL __fastcall sub_8001EDE0(int a1, int a2, int a3, int a4, int a5, int a6, __int16 a7, __int16 a8)
{
  int i; // $s2
  UiFrameStyle *v12; // $s1
  int v13; // $s0
  BOOL result; // $v0

  for ( i = 0; i < 2; result = i < 2 )
  {
    v12 = a1;
    SwapGpuCommandBuffers();
    v13 = 0;
    DrawUiFrame(&g_GPU_FrameVisuals, &dword_80067CCC[616 * *g_LanguageID[0].header + 28]);
    DrawUiText(g_GPU_TextBuffer, &dword_80067CCC[616 * *g_LanguageID[0].header + 28]);
    if ( a2 > 0 )
    {
      do
      {
        DrawUiText(g_GPU_TextBuffer, v12);
        ++v13;
        ++v12;
      }
      while ( v13 < a2 );
    }
    DrawTexturedQuad(a3, a4, a5, a6, a7, a8);
    ++i;
    FlushGpuCommands();
  }
  return result;
}
// 80067AB4: using guessed type int g_GPU_TextBuffer[2];
// 80067CCC: using guessed type int dword_80067CCC[7];

//----- (8001EF38) --------------------------------------------------------
int __fastcall sub_8001EF38(int a1)
{
  int v2; // $s1
  unsigned __int8 v3; // $s3
  unsigned __int8 v4; // $s2
  int v5; // $s0
  int v6; // $s0
  int v8; // [sp+18h] [-10h] BYREF
  int v9; // [sp+1Ch] [-Ch] BYREF
  int v10; // [sp+20h] [-8h] BYREF

  v2 = 0;
  v3 = 0;
  v4 = 0;
  v10 = -99;
  v9 = 0;
  v8 = -1;
  SetupMenuUIBuffers();
  v5 = 0;
  do
  {
    ++v5;
    SwapGpuCommandBuffers();
    RenderMenuFrame(3, 3, 0, v9);
    FlushGpuCommands();
  }
  while ( v5 < 2 );
  PlaySfx(16);
  WaitForButtonRelease();
  while ( 1 )
  {
    if ( v8 != -1 || v10 != -99 )
      WaitForButtonRelease();
    if ( v8 )
    {
      if ( v8 == 1 )
        v4 = SellItemMenu_8001F46C(a1, v4);
    }
    else
    {
      v3 = BuyItemMenu(a1, v3);
    }
    if ( v10 != -99 )
      break;
    v2 = sub_80020420(v2, 2, &v8, &v9, &v10);
    v6 = 0;
    do
    {
      ++v6;
      SwapGpuCommandBuffers();
      RenderMenuFrame(3, 3, v2, v9);
      FlushGpuCommands();
    }
    while ( v6 < 2 );
  }
  return Music_UpdateState(0);
}

//----- (8001F0D4) --------------------------------------------------------
// write access to const memory has been detected, the output may be wrong!
int __fastcall BuyItemMenu(int shop_type, unsigned __int8 a2)
{
  int v2; // $s5
  int count; // $v0
  char v6; // $s1
  int result; // $v0
  int v8; // $gp
  int v9; // $s0
  int v10; // $a0
  int v11; // $gp
  ListWidget v12; // [sp+20h] [-4F0h] BYREF
  int *v13; // [sp+44h] [-4CCh]
  char *v14; // [sp+4Ch] [-4C4h]
  int *v15; // [sp+50h] [-4C0h]
  int v16[240]; // [sp+58h] [-4B8h] BYREF
  char quantities[40]; // [sp+418h] [-F8h] BYREF
  int prices[40]; // [sp+440h] [-D0h] BYREF
  char item_ids[40]; // [sp+4E0h] [-30h] BYREF
  int v20; // [sp+508h] [-8h] BYREF
  int v21; // [sp+50Ch] [-4h] BYREF

  v21 = -99;
  v20 = 0;
  byte_8006D523 = byte_8009DEA3 == 0;
  count = GetInventoryItems(&dword_8006D388[30 * shop_type], v16, quantities, item_ids, 0, 119);
  v6 = count;
  //    ?
  CollectBuyData(g_InventoryCounts, quantities, prices, item_ids, 0, count, shop_type);
  InitListWidget(&v12, 3, 0);
  v12.visible_count = v6;
  v13 = v16;
  v14 = quantities;
  v15 = prices;
  v12.viewport_bottom = 24;
  ListNavigating(&v12, a2);
  result = Draw3dPreview(item_ids[v12.viewport_top]);
  if ( !result )
  {
    while ( 1 )
    {
      if ( v20 || v21 != -99 )
        WaitForButtonRelease();
      if ( v20 == 1 )
      {
        v21 = ShowEquipmentMenu(&v12, 3, 10, v2);
        if ( v21 == -1 )
          v21 = -99;
        else
          v21 = v2;
      }
      if ( v21 != -99 )
        break;
      ProcessListNavigation(&v12, item_ids, &v20, &v21);
      a2 = v12.viewport_top;
      v2 = item_ids[v12.viewport_top];
      v9 = 0;
      if ( v20 == 1 )
      {
        v10 = *(v8 + 108);
        // g_Gold_8019B4F0 >= price * quantity
        if ( g_PlayerGold >= (v15[v12.viewport_top] * v10) && g_InventoryCounts[v2] + v10 < 100 )
        {
          PlaySfx(SFX_MENU_SELECT);
          v9 = 0;
        }
        else
        {
          PlaySfx(SFX_MENU_CANCEL);
          v20 = 0;
        }
      }
      do
      {
        SwapGpuCommandBuffers();
        if ( v12.visible_count )
          Update3dPreview(v2);
        RenderItemList(&v12, 10);
        ++v9;
        FlushGpuCommands();
      }
      while ( v9 < 2 );
    }
    Flush3dRender();
    result = a2;
    if ( v21 != -1 )
    {
      // g_Gold_8019B4F0 -= price * quantity;
      g_PlayerGold -= v15[v12.viewport_top] * *(v11 + 108);
      //    
      g_InventoryCounts[v21] += *(v11 + 108);
      return a2;
    }
  }
  return result;
}
// 8001F12C: write access to const memory at 8006D523 has been detected
// 8001F13C: write access to const memory at 8006D523 has been detected
// 8001F24C: variable 'v2' is possibly undefined
// 8001F2B0: variable 'v8' is possibly undefined
// 8001F384: variable 'v11' is possibly undefined
// 8006D388: using guessed type int dword_8006D388[4];
// 8006D523: using guessed type char byte_8006D523;
// 8009DEA3: using guessed type char byte_8009DEA3;
// 8019B4F0: using guessed type int g_PlayerGold;
// 8001F0D4: using guessed type int var_4B8[240];
// 8001F0D4: using guessed type unsigned __int8 item_ids[40];
// 8001F0D4: using guessed type _DWORD prices[40];

//----- (8001F3F8) --------------------------------------------------------
int __fastcall CollectBuyData(
        int inventory_counts,
        _BYTE *out_quantities,
        _DWORD *out_prices,
        unsigned __int8 *item_ids,
        int start_idx,
        int count,
        int shop_type)
{
  int v7; // $t0
  int result; // $v0
  int v9; // $v0

  v7 = start_idx;
  for ( result = 16 * shop_type; v7 < count; ++out_prices )
  {
    ++v7;
    *out_quantities++ = *(inventory_counts + *item_ids);
    v9 = *(&g_ItemBuyPrices[60 * shop_type] + *item_ids++);
    *out_prices = v9;
    result = v7 < count;
  }
  return result;
}
// 8006D658: using guessed type int g_ItemBuyPrices[360];

//----- (8001F46C) --------------------------------------------------------
int __fastcall SellItemMenu_8001F46C(int a1, unsigned __int8 a2)
{
  unsigned __int8 v2; // $s6
  int v5; // $v0
  char v6; // $s0
  int result; // $v0
  int v8; // $gp
  int v9; // $s0
  int v10; // $gp
  ListWidget wdg; // [sp+18h] [-E50h] BYREF
  int *v12; // [sp+3Ch] [-E2Ch]
  char *v13; // [sp+44h] [-E24h]
  int *v14; // [sp+48h] [-E20h]
  int v15[720]; // [sp+50h] [-E18h] BYREF
  char v16[120]; // [sp+B90h] [-2D8h] BYREF
  int v17[120]; // [sp+C08h] [-260h] BYREF
  char v18[120]; // [sp+DE8h] [-80h] BYREF
  int v19; // [sp+E60h] [-8h] BYREF
  int v20; // [sp+E64h] [-4h] BYREF

  v20 = -99;
  v19 = 0;
  v5 = CollectEquippableItems(g_InventoryCounts, v15, v16, v18, 0, 119);
  v6 = v5;
  CalculateSellPrices(v17, v18, 0, v5, a1);
  InitListWidget(&wdg, 3, 1);
  wdg.visible_count = v6;
  v12 = v15;
  v13 = v16;
  v14 = v17;
  wdg.viewport_bottom = 24;
  ListNavigating(&wdg, a2);
  if ( !wdg.visible_count || (result = Draw3dPreview(v18[wdg.viewport_top])) == 0 )
  {
    while ( 1 )
    {
      if ( v19 || v20 != -99 )
        WaitForButtonRelease();
      if ( v19 == 1 )
      {
        v20 = ShowEquipmentMenu(&wdg, 4, 11, v2);
        if ( v20 == -1 )
          v20 = -99;
        else
          v20 = v2;
      }
      if ( v20 != -99 )
        break;
      ProcessListNavigation(&wdg, v18, &v19, &v20);
      a2 = wdg.viewport_top;
      v2 = v18[wdg.viewport_top];
      v9 = 0;
      if ( v19 == 1 )
      {
        if ( v16[wdg.viewport_top] >= *(v8 + 108) )
        {
          PlaySfx(SFX_MENU_SELECT);
        }
        else
        {
          PlaySfx(SFX_MENU_CANCEL);
          v19 = 0;
        }
        v9 = 0;
      }
      do
      {
        SwapGpuCommandBuffers();
        if ( wdg.visible_count )
          Update3dPreview(v2);
        RenderItemList(&wdg, 11);
        ++v9;
        FlushGpuCommands();
      }
      while ( v9 < 2 );
    }
    Flush3dRender();
    result = a2;
    if ( v20 != -1 )
    {
      g_PlayerGold += v14[wdg.viewport_top] * *(v10 + 108);
      g_InventoryCounts[v20] -= *(v10 + 108);
      return a2;
    }
  }
  return result;
}
// 8001F5A8: variable 'v2' is possibly undefined
// 8001F60C: variable 'v8' is possibly undefined
// 8001F6B0: variable 'v10' is possibly undefined
// 8019B4F0: using guessed type int g_PlayerGold;
// 8001F46C: using guessed type int var_E18[720];
// 8001F46C: using guessed type char var_2D8[120];
// 8001F46C: using guessed type unsigned __int8 var_80[120];
// 8001F46C: using guessed type _DWORD var_260[120];

//----- (8001F728) --------------------------------------------------------
int __fastcall CalculateSellPrices(
        _DWORD *out_prices,
        unsigned __int8 *item_ids,
        int start_idx,
        int count,
        int shop_type)
{
  int result; // $v0
  int item_id; // $v0

  for ( result = 16 * shop_type; start_idx < count; ++out_prices )
  {
    item_id = *item_ids++;
    ++start_idx;
    *out_prices = *(&g_ItemSellPriceTable[60 * shop_type] + item_id);
    result = start_idx < count;
  }
  return result;
}
// 8006DBF8: using guessed type int g_ItemSellPriceTable[10];

//----- (8001F77C) --------------------------------------------------------
int sub_8001F77C()
{
  char InventoryItems; // $s0
  int v1; // $gp
  unsigned __int8 v2; // $a1
  unsigned __int8 v3; // $s1
  bool v4; // dc
  int result; // $v0
  int i; // $s0
  unsigned __int8 *v7; // $v1
  int v8; // $gp
  int v9; // $s0
  ListWidget v10; // [sp+18h] [-C70h] BYREF
  int *v11; // [sp+3Ch] [-C4Ch]
  char *v12; // [sp+44h] [-C44h]
  int v13[720]; // [sp+50h] [-C38h] BYREF
  char v14[120]; // [sp+B90h] [-F8h] BYREF
  char v15[120]; // [sp+C08h] [-80h] BYREF
  int v16; // [sp+C80h] [-8h] BYREF
  int v17; // [sp+C84h] [-4h] BYREF

  v16 = 0;
  v17 = -99;
  SetupMenuUIBuffers();
  InventoryItems = GetInventoryItems(g_InventoryCounts, v13, v14, v15, 0, 119);
  InitListWidget(&v10, 5, 0);
  v2 = *(v1 + 123);
  v10.visible_count = InventoryItems;
  v11 = v13;
  v12 = v14;
  v10.viewport_bottom = 24;
  ListNavigating(&v10, v2);
  v3 = v15[v10.viewport_top];
  v4 = Draw3dPreview(v3) != 0;
  result = -1;
  if ( !v4 )
  {
    for ( i = 0; i < 2; ++i )
    {
      SwapGpuCommandBuffers();
      if ( v10.visible_count )
        Update3dPreview(v3);
      RenderItemList(&v10, 12);
      FlushGpuCommands();
    }
    PlaySfx(16);
    WaitForButtonRelease();
    while ( 1 )
    {
      if ( v16 || v17 != -99 )
        WaitForButtonRelease();
      if ( v16 == 1 )
      {
        v17 = ShowEquipmentMenu(&v10, 8, 12, v3);
        if ( v17 == -1 )
          v17 = -99;
        else
          v17 = v3;
      }
      if ( v17 != -99 )
        break;
      ProcessListNavigation(&v10, v15, &v16, &v17);
      v7 = &v15[v10.viewport_top];
      *(v8 + 123) = v10.viewport_top;
      v3 = *v7;
      v9 = 0;
      if ( v16 == 1 )
        PlaySfx(17);
      do
      {
        SwapGpuCommandBuffers();
        if ( v10.visible_count )
          Update3dPreview(v3);
        RenderItemList(&v10, 12);
        ++v9;
        FlushGpuCommands();
      }
      while ( v9 < 2 );
    }
    Flush3dRender();
    Music_UpdateState(0);
    return v17;
  }
  return result;
}
// 8001F7F4: variable 'v1' is possibly undefined
// 8001F91C: variable 'v8' is possibly undefined
// 8001F77C: using guessed type int var_C38[720];
// 8001F77C: using guessed type char var_80[120];

//----- (8001F9B8) --------------------------------------------------------
int sub_8001F9B8()
{
  int InventoryItems; // $v0
  char v1; // $s1
  unsigned __int8 v2; // $s0
  int result; // $v0
  int v4; // $s1
  int v5; // $gp
  int v6; // $s1
  int v7; // $a0
  int v8; // $v1
  int v9; // $gp
  ListWidget v10; // [sp+20h] [-4F0h] BYREF
  int *v11; // [sp+44h] [-4CCh]
  char *v12; // [sp+4Ch] [-4C4h]
  int *v13; // [sp+50h] [-4C0h]
  int v14[240]; // [sp+58h] [-4B8h] BYREF
  char v15[40]; // [sp+418h] [-F8h] BYREF
  int v16[40]; // [sp+440h] [-D0h] BYREF
  char v17[40]; // [sp+4E0h] [-30h] BYREF
  int v18; // [sp+508h] [-8h] BYREF
  int v19; // [sp+50Ch] [-4h] BYREF

  v18 = 0;
  v19 = -99;
  SetupMenuUIBuffers();
  InventoryItems = GetInventoryItems(dword_8006D568, v14, v15, v17, 0, 119);
  v1 = InventoryItems;
  CollectBuyData(g_InventoryCounts, v15, v16, v17, 0, InventoryItems, 4);
  InitListWidget(&v10, 5, 1);
  v10.visible_count = v1;
  v11 = v14;
  v12 = v15;
  v13 = v16;
  v10.viewport_bottom = 24;
  v2 = v17[v10.viewport_top];
  result = Draw3dPreview(v2);
  v4 = 0;
  if ( result )
    return result;
  do
  {
    SwapGpuCommandBuffers();
    if ( v10.visible_count )
      Update3dPreview(v2);
    RenderItemList(&v10, 15);
    ++v4;
    FlushGpuCommands();
  }
  while ( v4 < 2 );
  PlaySfx(16);
  WaitForButtonRelease();
  while ( 1 )
  {
    if ( v18 || v19 != -99 )
      WaitForButtonRelease();
    if ( v18 == 1 )
    {
      v19 = ShowEquipmentMenu(&v10, 9, 15, v2);
      if ( v19 == -1 )
        v19 = -99;
      else
        v19 = v2;
    }
    if ( v19 != -99 )
      break;
    ProcessListNavigation(&v10, v17, &v18, &v19);
    v2 = v17[v10.viewport_top];
    v6 = 0;
    if ( v18 == 1 )
    {
      v7 = *(v5 + 108);
      v8 = v17[v10.viewport_top];
      if ( byte_8009DED0 >= v13[v10.viewport_top] * v7 )
      {
        if ( v8 == 117 )
        {
          if ( byte_8009DEE5 + 10 * v7 < 100 )
          {
LABEL_21:
            PlaySfx(17);
            goto LABEL_22;
          }
        }
        else if ( g_InventoryCounts[v8] + v7 < 100 )
        {
          goto LABEL_21;
        }
      }
      PlaySfx(18);
      v18 = 0;
LABEL_22:
      v6 = 0;
      goto LABEL_23;
    }
    do
    {
LABEL_23:
      SwapGpuCommandBuffers();
      if ( v10.visible_count )
        Update3dPreview(v2);
      RenderItemList(&v10, 15);
      ++v6;
      FlushGpuCommands();
    }
    while ( v6 < 2 );
  }
  Flush3dRender();
  if ( v19 != -1 )
  {
    byte_8009DED0 -= v13[v10.viewport_top] * *(v9 + 108);
    if ( v19 == 117 )
      byte_8009DEE5 += 10 * *(v9 + 108);
    else
      g_InventoryCounts[v19] += *(v9 + 108);
  }
  return Music_UpdateState(0);
}
// 8001FB90: variable 'v5' is possibly undefined
// 8001FC94: variable 'v9' is possibly undefined
// 8006D568: using guessed type int dword_8006D568[20];
// 8009DED0: using guessed type char byte_8009DED0;
// 8009DEE5: using guessed type char byte_8009DEE5;
// 8001F9B8: using guessed type int var_4B8[240];
// 8001F9B8: using guessed type unsigned __int8 var_30[40];
// 8001F9B8: using guessed type _DWORD var_D0[40];

//----- (8001FD28) --------------------------------------------------------
int sub_8001FD28()
{
  int v0; // $s1
  int v1; // $s0
  int v2; // $s0
  int v4; // [sp+18h] [-10h] BYREF
  int v5; // [sp+1Ch] [-Ch] BYREF
  int v6; // [sp+20h] [-8h] BYREF

  v0 = 0;
  v6 = -99;
  v5 = 0;
  v4 = -1;
  SetupMenuUIBuffers();
  v1 = 0;
  do
  {
    ++v1;
    SwapGpuCommandBuffers();
    RenderMenuFrame(4, 3, 0, v5);
    FlushGpuCommands();
  }
  while ( v1 < 2 );
  PlaySfx(16);
  WaitForButtonRelease();
  while ( 1 )
  {
    if ( v4 != -1 || v6 != -99 )
      WaitForButtonRelease();
    if ( v4 )
    {
      if ( v4 == 1 )
        sub_80020158();
    }
    else
    {
      sub_8001FE98();
    }
    if ( v6 != -99 )
      break;
    v0 = sub_80020420(v0, 2, &v4, &v5, &v6);
    v2 = 0;
    do
    {
      ++v2;
      SwapGpuCommandBuffers();
      RenderMenuFrame(4, 3, v0, v5);
      FlushGpuCommands();
    }
    while ( v2 < 2 );
  }
  return Music_UpdateState(0);
}

//----- (8001FE98) --------------------------------------------------------
int sub_8001FE98()
{
  int v0; // $s4
  int InventoryItems; // $v0
  char v2; // $s0
  int result; // $v0
  int v4; // $gp
  int v5; // $s0
  int v6; // $a0
  int v7; // $gp
  ListWidget v8; // [sp+20h] [-4F0h] BYREF
  int *v9; // [sp+44h] [-4CCh]
  char *v10; // [sp+4Ch] [-4C4h]
  int *v11; // [sp+50h] [-4C0h]
  int v12[240]; // [sp+58h] [-4B8h] BYREF
  char v13[40]; // [sp+418h] [-F8h] BYREF
  int v14[40]; // [sp+440h] [-D0h] BYREF
  char v15[40]; // [sp+4E0h] [-30h] BYREF
  int v16; // [sp+508h] [-8h] BYREF
  int v17; // [sp+50Ch] [-4h] BYREF

  v17 = -99;
  v16 = 0;
  InventoryItems = GetInventoryItems(dword_8006D5E0, v12, v13, v15, 0, 119);
  v2 = InventoryItems;
  CollectBuyData(g_InventoryCounts, v13, v14, v15, 0, InventoryItems, 5);
  InitListWidget(&v8, 4, 0);
  v8.visible_count = v2;
  v9 = v12;
  v10 = v13;
  v11 = v14;
  v8.viewport_bottom = 24;
  result = Draw3dPreview(v15[v8.viewport_top]);
  if ( !result )
  {
    while ( 1 )
    {
      if ( v16 || v17 != -99 )
        WaitForButtonRelease();
      if ( v16 == 1 )
      {
        v17 = ShowEquipmentMenu(&v8, 3, 13, v0);
        if ( v17 == -1 )
          v17 = -99;
        else
          v17 = v0;
      }
      if ( v17 != -99 )
        break;
      ProcessListNavigation(&v8, v15, &v16, &v17);
      v0 = v15[v8.viewport_top];
      v5 = 0;
      if ( v16 == 1 )
      {
        v6 = *(v4 + 108);
        if ( g_PlayerGold >= (v11[v8.viewport_top] * v6) && g_InventoryCounts[v0] + v6 < 100 )
        {
          PlaySfx(17);
          v5 = 0;
        }
        else
        {
          PlaySfx(18);
          v16 = 0;
        }
      }
      do
      {
        SwapGpuCommandBuffers();
        if ( v8.visible_count )
          Update3dPreview(v0);
        RenderItemList(&v8, 13);
        ++v5;
        FlushGpuCommands();
      }
      while ( v5 < 2 );
    }
    Flush3dRender();
    result = -1;
    if ( v17 != -1 )
    {
      g_PlayerGold -= v11[v8.viewport_top] * *(v7 + 108);
      result = g_InventoryCounts[v17] + *(v7 + 108);
      g_InventoryCounts[v17] = result;
    }
  }
  return result;
}
// 8001FFBC: variable 'v0' is possibly undefined
// 8002001C: variable 'v4' is possibly undefined
// 800200F0: variable 'v7' is possibly undefined
// 8006D5E0: using guessed type int dword_8006D5E0[26];
// 8019B4F0: using guessed type int g_PlayerGold;
// 8001FE98: using guessed type int var_4B8[240];
// 8001FE98: using guessed type unsigned __int8 var_30[40];
// 8001FE98: using guessed type _DWORD var_D0[40];

//----- (80020158) --------------------------------------------------------
int sub_80020158()
{
  int v0; // $s4
  int v1; // $v0
  char v2; // $s0
  int result; // $v0
  int v4; // $gp
  int v5; // $s0
  int v6; // $a0
  int v7; // $gp
  ListWidget v8; // [sp+18h] [-4F0h] BYREF
  int *v9; // [sp+3Ch] [-4CCh]
  char *v10; // [sp+44h] [-4C4h]
  int *v11; // [sp+48h] [-4C0h]
  int v12[240]; // [sp+50h] [-4B8h] BYREF
  char v13[40]; // [sp+410h] [-F8h] BYREF
  int v14[40]; // [sp+438h] [-D0h] BYREF
  char v15[40]; // [sp+4D8h] [-30h] BYREF
  int v16; // [sp+500h] [-8h] BYREF
  int v17; // [sp+504h] [-4h] BYREF

  v17 = -99;
  v16 = 0;
  v1 = sub_80019F94(g_InventoryCounts, v12, v13, v15, 99, 109);
  v2 = v1;
  CalculateSellPrices(v14, v15, 0, v1, 4);
  InitListWidget(&v8, 4, 1);
  v8.visible_count = v2;
  v9 = v12;
  v10 = v13;
  v11 = v14;
  v8.viewport_bottom = 24;
  if ( !v2 || (result = Draw3dPreview(v15[v8.viewport_top])) == 0 )
  {
    while ( 1 )
    {
      if ( v16 || v17 != -99 )
        WaitForButtonRelease();
      if ( v16 == 1 )
      {
        v17 = ShowEquipmentMenu(&v8, 10, 14, v0);
        if ( v17 == -1 )
          v17 = -99;
        else
          v17 = v0;
      }
      if ( v17 != -99 )
        break;
      ProcessListNavigation(&v8, v15, &v16, &v17);
      v0 = v15[v8.viewport_top];
      v5 = 0;
      if ( v16 == 1 )
      {
        v6 = *(v4 + 108);
        if ( g_PlayerGold >= (v11[v8.viewport_top] * v6) && g_InventoryCounts[v0] + v6 < 100 )
        {
          PlaySfx(17);
          v5 = 0;
        }
        else
        {
          PlaySfx(18);
          v16 = 0;
        }
      }
      do
      {
        SwapGpuCommandBuffers();
        if ( v8.visible_count )
          Update3dPreview(v0);
        RenderItemList(&v8, 14);
        ++v5;
        FlushGpuCommands();
      }
      while ( v5 < 2 );
    }
    Flush3dRender();
    result = -1;
    if ( v17 != -1 )
    {
      g_PlayerGold -= v11[v8.viewport_top] * *(v7 + 108);
      result = g_InventoryCounts[v17] + *(v7 + 108);
      g_InventoryCounts[v17] = result;
    }
  }
  return result;
}
// 80020284: variable 'v0' is possibly undefined
// 800202E4: variable 'v4' is possibly undefined
// 800203B8: variable 'v7' is possibly undefined
// 8019B4F0: using guessed type int g_PlayerGold;
// 80020158: using guessed type int var_4B8[240];
// 80020158: using guessed type unsigned __int8 var_30[40];
// 80020158: using guessed type _DWORD var_D0[40];

//----- (80020420) --------------------------------------------------------
int __fastcall sub_80020420(int a1, int a2, _DWORD *a3, _DWORD *a4, _DWORD *a5)
{
  __int16 PadWithFlag; // $v0
  int v10; // $gp
  __int16 v11; // $a0
  bool v12; // dc
  int result; // $v0

  *a3 = -1;
  *a4 = 0;
  WaitForInputStable();
  PadWithFlag = ReadPadWithFlag();
  v11 = PadWithFlag;
  if ( (PadWithFlag & 0x1000) != 0 )
  {
    *(v10 + 116) = 0;
    PlaySfx(16);
    v12 = a1-- != 0;
    if ( !v12 )
      return a2;
    return a1;
  }
  if ( (PadWithFlag & 0x4000) != 0 )
  {
    *(v10 + 116) = 0;
    PlaySfx(16);
    v12 = a1++ != a2;
    if ( !v12 )
      return 0;
    return a1;
  }
  if ( (PadWithFlag & 0x20) != 0 )
  {
    PlaySfx(17);
    *a4 = 1;
    if ( a1 < a2 )
    {
      *a3 = a1;
      return a1;
    }
LABEL_13:
    *a5 = -1;
    return a1;
  }
  if ( (PadWithFlag & 0x10) != 0 || (result = a1, (v11 & 0x800) != 0) )
  {
    PlaySfx(18);
    goto LABEL_13;
  }
  return result;
}
// 80020484: variable 'v10' is possibly undefined

//----- (80020578) --------------------------------------------------------
int __fastcall ProcessListNavigation(
        ListWidget *widget_ptr,
        int preview_callback,
        _DWORD *out_confirmed,
        _DWORD *out_cancelled)
{
  int PadWithFlag; // $v0
  int v9; // $gp
  int v10; // $s1
  int viewport_flags; // $v1
  bool v12; // dc
  char visible_count; // $v0
  char v14; // $v1
  __int16 v15; // $v0
  __int16 v16; // $v0
  __int16 v17; // $v0
  __int16 v18; // $v0
  int v19; // $v0
  int v20; // $v0
  int result; // $v0
  __int16 v22; // $v0
  __int16 v23; // $v0
  __int16 v24; // $v0
  __int16 v25; // $v0
  __int16 v26; // $v0
  int v27; // $v1

  *out_confirmed = 0;
  WaitForInputStable();
  PadWithFlag = ReadPadWithFlag();
  v10 = PadWithFlag;
  if ( !widget_ptr->visible_count )
  {
    if ( !PadWithFlag )
      goto LABEL_36;
LABEL_34:
    PlaySfx(18);
LABEL_35:
    *out_cancelled = -1;
    goto LABEL_36;
  }
  if ( (PadWithFlag & PAD_UP) != 0 )
  {
    PlaySfx(SFX_MENU_MOVE);
    if ( widget_ptr->viewport_top )
    {
      viewport_flags = widget_ptr->viewport_flags;
      --widget_ptr->viewport_top;
      if ( viewport_flags )
        --widget_ptr->viewport_flags;
      else
        --widget_ptr->cursor_idx;
    }
    else
    {
      v12 = widget_ptr->visible_count >= widget_ptr->scroll_offset;
      widget_ptr->viewport_top = widget_ptr->visible_count - 1;
      if ( v12 )
      {
        v14 = widget_ptr->scroll_offset - 1;
        widget_ptr->cursor_idx = widget_ptr->visible_count - widget_ptr->scroll_offset;
        widget_ptr->viewport_flags = v14;
      }
      else
      {
        visible_count = widget_ptr->visible_count;
        widget_ptr->cursor_idx = 0;
        widget_ptr->viewport_flags = visible_count - 1;
      }
    }
    if ( preview_callback && Draw3dPreview(*(preview_callback + widget_ptr->viewport_top)) )
      goto LABEL_35;
  }
  else
  {
    if ( (PadWithFlag & PAD_DOWN) == 0 )
    {
      if ( (PadWithFlag & 0x2000) != 0 )
      {
        if ( *(v9 + 108) < 99 )
        {
          PlaySfx(SFX_MENU_MOVE);
          ++*(v9 + 108);
        }
        goto LABEL_36;
      }
      if ( (PadWithFlag & 0x8000) != 0 )
      {
        if ( *(v9 + 108) >= 2 )
        {
          PlaySfx(SFX_MENU_MOVE);
          --*(v9 + 108);
        }
        goto LABEL_36;
      }
      if ( (PadWithFlag & PAD_CIRCLE) != 0 )
      {
        *out_confirmed = 1;
        goto LABEL_36;
      }
      if ( (PadWithFlag & PAD_TRIANGLE) == 0 && (PadWithFlag & PAD_START) == 0 )
        goto LABEL_49;
      goto LABEL_34;
    }
    PlaySfx(SFX_MENU_MOVE);
    if ( widget_ptr->viewport_top >= widget_ptr->visible_count - 1 )
    {
      widget_ptr->viewport_top = 0;
      widget_ptr->cursor_idx = 0;
      widget_ptr->viewport_flags = 0;
    }
    else
    {
      ++widget_ptr->viewport_top;
      if ( widget_ptr->viewport_flags == widget_ptr->scroll_offset - 1 )
        ++widget_ptr->cursor_idx;
      else
        ++widget_ptr->viewport_flags;
    }
    if ( preview_callback && Draw3dPreview(*(preview_callback + widget_ptr->viewport_top)) )
      goto LABEL_35;
  }
LABEL_36:
  if ( (v10 & PAD_START) != 0 )
  {
    if ( (v10 & 8) != 0 )
    {
      v15 = *(v9 + 268);
      *(v9 + 104) = 0;
      *(v9 + 268) = v15 + 16;
    }
    if ( (v10 & 2) != 0 )
    {
      v16 = *(v9 + 268);
      *(v9 + 104) = 0;
      *(v9 + 268) = v16 - 16;
    }
    if ( (v10 & 4) != 0 )
    {
      v17 = *(v9 + 272);
      *(v9 + 104) = 0;
      *(v9 + 272) = v17 + 16;
    }
    if ( (v10 & 1) != 0 )
    {
      v18 = *(v9 + 272);
      *(v9 + 104) = 0;
      *(v9 + 272) = v18 - 16;
    }
    if ( (v10 & 0x40) != 0 )
    {
      v19 = *(v9 + 276);
      *(v9 + 104) = 0;
      *(v9 + 276) = v19 + 1;
    }
    if ( (v10 & 0x80) != 0 )
    {
      v20 = *(v9 + 276);
      *(v9 + 104) = 0;
      *(v9 + 276) = v20 - 1;
    }
  }
LABEL_49:
  result = v10;
  if ( (v10 & 0x100) != 0 )
  {
    if ( (v10 & 8) != 0 )
    {
      v22 = *(v9 + 260);
      *(v9 + 104) = 0;
      *(v9 + 260) = v22 + 16;
    }
    if ( (v10 & 2) != 0 )
    {
      v23 = *(v9 + 260);
      *(v9 + 104) = 0;
      *(v9 + 260) = v23 - 16;
    }
    if ( (v10 & 4) != 0 )
    {
      v24 = *(v9 + 262);
      *(v9 + 104) = 0;
      *(v9 + 262) = v24 + 16;
    }
    if ( (v10 & 1) != 0 )
    {
      v25 = *(v9 + 262);
      *(v9 + 104) = 0;
      *(v9 + 262) = v25 - 16;
    }
    if ( (v10 & 0x40) != 0 )
    {
      v26 = *(v9 + 264);
      *(v9 + 104) = 0;
      *(v9 + 264) = v26 + 16;
    }
    result = v10;
    if ( (v10 & 0x80) != 0 )
    {
      v27 = *(v9 + 264);
      if ( v27 >= 501 )
        *(v9 + 264) = v27 - 16;
      *(v9 + 104) = 0;
      return v10;
    }
  }
  return result;
}
// 80020794: variable 'v9' is possibly undefined

//----- (80020ABC) --------------------------------------------------------
BOOL sub_80020ABC()
{
  int *v0; // $v0
  int v1; // $a2
  int v2; // $a3
  int v3; // $t0
  int v4; // $a2
  int *v5; // $v0
  int v6; // $a2
  int v7; // $a3
  int v8; // $t0
  int v9; // $a2
  int *v10; // $v0
  int v11; // $a2
  int v12; // $a3
  int v13; // $t0
  int v14; // $a2
  int *v15; // $v0
  int v16; // $a2
  int v17; // $a3
  int v18; // $t0
  int v19; // $a2
  int *v20; // $v0
  int v21; // $a2
  int v22; // $a3
  int v23; // $t0
  int v24; // $a2
  int v25; // $v0
  int *v26; // $v1
  int *v27; // $v0
  int v28; // $a0
  int v29; // $a1
  int v30; // $a2
  int v31; // $a0
  int v32; // $v0
  int v33; // $a2
  int v34; // $a3
  int v35; // $t0
  int v36; // $a2
  UiFrameStyle v38; // [sp+18h] [-40h] BYREF
  UiFrameStyle v39; // [sp+38h] [-20h] BYREF

  v38.posX = 168;
  v38.posY = 30;
  v0 = &dword_80069998[420 * *g_LanguageID[0].header];
  v1 = v0[1];
  v2 = v0[2];
  v3 = v0[3];
  *&v38.width = *v0;
  *&v38.colorBase = v1;
  *&v38.refX = v2;
  *v38.extra = v3;
  v4 = v0[5];
  *&v38.extra[4] = v0[4];
  *&v38.extra[8] = v4;
  DrawUiText(g_GPU_TextBuffer, &v38);
  v39.posX = v38.posX + 77;
  v39.posY = v38.posY;
  FormatNumberForUI(dword_8019B4C4, 7, 0, 0, &v39.width);
  sub_80023FD4(dword_80067AA8, &v39);
  v38.posY += 23;
  v5 = &dword_800699B0[420 * *g_LanguageID[0].header];
  v6 = v5[1];
  v7 = v5[2];
  v8 = v5[3];
  *&v38.width = *v5;
  *&v38.colorBase = v6;
  *&v38.refX = v7;
  *v38.extra = v8;
  v9 = v5[5];
  *&v38.extra[4] = v5[4];
  *&v38.extra[8] = v9;
  DrawUiText(g_GPU_TextBuffer, &v38);
  v39.posY += 23;
  FormatNumberForUI(byte_8019B4CC, 7, 0, 0, &v39.width);
  sub_80023FD4(dword_80067AA8, &v39);
  v38.width = 3847;
  LOBYTE(v38.height) = -1;
  v38.posY += 23;
  DrawUiText(g_GPU_TextBuffer, &v38);
  v39.posX = v38.posX + 63;
  v39.posY += 23;
  FormatNumberForUI(g_CurrentHP, 4, 0, 0, &v39.width);
  sub_80023FD4(dword_80067AA8, &v39);
  v39.width = -236;
  v39.posX += 28;
  sub_80023FD4(dword_80067AA8, &v39);
  v39.posX += 7;
  FormatNumberForUI(g_MaxHP, 4, 0, 0, &v39.width);
  sub_80023FD4(dword_80067AA8, &v39);
  LOBYTE(v38.width) = 12;
  v38.posY += 23;
  DrawUiText(g_GPU_TextBuffer, &v38);
  v39.posX = v38.posX + 63;
  v39.posY += 23;
  FormatNumberForUI(g_CurrentMP, 4, 0, 0, &v39.width);
  sub_80023FD4(dword_80067AA8, &v39);
  v39.width = -236;
  v39.posX += 28;
  sub_80023FD4(dword_80067AA8, &v39);
  v39.posX += 7;
  FormatNumberForUI(g_MaxMP, 4, 0, 0, &v39.width);
  sub_80023FD4(dword_80067AA8, &v39);
  v38.posY += 23;
  v10 = &dword_80069D40[420 * *g_LanguageID[0].header];
  v11 = v10[1];
  v12 = v10[2];
  v13 = v10[3];
  *&v38.width = *v10;
  *&v38.colorBase = v11;
  *&v38.refX = v12;
  *v38.extra = v13;
  v14 = v10[5];
  *&v38.extra[4] = v10[4];
  *&v38.extra[8] = v14;
  DrawUiText(g_GPU_TextBuffer, &v38);
  v39.posX = v38.posX + 84;
  v39.posY = v38.posY;
  FormatNumberForUI(g_unk_8019B4EC, 6, 0, 0, &v39.width);
  sub_80023FD4(dword_80067AA8, &v39);
  v38.posY += 23;
  v15 = &dword_80069D58[420 * *g_LanguageID[0].header];
  v16 = v15[1];
  v17 = v15[2];
  v18 = v15[3];
  *&v38.width = *v15;
  *&v38.colorBase = v16;
  *&v38.refX = v17;
  *v38.extra = v18;
  v19 = v15[5];
  *&v38.extra[4] = v15[4];
  *&v38.extra[8] = v19;
  DrawUiText(g_GPU_TextBuffer, &v38);
  v39.posX = v38.posX + 84;
  v39.posY = v38.posY;
  FormatNumberForUI(g_unk_8019B4EE, 6, 0, 0, &v39.width);
  sub_80023FD4(dword_80067AA8, &v39);
  v38.posY += 23;
  v20 = &dword_800699F8[420 * *g_LanguageID[0].header];
  v21 = v20[1];
  v22 = v20[2];
  v23 = v20[3];
  *&v38.width = *v20;
  *&v38.colorBase = v21;
  *&v38.refX = v22;
  *v38.extra = v23;
  v24 = v20[5];
  *&v38.extra[4] = v20[4];
  *&v38.extra[8] = v24;
  DrawUiText(g_GPU_TextBuffer, &v38);
  v39.posX = v38.posX + 56;
  v39.posY += 23;
  if ( g_AttackCooldown )
  {
    v25 = 420 * *g_LanguageID[0].header;
    v26 = dword_80069A10;
  }
  else if ( word_8019B51A )
  {
    v25 = 420 * *g_LanguageID[0].header;
    v26 = dword_80069A28;
  }
  else if ( word_8019B522 )
  {
    v25 = 420 * *g_LanguageID[0].header;
    v26 = dword_80069A40;
  }
  else if ( g_PoisenStatus )
  {
    v25 = 420 * *g_LanguageID[0].header;
    v26 = dword_80069A58;
  }
  else
  {
    v25 = 420 * *g_LanguageID[0].header;
    if ( word_8019B51E )
      v26 = dword_80069A70;
    else
      v26 = dword_80069A88;
  }
  v27 = &v26[v25];
  v28 = v27[1];
  v29 = v27[2];
  v30 = v27[3];
  *&v39.width = *v27;
  *&v39.colorBase = v28;
  *&v39.refX = v29;
  *v39.extra = v30;
  v31 = v27[5];
  *&v39.extra[4] = v27[4];
  *&v39.extra[8] = v31;
  DrawUiText(g_GPU_TextBuffer, &v39);
  v38.posY += 23;
  v32 = 1680 * *g_LanguageID[0].header;
  v33 = *&byte_80069AA4[v32];
  v34 = *&byte_80069AA8[v32];
  v35 = *&byte_80069AAC[v32];
  *&v38.width = *&byte_80069AA0[v32];
  *&v38.colorBase = v33;
  *&v38.refX = v34;
  *v38.extra = v35;
  v36 = *&byte_80069AB4[v32];
  *&v38.extra[4] = *&byte_80069AB0[v32];
  *&v38.extra[8] = v36;
  DrawUiText(g_GPU_TextBuffer, &v38);
  v39.posX = v38.posX + 77;
  v39.posY += 23;
  FormatNumberForUI(g_PlayerGold, 7, 0, 0, &v39.width);
  sub_80023FD4(dword_80067AA8, &v39);
  return DrawTexturedQuad(161, 14, 140, 205, 1, 2);
}
// 80067AA8: using guessed type int dword_80067AA8[3];
// 80067AB4: using guessed type int g_GPU_TextBuffer[2];
// 80069998: using guessed type int dword_80069998[6];
// 800699B0: using guessed type int dword_800699B0[6];
// 800699F8: using guessed type int dword_800699F8[6];
// 80069A10: using guessed type int dword_80069A10[6];
// 80069A28: using guessed type int dword_80069A28[6];
// 80069A40: using guessed type int dword_80069A40[6];
// 80069A58: using guessed type int dword_80069A58[6];
// 80069A70: using guessed type int dword_80069A70[6];
// 80069A88: using guessed type int dword_80069A88[6];
// 80069D40: using guessed type int dword_80069D40[6];
// 80069D58: using guessed type int dword_80069D58[6];
// 8019B4C4: using guessed type int dword_8019B4C4;
// 8019B4CC: using guessed type char byte_8019B4CC;
// 8019B4D6: using guessed type __int16 g_MaxHP;
// 8019B4D8: using guessed type __int16 g_CurrentHP;
// 8019B4DA: using guessed type __int16 g_MaxMP;
// 8019B4DC: using guessed type __int16 g_CurrentMP;
// 8019B4EC: using guessed type __int16 g_unk_8019B4EC;
// 8019B4EE: using guessed type __int16 g_unk_8019B4EE;
// 8019B4F0: using guessed type int g_PlayerGold;
// 8019B518: using guessed type __int16 g_PoisenStatus;
// 8019B51A: using guessed type __int16 word_8019B51A;
// 8019B51E: using guessed type __int16 word_8019B51E;
// 8019B522: using guessed type __int16 word_8019B522;
// 8019B524: using guessed type __int16 g_AttackCooldown;

//----- (800213E8) --------------------------------------------------------
BOOL sub_800213E8()
{
  int *v0; // $v0
  int v1; // $a2
  int v2; // $a3
  int v3; // $t0
  int v4; // $a2
  int *v5; // $v0
  int v6; // $a2
  int v7; // $a3
  int v8; // $t0
  int v9; // $a2
  int *v10; // $v0
  int v11; // $a2
  int v12; // $a3
  int v13; // $t0
  int v14; // $a2
  int *v15; // $v0
  int v16; // $a2
  int v17; // $a3
  int v18; // $t0
  int v19; // $a2
  int *v20; // $v0
  int v21; // $a2
  int v22; // $a3
  int v23; // $t0
  int v24; // $a2
  int *v25; // $v0
  int v26; // $a2
  int v27; // $a3
  int v28; // $t0
  int v29; // $a2
  int *v30; // $v0
  int v31; // $a2
  int v32; // $a3
  int v33; // $t0
  int v34; // $a2
  int *v35; // $v0
  int v36; // $a2
  int v37; // $a3
  int v38; // $t0
  int v39; // $a2
  int *v40; // $v0
  int v41; // $a2
  int v42; // $a3
  int v43; // $t0
  int v44; // $a2
  int *v45; // $v0
  int v46; // $a2
  int v47; // $a3
  int v48; // $t0
  int v49; // $a2
  int *v50; // $v0
  int v51; // $a2
  int v52; // $a3
  int v53; // $t0
  int v54; // $a2
  int *v55; // $v0
  int v56; // $a2
  int v57; // $a3
  int v58; // $t0
  int v59; // $a2
  int *v60; // $v0
  int v61; // $a2
  int v62; // $a3
  int v63; // $t0
  int v64; // $a2
  int *v65; // $v0
  int v66; // $a2
  int v67; // $a3
  int v68; // $t0
  int v69; // $a2
  int *v70; // $v0
  int v71; // $a2
  int v72; // $a3
  int v73; // $t0
  int v74; // $a2
  int *v75; // $v0
  int v76; // $a2
  int v77; // $a3
  int v78; // $t0
  int v79; // $a2
  int *v80; // $v0
  int v81; // $a2
  int v82; // $a3
  int v83; // $t0
  int v84; // $a2
  int *v85; // $v0
  int v86; // $a2
  int v87; // $a3
  int v88; // $t0
  int v89; // $a2
  int *v90; // $v0
  int v91; // $a2
  int v92; // $a3
  int v93; // $t0
  int v94; // $a2
  UiFrameStyle v96; // [sp+18h] [-40h] BYREF
  __int16 v97; // [sp+38h] [-20h] BYREF
  __int16 posY; // [sp+3Ah] [-1Eh]
  char v99[28]; // [sp+3Ch] [-1Ch] BYREF

  v96.posX = 24;
  v96.posY = 28;
  v0 = &dword_800699C8[420 * *g_LanguageID[0].header];
  v1 = v0[1];
  v2 = v0[2];
  v3 = v0[3];
  *&v96.width = *v0;
  *&v96.colorBase = v1;
  *&v96.refX = v2;
  *v96.extra = v3;
  v4 = v0[5];
  *&v96.extra[4] = v0[4];
  *&v96.extra[8] = v4;
  DrawUiText(g_GPU_TextBuffer, &v96);
  v96.posY += 18;
  v5 = &dword_80069CF8[420 * *g_LanguageID[0].header];
  v6 = v5[1];
  v7 = v5[2];
  v8 = v5[3];
  *&v96.width = *v5;
  *&v96.colorBase = v6;
  *&v96.refX = v7;
  *v96.extra = v8;
  v9 = v5[5];
  *&v96.extra[4] = v5[4];
  *&v96.extra[8] = v9;
  DrawUiText(g_GPU_TextBuffer, &v96);
  v97 = v96.posX + 84;
  posY = v96.posY;
  FormatNumberForUI(g_AttackStrike, 6, 0, 0, v99);
  sub_80023FD4(dword_80067AA8, &v97);
  v96.posY += 18;
  v10 = &dword_80069D10[420 * *g_LanguageID[0].header];
  v11 = v10[1];
  v12 = v10[2];
  v13 = v10[3];
  *&v96.width = *v10;
  *&v96.colorBase = v11;
  *&v96.refX = v12;
  *v96.extra = v13;
  v14 = v10[5];
  *&v96.extra[4] = v10[4];
  *&v96.extra[8] = v14;
  DrawUiText(g_GPU_TextBuffer, &v96);
  posY = v96.posY;
  FormatNumberForUI(g_AttackSlash, 6, 0, 0, v99);
  sub_80023FD4(dword_80067AA8, &v97);
  v96.posY += 18;
  v15 = &dword_80069D28[420 * *g_LanguageID[0].header];
  v16 = v15[1];
  v17 = v15[2];
  v18 = v15[3];
  *&v96.width = *v15;
  *&v96.colorBase = v16;
  *&v96.refX = v17;
  *v96.extra = v18;
  v19 = v15[5];
  *&v96.extra[4] = v15[4];
  *&v96.extra[8] = v19;
  DrawUiText(g_GPU_TextBuffer, &v96);
  posY = v96.posY;
  FormatNumberForUI(g_AttackPierce, 6, 0, 0, v99);
  sub_80023FD4(dword_80067AA8, &v97);
  v96.posY += 18;
  v20 = &dword_80069E18[420 * *g_LanguageID[0].header];
  v21 = v20[1];
  v22 = v20[2];
  v23 = v20[3];
  *&v96.width = *v20;
  *&v96.colorBase = v21;
  *&v96.refX = v22;
  *v96.extra = v23;
  v24 = v20[5];
  *&v96.extra[4] = v20[4];
  *&v96.extra[8] = v24;
  DrawUiText(g_GPU_TextBuffer, &v96);
  posY = v96.posY;
  FormatNumberForUI(g_AttackWhiteMagic, 6, 0, 0, v99);
  sub_80023FD4(dword_80067AA8, &v97);
  v96.posY += 18;
  v25 = &dword_80069E30[420 * *g_LanguageID[0].header];
  v26 = v25[1];
  v27 = v25[2];
  v28 = v25[3];
  *&v96.width = *v25;
  *&v96.colorBase = v26;
  *&v96.refX = v27;
  *v96.extra = v28;
  v29 = v25[5];
  *&v96.extra[4] = v25[4];
  *&v96.extra[8] = v29;
  DrawUiText(g_GPU_TextBuffer, &v96);
  posY = v96.posY;
  FormatNumberForUI(g_AttackFire, 6, 0, 0, v99);
  sub_80023FD4(dword_80067AA8, &v97);
  v96.posY += 18;
  v30 = &dword_80069E48[420 * *g_LanguageID[0].header];
  v31 = v30[1];
  v32 = v30[2];
  v33 = v30[3];
  *&v96.width = *v30;
  *&v96.colorBase = v31;
  *&v96.refX = v32;
  *v96.extra = v33;
  v34 = v30[5];
  *&v96.extra[4] = v30[4];
  *&v96.extra[8] = v34;
  DrawUiText(g_GPU_TextBuffer, &v96);
  posY = v96.posY;
  FormatNumberForUI(g_AttackEarth, 6, 0, 0, v99);
  sub_80023FD4(dword_80067AA8, &v97);
  v96.posY += 18;
  v35 = &dword_80069E60[420 * *g_LanguageID[0].header];
  v36 = v35[1];
  v37 = v35[2];
  v38 = v35[3];
  *&v96.width = *v35;
  *&v96.colorBase = v36;
  *&v96.refX = v37;
  *v96.extra = v38;
  v39 = v35[5];
  *&v96.extra[4] = v35[4];
  *&v96.extra[8] = v39;
  DrawUiText(g_GPU_TextBuffer, &v96);
  posY = v96.posY;
  FormatNumberForUI(g_AttackWind, 6, 0, 0, v99);
  sub_80023FD4(dword_80067AA8, &v97);
  v96.posY += 18;
  v40 = &dword_80069E78[420 * *g_LanguageID[0].header];
  v41 = v40[1];
  v42 = v40[2];
  v43 = v40[3];
  *&v96.width = *v40;
  *&v96.colorBase = v41;
  *&v96.refX = v42;
  *v96.extra = v43;
  v44 = v40[5];
  *&v96.extra[4] = v40[4];
  *&v96.extra[8] = v44;
  DrawUiText(g_GPU_TextBuffer, &v96);
  posY = v96.posY;
  FormatNumberForUI(g_AttackWater, 6, 0, 0, v99);
  sub_80023FD4(dword_80067AA8, &v97);
  v96.posX = 168;
  v96.posY = 28;
  v45 = &dword_800699E0[420 * *g_LanguageID[0].header];
  v46 = v45[1];
  v47 = v45[2];
  v48 = v45[3];
  *&v96.width = *v45;
  *&v96.colorBase = v46;
  *&v96.refX = v47;
  *v96.extra = v48;
  v49 = v45[5];
  *&v96.extra[4] = v45[4];
  *&v96.extra[8] = v49;
  DrawUiText(g_GPU_TextBuffer, &v96);
  v96.posY += 18;
  v50 = &dword_80069CF8[420 * *g_LanguageID[0].header];
  v51 = v50[1];
  v52 = v50[2];
  v53 = v50[3];
  *&v96.width = *v50;
  *&v96.colorBase = v51;
  *&v96.refX = v52;
  *v96.extra = v53;
  v54 = v50[5];
  *&v96.extra[4] = v50[4];
  *&v96.extra[8] = v54;
  DrawUiText(g_GPU_TextBuffer, &v96);
  v97 = v96.posX + 84;
  posY = v96.posY;
  FormatNumberForUI(g_DefenseStrike, 6, 0, 0, v99);
  sub_80023FD4(dword_80067AA8, &v97);
  v96.posY += 18;
  v55 = &dword_80069D10[420 * *g_LanguageID[0].header];
  v56 = v55[1];
  v57 = v55[2];
  v58 = v55[3];
  *&v96.width = *v55;
  *&v96.colorBase = v56;
  *&v96.refX = v57;
  *v96.extra = v58;
  v59 = v55[5];
  *&v96.extra[4] = v55[4];
  *&v96.extra[8] = v59;
  DrawUiText(g_GPU_TextBuffer, &v96);
  posY = v96.posY;
  FormatNumberForUI(g_DefenseSlash, 6, 0, 0, v99);
  sub_80023FD4(dword_80067AA8, &v97);
  v96.posY += 18;
  v60 = &dword_80069D28[420 * *g_LanguageID[0].header];
  v61 = v60[1];
  v62 = v60[2];
  v63 = v60[3];
  *&v96.width = *v60;
  *&v96.colorBase = v61;
  *&v96.refX = v62;
  *v96.extra = v63;
  v64 = v60[5];
  *&v96.extra[4] = v60[4];
  *&v96.extra[8] = v64;
  DrawUiText(g_GPU_TextBuffer, &v96);
  posY = v96.posY;
  FormatNumberForUI(g_DefensePierce, 6, 0, 0, v99);
  sub_80023FD4(dword_80067AA8, &v97);
  v96.posY += 18;
  v65 = &dword_80069E90[420 * *g_LanguageID[0].header];
  v66 = v65[1];
  v67 = v65[2];
  v68 = v65[3];
  *&v96.width = *v65;
  *&v96.colorBase = v66;
  *&v96.refX = v67;
  *v96.extra = v68;
  v69 = v65[5];
  *&v96.extra[4] = v65[4];
  *&v96.extra[8] = v69;
  DrawUiText(g_GPU_TextBuffer, &v96);
  posY = v96.posY;
  FormatNumberForUI(g_DefensePoison, 6, 0, 0, v99);
  sub_80023FD4(dword_80067AA8, &v97);
  v96.posY += 18;
  v70 = &dword_80069EA8[420 * *g_LanguageID[0].header];
  v71 = v70[1];
  v72 = v70[2];
  v73 = v70[3];
  *&v96.width = *v70;
  *&v96.colorBase = v71;
  *&v96.refX = v72;
  *v96.extra = v73;
  v74 = v70[5];
  *&v96.extra[4] = v70[4];
  *&v96.extra[8] = v74;
  DrawUiText(g_GPU_TextBuffer, &v96);
  posY = v96.posY;
  FormatNumberForUI(g_DefenseBlackMagic, 6, 0, 0, v99);
  sub_80023FD4(dword_80067AA8, &v97);
  v96.posY += 18;
  v75 = &dword_80069E30[420 * *g_LanguageID[0].header];
  v76 = v75[1];
  v77 = v75[2];
  v78 = v75[3];
  *&v96.width = *v75;
  *&v96.colorBase = v76;
  *&v96.refX = v77;
  *v96.extra = v78;
  v79 = v75[5];
  *&v96.extra[4] = v75[4];
  *&v96.extra[8] = v79;
  DrawUiText(g_GPU_TextBuffer, &v96);
  posY = v96.posY;
  FormatNumberForUI(g_DefenseFire, 6, 0, 0, v99);
  sub_80023FD4(dword_80067AA8, &v97);
  v96.posY += 18;
  v80 = &dword_80069E48[420 * *g_LanguageID[0].header];
  v81 = v80[1];
  v82 = v80[2];
  v83 = v80[3];
  *&v96.width = *v80;
  *&v96.colorBase = v81;
  *&v96.refX = v82;
  *v96.extra = v83;
  v84 = v80[5];
  *&v96.extra[4] = v80[4];
  *&v96.extra[8] = v84;
  DrawUiText(g_GPU_TextBuffer, &v96);
  posY = v96.posY;
  FormatNumberForUI(g_DefenseEarth, 6, 0, 0, v99);
  sub_80023FD4(dword_80067AA8, &v97);
  v96.posY += 18;
  v85 = &dword_80069E60[420 * *g_LanguageID[0].header];
  v86 = v85[1];
  v87 = v85[2];
  v88 = v85[3];
  *&v96.width = *v85;
  *&v96.colorBase = v86;
  *&v96.refX = v87;
  *v96.extra = v88;
  v89 = v85[5];
  *&v96.extra[4] = v85[4];
  *&v96.extra[8] = v89;
  DrawUiText(g_GPU_TextBuffer, &v96);
  posY = v96.posY;
  FormatNumberForUI(g_DefenseWind, 6, 0, 0, v99);
  sub_80023FD4(dword_80067AA8, &v97);
  v96.posY += 18;
  v90 = &dword_80069E78[420 * *g_LanguageID[0].header];
  v91 = v90[1];
  v92 = v90[2];
  v93 = v90[3];
  *&v96.width = *v90;
  *&v96.colorBase = v91;
  *&v96.refX = v92;
  *v96.extra = v93;
  v94 = v90[5];
  *&v96.extra[4] = v90[4];
  *&v96.extra[8] = v94;
  DrawUiText(g_GPU_TextBuffer, &v96);
  posY = v96.posY;
  FormatNumberForUI(g_DefenseWater, 6, 0, 0, v99);
  sub_80023FD4(dword_80067AA8, &v97);
  DrawTexturedQuad(17, 14, 140, 205, 1, 2);
  return DrawTexturedQuad(161, 14, 140, 205, 1, 2);
}
// 80067AA8: using guessed type int dword_80067AA8[3];
// 80067AB4: using guessed type int g_GPU_TextBuffer[2];
// 800699C8: using guessed type int dword_800699C8[6];
// 800699E0: using guessed type int dword_800699E0[6];
// 80069CF8: using guessed type int dword_80069CF8[6];
// 80069D10: using guessed type int dword_80069D10[6];
// 80069D28: using guessed type int dword_80069D28[6];
// 80069E18: using guessed type int dword_80069E18[6];
// 80069E30: using guessed type int dword_80069E30[6];
// 80069E48: using guessed type int dword_80069E48[6];
// 80069E60: using guessed type int dword_80069E60[6];
// 80069E78: using guessed type int dword_80069E78[6];
// 80069E90: using guessed type int dword_80069E90[6];
// 80069EA8: using guessed type int dword_80069EA8[6];
// 8019B4F4: using guessed type __int16 g_AttackStrike;
// 8019B4F6: using guessed type __int16 g_AttackSlash;
// 8019B4F8: using guessed type __int16 g_AttackPierce;
// 8019B4FA: using guessed type __int16 g_AttackWhiteMagic;
// 8019B4FC: using guessed type __int16 g_AttackFire;
// 8019B4FE: using guessed type __int16 g_AttackEarth;
// 8019B500: using guessed type __int16 g_AttackWind;
// 8019B502: using guessed type __int16 g_AttackWater;
// 8019B506: using guessed type __int16 g_DefenseStrike;
// 8019B508: using guessed type __int16 g_DefenseSlash;
// 8019B50A: using guessed type __int16 g_DefensePierce;
// 8019B50C: using guessed type __int16 g_DefensePoison;
// 8019B50E: using guessed type __int16 g_DefenseBlackMagic;
// 8019B510: using guessed type __int16 g_DefenseFire;
// 8019B512: using guessed type __int16 g_DefenseEarth;
// 8019B514: using guessed type __int16 g_DefenseWind;
// 8019B516: using guessed type __int16 g_DefenseWater;

//----- (80022354) --------------------------------------------------------
BOOL __fastcall RenderOptionsList(_WORD *a1, _WORD *a2, _BYTE *a3)
{
  int v6; // $s4
  __int16 v7; // $s6
  __int16 v8; // $s7
  int *v9; // $a0
  BOOL result; // $v0

  v6 = 0;
  v7 = a1[1];
  v8 = a2[1];
  do
  {
    if ( *a3 == 1 )
    {
      sub_80023C94(dword_80067AC0, a1);
      DrawUiFrame(dword_80067AD8, a1);
      v9 = dword_80067ACC;
    }
    else
    {
      sub_80023C94(dword_80067AC0, a2);
      DrawUiFrame(dword_80067ACC, a1);
      v9 = dword_80067AD8;
    }
    DrawUiFrame(v9, a2);
    DrawUiText(g_GPU_TextBuffer, a1);
    DrawUiText(g_GPU_TextBuffer, a2);
    a1[1] += 26;
    ++v6;
    a2[1] += 26;
    result = v6 < 6;
    ++a3;
  }
  while ( v6 < 6 );
  a1[1] = v7;
  a2[1] = v8;
  return result;
}
// 80067AB4: using guessed type int g_GPU_TextBuffer[2];
// 80067AC0: using guessed type int dword_80067AC0[3];
// 80067ACC: using guessed type int dword_80067ACC[3];
// 80067AD8: using guessed type int dword_80067AD8[3];

//----- (80022468) --------------------------------------------------------
int __fastcall ShowEquipmentMenu(ListWidget *widget_ptr, int flags, int slot_id, unsigned __int8 start_idx)
{
  int v6; // $v0
  int v8; // $s1
  int v9; // $s2
  int *v10; // $v0
  int v11; // $a2
  int v12; // $a3
  int v13; // $t0
  int v14; // $a2
  int *v15; // $v0
  int v16; // $a0
  int v17; // $a1
  int v18; // $a2
  int v19; // $a0
  int v21; // $s3
  __int16 pad; // $v0
  int v23; // $gp
  int v24; // $s0
  __int16 v25[2]; // [sp+10h] [-38h] BYREF
  int v26; // [sp+14h] [-34h]
  int v27; // [sp+18h] [-30h]
  int v28; // [sp+1Ch] [-2Ch]
  int v29; // [sp+20h] [-28h]
  int v30; // [sp+24h] [-24h]
  int v31; // [sp+28h] [-20h]
  __int16 v32[2]; // [sp+2Ch] [-1Ch] BYREF
  int v33; // [sp+30h] [-18h]
  int v34; // [sp+34h] [-14h]
  int v35; // [sp+38h] [-10h]
  int v36; // [sp+3Ch] [-Ch]
  int v37; // [sp+40h] [-8h]
  int v38; // [sp+44h] [-4h]

  v6 = 1232 * *g_LanguageID[0].header;
  v25[0] = *&g_ZoneCameraTable[v6 * 2];
  v8 = 0;
  v25[1] = word_80067CEA[v6];
  v9 = -99;
  v32[0] = *&byte_80067D04[v6 * 2];
  v32[1] = word_80067D06[v6];
  v10 = &g_ZoneLightTable_Main[420 * *g_LanguageID[0].header];
  v11 = v10[1];
  v12 = v10[2];
  v13 = v10[3];
  v26 = *v10;
  v27 = v11;
  v28 = v12;
  v29 = v13;
  v14 = v10[5];
  v30 = v10[4];
  v31 = v14;
  v15 = &g_ZoneLightTable_Ambient[420 * *g_LanguageID[0].header];
  v16 = v15[1];
  v17 = v15[2];
  v18 = v15[3];
  v33 = *v15;
  v34 = v16;
  v35 = v17;
  v36 = v18;
  v19 = v15[5];
  v37 = v15[4];
  v38 = v19;
  while ( v9 == -99 )
  {
    v21 = 0;
    //    (  )
    WaitForInputStable();
    //      " "
    pad = ReadPadWithFlag();
    if ( (pad & PAD_UP) != 0 || (pad & PAD_DOWN) != 0 )// (0x1000 / 0x4000)   -  ?
    {
      *(v23 + 116) = 0;
      PlaySfx(SFX_MENU_MOVE);
      v8 = v8 == 0;
LABEL_12:
      v24 = 0;
      goto LABEL_13;
    }
    if ( (pad & PAD_CIRCLE) != 0 )
    {
      PlaySfx(SFX_MENU_SELECT);
      v21 = 1;
      v9 = -v8;
      goto LABEL_12;
    }
    if ( (pad & PAD_TRIANGLE) != 0 || (v24 = 0, (pad & PAD_START) != 0) )
    {
      PlaySfx(SFX_MENU_CANCEL);
      v9 = -1;
      goto LABEL_12;
    }
    do
    {
LABEL_13:
      ++v24;
      SwapGpuCommandBuffers();
      //  sub_80023388      SetLightMatrix
      // RotMatrix(dword_800763CC, v8);
      // SetColorMatrix(v21);
      // SetTransMatrix(v8);
      Update3dPreview(start_idx);
      RenderItemList(widget_ptr, slot_id);      //    FormatNumberForUI  . 
      ApplyViewTransforms(v25, v32, v8, v21);
      FlushGpuCommands();
    }
    while ( v24 < 2 );
  }
  WaitForButtonRelease();
  return v9;
}
// 80022674: variable 'v23' is possibly undefined
// 80067CEA: using guessed type __int16 word_80067CEA[];
// 80067D06: using guessed type __int16 word_80067D06[];
// 80069D70: using guessed type int g_ZoneLightTable_Main[6];
// 80069D88: using guessed type int g_ZoneLightTable_Ambient[6];

//----- (80022774) --------------------------------------------------------
int __fastcall RenderMenuFrame(int menuId, int itemCount, int cursorIndex, int isConfirmed)
{
  UiFrameStyle *style; // $s2
  int result; // $v0
  UiFrameStyle *v9; // $s1
  int i; // $s0
  ListItemStyle *GPU_Buffer; // $a0

  style = &g_UiStyleTable[0x58 * *g_LanguageID[0].header + 0xB * menuId];
  result = style->posX;
  v9 = style + 1;
  if ( style->posX )
  {
    DrawUiFrame(&g_GPU_FrameVisuals, style);
    result = DrawUiText(g_GPU_TextBuffer, style);
  }
  for ( i = 0; i < itemCount; ++v9 )
  {
    GPU_Buffer = &g_GPU_FrameVisuals;
    if ( i == cursorIndex && isConfirmed == 1 )
      GPU_Buffer = dword_80067AF0;
    DrawUiFrame(GPU_Buffer, v9);
    if ( i == cursorIndex )
      sub_80023AE8(dword_80067AC0, v9);
    DrawUiText(g_GPU_TextBuffer, v9);
    result = ++i < itemCount;
  }
  return result;
}
// 80067AB4: using guessed type int g_GPU_TextBuffer[2];
// 80067AC0: using guessed type int dword_80067AC0[3];
// 80067AF0: using guessed type int dword_80067AF0[3];

//----- (800228B4) --------------------------------------------------------
void __fastcall RenderItemList(int a1, int a2)
{
  int v3; // $s7
  int v4; // $s6
  int v5; // $s1
  int v6; // $s3
  int v8; // $v1
  int v9; // $s4
  char *v10; // $s6
  int *v11; // $s1
  unsigned __int8 *v12; // $s3
  char *v13; // $s7
  __int16 *p_width; // $a0
  int v15; // $v1
  char v16; // $v0
  unsigned int v17; // $v0
  __int16 *v18; // $a0
  int v19; // $v1
  char v20; // $v0
  int v21; // $a0
  int v22; // $a3
  int v23; // $a0
  bool v24; // dc
  int v25; // $a0
  int v26; // $a0
  int v27; // $a0
  int v28; // $a0
  int v29; // $a0
  int v30; // $s4
  int v31; // $gp
  int v32; // $a0
  __int16 v33; // $s3
  __int16 *v34; // $s1
  int *v35; // $s0
  int v36; // $gp
  int v37; // $a0
  int v38; // $gp
  int v39; // $a1
  int v40; // $a0
  unsigned int v41; // $v0
  UiFrameStyle v42[2]; // [sp+18h] [-38h] BYREF

  v3 = *(a1 + 36);
  v4 = *(a1 + 40);
  v5 = *(a1 + 48);
  v6 = *(a1 + 44);
  if ( *a1 )
  {
    DrawUiFrame(&g_GPU_FrameVisuals, a1);
    DrawUiText(g_GPU_TextBuffer, a1);
  }
  v8 = *(a1 + 32);
  v9 = 0;
  v10 = (v4 + 24 * v8);
  v11 = (v5 + 4 * v8);
  v12 = (v6 + v8);
  v13 = (v3 + v8 * *(a1 + 35));
  if ( *(a1 + 31) )
  {
    do
    {
      if ( v9 >= *(a1 + 30) )
        break;
      p_width = &v42[0].width;
      v42[0].posX = *(a1 + 28) + 5;
      v42[0].posY = *(a1 + 29) + 5 + 14 * v9;
      v15 = 0;
      if ( *(a1 + 35) )
      {
        do
        {
          v16 = *v13++;
          ++v15;
          *p_width = v16;
          p_width = (p_width + 1);
        }
        while ( v15 < *(a1 + 35) );
      }
      DrawUiText(g_GPU_TextBuffer, v42);
      v17 = a2 - 10;
      if ( a2 == 3 )
      {
        v18 = &v42[0].width;
        v19 = 0;
        v42[0].posX += 84;
        do
        {
          v20 = *v10++;
          ++v19;
          *v18 = v20;
          v18 = (v18 + 1);
        }
        while ( v19 < 24 );
        DrawUiText(g_GPU_TextBuffer, v42);
        v17 = -7;
      }
      if ( v17 < 6 && a2 != 12 )
      {
        v21 = *v11;
        v42[0].posX += 140;
        if ( a2 == 15 )
          v22 = 6;
        else
          v22 = 2;
        ++v11;
        FormatNumberForUI(v21, 6, 0, v22, &v42[0].width);
        sub_80023FD4(dword_80067AA8, v42);
      }
      if ( a2 == 2 || a2 == 4 )
      {
        v23 = *v11;
        v24 = *v11++ == -1;
        if ( !v24 )
        {
          v42[0].posX += 189;
          FormatNumberForUI(v23, 3, 0, 3, &v42[0].width);
          sub_80023FD4(dword_80067AA8, v42);
        }
      }
      if ( (a2 - 8) < 2 )
      {
        v25 = *v11;
        v24 = *v11++ == -1;
        if ( !v24 )
        {
          v42[0].posX += 98;
          FormatNumberForUI(v25, 7, 0, 4, &v42[0].width);
          sub_80023FD4(dword_80067AA8, v42);
        }
        v26 = *v12++;
        if ( v26 != 255 )
        {
          v42[0].posX += 91;
          FormatNumberForUI(v26, 3, 0, 5, &v42[0].width);
          sub_80023FD4(dword_80067AA8, v42);
        }
      }
      if ( (a2 - 2) >= 2 && a2 != 4 && (a2 - 8) >= 2 )
      {
        if ( a2 == 16 )
          goto LABEL_33;
        v27 = *v12++;
        if ( v27 != 255 )
        {
          v42[0].posX = *(a1 + 28) + 208;
          FormatNumberForUI(v27, 2, 0, 1, &v42[0].width);
          sub_80023FD4(dword_80067AA8, v42);
        }
      }
      if ( a2 == 16 )
      {
LABEL_33:
        v28 = *v12++;
        if ( v28 != 255 )
        {
          v42[0].posX += 203;
          FormatNumberForUI(v28, 2, 0, 1, &v42[0].width);
          sub_80023FD4(dword_80067AA8, v42);
        }
        v29 = *v11;
        v24 = *v11++ == -1;
        if ( !v24 )
        {
          v42[0].posX += 189;
          FormatNumberForUI(v29, 3, 0, 3, &v42[0].width);
          sub_80023FD4(dword_80067AA8, v42);
        }
      }
      ++v9;
    }
    while ( v9 < *(a1 + 31) );
  }
  v30 = 0;
  GPU_Cmd_SetupFlatGrayQuad();
  *(*(v31 + 240) + 4) = -1;
  *(*(v31 + 240) + 5) = -1;
  *(*(v31 + 240) + 6) = -1;
  v32 = *(v31 + 240);
  *(v32 + 22) = 30;
  *(v32 + 14) = 32676;
  *(v32 + 8) = *(a1 + 28);
  *(v32 + 10) = *(a1 + 29);
  *(v32 + 16) = *(a1 + 28) + 236;
  *(v32 + 18) = *(a1 + 29);
  *(v32 + 24) = *(a1 + 28);
  *(v32 + 26) = *(a1 + 29) + 6;
  *(v32 + 32) = *(a1 + 28) + 236;
  *(v32 + 34) = *(a1 + 29) + 6;
  *(v32 + 12) = 0;
  *(*(v31 + 240) + 13) = 64;
  *(*(v31 + 240) + 20) = -20;
  *(*(v31 + 240) + 21) = 64;
  *(*(v31 + 240) + 28) = 0;
  *(*(v31 + 240) + 29) = 70;
  *(*(v31 + 240) + 36) = -20;
  *(*(v31 + 240) + 37) = 70;
  GPU_Cmd_SetBlendFlag(*(v31 + 240), 1);
  GPU_Cmd_FinalizeAndAdvance(20);
  if ( *(a1 + 31) )
  {
    v33 = 0;
    do
    {
      v34 = &word_80067B12;
      v35 = dword_80067B08;
      if ( v30 == *(a1 + 34) )
      {
        v34 = &word_80067B2A;
        v35 = dword_80067B20;
      }
      ++v30;
      GPU_Cmd_SetupFlatGrayQuad();
      *(*(v36 + 240) + 4) = -1;
      *(*(v36 + 240) + 5) = -1;
      *(*(v36 + 240) + 6) = -1;
      v37 = *(v36 + 240);
      *(v37 + 22) = *v35;
      *(v37 + 14) = *(v34 - 4);
      *(v37 + 8) = *(a1 + 28);
      *(v37 + 10) = *(a1 + 29) + v33 + 5;
      *(v37 + 16) = *(a1 + 28) + *(v34 - 1);
      *(v37 + 18) = *(a1 + 29) + v33 + 5;
      *(v37 + 24) = *(a1 + 28);
      *(v37 + 26) = *(a1 + 29) + v33 + *v34 + 5;
      *(v37 + 32) = *(a1 + 28) + *(v34 - 1);
      *(v37 + 34) = *(a1 + 29) + v33 + *v34 + 5;
      *(v37 + 12) = *(v34 - 6);
      *(*(v36 + 240) + 13) = *(v34 - 4);
      *(*(v36 + 240) + 20) = *(v34 - 6) + *(v34 - 2);
      *(*(v36 + 240) + 21) = *(v34 - 4);
      *(*(v36 + 240) + 28) = *(v34 - 6);
      *(*(v36 + 240) + 29) = *(v34 - 4) + *v34;
      *(*(v36 + 240) + 36) = *(v34 - 6) + *(v34 - 2);
      *(*(v36 + 240) + 37) = *(v34 - 4) + *v34;
      GPU_Cmd_SetBlendFlag(*(v36 + 240), 1);
      GPU_Cmd_FinalizeAndAdvance(20);
      v33 += 14;
    }
    while ( v30 < *(a1 + 31) );
  }
  GPU_Cmd_SetupFlatGrayQuad();
  *(*(v38 + 240) + 4) = -1;
  *(*(v38 + 240) + 5) = -1;
  *(*(v38 + 240) + 6) = -1;
  v39 = *(v38 + 240);
  *(v39 + 22) = 30;
  *(v39 + 14) = 32676;
  *(v39 + 8) = *(a1 + 28);
  *(v39 + 10) = *(a1 + 29) + 14 * *(a1 + 31) + 5;
  *(v39 + 16) = *(a1 + 28) + 236;
  *(v39 + 18) = *(a1 + 29) + 14 * *(a1 + 31) + 5;
  *(v39 + 24) = *(a1 + 28);
  *(v39 + 26) = *(a1 + 29) + 14 * *(a1 + 31) + 11;
  *(v39 + 32) = *(a1 + 28) + 236;
  *(v39 + 34) = *(a1 + 29) + 14 * *(a1 + 31) + 11;
  *(v39 + 12) = 0;
  *(*(v38 + 240) + 13) = 104;
  *(*(v38 + 240) + 20) = -20;
  *(*(v38 + 240) + 21) = 104;
  *(*(v38 + 240) + 28) = 0;
  *(*(v38 + 240) + 29) = 110;
  *(*(v38 + 240) + 36) = -20;
  *(*(v38 + 240) + 37) = 110;
  GPU_Cmd_SetBlendFlag(*(v38 + 240), 1);
  GPU_Cmd_FinalizeAndAdvance(20);
  v40 = 1;
  if ( (a2 - 10) >= 2 && (a2 - 13) >= 2 )
  {
    v41 = a2 - 8;
    if ( a2 != 15 )
      goto LABEL_48;
    v40 = 3;
  }
  sub_800234CC(v40);
  v41 = a2 - 8;
LABEL_48:
  if ( v41 < 2 )
    nullsub_2();
}
// 80022C94: variable 'v31' is possibly undefined
// 80022E80: variable 'v36' is possibly undefined
// 80023014: variable 'v38' is possibly undefined
// 80067AA8: using guessed type int dword_80067AA8[3];
// 80067AB4: using guessed type int g_GPU_TextBuffer[2];
// 80067B08: using guessed type int dword_80067B08[2];
// 80067B12: using guessed type __int16 word_80067B12;
// 80067B20: using guessed type int dword_80067B20[2];
// 80067B2A: using guessed type __int16 word_80067B2A;

//----- (80023294) --------------------------------------------------------
int __fastcall ApplyViewTransforms(_WORD *a1, _WORD *a2, int a3, int a4)
{
  UiFrameStyle *v5; // $s2
  int *v8; // $a0
  int *v9; // $a0

  v5 = a2;
  if ( !a3 )
    a2 = a1;
  sub_80023AE8(dword_80067AC0, a2);
  if ( a4 != 1 )
  {
    v8 = dword_80067ACC;
    goto LABEL_8;
  }
  if ( !a3 )
  {
    v8 = dword_80067AD8;
LABEL_8:
    DrawUiFrame(v8, a1);
    v9 = dword_80067ACC;
    goto LABEL_9;
  }
  DrawUiFrame(dword_80067ACC, a1);
  v9 = dword_80067AD8;
LABEL_9:
  DrawUiFrame(v9, v5);
  DrawUiText(g_GPU_TextBuffer, a1);
  return DrawUiText(g_GPU_TextBuffer, v5);
}
// 80067AB4: using guessed type int g_GPU_TextBuffer[2];
// 80067AC0: using guessed type int dword_80067AC0[3];
// 80067ACC: using guessed type int dword_80067ACC[3];
// 80067AD8: using guessed type int dword_80067AD8[3];

//----- (80023388) --------------------------------------------------------
int __fastcall Update3dPreview(unsigned __int8 a1)
{
  __int16 *v1; // $gp
  int result; // $v0
  int v3; // $v0
  int v4; // $a2
  __int16 v5; // $v1
  __int16 v6; // $v1
  int v7; // $gp
  __int16 v8[10]; // [sp+10h] [-C0h] BYREF
  int v9; // [sp+24h] [-ACh]
  int v10; // [sp+28h] [-A8h]
  int v11; // [sp+2Ch] [-A4h]
  int v12; // [sp+70h] [-60h] BYREF
  __int16 v13; // [sp+74h] [-5Ch]
  __int16 v14; // [sp+76h] [-5Ah]
  __int16 v15; // [sp+78h] [-58h]
  __int16 v16; // [sp+7Ah] [-56h]
  __int16 v17; // [sp+7Ch] [-54h]
  __int16 v18; // [sp+7Eh] [-52h]
  __int16 v19; // [sp+80h] [-50h]
  int v20[8]; // [sp+90h] [-40h] BYREF
  __int16 v21[16]; // [sp+B0h] [-20h] BYREF

  result = g_Option_ShowPreviewItem3D;
  if ( g_Option_ShowPreviewItem3D )
  {
    result = 255;
    if ( a1 != 255 )
    {
      v3 = v1[130];
      v4 = v1[132];
      v10 = v1[131];
      v5 = v1[135];
      v9 = v3;
      LOWORD(v3) = v1[134];
      v11 = v4;
      LOWORD(v4) = v1[138];
      v1[134] = v3 & 0xFFF;
      LOWORD(v3) = v1[136];
      v6 = v5 + v4;
      v1[135] = v6;
      v1[135] = v6 & 0xFFF;
      v1[136] = v3 & 0xFFF;
      RotMatrix(dword_800763CC, v8);
      v12 = 0x8000800;
      v13 = -2048;
      v14 = 0;
      v15 = 0;
      v16 = -2048;
      v17 = 4096;
      v18 = 0;
      v19 = -2048;
      sub_800611CC(&v12, v8, v20);
      SetLightMatrix(v20);
      v21[0] = 4096;
      v21[1] = 4096;
      v21[2] = 4096;
      v21[3] = 4096;
      v21[4] = 4096;
      v21[5] = 4096;
      v21[6] = 4096;
      v21[7] = 4096;
      v21[8] = 4096;
      SetColorMatrix(v21);
      SetRotMatrix(v8);
      SetTransMatrix(v8);
      sub_80036428();
      result = *(g_GpuCmdBufferMirror + 8);
      *(v7 + 240) = result;
    }
  }
  return result;
}
// 800233B8: variable 'v1' is possibly undefined
// 800234B0: variable 'v7' is possibly undefined
// 8005E0F8: using guessed type int __fastcall SetRotMatrix(_DWORD);
// 8005E128: using guessed type int __fastcall SetLightMatrix(_DWORD);
// 8005E158: using guessed type int __fastcall SetColorMatrix(_DWORD);
// 8005F698: using guessed type int __fastcall RotMatrix(_DWORD, _DWORD);
// 800763CC: using guessed type int dword_800763CC[12];
// 80180158: using guessed type int g_GpuCmdBufferMirror;
// 8019B58F: using guessed type char g_Option_ShowPreviewItem3D;
// 80023388: using guessed type unsigned __int16 var_C0[10];
// 80023388: using guessed type int var_40[8];

//----- (800234CC) --------------------------------------------------------
int __fastcall sub_800234CC(int a1)
{
  int v2; // $a0
  int v3; // $a1
  int v4; // $a2
  int v5; // $a0
  int v6; // $a0
  int v7; // $a1
  int v8; // $a2
  int v9; // $a0
  int v10; // $a3
  int result; // $v0
  int v12; // $v0
  int v13; // $a2
  int v14; // $a3
  int v15; // $t0
  int v16; // $a2
  int v17; // $gp
  int v18; // $a0
  UiFrameStyle v19; // [sp+18h] [-40h] BYREF
  __int16 v20; // [sp+38h] [-20h] BYREF
  __int16 posY; // [sp+3Ah] [-1Eh]
  char v22[28]; // [sp+3Ch] [-1Ch] BYREF

  v19.posX = 183;
  v19.posY = 33;
  if ( a1 == 3 )
  {
    v2 = *&byte_80069EC4[1680 * *g_LanguageID[0].header];
    v3 = *&byte_80069EC8[1680 * *g_LanguageID[0].header];
    v4 = *&byte_80069ECC[1680 * *g_LanguageID[0].header];
    *&v19.width = *&byte_80069EC0[1680 * *g_LanguageID[0].header];
    *&v19.colorBase = v2;
    *&v19.refX = v3;
    *v19.extra = v4;
    v5 = *&byte_80069ED4[1680 * *g_LanguageID[0].header];
    *&v19.extra[4] = *&byte_80069ED0[1680 * *g_LanguageID[0].header];
  }
  else
  {
    v6 = *&byte_80069AA4[1680 * *g_LanguageID[0].header];
    v7 = *&byte_80069AA8[1680 * *g_LanguageID[0].header];
    v8 = *&byte_80069AAC[1680 * *g_LanguageID[0].header];
    *&v19.width = *&byte_80069AA0[1680 * *g_LanguageID[0].header];
    *&v19.colorBase = v6;
    *&v19.refX = v7;
    *v19.extra = v8;
    v5 = *&byte_80069AB4[1680 * *g_LanguageID[0].header];
    *&v19.extra[4] = *&byte_80069AB0[1680 * *g_LanguageID[0].header];
  }
  *&v19.extra[8] = v5;
  DrawUiFrame(&g_GPU_FrameVisuals, &v19);
  DrawUiText(g_GPU_TextBuffer, &v19);
  v20 = v19.posX + 56;
  posY = v19.posY;
  if ( a1 == 3 )
  {
    v9 = byte_8009DED0;
    v10 = 6;
  }
  else
  {
    v10 = 2;
    v9 = g_PlayerGold;
  }
  FormatNumberForUI(v9, 7, 0, v10, v22);
  sub_80023FD4(dword_80067AA8, &v20);
  result = 2;
  if ( a1 != 2 )
  {
    v19.posX = 183;
    v19.posY = 61;
    v12 = 1680 * *g_LanguageID[0].header;
    v13 = *&byte_80069EDC[v12];
    v14 = *&byte_80069EE0[v12];
    v15 = *&byte_80069EE4[v12];
    *&v19.width = *&byte_80069ED8[v12];
    *&v19.colorBase = v13;
    *&v19.refX = v14;
    *v19.extra = v15;
    v16 = *&byte_80069EEC[v12];
    *&v19.extra[4] = *&byte_80069EE8[v12];
    *&v19.extra[8] = v16;
    DrawUiFrame(&g_GPU_FrameVisuals, &v19);
    DrawUiText(g_GPU_TextBuffer, &v19);
    v18 = *(v17 + 108);
    v20 = v19.posX + 91;
    posY = v19.posY;
    FormatNumberForUI(v18, 2, 0, 1, v22);
    return sub_80023FD4(dword_80067AA8, &v20);
  }
  return result;
}
// 800238F8: variable 'v17' is possibly undefined
// 80067AA8: using guessed type int dword_80067AA8[3];
// 80067AB4: using guessed type int g_GPU_TextBuffer[2];
// 8009DED0: using guessed type char byte_8009DED0;
// 8019B4F0: using guessed type int g_PlayerGold;

//----- (80023944) --------------------------------------------------------
int __fastcall DrawUiFrame(ListItemStyle *visuals, UiFrameStyle *style)
{
  GpuContext *ctx; // $gp
  GpuCommandHeader *gpu_cmd; // $a0

  GPU_Cmd_SetupFlatGrayQuad();
  ctx->gpu_cmd->r = -1;
  ctx->gpu_cmd->g = -1;
  ctx->gpu_cmd->b = -1;
  gpu_cmd = ctx->gpu_cmd;
  *&gpu_cmd[2].b = visuals->refX;
  *&gpu_cmd[1].b = visuals->refY;
  gpu_cmd[1].x = style->posX - 6;
  gpu_cmd[1].y = style->posY - 6;
  gpu_cmd[2].x = style->posX + visuals->width - 6;
  gpu_cmd[2].y = style->posY - 6;
  gpu_cmd[3].x = style->posX - 6;
  gpu_cmd[3].y = style->posY + visuals->height - 6;
  gpu_cmd[4].x = style->posX + visuals->width - 6;
  gpu_cmd[4].y = style->posY + visuals->height - 6;
  gpu_cmd[1].r = visuals->ColorBase;
  ctx->gpu_cmd[1].g = visuals->ColorAlt;
  ctx->gpu_cmd[2].r = LOBYTE(visuals->ColorBase) + LOBYTE(visuals->width);
  ctx->gpu_cmd[2].g = visuals->ColorAlt;
  ctx->gpu_cmd[3].r = visuals->ColorBase;
  ctx->gpu_cmd[3].g = LOBYTE(visuals->ColorAlt) + LOBYTE(visuals->height);
  ctx->gpu_cmd[4].r = LOBYTE(visuals->ColorBase) + LOBYTE(visuals->width);
  ctx->gpu_cmd[4].g = LOBYTE(visuals->ColorAlt) + LOBYTE(visuals->height);
  GPU_Cmd_SetBlendFlag(ctx->gpu_cmd, 1);
  return GPU_Cmd_FinalizeAndAdvance(20);
}
// 80023960: variable 'ctx' is possibly undefined

//----- (80023AE8) --------------------------------------------------------
int __fastcall sub_80023AE8(int a1, _WORD *a2)
{
  int v2; // $gp
  int v3; // $s2
  int v6; // $gp
  int v7; // $a0

  v3 = *(v2 + 112);
  GPU_Cmd_SetupFlatGrayQuad();
  *(*(v6 + 240) + 4) = 64;
  *(*(v6 + 240) + 5) = 64;
  *(*(v6 + 240) + 6) = 64;
  v7 = *(v6 + 240);
  *(v7 + 22) = *a1;
  *(v7 + 14) = ((v3 + 500) << 6) + 36;
  *(v7 + 8) = *a2 - 8 - *(a1 + 8);
  *(v7 + 10) = a2[1];
  *(v7 + 16) = *a2 - 8;
  *(v7 + 18) = a2[1];
  *(v7 + 24) = *a2 - 8 - *(a1 + 8);
  *(v7 + 26) = a2[1] + *(a1 + 10);
  *(v7 + 32) = *a2 - 8;
  *(v7 + 34) = a2[1] + *(a1 + 10);
  LOBYTE(v3) = 16 * v3;
  *(v7 + 12) = *(a1 + 4) + v3;
  *(*(v6 + 240) + 13) = *(a1 + 6);
  *(*(v6 + 240) + 20) = *(a1 + 4) + v3 + *(a1 + 8);
  *(*(v6 + 240) + 21) = *(a1 + 6);
  *(*(v6 + 240) + 28) = *(a1 + 4) + v3;
  *(*(v6 + 240) + 29) = *(a1 + 6) + *(a1 + 10);
  *(*(v6 + 240) + 36) = *(a1 + 4) + v3 + *(a1 + 8);
  *(*(v6 + 240) + 37) = *(a1 + 6) + *(a1 + 10);
  return GPU_Cmd_FinalizeAndAdvance(20);
}
// 80023AF0: variable 'v2' is possibly undefined
// 80023B0C: variable 'v6' is possibly undefined

//----- (80023C94) --------------------------------------------------------
int __fastcall sub_80023C94(int a1, _WORD *a2)
{
  int v4; // $gp
  int v5; // $a0

  GPU_Cmd_SetupFlatGrayQuad();
  *(*(v4 + 240) + 4) = 56;
  *(*(v4 + 240) + 5) = 56;
  *(*(v4 + 240) + 6) = 56;
  v5 = *(v4 + 240);
  *(v5 + 22) = *a1;
  *(v5 + 14) = 32036;
  *(v5 + 8) = *a2 - 7 - *(a1 + 8);
  *(v5 + 10) = a2[1];
  *(v5 + 16) = *a2 - 7;
  *(v5 + 18) = a2[1];
  *(v5 + 24) = *a2 - 7 - *(a1 + 8);
  *(v5 + 26) = a2[1] + *(a1 + 10);
  *(v5 + 32) = *a2 - 7;
  *(v5 + 34) = a2[1] + *(a1 + 10);
  *(v5 + 12) = *(a1 + 4);
  *(*(v4 + 240) + 13) = *(a1 + 6);
  *(*(v4 + 240) + 20) = *(a1 + 4) + *(a1 + 8);
  *(*(v4 + 240) + 21) = *(a1 + 6);
  *(*(v4 + 240) + 28) = *(a1 + 4);
  *(*(v4 + 240) + 29) = *(a1 + 6) + *(a1 + 10);
  *(*(v4 + 240) + 36) = *(a1 + 4) + *(a1 + 8);
  *(*(v4 + 240) + 37) = *(a1 + 6) + *(a1 + 10);
  return GPU_Cmd_FinalizeAndAdvance(20);
}
// 80023CB0: variable 'v4' is possibly undefined

//----- (80023E20) --------------------------------------------------------
int __fastcall DrawUiText(_WORD *a1, UiFrameStyle *a2)
{
  __int16 *p_width; // $s3
  int result; // $v0
  int v6; // $s4
  int v7; // $s2
  int v8; // $gp
  GpuCmd_TexturedQuad *v9; // $a1
  char v10; // $a0
  int v11; // $v0

  p_width = &a2->width;
  result = 255;
  v6 = 0;
  // v4 =     ( 0xFF)
  if ( LOBYTE(a2->width) != 255 )
  {
    v7 = 0;
    result = 1;
    do
    {
      if ( !result )
        break;
      ++v6;
      GPU_Cmd_SetupFlatGrayQuad();
      v9 = *(v8 + 240);
      v9->word16 = *a1;
      v9->wordE = a1[1];
      v9->word8 = a2->posX + v7;
      v9->wordA = a2->posY;
      v9->word10 = a2->posX + v7 + a1[4];
      v9->word12 = a2->posY;
      v9->word18 = a2->posX + v7;
      v9->word1A = a2->posY + a1[5];
      v9->word20 = a2->posX + v7 + a1[4];
      v9->word22 = a2->posY + a1[5];
      v10 = 8 * (*p_width & 0xF);               // U  : 0, 8, 16... (8px )
      v11 = (*p_width & 0x7F) >> 4;             //   : 0-7 (  )
      v9->byteC = v10;                          // U1
      *(*(v8 + 240) + 13) = 15 * v11;           // V1 (15px  )
      *(*(v8 + 240) + 20) = v10 + *(a1 + 8);
      v7 += 7;                                  // +7px  X ( )
      *(*(v8 + 240) + 21) = 15 * v11;
      p_width = (p_width + 1);                  //    
      *(*(v8 + 240) + 28) = v10;
      *(*(v8 + 240) + 29) = 15 * v11 + *(a1 + 10);
      *(*(v8 + 240) + 36) = v10 + *(a1 + 8);
      *(*(v8 + 240) + 37) = 15 * v11 + *(a1 + 10);
      GPU_Cmd_FinalizeAndAdvance(10);
      result = v6 < 24;
    }
    while ( *p_width != 255 );                  //    
  }
  return result;
}
// 80023E70: variable 'v8' is possibly undefined

//----- (80023FD4) --------------------------------------------------------
int __fastcall sub_80023FD4(int a1, int a2)
{
  _BYTE *v4; // $s1
  int result; // $v0
  int v6; // $s4
  __int16 v7; // $s3
  int v8; // $gp
  int v9; // $a0

  v4 = (a2 + 4);
  result = 255;
  v6 = 0;
  if ( *(a2 + 4) != 255 )
  {
    v7 = 0;
    do
    {
      result = v6 < 24;
      if ( v6 >= 24 )
        break;
      GPU_Cmd_SetupFlatGrayQuad();
      v9 = *(v8 + 240);
      *(v9 + 22) = *a1;
      *(v9 + 14) = *(a1 + 2);
      *(v9 + 8) = *a2 + v7;
      *(v9 + 10) = *(a2 + 2);
      *(v9 + 16) = *a2 + v7 + *(a1 + 8);
      *(v9 + 18) = *(a2 + 2);
      *(v9 + 24) = *a2 + v7;
      *(v9 + 26) = *(a2 + 2) + *(a1 + 10);
      *(v9 + 32) = *a2 + v7 + *(a1 + 8);
      *(v9 + 34) = *(a2 + 2) + *(a1 + 10);
      if ( *v4 >= 0xBu )
      {
        *(v9 + 12) = *(a1 + 4) + 7;
        *(*(v8 + 240) + 13) = 15 * (*v4 - 11);
        *(*(v8 + 240) + 20) = *(a1 + 4) + 7 + *(a1 + 8);
        *(*(v8 + 240) + 21) = 15 * (*v4 - 11);
        *(*(v8 + 240) + 28) = *(a1 + 4) + 7;
        *(*(v8 + 240) + 29) = 15 * (*v4 - 11) + *(a1 + 10);
        *(*(v8 + 240) + 36) = *(a1 + 4) + 7 + *(a1 + 8);
        *(*(v8 + 240) + 37) = 15 * (*v4 - 11) + *(a1 + 10);
      }
      else
      {
        *(v9 + 12) = *(a1 + 4);
        *(*(v8 + 240) + 13) = 15 * *v4;
        *(*(v8 + 240) + 20) = *(a1 + 4) + *(a1 + 8);
        *(*(v8 + 240) + 21) = 15 * *v4;
        *(*(v8 + 240) + 28) = *(a1 + 4);
        *(*(v8 + 240) + 29) = 15 * *v4 + *(a1 + 10);
        *(*(v8 + 240) + 36) = *(a1 + 4) + *(a1 + 8);
        *(*(v8 + 240) + 37) = 15 * *v4 + *(a1 + 10);
      }
      GPU_Cmd_FinalizeAndAdvance(10);
      ++v4;
      v7 += 7;
      result = 255;
      ++v6;
    }
    while ( *v4 != 255 );
  }
  return result;
}
// 80024024: variable 'v8' is possibly undefined

//----- (80024298) --------------------------------------------------------
BOOL __fastcall DrawTexturedQuad(int a1, int a2, int a3, int a4, __int16 a5, __int16 a6)
{
  int v6; // $s7
  int *v7; // $s0
  int v9; // $s6
  __int16 v10; // $fp
  int v11; // $s2
  int v12; // $s3
  int v13; // $s5
  __int16 v14; // $s1
  int v15; // $gp
  int v16; // $gp
  int v17; // $v1
  __int16 v18; // $a1
  BOOL result; // $v0
  int v21; // [sp+18h] [-10h]
  int v22; // [sp+20h] [-8h]

  v6 = 9;
  v7 = dword_80067B2C;
  v9 = 0;
  v21 = a3 - 94;
  v22 = a4 - 94;
  do
  {
    v10 = *(v7 + 5);
    if ( v9 == 1 )
    {
      a2 += 33;
      v10 += v22 + a6;
    }
    else if ( v9 == 2 )
    {
      a2 += 28 + v22;
    }
    v11 = a1;
    v12 = 0;
    v13 = 3 * v6;
    do
    {
      v14 = *(v7 + 4);
      if ( v12 == 1 )
      {
        v11 += 33;
        v14 += v21 + a5;
      }
      else if ( v12 == 2 )
      {
        v11 += 28 + v21;
      }
      v13 += 3;
      GPU_Cmd_SetupFlatGrayQuad();
      *(*(v15 + 240) + 4) = -1;
      *(*(v15 + 240) + 5) = -1;
      *(*(v15 + 240) + 6) = -1;
      GPU_Cmd_SetBlendFlag(*(v15 + 240), 1);
      v17 = *(v16 + 240);
      *(v17 + 22) = *v7;
      v18 = *(v7 + 1);
      *(v17 + 8) = v11;
      *(v17 + 10) = a2;
      *(v17 + 16) = v11 + v14;
      *(v17 + 18) = a2;
      *(v17 + 24) = v11;
      *(v17 + 26) = a2 + v10;
      *(v17 + 32) = v11 + v14;
      *(v17 + 34) = a2 + v10;
      *(v17 + 14) = v18;
      *(v17 + 12) = *(v7 + 4);
      ++v6;
      *(*(v16 + 240) + 13) = *(v7 + 6);
      *(*(v16 + 240) + 20) = *(v7 + 4) + *(v7 + 8);
      ++v12;
      *(*(v16 + 240) + 21) = *(v7 + 6);
      *(*(v16 + 240) + 28) = *(v7 + 4);
      *(*(v16 + 240) + 29) = *(v7 + 6) + *(v7 + 10);
      *(*(v16 + 240) + 36) = *(v7 + 4) + *(v7 + 8);
      *(*(v16 + 240) + 37) = *(v7 + 6) + *(v7 + 10);
      GPU_Cmd_FinalizeAndAdvance(20);
      v7 = &dword_80067AC0[v13];
    }
    while ( v12 < 3 );
    result = ++v9 < 3;
  }
  while ( v9 < 3 );
  return result;
}
// 80024380: variable 'v15' is possibly undefined
// 800243B0: variable 'v16' is possibly undefined
// 80067AC0: using guessed type int dword_80067AC0[3];
// 80067B2C: using guessed type int dword_80067B2C[27];

//----- (800244D8) --------------------------------------------------------
void nullsub_2()
{
  ;
}

//----- (800244E0) --------------------------------------------------------
int SwapGpuCommandBuffers()
{
  int v0; // $gp
  int v1; // $v1
  int v2; // $v0
  int result; // $v0

  byte_80180138 = byte_80180138 == 0;
  g_GpuCmdBufferMirror = &dword_80180140[3 * byte_80180138];
  g_GpuCommandBuffer = &dword_8018015C[0x2000 * byte_80180138];
  sub_8006353C(&dword_8018015C[0x2000 * byte_80180138], 0x2000);
  *(g_GpuCmdBufferMirror + 8) = *g_GpuCmdBufferMirror;
  *(v0 + 240) = *(g_GpuCmdBufferMirror + 8);
  if ( byte_80180138 == 1 )
  {
    *(v0 + 252) = 0;
    *(v0 + 254) = 240;
  }
  else
  {
    *(v0 + 252) = 0;
    *(v0 + 254) = 0;
  }
  v1 = *(v0 + 116);
  if ( v1 )
  {
    if ( v1 != 1 )
      goto LABEL_9;
    v2 = *(v0 + 112) - 1;
  }
  else
  {
    v2 = *(v0 + 112) + 1;
  }
  *(v0 + 112) = v2;
LABEL_9:
  if ( *(v0 + 112) >= 8 )
  {
    *(v0 + 112) = 7;
    *(v0 + 116) = 1;
  }
  result = -1;
  if ( *(v0 + 112) < 0 )
  {
    *(v0 + 112) = 0;
    *(v0 + 116) = -1;
  }
  return result;
}
// 80024570: variable 'v0' is possibly undefined
// 80180138: using guessed type char byte_80180138;
// 80180140: using guessed type int dword_80180140[];
// 80180158: using guessed type int g_GpuCmdBufferMirror;
// 8018015C: using guessed type unsigned int dword_8018015C[16384];
// 8019015C: using guessed type int g_GpuCommandBuffer;

//----- (80024620) --------------------------------------------------------
int FlushGpuCommands()
{
  int v0; // $gp

  WaitForDmaComplete(0);
  VSync(0);
  sub_800637A4(&unk_80190218 + 20 * byte_80180138);
  sub_800636A8(&unk_80190160 + 23 * byte_80180138);
  SubmitCdDmaTransfer(g_MenuDrawEnv, *(v0 + 248));
  return QueueGpuDmaTransfer(g_GpuCommandBuffer + 32764);
}
// 80024694: variable 'v0' is possibly undefined
// 800763BC: using guessed type int g_MenuDrawEnv[4];
// 80180138: using guessed type char byte_80180138;
// 8019015C: using guessed type int g_GpuCommandBuffer;

//----- (800246CC) --------------------------------------------------------
// write access to const memory has been detected, the output may be wrong!
int SetupMenuUIBuffers()
{
  int v0; // $gp
  int v1; // $v1
  int v2; // $a1
  int v3; // $gp
  int result; // $v0

  sub_80037184();
  byte_80190178 = 0;
  byte_80190177 = 0;
  byte_801901D4 = 0;
  byte_801901D3 = 0;
  dword_80076478 = dword_80180140[0];
  dword_8007647C = dword_80180144;
  dword_80076480 = dword_80180148;
  dword_80076484 = dword_8018014C;
  dword_80076488 = dword_80180150;
  dword_8007648C = dword_80180154;
  dword_80180144 = dword_80180140[0] + 25600;
  dword_8018014C = dword_80180140[0] + 25600;
  v1 = byte_80180138;
  dword_80180150 = dword_80180140[0] + 51200;
  *(v0 + 248) = dword_80180140[0] + 51200;
  *(v0 + 252) = 0;
  if ( v1 == 1 )
    *(v0 + 254) = 240;
  else
    *(v0 + 254) = 0;
  v2 = *(v0 + 248);
  *(v0 + 256) = 320;
  *(v0 + 258) = 240;
  GPU_SetTransferRect(g_MenuDrawEnv, v2);
  WaitForDmaComplete(0);
  *(v3 + 244) = g_Option_Music;
  result = 1;
  if ( g_Option_Music == 1 )
  {
    result = g_IsAudioPlaying;
    if ( g_IsAudioPlaying == 1 )
      return PlayTrack(g_MenuTrackID);
  }
  return result;
}
// 80024718: write access to const memory at 80076478 has been detected
// 8002471C: write access to const memory at 8007647C has been detected
// 80024720: write access to const memory at 80076480 has been detected
// 80024744: write access to const memory at 80076484 has been detected
// 80024748: write access to const memory at 80076488 has been detected
// 8002474C: write access to const memory at 8007648C has been detected
// 80024774: variable 'v0' is possibly undefined
// 800247D8: variable 'v3' is possibly undefined
// 800763BC: using guessed type int g_MenuDrawEnv[4];
// 80076478: using guessed type int dword_80076478;
// 8007647C: using guessed type int dword_8007647C;
// 80076480: using guessed type int dword_80076480;
// 80076484: using guessed type int dword_80076484;
// 80076488: using guessed type int dword_80076488;
// 8007648C: using guessed type int dword_8007648C;
// 80180138: using guessed type char byte_80180138;
// 80180140: using guessed type int dword_80180140[];
// 80180144: using guessed type int dword_80180144;
// 80180148: using guessed type int dword_80180148;
// 8018014C: using guessed type int dword_8018014C;
// 80180150: using guessed type int dword_80180150;
// 80180154: using guessed type int dword_80180154;
// 80190177: using guessed type char byte_80190177;
// 80190178: using guessed type char byte_80190178;
// 801901D3: using guessed type char byte_801901D3;
// 801901D4: using guessed type char byte_801901D4;
// 8019A62C: using guessed type __int16 g_MenuTrackID;
// 8019A630: using guessed type int g_IsAudioPlaying;
// 8019B58C: using guessed type char g_Option_Music;

//----- (80024820) --------------------------------------------------------
int __fastcall Music_UpdateState(int a1)
{
  int v1; // $gp
  int result; // $v0

  dword_80180140[0] = 0;
  dword_80180144 = 0;
  dword_80180148 = 0;
  dword_8018014C = 0;
  dword_80180150 = 0;
  dword_80180154 = 0;
  byte_80190178 = 1;
  byte_80190177 = 1;
  byte_801901D4 = 1;
  byte_801901D3 = 1;
  if ( a1 == 1 )
    return Music_Stop();
  result = *(v1 + 244);
  if ( g_Option_Music == result )
  {
    if ( g_Option_Music == 1 )
    {
      result = g_IsAudioPlaying;
      if ( g_IsAudioPlaying == g_Option_Music )
        return Music_PlayTrack(g_MenuTrackID);
    }
  }
  else
  {
    if ( !g_Option_Music )
      return Music_Stop();
    return Music_PlaySEQ();
  }
  return result;
}
// 800248B8: variable 'v1' is possibly undefined
// 80076478: using guessed type int dword_80076478;
// 8007647C: using guessed type int dword_8007647C;
// 80076480: using guessed type int dword_80076480;
// 80076484: using guessed type int dword_80076484;
// 80076488: using guessed type int dword_80076488;
// 8007648C: using guessed type int dword_8007648C;
// 80180140: using guessed type int dword_80180140[];
// 80180144: using guessed type int dword_80180144;
// 80180148: using guessed type int dword_80180148;
// 8018014C: using guessed type int dword_8018014C;
// 80180150: using guessed type int dword_80180150;
// 80180154: using guessed type int dword_80180154;
// 80190177: using guessed type char byte_80190177;
// 80190178: using guessed type char byte_80190178;
// 801901D3: using guessed type char byte_801901D3;
// 801901D4: using guessed type char byte_801901D4;
// 8019A62C: using guessed type __int16 g_MenuTrackID;
// 8019A630: using guessed type int g_IsAudioPlaying;
// 8019B58C: using guessed type char g_Option_Music;

//----- (8002492C) --------------------------------------------------------
int GPU_Cmd_SetupFlatGrayQuad()
{
  int v0; // $gp
  int v1; // $gp
  int result; // $v0

  GPU_Cmd_SetBaseParams(*(v0 + 0xF0));
  *(*(v1 + 0xF0) + 4) = 0x68;
  *(*(v1 + 0xF0) + 5) = 0x68;
  result = *(v1 + 0xF0);
  *(result + 6) = 0x68;
  return result;
}
// 8002492C: variable 'v0' is possibly undefined
// 80024940: variable 'v1' is possibly undefined

//----- (80024974) --------------------------------------------------------
int __fastcall GPU_Cmd_FinalizeAndAdvance(int a1)
{
  int v1; // $gp
  int v2; // $gp
  int v3; // $v1
  int result; // $v0

  GPU_Cmd_MergeParams((4 * a1 + g_GpuCommandBuffer), *(v1 + 240));
  v3 = g_GpuCmdBufferMirror;
  result = *(v2 + 240) + 40;
  *(v2 + 240) = result;
  *(v3 + 8) = result;
  return result;
}
// 80024980: variable 'v1' is possibly undefined
// 80024994: variable 'v2' is possibly undefined
// 80180158: using guessed type int g_GpuCmdBufferMirror;
// 8019015C: using guessed type int g_GpuCommandBuffer;

//----- (800249BC) --------------------------------------------------------
int __fastcall InitListWidget(ListWidget *widget_ptr, int menu_type, int style_id)
{
  char *frame_style; // $t1
  int v4; // $t0
  __int16 *p_width; // $v1
  char v6; // $v0
  int result; // $v0

  frame_style = widget_ptr->frame_style;
  widget_ptr->pos_x = 17;
  v4 = 0;
  widget_ptr->pos_y = 19;
  p_width = &g_UiStyleTable[88 * *g_LanguageID[0].header + 1 + 11 * menu_type + style_id].width;
  do
  {
    v6 = *p_width;
    p_width = (p_width + 1);
    ++v4;
    *frame_style++ = v6;
  }
  while ( v4 < 24 );
  widget_ptr->total_items = 42;
  widget_ptr->selected_idx = -97;
  widget_ptr->scroll_offset = 4;
  result = 20;
  widget_ptr->visible_count = 0;
  widget_ptr->cursor_idx = 0;
  widget_ptr->viewport_top = 0;
  widget_ptr->viewport_flags = 0;
  widget_ptr->viewport_bottom = 20;
  return result;
}

//----- (80024A8C) --------------------------------------------------------
int __fastcall ListNavigating(unsigned __int8 *a1, unsigned __int8 a2)
{
  int result; // $v0
  unsigned int v4; // $a0
  unsigned int v5; // $v1
  unsigned __int8 v6; // $v1

  result = a1[30];
  if ( a1[30] )
  {
    if ( result - 1 < a2 )
      a2 = a1[30] - 1;
    v4 = a1[30];
    a1[33] = a2;
    v5 = a1[31];
    result = v4 < v5;
    if ( (v4 - a1[33]) >= v5 )
    {
      a1[32] = a2;
      a1[34] = 0;
    }
    else if ( v4 >= v5 )
    {
      result = a1[30] - a1[31];
      v6 = a1[33] - result;
      a1[32] = result;
      a1[34] = v6;
    }
    else
    {
      result = a1[33];
      a1[32] = 0;
      a1[34] = result;
    }
  }
  return result;
}

//----- (80024B24) --------------------------------------------------------
int __fastcall FormatNumberForUI(int stat, int a2, int a3, int a4, _BYTE *a5)
{
  int v5; // $t0
  int v6; // $a2
  _BYTE *v7; // $v1
  int result; // $v0
  int v9; // $t0
  _BYTE *v10; // $a1
  int v11; // $hi
  char v12; // $v0

  v5 = 0;
  if ( (a4 - 1) < 2 || a4 == 6 )
  {
    ++a2;
  }
  else
  {
    v5 = 0;
    if ( a4 == 3 || a4 == 5 )
    {
      a2 += 2;
    }
    else
    {
      v5 = 0;
      if ( a4 == 4 )
        a2 += 3;
    }
  }
  v6 = a3 == 0 ? 0xA : 0;
  if ( a2 > 0 )
  {
    v7 = a5;
    do
    {
      *v7 = v6;
      ++v5;
      ++v7;
    }
    while ( v5 < a2 );
  }
  a5[a2] = -1;
  if ( a4 != 1 )
  {
    switch ( a4 )
    {
      case 2:
        result = 13;
        break;
      case 3:
        *a5 = 15;
        result = 16;
        a5[1] = 16;
        goto LABEL_25;
      case 4:
        *a5 = 12;
        a5[1] = 18;
        result = 16;
        a5[2] = 16;
        goto LABEL_25;
      default:
        result = 6;
        if ( a4 == 5 )
        {
          *a5 = 14;
          result = 17;
          a5[1] = 17;
          goto LABEL_25;
        }
        v9 = a2 - 1;
        if ( a4 != 6 )
          goto LABEL_26;
        result = 11;
        break;
    }
    a5[--a2] = result;
    goto LABEL_25;
  }
  result = 19;
  *a5 = 19;
LABEL_25:
  v9 = a2 - 1;
LABEL_26:
  if ( v9 >= 0 )
  {
    v10 = &a5[v9];
    v11 = (1717986919LL * stat) >> 32;          //   10 ( PS1)
    do
    {
      v12 = stat - 10 * ((v11 >> 2) - (stat >> 31));//  (0-9)
      stat = (v11 >> 2) - (stat >> 31);         //  
      *v10 = v12;                               //   ASCII
      if ( !stat )
        v10 = a5 - 1;
      result = --v10 < a5;
      v11 = (1717986919LL * stat) >> 32;
    }
    while ( v10 >= a5 );
  }
  return result;
}

//----- (80024CAC) --------------------------------------------------------
int __fastcall Draw3dPreview(unsigned __int8 item_id)
{
  int v1; // $gp
  int v2; // $v0
  int result; // $v0
  int v5; // $gp
  int v6; // $v0
  int *Memory; // $v0
  unsigned __int16 v8; // $a1
  int model_ptr; // $s0

  v2 = g_Option_ShowPreviewItem3D;
  *(v1 + 108) = 1;
  if ( !v2 )
    return 0;
  Flush3dRender();
  if ( item_id != 255 )
  {
    v6 = ReadFromFile(6u, item_id, 0);
    Memory = AllocateMemory(v6);
    v8 = item_id;
    model_ptr = Memory;
    ExtractFileSections(6u, v8, Memory);
    RegisterAndTransformModel(3u, model_ptr);
    *(v5 + 100) = 1;
  }
  result = 0;
  *(v5 + 264) = 1000;
  *(v5 + 260) = 0;
  *(v5 + 262) = 0;
  *(v5 + 268) = 0;
  *(v5 + 270) = 0;
  *(v5 + 272) = 0;
  *(v5 + 276) = 4;
  return result;
}
// 80024CC8: variable 'v1' is possibly undefined
// 80024D2C: variable 'v5' is possibly undefined
// 8019B58F: using guessed type char g_Option_ShowPreviewItem3D;

//----- (80024D70) --------------------------------------------------------
int Flush3dRender()
{
  int v0; // $gp
  int result; // $v0
  int v2; // $gp

  result = 1;
  if ( *(v0 + 100) == 1 )                       // _RenderState.is_rendering == 1
  {
    result = PadChkVsync(dword_8019024C);
    *(v2 + 100) = 0;                            // g_RenderState.is_rendering = 0;
  }
  return result;
}
// 80024D74: variable 'v0' is possibly undefined
// 80024D94: variable 'v2' is possibly undefined
// 8019024C: using guessed type int dword_8019024C;

//----- (80024DA8) --------------------------------------------------------
int __fastcall PlaySfx(int a1)
{
  int result; // $v0

  if ( a1 == 16 )
  {
    a1 = 16;
LABEL_4:
    PlayAudioStream(a1, 48, 48, 0);
    return sub_8005C7F8();
  }
  result = 13;
  if ( (a1 - 17) < 2 )
    goto LABEL_4;
  if ( a1 == 13 )
  {
    PlayAudioStream(13, 0, 58, 0);
    VSync(0);
    VSync(0);
    return PlayAudioStream(13, 58, 0, 0);
  }
  return result;
}

//----- (80024E3C) --------------------------------------------------------
int ReadPadWithFlag()
{
  int v0; // $v1
  int v1; // $gp

  v0 = PadRead();
  if ( v0 )
    *(v1 + 0x68) = 1;
  return v0;
}
// 80024E58: variable 'v1' is possibly undefined

//----- (80024E70) --------------------------------------------------------
BOOL WaitForInputStable()
{
  int v0; // $gp
  int v1; // $s0
  BOOL result; // $v0
  bool v3; // dc
  int v4; // $gp

  v1 = 0;
  result = 1;
  if ( *(v0 + 104) == 1 )
  {
    *(v0 + 104) = 0;
    while ( 1 )
    {
      v3 = PadRead() == 0;
      result = v1;
      if ( v3 )
        break;
      result = v1++ < 6;
      if ( !result )
      {
        *(v4 + 112) = 0;
        return result;
      }
      VSync(0);
    }
  }
  return result;
}
// 80024E7C: variable 'v0' is possibly undefined
// 80024EBC: variable 'v4' is possibly undefined

//----- (80024ED4) --------------------------------------------------------
int WaitForButtonRelease()
{
  int g_InputProcessingFlag; // $gp
  int result; // $v0

  *(g_InputProcessingFlag + 104) = 0;
  do
    result = PadRead();
  while ( result );
  return result;
}
// 80024EDC: variable 'g_InputProcessingFlag' is possibly undefined

//----- (80024F00) --------------------------------------------------------
void InitBiosEvents()
{
  int v0; // $v0
  int v1; // $gp
  int v2; // $v0
  int v3; // $gp
  int v4; // $v0
  int v5; // $gp
  int v6; // $v0
  int v7; // $gp

  OpenEvent();
  *(v1 + 280) = v0;
  OpenEvent();
  *(v3 + 284) = v2;
  OpenEvent();
  *(v5 + 288) = v4;
  OpenEvent();
  *(v7 + 292) = v6;
  EnableEvent();
  EnableEvent();
  EnableEvent();
  EnableEvent();
}
// 80024F30: variable 'v0' is possibly undefined
// 80024F30: variable 'v1' is possibly undefined
// 80024F4C: variable 'v2' is possibly undefined
// 80024F4C: variable 'v3' is possibly undefined
// 80024F68: variable 'v4' is possibly undefined
// 80024F68: variable 'v5' is possibly undefined
// 80024F78: variable 'v6' is possibly undefined
// 80024F78: variable 'v7' is possibly undefined

//----- (80025008) --------------------------------------------------------
void MemCard_InitSystem()
{
  int Memory; // $v0
  int v1; // $gp

  EnterCriticalSection();
  StartCARD2();
  ChangeClearPAD();
  bu_init();
  Memory = AllocateMemory(0x4000);
  *(v1 + 312) = Memory;
  if ( !Memory )
    exit(1);
  ExitCriticalSection();
}
// 80025038: variable 'v1' is possibly undefined
// 8004C8E4: using guessed type int StartCARD2(void);
// 80062A90: using guessed type int bu_init(void);
// 80062C10: using guessed type void __fastcall __noreturn exit(_DWORD);

//----- (80025064) --------------------------------------------------------
void sub_80025064()
{
  int v0; // $gp

  PadChkVsync(*(v0 + 312));
  EnterCriticalSection();
  StopCARD2();
  PadInit(0);
  ExitCriticalSection();
}
// 80025064: variable 'v0' is possibly undefined
// 8004C8D4: using guessed type int StopCARD2(void);

//----- (800250A8) --------------------------------------------------------
int MemCard_CheckSlot()
{
  int v0; // $v1
  int result; // $v0
  int v2; // $v0
  int v3; // $s0
  char v4[32]; // [sp+10h] [-20h] BYREF

  strcpy(v4, "bu00:BESCES-00510TEMP    ");
  // VSync(0);
  //   TestEvent(*(_DWORD *)(v0 + 280));  
  sub_80025DE0();
  card_info();
  // VSync(0);
  //  do while
  //     v1 = TestEvent(*(_DWORD *)(v0 + 280)) == 1;
  v0 = sub_80025D64();
  if ( v0 == 2 || (result = v0) == 0 )
  {
    open();
    v3 = v2;
    close();
    erase(v4);
    return 2 * (v3 == -1);
  }
  return result;
}
// 80025164: variable 'v2' is possibly undefined
// 80062880: using guessed type int __fastcall erase(_DWORD);

//----- (80025198) --------------------------------------------------------
BOOL __fastcall MemCard_ScanForSaves(_DWORD *a1, _DWORD *a2)
{
  int v2; // $gp
  _DWORD *v3; // $s0
  int v5; // $s4
  char v6; // $v1
  _DWORD *v8; // $v0
  _DWORD *v9; // $a0
  int v10; // $v0
  _DWORD *v11; // $s0
  int v12; // $s2
  _DWORD *v13; // $s1
  _DWORD *v14; // $a3
  _DWORD *v15; // $a2
  int v16; // $v1
  int v17; // $a0
  int v18; // $a1
  int v19; // $v1
  _DWORD *v20; // $a3
  _QWORD *v21; // $a2
  int v22; // $v1
  int v23; // $a0
  int v24; // $a1
  int v25; // $v1
  _QWORD v27[75]; // [sp+10h] [-260h] BYREF
  char v28[8]; // [sp+268h] [-8h] BYREF

  v3 = a1;
  v5 = 0;
  v6 = *(v2 + 129);
  v28[0] = *(v2 + 128);
  v28[1] = v6;
  memset(a1, 0, 600);
  *a2 = 0;
  v8 = firstfile2("bu00:*", a1);
  v9 = v3;
  if ( v8 == a1 )
  {
    do
    {
      v5 += v3[6];
      v3 += 10;
      if ( !strncmp(v9, "BESCES-00510", 12) )
        ++*a2;
      v10 = nextfile(v3);
      v9 = v3;
    }
    while ( v10 == v3 );
  }
  v11 = a1;
  memset(v27, 0, sizeof(v27));
  v12 = 0;
  v13 = a1 + 8;
  do
  {
    if ( !strncmp(v11, "BESCES-00510", 12) )
    {
      v28[0] = *(v13 - 20);                     //      ( )
      v14 = &v27[5 * atoi(v28) - 5];            //       
      v15 = v11;
      do
      {
        v16 = v15[1];
        v17 = v15[2];
        v18 = v15[3];
        *v14 = *v15;
        v14[1] = v16;
        v14[2] = v17;
        v14[3] = v18;
        v15 += 4;
        v14 += 4;
      }
      while ( v15 != v13 );
      v19 = v15[1];
      *v14 = *v15;
      v14[1] = v19;
    }
    v13 += 10;
    ++v12;
    v11 += 10;
  }
  while ( v12 < 15 );
  v20 = a1;
  v21 = v27;
  do
  {
    v22 = *(v21 + 1);
    v23 = *(v21 + 2);
    v24 = *(v21 + 3);
    *v20 = *v21;
    v20[1] = v22;
    v20[2] = v23;
    v20[3] = v24;
    v21 += 2;
    v20 += 4;
  }
  while ( v21 != &v27[74] );
  v25 = *(v21 + 1);
  *v20 = *v21;
  v20[1] = v25;
  return v5 > 106496;
}
// 800251C4: variable 'v2' is possibly undefined
// 80062AA0: using guessed type int __fastcall nextfile(_DWORD);
// 80062B30: using guessed type int __fastcall firstfile2(_DWORD, _DWORD);
// 80062B80: using guessed type int __fastcall memset(_DWORD, _DWORD, _DWORD);
// 80062BE0: using guessed type int __fastcall strncmp(_DWORD, _DWORD, _DWORD);
// 80062C00: using guessed type int __fastcall atoi(_DWORD);

//----- (8002536C) --------------------------------------------------------
int __fastcall sub_8002536C(int a1, _DWORD *a2, _DWORD *a3, _DWORD *a4)
{
  int v8; // $gp
  char v9; // $v1
  bool v10; // dc
  int result; // $v0
  int v12; // $v0
  int v13; // $a3
  int v14; // $t0
  int v15; // $t1
  char *v16; // $v0
  char v17; // $a0
  int v18; // $v1
  int v19; // $a3
  int v20; // $t0
  int v21; // $t1
  char *v22; // $v0
  char v23; // $a0
  int v24; // $v1
  char v25[44]; // [sp+10h] [-2B8h] BYREF
  int v26; // [sp+3Ch] [-28Ch] BYREF
  __int16 v27; // [sp+4Eh] [-27Ah] BYREF
  char v28[40]; // [sp+290h] [-38h] BYREF
  char v29[8]; // [sp+2B8h] [-10h] BYREF
  unsigned __int16 v30; // [sp+2C0h] [-8h]

  strcpy(v28, "bu00:");
  memset(&v28[6], 0, 34);
  v9 = *(v8 + 129);
  v29[0] = *(v8 + 128);
  v29[1] = v9;
  v10 = strncmp(a1, "BESCES-00510", 12) != 0;
  result = 1;
  if ( !v10 )
  {
    strcat(v28);
    open();
    if ( v12 != -1 && read(v12, v25, 640) == 640 )
    {
      close();
      *a2 = 0;
      v13 = 100000;
      v14 = 0;
      v15 = 44;
      v16 = &v26;
      do
      {
        v17 = v16[1];
        LOBYTE(v30) = *v16;
        HIBYTE(v30) = v17;
        v18 = v30 << 16;
        v15 += 2;
        if ( v30 != 16513 )
        {
          v30 = (v30 >> 8) - 79;
          *a2 += ((v18 >> 24) - 79) * v13;
        }
        ++v14;
        v13 /= 10;
        v16 = &v25[v15];
      }
      while ( v14 < 6 );
      *a3 = 0;
      v19 = 10;
      v20 = 0;
      v21 = 62;
      v22 = &v27;
      do
      {
        v23 = v22[1];
        LOBYTE(v30) = *v22;
        HIBYTE(v30) = v23;
        v24 = v30 << 16;
        v21 += 2;
        if ( v30 != 16513 )
        {
          v30 = (v30 >> 8) - 79;
          *a3 += ((v24 >> 24) - 79) * v19;
        }
        ++v20;
        v19 /= 10;
        v22 = &v25[v21];
      }
      while ( v20 < 2 );
      v29[0] = *(a1 + 12);
      *a4 = atoi(v29);
      return 0;
    }
    else
    {
      return 1;
    }
  }
  return result;
}
// 800253D4: variable 'v8' is possibly undefined
// 80025420: variable 'v12' is possibly undefined
// 80062AC0: using guessed type int __fastcall read(_DWORD, _DWORD, _DWORD);
// 80062B80: using guessed type int __fastcall memset(_DWORD, _DWORD, _DWORD);
// 80062B90: using guessed type int __fastcall strcat(_DWORD);
// 80062BE0: using guessed type int __fastcall strncmp(_DWORD, _DWORD, _DWORD);
// 80062C00: using guessed type int __fastcall atoi(_DWORD);

//----- (800255B0) --------------------------------------------------------
BOOL sub_800255B0()
{
  int v0; // $v0

  format();
  return v0 != 1;
}
// 800255C8: variable 'v0' is possibly undefined

//----- (800255E0) --------------------------------------------------------
int __fastcall sub_800255E0(char a1)
{
  int v2; // $s1
  int v3; // $v0
  int v4; // $gp
  int v5; // $v1
  int v6; // $gp
  int v7; // $s0
  int v8; // $v0
  int v9; // $gp
  int v10; // $gp
  char v13[40]; // [sp+10h] [-28h] BYREF

  strcpy(v13, "bu00:");
  memset(&v13[6], 0, 34);
  v2 = 0;
  do
  {
    strcat(v13);
    v13[17] = a1 + 48;
    v13[18] = 0;
    open();
    if ( v3 != -1 && read(v3, *(v4 + 312), 0x4000) == 0x4000 )
    {
      close();
      v7 = *(v6 + 312);
      v8 = sub_80025D40((v7 + 1024));
      v5 = 2;
      if ( *(v7 + 512) == v8 )
      {
        sub_8004BC5C(*(v9 + 312) + 1024);
        *(v10 + 124) = a1;
        return 0;
      }
    }
    else
    {
      v5 = 1;
    }
  }
  while ( v2++ < 2 );
  return v5;
}
// 80025668: variable 'v3' is possibly undefined
// 80025674: variable 'v4' is possibly undefined
// 8002569C: variable 'v6' is possibly undefined
// 800256B8: variable 'v9' is possibly undefined
// 800256C4: variable 'v10' is possibly undefined
// 80062AC0: using guessed type int __fastcall read(_DWORD, _DWORD, _DWORD);
// 80062B80: using guessed type int __fastcall memset(_DWORD, _DWORD, _DWORD);
// 80062B90: using guessed type int __fastcall strcat(_DWORD);

//----- (80025700) --------------------------------------------------------
int __fastcall sub_80025700(int a1)
{
  int v2; // $gp
  char v3; // $v1
  int v4; // $s7
  BOOL v5; // $s6
  int v6; // $s5
  int v7; // $s0
  int v8; // $s2
  int *v9; // $s1
  int v10; // $v0
  int v11; // $v0
  int v12; // $s0
  int result; // $v0
  int v14; // $v0
  char *v15; // $s1
  int v16; // $a0
  int v17; // $a1
  int v18; // $a2
  int v19; // $a0
  int v20; // $a1
  int v21; // $a2
  int v22; // $gp
  int v23; // $gp
  int v24; // $gp
  int v25; // $v0
  int v26; // $gp
  _DWORD *v27; // $a2
  int v28; // $s6
  int v29; // $v1
  int v30; // $a0
  int v31; // $a1
  int v32; // $v1
  int v33; // $a0
  int v34; // $a1
  int v35; // $v0
  bool v36; // dc
  int v37; // $v0
  int v38; // $gp
  BOOL v39; // $v0
  int v40; // $v0
  int v41; // $gp
  int v42; // $gp
  int v43; // $gp
  int v44[150]; // [sp+10h] [-560h] BYREF
  char v45[4]; // [sp+268h] [-308h] BYREF
  char v46[63]; // [sp+26Ch] [-304h] BYREF
  int v47; // [sp+2C8h] [-2A8h]
  int v48; // [sp+2CCh] [-2A4h]
  int v49; // [sp+2D0h] [-2A0h]
  int v50; // [sp+2D4h] [-29Ch]
  int v51; // [sp+2D8h] [-298h]
  int v52; // [sp+2DCh] [-294h]
  int v53; // [sp+2E0h] [-290h]
  int v54; // [sp+2E4h] [-28Ch]
  char v55[128]; // [sp+2E8h] [-288h] BYREF
  char v56[128]; // [sp+368h] [-208h] BYREF
  char v57[128]; // [sp+3E8h] [-188h] BYREF
  int v58; // [sp+468h] [-108h]
  char v59[104]; // [sp+4E8h] [-88h] BYREF
  __int16 v60[4]; // [sp+550h] [-20h] BYREF
  char v61[16]; // [sp+558h] [-18h] BYREF
  int v62; // [sp+568h] [-8h] BYREF

  strcpy(v59, "bu00:");
  memset(&v59[6], 0, 34);
  v3 = *(v2 + 129);
  v61[0] = *(v2 + 128);
  v61[1] = v3;
  memset(&v61[2], 0, 8);
  v4 = 0;
  memset(&v59[40], 0, 60);
  memset(v44, 0, sizeof(v44));
  v5 = MemCard_ScanForSaves(v44, &v62);
  v6 = 0;
  v7 = 0;
  v8 = 0;
  do
  {
    v9 = &v44[v8];
    v10 = strncmp(&v44[v8], "BESCES-00510", 12);
    v8 += 10;
    if ( !v10 )
    {
      v61[0] = *(v9 + 12);
      v11 = atoi(v61);
      *&v59[4 * v11 + 36] = 1;
      if ( v11 == a1 )
        v6 = 1;
    }
    ++v7;
  }
  while ( v7 < 15 );
  if ( v6 )
  {
    while ( 1 )
    {
LABEL_13:
      strcat(v59);
      v59[17] = a1 + 48;
      qmemcpy(v45, "SC", 2);
      v45[2] = 18;
      v59[18] = 0;
      v45[3] = 2;
      strcpy(v46, dword_8006E0B8);
      v15 = v45;
      sub_80025C3C(v45, a1);
      v16 = *&byte_8006E0DC[32 * a1];
      v17 = *&byte_8006E0E0[32 * a1];
      v18 = *&byte_8006E0E4[32 * a1];
      v47 = *&byte_8006E0D8[32 * a1];
      v48 = v16;
      v49 = v17;
      v50 = v18;
      v19 = *&byte_8006E0EC[32 * a1];
      v20 = *&byte_8006E0F0[32 * a1];
      v21 = *&byte_8006E0F4[32 * a1];
      v51 = *&byte_8006E0E8[32 * a1];
      v52 = v19;
      v53 = v20;
      v54 = v21;
      v60[0] = 800;
      v60[1] = 16 * a1 + 240;
      v60[2] = 4;
      v60[3] = 16;
      GPU_SetTransferRect(v60, v55);
      v60[0] = 804;
      GPU_SetTransferRect(v60, v56);
      v60[0] = 808;
      GPU_SetTransferRect(v60, v57);
      memset(*(v22 + 312), 0, 0x4000);
      sub_8004B694(*(v23 + 312) + 1024);
      v25 = sub_80025D40((*(v24 + 312) + 1024));
      v27 = *(v26 + 312);
      v28 = v25;
      v58 = v25;
      if ( ((v45 | v27) & 3) != 0 )
      {
        do
        {
          v29 = *(v15 + 1);
          v30 = *(v15 + 2);
          v31 = *(v15 + 3);
          *v27 = *v15;
          v27[1] = v29;
          v27[2] = v30;
          v27[3] = v31;
          v15 += 16;
          v27 += 4;
        }
        while ( v15 != v59 );
      }
      else
      {
        do
        {
          v32 = *(v15 + 1);
          v33 = *(v15 + 2);
          v34 = *(v15 + 3);
          *v27 = *v15;
          v27[1] = v32;
          v27[2] = v33;
          v27[3] = v34;
          v15 += 16;
          v27 += 4;
        }
        while ( v15 != v59 );
      }
      if ( !v6 )
      {
        open();
        v36 = v35 == -1;
        result = 1;
        if ( v36 )
          return result;
        close();
        v6 = 1;
      }
      open();
      if ( v37 == -1 )
        goto LABEL_26;
      v36 = write(v37, *(v38 + 312), 0x4000) != 0x4000;
      v39 = v4 < 3;
      if ( !v36 )
        break;
LABEL_27:
      ++v4;
      if ( !v39 )
        return 1;
    }
    close();
    open();
    if ( v40 != -1 )
    {
      v36 = read(v40, *(v41 + 312), 0x4000) != 0x4000;
      v39 = v4 < 3;
      if ( !v36 )
      {
        close();
        v36 = v28 != sub_80025D40((*(v42 + 312) + 1024));
        v39 = v4 < 3;
        if ( !v36 )
        {
          *(v43 + 124) = a1;
          return 0;
        }
      }
      goto LABEL_27;
    }
LABEL_26:
    v39 = v4 < 3;
    goto LABEL_27;
  }
  v12 = 0;
  if ( !v5 )
  {
    v14 = 0;
    do
    {
      if ( !v44[v14 + 320] )
      {
        a1 = v12 + 1;
        v12 = 15;
      }
      v14 = ++v12;
    }
    while ( v12 < 15 );
    goto LABEL_13;
  }
  return 2;
}
// 80025768: variable 'v2' is possibly undefined
// 80025A74: variable 'v22' is possibly undefined
// 80025A80: variable 'v23' is possibly undefined
// 80025A8C: variable 'v24' is possibly undefined
// 80025A98: variable 'v26' is possibly undefined
// 80025B58: variable 'v35' is possibly undefined
// 80025B80: variable 'v37' is possibly undefined
// 80025B88: variable 'v38' is possibly undefined
// 80025BB8: variable 'v40' is possibly undefined
// 80025BC0: variable 'v41' is possibly undefined
// 80025BDC: variable 'v42' is possibly undefined
// 80025BF0: variable 'v43' is possibly undefined
// 80062860: using guessed type int __fastcall write(_DWORD, _DWORD, _DWORD);
// 80062AC0: using guessed type int __fastcall read(_DWORD, _DWORD, _DWORD);
// 80062B80: using guessed type int __fastcall memset(_DWORD, _DWORD, _DWORD);
// 80062B90: using guessed type int __fastcall strcat(_DWORD);
// 80062BD0: using guessed type int __fastcall strcpy(_DWORD, _DWORD);
// 80062BE0: using guessed type int __fastcall strncmp(_DWORD, _DWORD, _DWORD);
// 80062C00: using guessed type int __fastcall atoi(_DWORD);
// 8006E0B8: using guessed type int dword_8006E0B8[8];
// 80025700: using guessed type _DWORD var_560[150];
// 80025700: using guessed type char var_288[128];
// 80025700: using guessed type char var_208[128];
// 80025700: using guessed type char var_188[128];

//----- (80025C3C) --------------------------------------------------------
BOOL __fastcall sub_80025C3C(int a1, char a2)
{
  int v3; // $a2
  int v4; // $a3
  int v5; // $t0
  int v6; // $hi
  int v7; // $a0
  int v8; // $v0
  int v9; // $a2
  int v10; // $hi
  int v11; // $a0
  char v12; // $v0
  BOOL result; // $v0

  v3 = 0;
  v4 = dword_8019B4C4;
  v5 = byte_8019B4CC;
  *(a1 + 34) = -126;
  *(a1 + 35) = a2 + 79;
  v6 = (1717986919LL * v4) >> 32;
  do
  {
    v7 = 2 * (25 - v3) + a1;
    *(v7 + 4) = -126;
    v8 = v4 - 10 * ((v6 >> 2) - (v4 >> 31));
    v4 = (v6 >> 2) - (v4 >> 31);
    *(v7 + 5) = v8 + 79;
    if ( !v4 )
      v3 = 6;
    ++v3;
    v6 = (1717986919LL * v4) >> 32;
  }
  while ( v3 < 6 );
  v9 = 0;
  v10 = (1717986919LL * v5) >> 32;
  do
  {
    v11 = 2 * (30 - v9) + a1;
    *(v11 + 4) = -126;
    v12 = v5 - 10 * ((v10 >> 2) - (v5 >> 31));
    v5 = (v10 >> 2) - (v5 >> 31);
    *(v11 + 5) = v12 + 79;
    if ( !v5 )
      v9 = 2;
    result = ++v9 < 2;
    v10 = (1717986919LL * v5) >> 32;
  }
  while ( v9 < 2 );
  return result;
}
// 8019B4C4: using guessed type int dword_8019B4C4;
// 8019B4CC: using guessed type char byte_8019B4CC;

//----- (80025D40) --------------------------------------------------------
int __fastcall sub_80025D40(unsigned __int8 *a1)
{
  int v1; // $a1
  int i; // $v1
  int v3; // $v0

  v1 = 0;
  for ( i = 15359; i >= 0; --i )
  {
    v3 = *a1++;
    v1 += v3;
  }
  return v1;
}

//----- (80025D64) --------------------------------------------------------
int sub_80025D64()
{
  int v0; // $v0
  bool v1; // dc
  int result; // $v0
  int v3; // $v0
  int v4; // $v0
  int v5; // $v0

  VSync(0);
  do
  {
    TestEvent();
    v1 = v0 == 1;
    result = 0;
    if ( v1 )
      break;
    TestEvent();
    v1 = v3 == 1;
    result = 1;
    if ( v1 )
      break;
    TestEvent();
    v1 = v4 == 1;
    result = 2;
    if ( v1 )
      break;
    TestEvent();
    v1 = v5 != 1;
    result = 3;
  }
  while ( v1 );
  return result;
}
// 80025D88: variable 'v0' is possibly undefined
// 80025D9C: variable 'v3' is possibly undefined
// 80025DB0: variable 'v4' is possibly undefined
// 80025DC4: variable 'v5' is possibly undefined

//----- (80025DE0) --------------------------------------------------------
void sub_80025DE0()
{
  VSync(0);
  TestEvent();
  TestEvent();
  TestEvent();
  TestEvent();
}

//----- (80025E30) --------------------------------------------------------
int Player_CheckHeadroom()
{
  int result; // $v0

  dword_8019B5E4 = g_CeilingHeight + 1600 - (word_8019B5F8 + *&g_LanguageID[0].header[6] + word_8019B5FC);
  if ( dword_8019B5E4 < -1000 )
    sub_8002C06C(0);
  result = word_8019B5F8 + *&g_LanguageID[0].header[6] + word_8019B5FC;
  dword_8019B5E8 = g_StepHeight + 1600 - result;
  if ( dword_8019B5E8 <= 0 )
    return sub_8002C06C(0);
  return result;
}
// 8019B5E4: using guessed type int dword_8019B5E4;
// 8019B5E8: using guessed type int dword_8019B5E8;
// 8019B5F8: using guessed type __int16 word_8019B5F8;
// 8019B5FC: using guessed type __int16 word_8019B5FC;
// 801DD58C: using guessed type int g_CeilingHeight;
// 801DD590: using guessed type int g_StepHeight;

//----- (80025EDC) --------------------------------------------------------
int __fastcall sub_80025EDC(int a1, int a2, int a3, int a4, int a5)
{
  return GetDistanceIfInRange(&g_LanguageID[0].header[2], a1, a2, a3, a4 + 800, 1700, a5);
}

//----- (80025F30) --------------------------------------------------------
int FinalizePlayerInit()
{
  int result; // $v0

  word_8019B5F8 = 0;
  word_8019B5FA = 0;
  word_8019B5FC = 0;
  g_PlayerIsMoving = 0;
  word_8019B5FE = 0;
  byte_8019B591 = 0;
  word_8019B5D8 = 0;
  word_8019B5D6 = 0;
  word_8019B5D4 = 0;
  LOWORD(dword_8019B5D0) = 0;
  dword_8019B5CC = 0;
  word_8019B5C8 = 0;
  word_8019B5C6 = 0;
  g_LanguageID[0].menus[0].items[0].ColorAlt = 0;
  *&g_LanguageID[0].menus[0].header.extra[2] = *&g_LanguageID[0].menus[0].header.extra[10];
  *&g_LanguageID[0].menus[0].header.extra[6] = *&g_LanguageID[0].menus[0].items[0].refY;
  word_8019B4D4 = 4096;
  g_CastReadyFlag = -1;
  result = 10000;
  word_8019B4D2 = 0;
  byte_8019B4D1 = 0;
  dword_8019B5E4 = 10000;
  dword_8019B5E8 = 10000;
  return result;
}
// 8019B4D1: using guessed type char byte_8019B4D1;
// 8019B4D2: using guessed type __int16 word_8019B4D2;
// 8019B4D4: using guessed type __int16 word_8019B4D4;
// 8019B591: using guessed type char byte_8019B591;
// 8019B594: using guessed type char g_PlayerIsMoving;
// 8019B595: using guessed type char g_CastReadyFlag;
// 8019B5C6: using guessed type __int16 word_8019B5C6;
// 8019B5C8: using guessed type __int16 word_8019B5C8;
// 8019B5CC: using guessed type int dword_8019B5CC;
// 8019B5D0: using guessed type int dword_8019B5D0;
// 8019B5D4: using guessed type __int16 word_8019B5D4;
// 8019B5D6: using guessed type __int16 word_8019B5D6;
// 8019B5D8: using guessed type __int16 word_8019B5D8;
// 8019B5E4: using guessed type int dword_8019B5E4;
// 8019B5E8: using guessed type int dword_8019B5E8;
// 8019B5F8: using guessed type __int16 word_8019B5F8;
// 8019B5FA: using guessed type __int16 word_8019B5FA;
// 8019B5FC: using guessed type __int16 word_8019B5FC;
// 8019B5FE: using guessed type __int16 word_8019B5FE;

//----- (8002601C) --------------------------------------------------------
#error "80026070: call analysis failed (funcsize=28)"

//----- (800260BC) --------------------------------------------------------
int __fastcall sub_800260BC(
        unsigned __int8 a1,
        unsigned __int8 a2,
        unsigned __int8 a3,
        unsigned __int8 a4,
        unsigned __int8 a5,
        int a6)
{
  WaitForCdIdle();
  g_TitleColor = 0x63636363;
  g_TitleBrightness = 0x63;
  sub_800166F8(a1, a2, a3, 0xFFu, 0xFFu, 127, 127, 127);
  do
  {
    PadStartCom();
    HandleUISequence();
  }
  while ( g_bStartKeyState );
  WaitForCdIdle();
  WaitForDmaComplete(0);
  VSync(0);
  WaitForDmaComplete(0);
  VSync(0);
  if ( a6 != 255 )
  {
    sub_800166F8(0xFFu, 0xFFu, a6, 0xFFu, 0xFFu, 127, 127, 127);
    do
    {
      PadStartCom();
      HandleUISequence();
    }
    while ( g_bStartKeyState );
    WaitForCdIdle();
    WaitForDmaComplete(0);
    VSync(0);
    WaitForDmaComplete(0);
    VSync(0);
  }
  Player_Spawn();
  PrepareRenderPrimitives();
  FadeScreenIn(0x82u, 4096, 4096, 0);
  if ( !dword_80190858 )
    sub_80034C68(0, 0x101u, 385);
  WaitForCdIdle();
  FadeScreenIn(0x82u, 4096, 0, -128);
  return sub_800166F8(0xFFu, 0xFFu, 0xFFu, a4, a5, 127, 127, 127);
}
// 801779D4: using guessed type __int16 g_bStartKeyState;
// 801779D8: using guessed type int g_TitleColor;
// 801779DC: using guessed type char g_TitleBrightness;
// 80190858: using guessed type int dword_80190858;

//----- (800262C0) --------------------------------------------------------
int __fastcall sub_800262C0(int a1, int a2)
{
  int v2; // $a0
  int v3; // $a1
  int v4; // $lo
  int result; // $v0

  v2 = a1 << 6;
  v3 = a2 + 1;
  v4 = v2 / v3;
  if ( v3 == -1 && v2 == 0x80000000 )
    _break(6u, 0);
  result = 5000;
  if ( v4 + 1 < 5000 )
    return v4 + 1;
  return result;
}
// 800262CC: conditional instruction was optimized away because $a1.4!=0

//----- (80026314) --------------------------------------------------------
int __fastcall sub_80026314(int a1)
{
  int result; // $v0
  bool v2; // dc
  int v3; // $a0
  _WORD *v4; // $a0
  int v5; // $v1

  result = 255;
  v2 = a1 == 255;
  v3 = 32 * a1;
  if ( !v2 )
  {
    v4 = (&unk_801DD318 + v3);
    g_DefenseStrike += v4[1];
    g_DefenseSlash += v4[2];
    g_DefensePierce += v4[3];
    g_DefensePoison += v4[4];
    g_DefenseBlackMagic += v4[5];
    g_DefenseFire += v4[6];
    g_DefenseEarth += v4[7];
    g_DefenseWind += v4[8];
    v5 = v4[9];
    result = g_DefenseWater + v5;
    g_DefenseWater += v5;
  }
  return result;
}
// 8019B506: using guessed type __int16 g_DefenseStrike;
// 8019B508: using guessed type __int16 g_DefenseSlash;
// 8019B50A: using guessed type __int16 g_DefensePierce;
// 8019B50C: using guessed type __int16 g_DefensePoison;
// 8019B50E: using guessed type __int16 g_DefenseBlackMagic;
// 8019B510: using guessed type __int16 g_DefenseFire;
// 8019B512: using guessed type __int16 g_DefenseEarth;
// 8019B514: using guessed type __int16 g_DefenseWind;
// 8019B516: using guessed type __int16 g_DefenseWater;

//----- (80026430) --------------------------------------------------------
BOOL CalculatePlayerStats()
{
  int v0; // $v0
  _WORD *Item; // $a0
  int v2; // $v1
  BOOL result; // $v0

  g_AttackStrike = 0;
  g_AttackSlash = 0;
  g_AttackPierce = 0;
  g_AttackWhiteMagic = 0;
  g_AttackFire = 0;
  g_AttackEarth = 0;
  g_AttackWind = 0;
  g_AttackWater = 0;
  g_DefenseStrike = 0;
  g_DefenseSlash = 0;
  g_DefensePierce = 0;
  g_DefensePoison = 0;
  g_DefenseBlackMagic = 0;
  g_DefenseFire = 0;
  g_DefenseEarth = 0;
  g_DefenseWind = 0;
  g_DefenseWater = 0;
  g_unk_8019B4EC = g_Strength;
  g_unk_8019B4EE = g_MagicPower;
  if ( word_8019B51A )
  {
    v0 = g_unk_8019B4EC - 20;
    if ( v0 < 0 )
      LOWORD(v0) = 0;
    g_unk_8019B4EC = v0;
  }
  if ( g_EquippedWeapon != 255 )
  {
    Item = &g_EquipmentDatabase[0x11 * g_EquippedWeapon];// 
                                                //     ?
    g_AttackStrike += Item[3];
    g_AttackSlash += Item[4];
    g_AttackPierce += Item[5];
    g_AttackWhiteMagic += Item[6];
    g_AttackFire += Item[7];
    g_AttackEarth += Item[8];
    g_AttackWind += Item[9];
    g_AttackWater += Item[10];
  }
  sub_80026314(g_EquippedHead);
  sub_80026314(g_EquippedBody);
  sub_80026314(g_EquippedShield);
  sub_80026314(g_EquippedArms);
  sub_80026314(g_EquippedLegs);
  sub_80026314(g_EquipAccessory1);
  sub_80026314(g_EquipAccessory2);
  if ( word_8019B526 )
    g_DefenseFire += 50;
  if ( word_8019B528 )
  {
    g_DefenseSlash += 30;
    g_DefensePierce += 30;
    g_DefenseStrike += 30;
  }
  if ( word_8019B532 )
    g_unk_8019B4EE += 30;
  v2 = g_EquippedWeapon;
  if ( g_EquippedWeapon == 10 )
  {
    g_DefenseSlash -= 10;
    g_DefensePierce -= 10;
    v2 = g_EquippedWeapon;
  }
  if ( v2 == 11 )
  {
    g_DefenseBlackMagic -= 10;
    g_DefenseFire -= 10;
    g_DefenseWind -= 10;
    g_DefenseWater -= 10;
  }
  if ( g_EquipAccessory1 == 55 || g_EquipAccessory2 == 55 )
  {
    g_AttackSlash += 5;
    g_AttackPierce += 5;
    g_AttackWhiteMagic += 22;
    g_AttackWater += 12;
  }
  if ( g_EquipAccessory1 == 56 || g_EquipAccessory2 == 56 )
    g_unk_8019B4EE += 8;
  if ( g_EquipAccessory1 == 57 || g_EquipAccessory2 == 57 )
    g_unk_8019B4EC += 8;
  if ( g_unk_8019B4EC <= 0x7FFFu )
  {
    if ( g_unk_8019B4EC >= 0x3E8u )
      g_unk_8019B4EC = 999;
  }
  else
  {
    g_unk_8019B4EC = 0;
  }
  if ( g_unk_8019B4EE <= 0x7FFFu )
  {
    if ( g_unk_8019B4EE >= 0x3E8u )
      g_unk_8019B4EE = 999;
  }
  else
  {
    g_unk_8019B4EE = 0;
  }
  if ( HIBYTE(g_AttackStrike) >> 7 )
    g_AttackStrike = 0;
  if ( HIBYTE(g_AttackSlash) >> 7 )
    g_AttackSlash = 0;
  if ( HIBYTE(g_AttackPierce) >> 7 )
    g_AttackPierce = 0;
  if ( HIBYTE(g_AttackWhiteMagic) >> 7 )
    g_AttackWhiteMagic = 0;
  if ( HIBYTE(g_AttackFire) >> 7 )
    g_AttackFire = 0;
  if ( HIBYTE(g_AttackEarth) >> 7 )
    g_AttackEarth = 0;
  if ( HIBYTE(g_AttackWind) >> 7 )
    g_AttackWind = 0;
  if ( g_AttackWater > 0x7FFFu )
    g_AttackWater = 0;
  if ( g_DefenseStrike > 0x7FFFu )
    g_DefenseStrike = 0;
  if ( g_DefenseSlash > 0x7FFFu )
    g_DefenseSlash = 0;
  if ( g_DefensePierce > 0x7FFFu )
    g_DefensePierce = 0;
  if ( g_DefensePoison > 0x7FFFu )
    g_DefensePoison = 0;
  if ( g_DefenseBlackMagic > 0x7FFFu )
    g_DefenseBlackMagic = 0;
  if ( g_DefenseFire > 0x7FFFu )
    g_DefenseFire = 0;
  if ( g_DefenseEarth > 0x7FFFu )
    g_DefenseEarth = 0;
  if ( g_DefenseWind > 0x7FFFu )
    g_DefenseWind = 0;
  result = g_DefenseWater > 0x7FFFu;
  if ( g_DefenseWater > 0x7FFFu )
    g_DefenseWater = 0;
  return result;
}
// 8019B4E8: using guessed type __int16 g_Strength;
// 8019B4EA: using guessed type __int16 g_MagicPower;
// 8019B4EC: using guessed type __int16 g_unk_8019B4EC;
// 8019B4EE: using guessed type __int16 g_unk_8019B4EE;
// 8019B4F4: using guessed type __int16 g_AttackStrike;
// 8019B4F6: using guessed type __int16 g_AttackSlash;
// 8019B4F8: using guessed type __int16 g_AttackPierce;
// 8019B4FA: using guessed type __int16 g_AttackWhiteMagic;
// 8019B4FC: using guessed type __int16 g_AttackFire;
// 8019B4FE: using guessed type __int16 g_AttackEarth;
// 8019B500: using guessed type __int16 g_AttackWind;
// 8019B502: using guessed type __int16 g_AttackWater;
// 8019B506: using guessed type __int16 g_DefenseStrike;
// 8019B508: using guessed type __int16 g_DefenseSlash;
// 8019B50A: using guessed type __int16 g_DefensePierce;
// 8019B50C: using guessed type __int16 g_DefensePoison;
// 8019B50E: using guessed type __int16 g_DefenseBlackMagic;
// 8019B510: using guessed type __int16 g_DefenseFire;
// 8019B512: using guessed type __int16 g_DefenseEarth;
// 8019B514: using guessed type __int16 g_DefenseWind;
// 8019B516: using guessed type __int16 g_DefenseWater;
// 8019B51A: using guessed type __int16 word_8019B51A;
// 8019B526: using guessed type __int16 word_8019B526;
// 8019B528: using guessed type __int16 word_8019B528;
// 8019B532: using guessed type __int16 word_8019B532;
// 8019B55F: using guessed type char g_EquippedWeapon;
// 8019B584: using guessed type char g_EquippedHead;
// 8019B585: using guessed type char g_EquippedBody;
// 8019B586: using guessed type char g_EquippedShield;
// 8019B587: using guessed type char g_EquippedArms;
// 8019B588: using guessed type char g_EquippedLegs;
// 8019B589: using guessed type char g_EquipAccessory1;
// 8019B58A: using guessed type char g_EquipAccessory2;
// 801CB8AC: using guessed type _DWORD g_EquipmentDatabase[306];

//----- (80026AE4) --------------------------------------------------------
BOOL __fastcall sub_80026AE4(int a1, __int16 a2)
{
  BOOL result; // $v0

  result = ++word_8019B4E4 < 0x64u;
  if ( word_8019B4E4 >= 0x64u )
  {
    ++g_Strength;
    word_8019B4E4 = 0;
    if ( g_Strength < 0x3E8u )
      MessageQueuePush(31, a2);
    else
      g_Strength = 999;
    return CalculatePlayerStats();
  }
  return result;
}
// 8019B4E4: using guessed type __int16 word_8019B4E4;
// 8019B4E8: using guessed type __int16 g_Strength;

//----- (80026B7C) --------------------------------------------------------
BOOL __fastcall sub_80026B7C(int a1, __int16 a2)
{
  BOOL result; // $v0

  result = ++word_8019B4E6 < 0x64u;
  if ( word_8019B4E6 >= 0x64u )
  {
    ++g_MagicPower;
    word_8019B4E6 = 0;
    if ( g_MagicPower < 0x3E8u )
      MessageQueuePush(32, a2);
    else
      g_MagicPower = 999;
    return CalculatePlayerStats();
  }
  return result;
}
// 8019B4E6: using guessed type __int16 word_8019B4E6;
// 8019B4EA: using guessed type __int16 g_MagicPower;

//----- (80026C14) --------------------------------------------------------
int __fastcall sub_80026C14(__int16 a1)
{
  int result; // $v0
  unsigned __int8 v2; // $v1
  int v3; // $v0
  char *v4; // $a0
  __int16 v5; // $a1

  dword_8019B4C4 += a1;
  if ( dword_8019B4C4 > 999999 )
    dword_8019B4C4 = 999999;
  for ( result = dword_8019B4C4 < dword_8019B4C8; dword_8019B4C4 >= dword_8019B4C8; result = dword_8019B4C4 < dword_8019B4C8 )
  {
    v2 = byte_8019B4CC;
    result = byte_8019B4CC + 1;
    if ( byte_8019B4CC == 255 )
      break;
    ++byte_8019B4CC;
    if ( v2 < 0x64u )
    {
      v4 = &g_LevelStatEntry + 12 * v2;
      g_MaxHP = *v4;
      g_MaxMP = *(v4 + 1);
      g_Strength += *(v4 + 2);
      g_MagicPower += *(v4 + 3);
      v3 = *(v4 + 2);
    }
    else
    {
      g_MaxHP += word_80079638 - word_8007962C;
      g_MaxMP += word_8007963A - word_8007962E;
      g_Strength += word_8007963C;
      g_MagicPower += word_8007963E;
      v3 = dword_80079640 - dword_80079634 + dword_8019B4C8;
    }
    dword_8019B4C8 = v3;
    if ( g_MaxHP >= 1000u )
      g_MaxHP = 999;
    if ( g_MaxMP >= 1000u )
      g_MaxMP = 999;
    if ( g_Strength >= 1000u )
      g_Strength = 999;
    if ( g_MagicPower >= 1000u )
      g_MagicPower = 999;
    CalculatePlayerStats();
    MessageQueuePush(0, v5);
  }
  return result;
}
// 80026DFC: variable 'v5' is possibly undefined
// 8007962C: using guessed type __int16 word_8007962C;
// 8007962E: using guessed type __int16 word_8007962E;
// 80079634: using guessed type int dword_80079634;
// 80079638: using guessed type __int16 word_80079638;
// 8007963A: using guessed type __int16 word_8007963A;
// 8007963C: using guessed type __int16 word_8007963C;
// 8007963E: using guessed type __int16 word_8007963E;
// 80079640: using guessed type int dword_80079640;
// 8019B4C4: using guessed type int dword_8019B4C4;
// 8019B4C8: using guessed type int dword_8019B4C8;
// 8019B4CC: using guessed type char byte_8019B4CC;
// 8019B4D6: using guessed type __int16 g_MaxHP;
// 8019B4DA: using guessed type __int16 g_MaxMP;
// 8019B4E8: using guessed type __int16 g_Strength;
// 8019B4EA: using guessed type __int16 g_MagicPower;

//----- (80026E38) --------------------------------------------------------
int __fastcall sub_80026E38(int a1, int a2, int a3)
{
  int v3; // $a2
  int v4; // $a1
  int v6; // $v1
  int v7; // $a0
  int v8; // $v1

  v3 = 16 * a3;
  v4 = 16 * a2;
  if ( !v3 )
    return 0;
  v6 = ((a1 * word_8019B4D4) >> 8) + v4;
  v7 = v3 - v6;
  if ( v3 - v6 < 0 )
    v7 = 0;
  if ( !v6 )
    v6 = 16;
  v8 = 2 * v6;
  if ( v8 == -1 && v3 * v3 == 0x80000000 )
    _break(6u, 0);
  return (v7 + v3 * v3 / v8) / 5;
}
// 80026E90: conditional instruction was optimized away because $v1.4!=0
// 8019B4D4: using guessed type __int16 word_8019B4D4;

//----- (80026EE0) --------------------------------------------------------
int __fastcall sub_80026EE0(int a1)
{
  int result; // $v0
  int v2; // $s0

  result = g_CurrentHP;
  v2 = g_CurrentHP + a1;
  if ( v2 <= 0 )
  {
    LOWORD(v2) = 0;
    result = sub_8002C06C(0);
  }
  g_CurrentHP = v2;
  return result;
}
// 8019B4D8: using guessed type __int16 g_CurrentHP;

//----- (80026F34) --------------------------------------------------------
int __fastcall sub_80026F34(_DWORD *a1, int a2, char a3)
{
  int result; // $v0
  int v6; // $s4
  int v7; // $v1
  int v8; // $lo
  int v9; // $s1
  int v10; // $s0
  int v11; // $a0
  signed int v12; // $s2
  int v13; // $v0
  int v14; // $v0
  int v15; // [sp+10h] [-10h] BYREF
  __int16 v16; // [sp+14h] [-Ch]
  int v17; // [sp+18h] [-8h] BYREF
  __int16 v18; // [sp+1Ch] [-4h]

  result = 17;
  if ( byte_8019B591 == 17 || !a2 )
    return result;
  v6 = g_CurrentHP - a2;
  v7 = a2 << 11;
  if ( v6 <= 0 )
    v6 = 0;
  g_CurrentHP = v6;
  v8 = v7 / g_MaxHP;
  if ( !g_MaxHP )
    _break(7u, 0);
  if ( g_MaxHP == -1 && v7 == 0x80000000 )
    _break(6u, 0);
  v9 = v8 >> 2;
  if ( a1 )
  {
    sub_800159DC(
      *&g_LanguageID[0].header[2] - *a1,
      *&g_LanguageID[0].header[6] - (a1[1] + 850),
      *&g_LanguageID[0].menus[0].header.posY - a1[2],
      &v15);
    if ( v9 < 80 )
      v9 = 80;
    if ( (a3 & 0x40) != 0 )
    {
      v9 *= 5;
      if ( v9 >= 601 )
        LOWORD(v9) = 600;
    }
    else if ( v9 >= 301 )
    {
      LOWORD(v9) = 300;
    }
    sub_80015538(&v15, &v17);
    sub_80015694(v9, &v17);
    if ( SHIWORD(v17) < 201 )
    {
      if ( SHIWORD(v17) < -200 )
        HIWORD(v17) = -200;
    }
    else
    {
      HIWORD(v17) = 200;
    }
  }
  else
  {
    v18 = 0;
    v17 = 0;
  }
  v10 = (1300 - (v8 >> 1)) >> 2;
  if ( v10 < 71 )
    LOWORD(v10) = 70;
  if ( !v6 )
  {
    sub_8002C06C(&v17);
    result = 3500;
LABEL_28:
    word_8019B600 = 3500;
    word_8019B602 = v10;
    return result;
  }
  result = 3500;
  if ( !a1 )
    goto LABEL_28;
  v12 = SquareRoot0(4 * v8);
  if ( v12 < 16 )
  {
    v12 = 16;
LABEL_33:
    v13 = a3 & 0x40;
    goto LABEL_34;
  }
  v13 = a3 & 0x40;
  if ( v12 >= 43 )
  {
    v12 = 42;
    goto LABEL_33;
  }
LABEL_34:
  if ( v13 )
    v12 *= 2;
  if ( (a3 & 0x80) != 0 )
  {
    LOWORD(v15) = 0;
    if ( rand(v11) < 16385 )
      v16 = -v12;
    else
      v16 = v12;
    HIWORD(v15) = 0;
    return sub_8002BFF4(&v17, &v15, v10);
  }
  else
  {
    switch ( ((SHIWORD(v15) - *&g_LanguageID[0].menus[0].header.extra[4] + 256) >> 9) & 7 )
    {
      case 0:
        LOWORD(v15) = -v12;
        v16 = 0;
        break;
      case 1:
        LOWORD(v15) = -v12;
        v16 = v12;
        break;
      case 2:
        LOWORD(v15) = 0;
        v16 = v12;
        break;
      case 3:
        LOWORD(v15) = v12;
        v16 = v12;
        break;
      case 4:
        LOWORD(v15) = v12;
        v16 = 0;
        break;
      case 5:
        v14 = -v12;
        LOWORD(v15) = v12;
        goto LABEL_50;
      case 6:
        v14 = -v12;
        LOWORD(v15) = 0;
        goto LABEL_50;
      case 7:
        v14 = -v12;
        LOWORD(v15) = -v12;
LABEL_50:
        v16 = v14;
        break;
      default:
        break;
    }
    HIWORD(v15) = 0;
    return sub_8002BF60(&v17, &v15, v10);
  }
}
// 80027150: variable 'v11' is possibly undefined
// 80062BF0: using guessed type int __fastcall rand(_DWORD);
// 8019B4D6: using guessed type __int16 g_MaxHP;
// 8019B4D8: using guessed type __int16 g_CurrentHP;
// 8019B591: using guessed type char byte_8019B591;
// 8019B600: using guessed type __int16 word_8019B600;
// 8019B602: using guessed type __int16 word_8019B602;

//----- (80027280) --------------------------------------------------------
int __fastcall sub_80027280(char a1)
{
  int v1; // $v0
  bool v2; // dc
  int v3; // $v0
  int result; // $v0

  v1 = a1 & 2;
  if ( (a1 & 1) != 0 )
  {
    if ( word_8019B51A >= 0x41 )
      word_8019B51A = 64;
    word_8019B51C = 0;
    v1 = a1 & 2;
  }
  v2 = v1 == 0;
  v3 = a1 & 3;
  if ( !v2 )
  {
    if ( word_8019B51E >= 0x41 )
      word_8019B51E = 64;
    word_8019B520 = 0;
    v3 = a1 & 3;
  }
  if ( v3 )
    g_PoisenStatus = 0;
  result = a1 & 4;
  if ( (a1 & 5) != 0 )
  {
    result = a1 & 4;
    if ( word_8019B522 >= 0x41 )
    {
      word_8019B522 = 64;
      result = a1 & 4;
    }
  }
  if ( result )
    g_AttackCooldown = 0;
  return result;
}
// 8019B518: using guessed type __int16 g_PoisenStatus;
// 8019B51A: using guessed type __int16 word_8019B51A;
// 8019B51C: using guessed type __int16 word_8019B51C;
// 8019B51E: using guessed type __int16 word_8019B51E;
// 8019B520: using guessed type __int16 word_8019B520;
// 8019B522: using guessed type __int16 word_8019B522;
// 8019B524: using guessed type __int16 g_AttackCooldown;

//----- (80027344) --------------------------------------------------------
int __fastcall ApplyStatusEffect(
        unsigned __int16 a1,
        unsigned __int16 a2,
        unsigned __int16 a3,
        char a4,
        unsigned __int16 a5,
        unsigned __int16 a6,
        unsigned __int16 a7,
        unsigned __int16 a8,
        unsigned __int16 a9,
        unsigned __int16 a10,
        unsigned __int16 a11,
        _DWORD *a12)
{
  int result; // $v0
  char v14; // $s2
  __int16 v18; // $a3
  __int16 v19; // $a2
  __int16 v20; // $s1
  __int16 v21; // $a1
  __int16 v22; // $a0
  int v23; // $s0
  signed int v24; // $v1
  int v25; // $s1
  int v26; // $s1
  int v27; // $s1
  int v28; // $s1
  int v29; // $s1
  int v30; // $s1
  int v31; // $s1
  int v32; // $v0

  result = byte_8019B564;
  v14 = a4;
  if ( !byte_8019B564 )
  {
    if ( (g_EquipAccessory1 == 54 || g_EquipAccessory2 == 54) && rand(a1) < 0x4000 )
      v14 = a4 & 0xF8;
    v18 = 300;
    if ( g_EquipAccessory1 == 58 || (v19 = 500, g_EquipAccessory2 == 58) )
    {
      v19 = 250;
      v20 = 300;
      v21 = 100;
      v22 = 300;
    }
    else
    {
      v18 = 600;
      v20 = 600;
      v21 = 200;
      v22 = 600;
    }
    switch ( v14 & 0xF )
    {
      case 1:
        word_8019B51C = v18;
        word_8019B51A = 1;
        CalculatePlayerStats();
        break;
      case 2:
        word_8019B520 = v19;
        break;
      case 3:
        if ( g_EquipAccessory1 != 53 && g_EquipAccessory2 != 53 || rand(v22) >= 0x4000 )
        {
          v23 = g_DefensePoison;
          if ( v23 < (100 * rand(v22)) >> 15 )
            g_PoisenStatus = v20;
        }
        break;
      case 4:
        g_AttackCooldown = v21;
        break;
      case 5:
        word_8019B522 = v22;
        break;
      case 6:
        v24 = g_MaxMP / 6u;
        if ( v24 >= g_CurrentMP )
          g_CurrentMP = 0;
        else
          g_CurrentMP -= v24;
        break;
      case 7:
        g_PoisenStatus = 0;
        break;
      default:
        break;
    }
    v25 = sub_80026E38(g_unk_8019B4EC, g_DefenseStrike, a1);
    v26 = v25 + sub_80026E38(g_unk_8019B4EC, g_DefenseSlash, a2);
    v27 = v26 + sub_80026E38(g_unk_8019B4EC, g_DefensePierce, a3);
    v28 = v27 + sub_80026E38(g_unk_8019B4EC, g_DefenseBlackMagic, a5);
    v29 = v28 + sub_80026E38(g_unk_8019B4EC, g_DefenseFire, a6);
    v30 = v29 + sub_80026E38(g_unk_8019B4EC, g_DefenseEarth, a7);
    v31 = v30 + sub_80026E38(g_unk_8019B4EC, g_DefenseWind, a8);
    v32 = sub_80026E38(g_unk_8019B4EC, g_DefenseWater, a9);
    return sub_80026F34(a12, a11 * ((a10 * (v31 + v32) + 0x8000) >> 16) / 10, v14);
  }
  return result;
}
// 800274F8: variable 'v22' is possibly undefined
// 80062BF0: using guessed type int __fastcall rand(_DWORD);
// 8019B4DA: using guessed type __int16 g_MaxMP;
// 8019B4DC: using guessed type __int16 g_CurrentMP;
// 8019B4EC: using guessed type __int16 g_unk_8019B4EC;
// 8019B506: using guessed type __int16 g_DefenseStrike;
// 8019B508: using guessed type __int16 g_DefenseSlash;
// 8019B50A: using guessed type __int16 g_DefensePierce;
// 8019B50C: using guessed type __int16 g_DefensePoison;
// 8019B50E: using guessed type __int16 g_DefenseBlackMagic;
// 8019B510: using guessed type __int16 g_DefenseFire;
// 8019B512: using guessed type __int16 g_DefenseEarth;
// 8019B514: using guessed type __int16 g_DefenseWind;
// 8019B516: using guessed type __int16 g_DefenseWater;
// 8019B518: using guessed type __int16 g_PoisenStatus;
// 8019B51A: using guessed type __int16 word_8019B51A;
// 8019B51C: using guessed type __int16 word_8019B51C;
// 8019B520: using guessed type __int16 word_8019B520;
// 8019B522: using guessed type __int16 word_8019B522;
// 8019B524: using guessed type __int16 g_AttackCooldown;
// 8019B564: using guessed type char byte_8019B564;
// 8019B589: using guessed type char g_EquipAccessory1;
// 8019B58A: using guessed type char g_EquipAccessory2;

//----- (80027700) --------------------------------------------------------
int __fastcall sub_80027700(
        int *a1,
        int a2,
        signed int a3,
        int a4,
        unsigned __int16 a5,
        unsigned __int16 a6,
        unsigned __int16 a7,
        unsigned __int16 a8,
        char a9,
        unsigned __int16 a10,
        unsigned __int16 a11,
        unsigned __int16 a12,
        unsigned __int16 a13,
        unsigned __int16 a14,
        __int16 a15,
        unsigned __int16 a16)
{
  int *v18; // $s4
  int v19; // $v1
  int result; // $v0
  int v21; // $v0
  unsigned int v22; // $v0

  v18 = a1;
  if ( (a15 & 0x8000) != 0 )
    v18 = 0;
  if ( a4 == 0x8000 )
    goto LABEL_6;
  if ( a4 != 32769 )
  {
    v19 = sub_80027E20(*a1, a1[1], a1[2], a3, a4);
    result = v19 < a2;
    if ( v19 != -1 )
      goto LABEL_10;
    goto LABEL_8;
  }
  if ( a1[1] < *&g_LanguageID[0].header[6] - 1700 )
  {
LABEL_8:
    v19 = -9999999;
    goto LABEL_9;
  }
LABEL_6:
  v19 = sub_80015B74(a1, a3, &g_LanguageID[0].header[2], 800, 1700);
LABEL_9:
  result = v19 < a2;
LABEL_10:
  if ( !result )
  {
    v21 = v19 << 12;
    if ( a5 == 4096 )
    {
      LOWORD(v22) = a15 & 0x7FFF;
    }
    else
    {
      if ( a3 == -1 && v21 == 0x80000000 )
        _break(6u, 0);
      v22 = ((a15 & 0x7FFF) * (4096 - (((v21 / a3) * (4096 - a5)) >> 12))) >> 12;
    }
    return ApplyStatusEffect(a6, a7, a8, a9, a10, a11, a12, a13, a14, v22, a16, v18);
  }
  return result;
}
// 8002783C: conditional instruction was optimized away because $s0.4!=0

//----- (8002791C) --------------------------------------------------------
int __fastcall GatherCameraContext(_DWORD *a1, _WORD *a2)
{
  int result; // $v0

  *a1 = *&g_LanguageID[0].header[2];
  a1[2] = *&g_LanguageID[0].menus[0].header.posY;
  a1[1] = word_8019B5F8 + *&g_LanguageID[0].header[6] + word_8019B5FC - 1600;
  *a2 = *&g_LanguageID[0].menus[0].header.extra[2];
  a2[1] = *&g_LanguageID[0].menus[0].header.extra[4];
  result = *&g_LanguageID[0].menus[0].header.extra[6];
  a2[2] = *&g_LanguageID[0].menus[0].header.extra[6];
  return result;
}
// 8019B5F8: using guessed type __int16 word_8019B5F8;
// 8019B5FC: using guessed type __int16 word_8019B5FC;

//----- (80027994) --------------------------------------------------------
int ResetPlayerBuffers()
{
  word_8019B532 = 0;
  word_8019B530 = 0;
  word_8019B52E = 0;
  word_8019B52C = 0;
  word_8019B52A = 0;
  word_8019B528 = 0;
  word_8019B526 = 0;
  g_AttackCooldown = 0;
  word_8019B522 = 0;
  word_8019B520 = 0;
  word_8019B51E = 0;
  word_8019B51C = 0;
  word_8019B51A = 0;
  g_PoisenStatus = 0;
  byte_8019B599 = 0;
  g_CurrentHP = g_MaxHP;
  g_CurrentMP = g_MaxMP;
  return FinalizePlayerInit();
}
// 8019B4D6: using guessed type __int16 g_MaxHP;
// 8019B4D8: using guessed type __int16 g_CurrentHP;
// 8019B4DA: using guessed type __int16 g_MaxMP;
// 8019B4DC: using guessed type __int16 g_CurrentMP;
// 8019B518: using guessed type __int16 g_PoisenStatus;
// 8019B51A: using guessed type __int16 word_8019B51A;
// 8019B51C: using guessed type __int16 word_8019B51C;
// 8019B51E: using guessed type __int16 word_8019B51E;
// 8019B520: using guessed type __int16 word_8019B520;
// 8019B522: using guessed type __int16 word_8019B522;
// 8019B524: using guessed type __int16 g_AttackCooldown;
// 8019B526: using guessed type __int16 word_8019B526;
// 8019B528: using guessed type __int16 word_8019B528;
// 8019B52A: using guessed type __int16 word_8019B52A;
// 8019B52C: using guessed type __int16 word_8019B52C;
// 8019B52E: using guessed type __int16 word_8019B52E;
// 8019B530: using guessed type __int16 word_8019B530;
// 8019B532: using guessed type __int16 word_8019B532;
// 8019B599: using guessed type char byte_8019B599;

//----- (80027A4C) --------------------------------------------------------
int InitPlayerStats()
{
  SpellDataEntry *v0; // $a2
  int v1; // $a1

  byte_8019B4CC = 1;
  dword_8019B4C4 = 0;
  g_PlayerGold = 0;
  word_8019B600 = 0;
  word_8019B602 = 0;
  g_EquippedHead = -1;
  g_EquippedBody = -1;
  g_EquippedArms = -1;
  g_EquippedLegs = -1;
  g_EquippedShield = -1;
  g_EquipAccessory1 = -1;
  g_EquipAccessory2 = -1;                       // 
                                                //      ?
  g_MaxMP = maxHp_word_80079196;
  g_MaxHP = g_LevelStatEntry.mp_gain;
  g_Strength = word_80079198;
  g_MagicPower = word_8007919A;
  dword_8019B4C8 = dword_8007919C;
  sub_80027ED0(255, 255);
  *&g_ActiveWeaponSpell.PlayerHas = 0;
  SsSetAutoKeyOffMode(255);                     // PS1 BIOS: - 
  sub_8002810C(0);
  sub_80027E80(0xFFu);
  sub_80027EA8(0xFFu);
  v0 = g_SpellEntryTable;
  v1 = 63;
  g_LanguageID[0].menus[0].items[0].refX = 2500;
  *&g_LanguageID[0].header[6] = 0xFFFFCE00;
  *&g_LanguageID[0].menus[0].header.extra[10] = 0;
  g_LanguageID[0].menus[0].items[0].refY = 0;
  *&g_LanguageID[0].header[2] = 71680;
  *&g_LanguageID[0].menus[0].header.posY = 98304;
  word_8019B5EC = 5;
  do
  {
    v0->PlayerHas = 0;
    --v1;
    v0 = (v0 + 26);
  }
  while ( v1 != -1 );
  return ResetPlayerBuffers();
}
// 80079196: using guessed type __int16 maxHp_word_80079196;
// 80079198: using guessed type __int16 word_80079198;
// 8007919A: using guessed type __int16 word_8007919A;
// 8007919C: using guessed type int dword_8007919C;
// 8019B4C4: using guessed type int dword_8019B4C4;
// 8019B4C8: using guessed type int dword_8019B4C8;
// 8019B4CC: using guessed type char byte_8019B4CC;
// 8019B4D6: using guessed type __int16 g_MaxHP;
// 8019B4DA: using guessed type __int16 g_MaxMP;
// 8019B4E8: using guessed type __int16 g_Strength;
// 8019B4EA: using guessed type __int16 g_MagicPower;
// 8019B4F0: using guessed type int g_PlayerGold;
// 8019B584: using guessed type char g_EquippedHead;
// 8019B585: using guessed type char g_EquippedBody;
// 8019B586: using guessed type char g_EquippedShield;
// 8019B587: using guessed type char g_EquippedArms;
// 8019B588: using guessed type char g_EquippedLegs;
// 8019B589: using guessed type char g_EquipAccessory1;
// 8019B58A: using guessed type char g_EquipAccessory2;
// 8019B5EC: using guessed type __int16 word_8019B5EC;
// 8019B600: using guessed type __int16 word_8019B600;
// 8019B602: using guessed type __int16 word_8019B602;

//----- (80027BCC) --------------------------------------------------------
int PlayerSetDefault()
{
  int result; // $v0

  *&g_ActiveWeaponSpell.DmgPhysical = &unk_80079644;//  - . ?
  InitPlayerStats();                            //  
  result = 1;
  g_Option_Sound = 1;                           //    ?
  g_Option_Music = 1;
  g_Option_ShowHPMP = 1;
  g_Option_ShowCompass = 1;
  g_Option_ShowPreviewItem3D = 1;
  g_Option_WalkEffect = 1;
  g_PhysicsReady = 0;
  return result;
}
// 8019B4CE: using guessed type char g_PhysicsReady;
// 8019B58B: using guessed type char g_Option_Sound;
// 8019B58C: using guessed type char g_Option_Music;
// 8019B58D: using guessed type char g_Option_ShowHPMP;
// 8019B58E: using guessed type char g_Option_ShowCompass;
// 8019B58F: using guessed type char g_Option_ShowPreviewItem3D;
// 8019B590: using guessed type char g_Option_WalkEffect;

//----- (80027C38) --------------------------------------------------------
int Player_ResetMovement()
{
  int result; // $v0

  word_8019B5F4 = 0;
  word_8019B5F6 = 0;
  word_8019B5F2 = 0;
  word_8019B5F0 = 0;
  word_8019B5EE = 0;
  result = 480;
  g_PadKey &= 0x1E0u;
  return result;
}
// 8019B5EE: using guessed type __int16 word_8019B5EE;
// 8019B5F0: using guessed type __int16 word_8019B5F0;
// 8019B5F2: using guessed type __int16 word_8019B5F2;
// 8019B5F4: using guessed type __int16 word_8019B5F4;
// 8019B5F6: using guessed type __int16 word_8019B5F6;
// 8019B606: using guessed type __int16 g_PadKey;

//----- (80027CA8) --------------------------------------------------------
int Player_Spawn()
{
  char layer; // $a0

  g_PlayerJumpState = 0;
  layer = 2;
  if ( !word_8019B5EC )
    layer = 1;
  *&g_LanguageID[0].header[6] = Map_GetCellData(
                                  layer,
                                  *&g_LanguageID[0].header[2],
                                  *&g_LanguageID[0].menus[0].header.posY,
                                  800,
                                  1700);
  Player_CheckHeadroom();
  g_PhysicsReady = 1;
  g_PlayerIsMoving = 0;
  word_8019B5FE = 0;
  byte_8019B591 = 0;
  Player_ResetMovement();
  return Map_MarkOccupiedTiles(*&g_LanguageID[0].header[2], *&g_LanguageID[0].menus[0].header.posY, 800, 1);
}
// 8019B4CE: using guessed type char g_PhysicsReady;
// 8019B538: using guessed type int g_PlayerJumpState;
// 8019B591: using guessed type char byte_8019B591;
// 8019B594: using guessed type char g_PlayerIsMoving;
// 8019B5EC: using guessed type __int16 word_8019B5EC;
// 8019B5FE: using guessed type __int16 word_8019B5FE;

//----- (80027D54) --------------------------------------------------------
int __fastcall sub_80027D54(int *a1, __int16 a2, signed int a3, int a4)
{
  int result; // $v0
  int v8; // $s1
  unsigned __int16 v9; // $v1
  unsigned __int16 v10; // $a0

  result = sub_80027E20(*a1, 0xFFFF, a1[2], a3, 0);
  v8 = result;
  if ( result != -1 )
  {
    v9 = (Math_Atan2_Fixed(*&g_LanguageID[0].header[2] - *a1, *&g_LanguageID[0].menus[0].header.posY - a1[2]) - a2) & 0xFFF;
    v10 = v9;
    if ( v9 >= 0x801u )
      v10 = 4096 - v9;
    result = v8;
    if ( a4 < v10 )
      return -1;
  }
  return result;
}

//----- (80027E20) --------------------------------------------------------
int __fastcall sub_80027E20(int a1, int a2, int a3, signed int a4, int a5)
{
  return GetDistanceIfInRange(&g_LanguageID[0].header[2], a1, a2, a3, a4, 1700, a5);
}

//----- (80027E80) --------------------------------------------------------
int __fastcall sub_80027E80(unsigned __int8 a1)
{
  int result; // $v0

  LOBYTE(g_QuickSlotItem) = a1;
  result = 255;
  if ( a1 != 255 )
    HIBYTE(g_QuickSlotItem) = -1;
  return result;
}
// 8019B55C: using guessed type __int16 g_QuickSlotItem;

//----- (80027EA8) --------------------------------------------------------
int __fastcall sub_80027EA8(unsigned __int8 a1)
{
  int result; // $v0

  HIBYTE(g_QuickSlotItem) = a1;
  result = 255;
  if ( a1 != 255 )
    LOBYTE(g_QuickSlotItem) = -1;
  return result;
}
// 8019B55C: using guessed type __int16 g_QuickSlotItem;

//----- (80027ED0) --------------------------------------------------------
BOOL __fastcall sub_80027ED0(char a1, char a2)
{
  switch ( a2 )
  {
    case 0:
      g_EquippedHead = a1;
      break;
    case 1:
      g_EquippedBody = a1;
      break;
    case 2:
      g_EquippedArms = a1;
      break;
    case 3:
      g_EquippedLegs = a1;
      break;
    case 4:
      g_EquippedShield = a1;
      break;
    case 5:
      g_EquipAccessory1 = a1;
      break;
    case 6:
      g_EquipAccessory2 = a1;
      break;
    default:
      break;
  }
  if ( g_EquippedHead == 255 )
    dword_8019B568 = 0;
  else
    dword_8019B568 = &unk_801DD318 + 32 * g_EquippedHead;
  if ( g_EquippedBody == 255 )
    dword_8019B56C = 0;
  else
    dword_8019B56C = &unk_801DD318 + 32 * g_EquippedBody;
  if ( g_EquippedArms == 255 )
    dword_8019B574 = 0;
  else
    dword_8019B574 = &unk_801DD318 + 32 * g_EquippedArms;
  if ( g_EquippedLegs == 255 )
    dword_8019B578 = 0;
  else
    dword_8019B578 = &unk_801DD318 + 32 * g_EquippedLegs;
  if ( g_EquippedShield == 255 )
    dword_8019B570 = 0;
  else
    dword_8019B570 = &unk_801DD318 + 32 * g_EquippedShield;
  if ( g_EquipAccessory1 == 255 )
    dword_8019B57C = 0;
  else
    dword_8019B57C = &unk_801DD318 + 32 * g_EquipAccessory1;
  if ( g_EquipAccessory2 == 255 )
    dword_8019B580 = 0;
  else
    dword_8019B580 = &unk_801DD318 + 32 * g_EquipAccessory2;
  return CalculatePlayerStats();
}
// 8019B568: using guessed type int dword_8019B568;
// 8019B56C: using guessed type int dword_8019B56C;
// 8019B570: using guessed type int dword_8019B570;
// 8019B574: using guessed type int dword_8019B574;
// 8019B578: using guessed type int dword_8019B578;
// 8019B57C: using guessed type int dword_8019B57C;
// 8019B580: using guessed type int dword_8019B580;
// 8019B584: using guessed type char g_EquippedHead;
// 8019B585: using guessed type char g_EquippedBody;
// 8019B586: using guessed type char g_EquippedShield;
// 8019B587: using guessed type char g_EquippedArms;
// 8019B588: using guessed type char g_EquippedLegs;
// 8019B589: using guessed type char g_EquipAccessory1;
// 8019B58A: using guessed type char g_EquipAccessory2;

//----- (8002810C) --------------------------------------------------------
BOOL __fastcall sub_8002810C(unsigned __int8 a1)
{
  byte_8019B4CF = 10;
  g_Stamina_8019B4DE = 0;
  g_AttackStartStamina = 0;
  g_EquippedWeapon = a1;
  if ( a1 != 255 )
  {
    *&g_ActiveWeaponSpell.StatusEffect = &g_EquipmentDatabase[17 * a1];
    ExtractFileSections(RES_FDAT, a1 + 49, *&g_ActiveWeaponSpell.DmgPhysical);
    sub_8003654C(0x20u, *&g_ActiveWeaponSpell.DmgPhysical);
  }
  g_ActiveWeaponSpell.field_14 = -1;
  *&g_ActiveWeaponSpell.DmgFire = 0;
  byte_8019B55A = 0;
  byte_8019B564 = 0;
  return CalculatePlayerStats();
}
// 8019B4CF: using guessed type char byte_8019B4CF;
// 8019B4DE: using guessed type __int16 g_Stamina_8019B4DE;
// 8019B4E0: using guessed type __int16 g_AttackStartStamina;
// 8019B55A: using guessed type char byte_8019B55A;
// 8019B55F: using guessed type char g_EquippedWeapon;
// 8019B564: using guessed type char byte_8019B564;
// 801CB8AC: using guessed type _DWORD g_EquipmentDatabase[306];

//----- (800281CC) --------------------------------------------------------
bool __fastcall MeleeAttack_800281CC(int attack_type)
{
  bool result; // $v0
  __int16 range; // $v0

  result = NULL;
  if ( g_ActiveWeaponSpell.field_14 == -1 && g_EquippedWeapon != NULL )
  {
    result = g_AttackCooldown;
    if ( !g_AttackCooldown )
    {
      g_CurrentAttackDir = attack_type;
      g_ActiveWeaponSpell.field_14 = 0;
      if ( attack_type )
      {
        *&g_ActiveWeaponSpell.manaCost = *(*&g_ActiveWeaponSpell.StatusEffect + 38);
        range = *(*&g_ActiveWeaponSpell.StatusEffect + 46);
      }
      else
      {
        *&g_ActiveWeaponSpell.manaCost = *(*&g_ActiveWeaponSpell.StatusEffect + 30);
        range = *(*&g_ActiveWeaponSpell.StatusEffect + 44);
      }
      g_AttackHitRange = range;
      g_AttackStartStamina = g_Stamina_8019B4DE;
      // cooldown?
      result = -120;
      //  " ":     
      if ( g_Stamina_8019B4DE == 5000 && (result = g_MagicStamina_8019B4E2, g_MagicStamina_8019B4E2 == 5000) )
      {
        g_FullStaminaBonus = 1;
        result = *(*&g_ActiveWeaponSpell.StatusEffect + 5);
        byte_8019B562 = result;
      }
      else
      {
        g_FullStaminaBonus = 0;
      }
      g_Stamina_8019B4DE = 0;
      byte_8019B560 = 0;
    }
  }
  return result;
}
// 8019B4DE: using guessed type __int16 g_Stamina_8019B4DE;
// 8019B4E0: using guessed type __int16 g_AttackStartStamina;
// 8019B4E2: using guessed type __int16 g_MagicStamina_8019B4E2;
// 8019B524: using guessed type __int16 g_AttackCooldown;
// 8019B558: using guessed type __int16 g_AttackHitRange;
// 8019B55E: using guessed type char g_CurrentAttackDir;
// 8019B55F: using guessed type char g_EquippedWeapon;
// 8019B560: using guessed type char byte_8019B560;
// 8019B562: using guessed type char byte_8019B562;
// 8019B563: using guessed type char g_FullStaminaBonus;

//----- (800282F0) --------------------------------------------------------
Entity **__fastcall CalculateTrajectory(__int16 a1, _DWORD *a2, __int16 *a3, int *a4)
{
  Entity **v8; // $s0
  unsigned __int8 *v9; // $a1
  int v11; // [sp+20h] [-8h] BYREF
  __int16 v12; // [sp+24h] [-4h]

  if ( a2 )
  {
    LOWORD(v11) = -*&g_LanguageID[0].menus[0].header.extra[2];
    HIWORD(v11) = *&g_LanguageID[0].menus[0].header.extra[4];
    v12 = *&g_LanguageID[0].menus[0].header.extra[6];
    sub_80015614(&v11, &g_MagicParticlePos, a2);
    *a2 += *&g_LanguageID[0].header[2];
    a2[1] = a2[1] - 1600 + *&g_LanguageID[0].header[6];
    a2[2] += *&g_LanguageID[0].menus[0].header.posY;
  }
  v8 = sub_8003D200(
         &g_LanguageID[0].header[2],
         *&g_LanguageID[0].menus[0].header.extra[4],
         *&g_LanguageID[0].menus[0].header.extra[2],
         22000,
         512,
         512,
         a4,
         0);
  dword_801779D0 = v8;
  if ( v8 )
  {
    v9 = sub_8003C184(&g_ObjectTypeTable[30 * *(v8 + 2)], 0x82u);
    if ( v9 )
    {
      if ( (v8[10] & 0x100) == 0 )
        sub_8003BB60(v8, v9);
    }
  }
  if ( a3 )
  {
    v11 = *&g_LanguageID[0].menus[0].header.extra[2];
    v12 = *&g_LanguageID[0].menus[0].header.extra[6];
    sub_80015538(&v11, a3);
    sub_80015694(a1, a3);
  }
  return v8;
}
// 801779D0: using guessed type int dword_801779D0;
// 8019B5DC: using guessed type int g_MagicParticlePos;

//----- (80028498) --------------------------------------------------------
void __fastcall SpawnMagicProjectile(int item_id, SVECTOR *vx)
{
  __int16 v2; // $a0
  Entity **v3; // $v0
  Entity **v4; // $s0
  int v5; // $v0
  Entity **v6; // $s0
  int v7; // $t2
  int *v8; // $s1
  int v9; // $s0
  int v10; // $v1
  int v11; // $a0
  int v12; // $v0
  int v13; // $a0
  int v14; // $v0
  int v15; // $a0
  int v16; // $v0
  char v17; // $v0
  __int16 v18; // $a0
  __int16 v19; // $a0
  Entity **v20; // $s0
  int v21; // $t2
  __int16 v22; // $s1
  char v23; // $v0
  Entity *v24; // $v0
  int *v25; // $s1
  int v26; // $s3
  int i; // $s0
  int v28; // $v1
  unsigned __int8 v29; // $a2
  int v30; // $a0
  int v31; // $a1
  int v32; // $a2
  int v33; // $a0
  int v34; // $a1
  int v35; // $a2
  unsigned __int8 v36; // $a2
  int v37; // [sp+14h] [-44h]
  __int16 v38; // [sp+18h] [-40h]
  __int16 v39; // [sp+18h] [-40h]
  __int16 v40; // [sp+1Ch] [-3Ch]
  __int16 v41; // [sp+1Ch] [-3Ch]
  __int16 v42; // [sp+20h] [-38h]
  __int16 v43; // [sp+20h] [-38h]
  __int16 v44; // [sp+24h] [-34h]
  __int16 v45; // [sp+24h] [-34h]
  __int16 v46; // [sp+28h] [-30h]
  __int16 v47; // [sp+28h] [-30h]
  SVECTOR *out_origin; // [sp+30h] [-28h] BYREF
  Entity *v49; // [sp+34h] [-24h]
  int v50; // [sp+38h] [-20h]
  int v51; // [sp+3Ch] [-1Ch]
  int out_angles; // [sp+40h] [-18h] BYREF
  __int16 v53; // [sp+44h] [-14h]
  int out_unused; // [sp+50h] [-8h] BYREF
  int v55; // [sp+54h] [-4h] BYREF
  unsigned __int8 v56; // [sp+70h] [+18h]
  unsigned __int8 v57; // [sp+70h] [+18h]

  v56 = item_id;
  switch ( item_id )
  {
    case WaterFall:                             //    ,      Entity,  ..    item_id   
      v6 = CalculateTrajectory(5000, &out_origin, &out_angles, &out_unused);
      v7 = 255;
      if ( v6 )
        v7 = (-1108378657 * (v6 - g_ObjectArray)) >> 2;
      out_origin = (out_origin + out_angles);
      v50 += v53;
      SpawnParticleEntity(10, 0x12u, 0x6Fu, &out_origin, 0, v7, v38, v40, v42, v44, v46);
      return;
    case Stone:
      v2 = 500;
      goto LABEL_3;
    case EarthWave:
      SpawnParticleEntity(10, 0x13u, item_id, &g_LanguageID[0].header[2], 0, 4096, 256, 4096, v42, v44, v46);
      return;
    case Meteor:
      v3 = CalculateTrajectory(5000, &out_origin, &out_angles, &out_unused);
      v4 = v3;
      if ( v3 )
      {
        out_origin = (&v3[11]->active + (*(v3 + 40) << 14) / 600);
        v49 = (v3[12] + (*(v3 + 41) << 14) / 600);
        v50 = v3[13] + (*(v3 + 42) << 14) / 600;
        if ( !CollisionWithTilemap(out_origin, v49, v50, 10, 10) )
          goto LABEL_11;
        out_origin = v4[11];
        v49 = v4[12];
        v5 = v4[13];
      }
      else
      {
        out_origin = (out_origin + out_angles);
        v49 = *&g_LanguageID[0].header[6];
        v5 = v53 + v50;
      }
      v50 = v5;
LABEL_11:
      SpawnParticleEntity(10, 0x12u, 0x72u, &out_origin, 0, v37, v38, v40, v42, v44, v46);
      return;
    case WindCutter:
      goto LABEL_21;
    case IceStorm:
      v19 = 200;
      goto LABEL_30;
    case Freeze:
      v18 = 250;
      goto LABEL_22;
    case FireBall:
      v2 = 1000;
LABEL_3:
      CalculateTrajectory(v2, &out_origin, &out_angles, &out_unused);
      goto LABEL_4;
    case FireWall:
      CalculateTrajectory(700, &out_origin, &out_angles, &out_unused);
      SpawnParticleEntity(
        10,
        0x12u,
        0x6Au,
        &out_origin,
        &out_angles,
        &g_LanguageID[0].menus[0].header.extra[2],
        v38,
        v40,
        v42,
        v44,
        v46);
      return;
    case FireStorm:
      v19 = 500;
LABEL_30:
      v20 = CalculateTrajectory(v19, &out_origin, &out_angles, &out_unused);
      v21 = 255;
      if ( v20 )
        v21 = (-1108378657 * (v20 - g_ObjectArray)) >> 2;
      SpawnParticleEntity(10, 0x12u, v56, &out_origin, &out_angles, v21, v38, v40, v42, v44, v46);
      return;
    case Flame:
      v18 = 300;
      goto LABEL_22;
    case LightningVolt:
      CalculateTrajectory(600, &out_origin, &out_angles, &v55);
      if ( v55 == -1 )
      {
        v55 = 10;
      }
      else
      {
        v55 = v55 / 600 - 8;
        if ( v55 < 2 )
          v55 = 2;
      }
      HIWORD(out_angles) = 0;
      SpawnParticleEntity(10, 0x12u, 0x67u, &out_origin, &out_angles, v55, v38, v40, v42, v44, v46);
      return;
    case Flash:
      v22 = *&g_LanguageID[0].menus[0].header.extra[4];
      *&g_LanguageID[0].menus[0].header.extra[4] -= 2 * g_MagicParticlePos;
      CalculateTrajectory(150, &out_origin, &out_angles, &out_unused);
      LOWORD(g_MagicParticlePos) = g_MagicParticlePos + 100;
      *&g_LanguageID[0].menus[0].header.extra[4] = v22;
      SpawnParticleEntity(
        10,
        0x12u,
        v56,
        &out_origin,
        &out_angles,
        &g_LanguageID[0].menus[0].header.extra[2],
        600,
        60,
        128,
        140,
        160);
      return;
    case Seath:
      v8 = dword_8006E200;
      v9 = 3;
      do
      {
        v10 = v8[1];
        g_MagicParticlePos = *v8;
        g_MagicParticleRadius = v10;
        CalculateTrajectory(800, &out_origin, &out_angles, &out_unused);
        v8 += 2;
        v12 = rand(v11);
        LOWORD(out_angles) = out_angles - 32 + (v12 >> 9);
        v14 = rand(v13);
        --v9;
        HIWORD(out_angles) = HIWORD(out_angles) - 32 + (v14 >> 9);
        v16 = rand(v15);
        v53 = v53 - 32 + (v16 >> 9);
        SpawnParticleEntity(10, 0x12u, v56, &out_origin, &out_angles, v37, v38, v40, v42, v44, v46);
      }
      while ( v9 != -1 );
      return;
    case Dispoison:
      //      ? 
      // Moodlight Sword     ?
      v36 = 14;
      goto LABEL_57;
    case ResistFire:
      SpawnParticleEntity(10, 0x10u, 0xFu, &g_LanguageID[0].header[2], &out_angles, v37, v38, v40, v42, v44, v46);
      word_8019B526 = 900;
      CalculatePlayerStats();
      return;
    case EarthHeal:
      v36 = 16;
      goto LABEL_57;
    case MissileShield:
      SpawnParticleEntity(10, 0x10u, 0x11u, &g_LanguageID[0].header[2], &out_angles, v37, v38, v40, v42, v44, v46);
      word_8019B528 = 900;
      CalculatePlayerStats();
      return;
    case Breath:
      v36 = 19;
LABEL_57:
      SpawnParticleEntity(10, 0x10u, v36, &g_LanguageID[0].header[2], &out_angles, v37, v38, v40, v42, v44, v46);
      return;
    case ShidenMagicA:
    case ShidenMagicB:
    case IceBladeMagicA:
      CalculateTrajectory(900, &out_origin, &out_angles, &out_unused);
      SpawnParticleEntity(
        10,
        WeaponA3,
        v56,
        &out_origin,
        &out_angles,
        &g_LanguageID[0].menus[0].header.extra[2],
        v38,
        v40,
        v42,
        v44,
        v46);
      return;
    case IceBladeMagicB:
      CalculateTrajectory(50, 0, &out_angles, &out_unused);
      v30 = *&vx->vz;
      v31 = *&vx[1].vx;
      v32 = *&vx[1].vz;
      out_origin = *&vx->vx;
      v49 = v30;
      v50 = v31;
      v51 = v32;
      goto LABEL_23;
    case SeathsSwordMagicA:
      v18 = 1000;
      goto LABEL_22;
    case MoonlightSwordMagicA:                  //   ?        ?     ?
      v23 = 113;
      goto LABEL_41;
    case MoonlightSwordMagicB:
      v23 = 115;
LABEL_41:
      v57 = v23;
      g_MagicParticlePos = 0;
      g_MagicParticleRadius = 100;
      CalculateTrajectory(600, &out_origin, &out_angles, &out_unused);
      v24 = SpawnParticleEntity(
              10,
              0x12u,
              v57,
              &out_origin,
              &out_angles,
              &g_LanguageID[0].menus[0].header.extra[2],
              v38,
              v40,
              v42,
              v44,
              v46);
      v25 = dword_8006E1E0;
      if ( v24 )
      {
        v26 = (954437177 * (v24 - &g_ParticleArray)) >> 3;
        for ( i = 3; i != -1; --i )
        {
          v28 = v25[1];
          g_MagicParticlePos = *v25;
          g_MagicParticleRadius = v28;
          CalculateTrajectory(600, &out_origin, &out_angles, &out_unused);
          v29 = *(v25 + 6);
          v25 += 2;
          SpawnParticleEntity(10, 0x12u, v29, &out_origin, &out_angles, v26, v39, v41, v43, v45, v47);
        }
      }
      return;
    case DarkSlayerMagicA:
      CalculateTrajectory(1000, &out_origin, &out_angles, &out_unused);
      v56 = 117;
      goto LABEL_23;
    case DarkSlayerMagicB:
      CalculateTrajectory(1000, &out_origin, &out_angles, &out_unused);
      v56 = 116;
      goto LABEL_4;
    case FlameSwordMagicA:
      CalculateTrajectory(550, 0, &out_angles, &out_unused);
      goto LABEL_50;
    case FlameSwordMagicB:
LABEL_50:
      v33 = *&vx->vz;
      v34 = *&vx[1].vx;
      v35 = *&vx[1].vz;
      out_origin = *&vx->vx;
      v49 = v33;
      v50 = v34;
      v51 = v35;
LABEL_4:
      SpawnParticleEntity(10, 0x12u, v56, &out_origin, &out_angles, v37, v38, v40, v42, v44, v46);
      return;
    case SpiderSwordMagicA:
      v17 = 118;
      goto LABEL_20;
    case SpiderSwordMagicB:
      v17 = 119;
LABEL_20:
      v56 = v17;
LABEL_21:
      v18 = 700;
LABEL_22:
      CalculateTrajectory(v18, &out_origin, &out_angles, &out_unused);
LABEL_23:
      SpawnParticleEntity(
        10,
        0x12u,
        v56,
        &out_origin,
        &out_angles,
        &g_LanguageID[0].menus[0].header.extra[2],
        v38,
        v40,
        v42,
        v44,
        v46);
      return;
    default:
      return;
  }
}
// 8002851C: variable 'v37' is possibly undefined
// 8002851C: variable 'v38' is possibly undefined
// 8002851C: variable 'v40' is possibly undefined
// 8002851C: variable 'v42' is possibly undefined
// 8002851C: variable 'v44' is possibly undefined
// 8002851C: variable 'v46' is possibly undefined
// 80028768: variable 'v11' is possibly undefined
// 80028780: variable 'v13' is possibly undefined
// 8002879C: variable 'v15' is possibly undefined
// 80028B40: variable 'v39' is possibly undefined
// 80028B40: variable 'v41' is possibly undefined
// 80028B40: variable 'v43' is possibly undefined
// 80028B40: variable 'v45' is possibly undefined
// 80028B40: variable 'v47' is possibly undefined
// 80062BF0: using guessed type int __fastcall rand(_DWORD);
// 8006E1E0: using guessed type int dword_8006E1E0[8];
// 8006E200: using guessed type int dword_8006E200[8];
// 8019B526: using guessed type __int16 word_8019B526;
// 8019B528: using guessed type __int16 word_8019B528;
// 8019B5DC: using guessed type int g_MagicParticlePos;
// 8019B5E0: using guessed type int g_MagicParticleRadius;

//----- (80028D54) --------------------------------------------------------
int __fastcall Local2World(int local, SVECTOR *world_pos)
{
  int v3; // $v1
  int result; // $v0
  __int16 transformed; // [sp+18h] [-10h] BYREF
  __int16 v6; // [sp+1Ah] [-Eh]
  __int16 v7; // [sp+1Ch] [-Ch]
  SVECTOR w_pos; // [sp+20h] [-8h] BYREF

  w_pos.vx = *&g_LanguageID[0].menus[0].header.extra[2] - *(*&g_ActiveWeaponSpell.StatusEffect + 60);
  w_pos.vy = *&g_LanguageID[0].menus[0].header.extra[4] - *(*&g_ActiveWeaponSpell.StatusEffect + 62);
  w_pos.vz = *&g_LanguageID[0].menus[0].header.extra[6] + *(*&g_ActiveWeaponSpell.StatusEffect + 64);
  // 0x20u  ,    
  sub_80036DD8(0x20u, g_CurrentAttackDir, g_ActiveWeaponSpell.field_14, local, &transformed);
  transformed -= *(*&g_ActiveWeaponSpell.StatusEffect + 52);
  v6 += *(*&g_ActiveWeaponSpell.StatusEffect + 54);
  v7 -= *(*&g_ActiveWeaponSpell.StatusEffect + 56);
  // sub_80015460(a1, v6);
  //   return ApplyMatrix(v6, a2, a3);
  sub_80015614(&w_pos.vx, &transformed, world_pos);
  *&world_pos->vx += *&g_LanguageID[0].header[2];
  v3 = *&world_pos->vz - 1600;
  *&world_pos[1].vx += *&g_LanguageID[0].menus[0].header.posY;
  result = word_8019B5F8 + *&g_LanguageID[0].header[6] + word_8019B5FC;
  *&world_pos->vz = v3 + result;
  return result;
}
// 8019B55E: using guessed type char g_CurrentAttackDir;
// 8019B5F8: using guessed type __int16 word_8019B5F8;
// 8019B5FC: using guessed type __int16 word_8019B5FC;

//----- (80028E8C) --------------------------------------------------------
BOOL sub_80028E8C()
{
  int v0; // $v1

  v0 = 0;
  if ( g_unk_8019B4EC >= 0x3Cu )
    return g_unk_8019B4EE >= 0x3Cu;
  return v0;
}
// 8019B4EC: using guessed type __int16 g_unk_8019B4EC;
// 8019B4EE: using guessed type __int16 g_unk_8019B4EE;

//----- (80028EC0) --------------------------------------------------------
void __fastcall CheckHasWeaponMagic(int item_id, int *a2, int a3)
{
  SpellDataEntry *spell; // $a0
  int local_pos; // $a0
  int v6; // $s0
  int v7; // $v0
  int v8; // $a0
  __int16 v9; // $v0
  int i; // $s0
  SVECTOR *svec; // $a1
  SVECTOR world_pos[2]; // [sp+10h] [-10h] BYREF

  // v4 =       (26 /)
  spell = (g_SpellEntryTable + 26 * item_id);
  if ( g_CurrentMP >= *&spell->manaCost )
  {
    //    " "
    *&g_ActiveWeaponSpell.PlayerHas = spell;
    if ( a2 )
    {
      g_MagicStamina_8019B4E2 = 0;
      g_CurrentMP -= *&spell->manaCost;
    }
    switch ( item_id )
    {
      case IceBladeMagicA:
        for ( i = 0; i < 4095; i += 684 )       // 6   
        {
          LOWORD(g_MagicParticlePos) = FixedCos(i) >> 3;// cos(angle) / 8
          HIWORD(g_MagicParticlePos) = FixedSin(i) >> 3;// sin(angle) / 8
          LOWORD(g_MagicParticleRadius) = 400;  // /
          //    switch
          SpawnMagicProjectile(item_id, svec);
        }
        return;
      case IceBladeMagicB:
        local_pos = *(dword_8006E220 + a3);     //    
        goto LABEL_7;
      case SeathsSwordMagicA:
        v6 = a3 << 9;                           //      ( )
        LOWORD(g_MagicParticlePos) = FixedCos(a3 << 9) >> 3;// cos(angle)
        v7 = FixedSin(v6);                      // sin(angle)
        v8 = item_id;
        HIWORD(g_MagicParticlePos) = v7 >> 3;
        v9 = 600;                               //  !
        goto LABEL_13;
      case FlameSwordMagicA:
      case FlameSwordMagicB:
        local_pos = 0;
LABEL_7:
        //   
        Local2World(local_pos, world_pos);      //    
        SpawnMagicProjectile(item_id, world_pos);
        return;
      default:
        v8 = item_id;
        g_MagicParticlePos = 13107400;          //  : , (1<<16)*200 + 400?
        v9 = 400;
LABEL_13:
        LOWORD(g_MagicParticleRadius) = v9;
        SpawnMagicProjectile(v8, a2);
        break;
    }
  }
}
// 8002901C: variable 'svec' is possibly undefined
// 80029060: variable 'a2' is possibly undefined
// 8006E220: using guessed type int dword_8006E220[3];
// 8019B4DC: using guessed type __int16 g_CurrentMP;
// 8019B4E2: using guessed type __int16 g_MagicStamina_8019B4E2;
// 8019B5DC: using guessed type int g_MagicParticlePos;
// 8019B5E0: using guessed type int g_MagicParticleRadius;

//----- (80029088) --------------------------------------------------------
int __fastcall ProcessMeleeAttack(int a1, int a2, unsigned __int8 a3)
{
  ObjectID v3; // $t0
  unsigned __int8 *l_wpn_table; // $s2
  int result; // $v0
  int v6; // $v0
  bool v7; // dc
  char v8; // $v0
  Entity *v9; // $s3
  int v10; // $a0
  int v11; // $v0
  int v12; // $s3
  __int16 v13; // $v1
  int v14; // $s3
  int v15; // $s1
  int v16; // $s4
  int v17; // $s5
  __int16 v18; // $s6
  __int16 v19; // $v0
  int v20; // $a0
  __int16 v21; // $v0
  int v22; // $v1
  int v23; // $s5
  int v24; // $v0
  unsigned __int16 entity_id; // $s3
  Entity **v26; // $s1
  EntityDefinition **v27; // $s2
  __int16 v28; // $s0
  int v29; // $a0
  __int16 v30; // [sp+18h] [-98h]
  __int16 v31; // [sp+1Ch] [-94h]
  __int16 v32; // [sp+20h] [-90h]
  __int16 v33; // [sp+24h] [-8Ch]
  __int16 v34; // [sp+28h] [-88h]
  __int16 v35; // [sp+38h] [-78h] BYREF
  __int16 v36; // [sp+3Ah] [-76h]
  __int16 v37; // [sp+3Ch] [-74h]
  __int16 v38; // [sp+40h] [-70h] BYREF
  __int16 refX; // [sp+42h] [-6Eh]
  __int16 v40; // [sp+44h] [-6Ch]
  int x; // [sp+48h] [-68h] BYREF
  int y; // [sp+4Ch] [-64h]
  int z; // [sp+50h] [-60h]
  int v44; // [sp+58h] [-58h] BYREF
  int v45; // [sp+5Ch] [-54h]
  int v46; // [sp+60h] [-50h]
  int v47[4]; // [sp+68h] [-48h] BYREF
  int v48[4]; // [sp+78h] [-38h] BYREF
  int *hit_pos; // [sp+88h] [-28h]
  int damage_multiply; // [sp+98h] [-18h]

  l_wpn_table = *&g_ActiveWeaponSpell.StatusEffect;
  if ( g_EquippedWeapon >= WeaponBow )
  {
    result = -1;
    if ( g_EquippedWeapon < WeaponA3 )
    {
      if ( g_ActiveWeaponSpell.field_14 == -1 )
      {
        g_Stamina_8019B4DE = 0;
        byte_8019B4CF = 0;
      }
      else if ( g_CurrentAttackDir )
      {
        result = g_ActiveWeaponSpell.field_14 + 400;
        if ( g_CurrentAttackDir == 1 )
        {
          g_ActiveWeaponSpell.field_14 += 400;
          v7 = result < 4095;
          result = -1;
          if ( !v7 )
          {
            g_ActiveWeaponSpell.field_14 = -1;
            g_Stamina_8019B4DE = 0;
          }
        }
      }
      else
      {
        if ( !g_ActiveWeaponSpell.field_14 )
        {
          if ( g_EquippedWeapon == WeaponBow )
          {
            a3 = 31;
            v3 = ItemArrowForTheBow;
          }
          else if ( g_EquippedWeapon == WeaponArbalest )
          {
            a3 = 30;
            v3 = ItemElfsBolt;
          }
          if ( g_EquipAccessory1 == EquipItemLightwaveRing || g_EquipAccessory2 == EquipItemLightwaveRing )
            a3 += 17;
          v6 = g_InventoryCounts[v3];
          v7 = v6 == 0;
          v8 = v6 - 1;
          if ( v7 )
          {
            *&g_ActiveWeaponSpell.DmgWind = 0;
          }
          else
          {
            g_InventoryCounts[v3] = v8;
            v9 = SpawnParticleEntity(
                   10,
                   0x12u,
                   a3,
                   &g_LanguageID[0].header[2],
                   0,
                   &g_LanguageID[0].menus[0].header.extra[2],
                   v30,
                   v31,
                   v32,
                   v33,
                   v34);
            *&g_ActiveWeaponSpell.DmgWind = v9;
            if ( v9 )
              v9->grind_z = 99;
          }
        }
        g_ActiveWeaponSpell.field_14 += *(l_wpn_table + 14);
        if ( g_ActiveWeaponSpell.field_14 >= 4095 )
          g_ActiveWeaponSpell.field_14 = 4095;
        if ( g_ActiveWeaponSpell.field_14 < *(l_wpn_table + 15) )
        {
          g_Stamina_8019B4DE = 0;
        }
        else
        {
          if ( !g_Stamina_8019B4DE && g_EquippedWeapon == WeaponBow )
            PlaySoundEffect(3, 110);
          v10 = *(l_wpn_table + 15);
          v11 = 5000 * (g_ActiveWeaponSpell.field_14 - v10);
          if ( v10 == 4095 )
            _break(7u, 0);
          if ( v10 == 4096 && v11 == 0x80000000 )
            _break(6u, 0);
          g_Stamina_8019B4DE = v11 / (4095 - v10);
        }
        v12 = *&g_ActiveWeaponSpell.DmgWind;
        if ( *&g_ActiveWeaponSpell.DmgWind )
        {
          v38 = *&g_LanguageID[0].menus[0].header.extra[2] - *(l_wpn_table + 30);
          refX = *&g_LanguageID[0].menus[0].header.extra[4] - *(l_wpn_table + 31);
          v40 = *&g_LanguageID[0].menus[0].header.extra[6] + *(l_wpn_table + 32);
          sub_80036DD8(0x20u, g_CurrentAttackDir, g_ActiveWeaponSpell.field_14, *(l_wpn_table + 29), &v35);
          v35 -= *(l_wpn_table + 26);
          v36 += *(l_wpn_table + 27);
          v37 -= *(l_wpn_table + 28);
          sub_80015614(&v38, &v35, &x);
          *(v12 + 20) = *&g_LanguageID[0].header[2] + x;
          *(v12 + 28) = *&g_LanguageID[0].menus[0].header.posY + z;
          *(v12 + 24) = *&g_LanguageID[0].header[6] + y + word_8019B5F8 + word_8019B5FC - 1600;
          sub_80036DD8(0x20u, g_CurrentAttackDir, g_ActiveWeaponSpell.field_14, *(l_wpn_table + 33), &v35);
          v35 -= *(l_wpn_table + 26);
          v36 += *(l_wpn_table + 27);
          v37 -= *(l_wpn_table + 28);
          sub_80015614(&v38, &v35, v48);
          sub_800159DC(x - v48[0], y - v48[1], z - v48[2], (v12 + 36));
        }
        result = g_PadKey & PAD_CROSS;
        if ( (g_PadKey & PAD_CROSS) == 0 )
        {
          if ( v12 )
          {
            *(v12 + 7) = 0;
            sub_80015538((v12 + 36), (v12 + 52));
            sub_80015694((900 * g_Stamina_8019B4DE) / 5000, (v12 + 52));
            v13 = *(v12 + 24);
            *(v12 + 14) = 50;
            *(v12 + 64) = v13;
          }
          result = 1;
          g_CurrentAttackDir = 1;
          g_ActiveWeaponSpell.field_14 = 0;
        }
      }
      return result;
    }
    result = None;
    if ( g_EquippedWeapon == None )
      return result;
  }
  if ( g_ActiveWeaponSpell.field_14 == -1 )
  {
    result = g_PadKey & PAD_CROSS;
    if ( (g_PadKey & PAD_CROSS) == 0 )
    {
      result = byte_8019B4CF - 1;
      if ( byte_8019B4CF )
      {
        --byte_8019B4CF;
      }
      else
      {
        v29 = 2 * sub_800262C0(g_unk_8019B4EC, *(*&g_ActiveWeaponSpell.StatusEffect + 1));
        if ( g_EquippedArms == ArmsDemonsHands )
          v29 >>= 1;
        if ( (g_EquipAccessory1 == EquipItemPsycprosCollar || g_EquipAccessory2 == EquipItemPsycprosCollar)
          && g_EquippedWeapon == WeaponSeathsSword )
        {
          LOWORD(v29) = 2 * v29;
        }
        g_Stamina_8019B4DE += v29;
        result = 5000;
        if ( g_Stamina_8019B4DE >= 0x1389u )
          g_Stamina_8019B4DE = 5000;
      }
    }
  }
  else
  {
    v14 = 0;
    if ( g_CurrentAttackDir )
    {
      v15 = *(*&g_ActiveWeaponSpell.StatusEffect + 36);
      v16 = *(*&g_ActiveWeaponSpell.StatusEffect + 40);
      v14 = *(*&g_ActiveWeaponSpell.StatusEffect + 42);
      v17 = *(*&g_ActiveWeaponSpell.StatusEffect + 48);
      v18 = *(*&g_ActiveWeaponSpell.StatusEffect + 50);
    }
    else
    {
      v15 = *(*&g_ActiveWeaponSpell.StatusEffect + 28);
      v16 = *(*&g_ActiveWeaponSpell.StatusEffect + 30);
      v17 = *(*&g_ActiveWeaponSpell.StatusEffect + 44);
      v18 = 0;
    }
    g_ActiveWeaponSpell.field_14 += v15;
    //   !
    if ( !g_CurrentAttackDir
      && *(*&g_ActiveWeaponSpell.StatusEffect + 3) != None
      && g_FullStaminaBonus
      && sub_80028E8C()
      && (g_PadKey & PAD_SQUARE) != 0 )
    {
      if ( g_ActiveWeaponSpell.field_14 < *(l_wpn_table + 16) || *(l_wpn_table + 17) < g_ActiveWeaponSpell.field_14 )
      {
        byte_8019B562 = 0;
      }
      else if ( byte_8019B562 )
      {
        // ,        
        // IceBladeMagicA, IceBladeMagicB ,SeathsSwordMagicA ,FlameSwordMagicA ,FlameSwordMagicB
        CheckHasWeaponMagic(l_wpn_table[3], (byte_8019B562 == l_wpn_table[5]), byte_8019B562);
        --byte_8019B562;
      }
    }
    if ( g_ActiveWeaponSpell.field_14 >= g_AttackHitRange && g_ActiveWeaponSpell.field_14 < g_AttackHitRange + v15 )
    {
      PlaySoundEffect(*l_wpn_table, 80);
      v19 = g_AttackHitRange + v18;
      if ( g_AttackHitRange >= v17 )
        v19 = 5000;
      g_AttackHitRange = v19;
    }
    if ( g_ActiveWeaponSpell.field_14 >= *&g_ActiveWeaponSpell.manaCost
      && g_ActiveWeaponSpell.field_14 < *&g_ActiveWeaponSpell.manaCost + v15 )
    {
      byte_8019B564 = 0;
      if ( g_CurrentAttackDir == 1 )
      {
        if ( g_EquippedWeapon == WeaponSeathsSword && (g_PadKey & PAD_SQUARE) != 0 )
        {
          g_ActiveWeaponSpell.field_14 -= v15;
          result = 1;
          byte_8019B564 = 1;
          return result;
        }
        v20 = l_wpn_table[4];
        if ( v20 != None )
          CheckHasWeaponMagic(
            v20,
            (g_ActiveWeaponSpell.field_14 >= v16),
            (g_ActiveWeaponSpell.field_14 - *(l_wpn_table + 19)) / v14);
      }
      if ( g_ActiveWeaponSpell.field_14 < v16 )
      {
        hit_pos = 0;
        damage_multiply = g_AttackStartStamina >> 2;
        *&g_ActiveWeaponSpell.manaCost += v14;
      }
      else
      {
        hit_pos = v47;
        *&g_ActiveWeaponSpell.manaCost = 5000;
        byte_8019B4CF = 10;
        g_Stamina_8019B4DE = 0;
        // g_LanguageID        ??
        v47[0] = *&g_LanguageID[0].header[2];
        damage_multiply = g_AttackStartStamina;
        v47[1] = *&g_LanguageID[0].header[6] - 1000;
        v47[2] = *&g_LanguageID[0].menus[0].header.posY;
      }
      v35 = 0;
      v36 = 0;
      v21 = *(l_wpn_table + 13);
      v40 = 0;
      v37 = v21;
      refX = g_LanguageID[0].menus[0].items[0].refX;
      v38 = -*&g_LanguageID[0].menus[0].header.extra[10];
      sub_80015614(&v38, &v35, &v44);
      v22 = (3600 - *(l_wpn_table + 13)) * v45 / 1800;
      v44 /= 4;
      v45 = v22 / 4;
      v23 = 3;
      v46 /= 4;
      x = *&g_LanguageID[0].header[2];
      y = *&g_LanguageID[0].header[6] - 800;
      z = *&g_LanguageID[0].menus[0].header.posY;
      while ( 1 )
      {
        x += v44;
        y += v45;
        z += v46;
        v24 = Entity_CheckWorldCollision(x, y, z, 400, 600);// int x, int y, int z, int radius, int max_dist
        entity_id = v24;
        --v23;
        if ( v24 != -1 )
        {
          v26 = &g_ObjectArray[31 * v24];
          v27 = &g_ObjectTypeTable[30 * *(v26 + 2)];
          v28 = Math_Atan2_Fixed(
                  v26[11] - *&g_LanguageID[0].header[2],
                  v26[13] - *&g_LanguageID[0].menus[0].header.posY);
          if ( Math_IsAngleInRange(*&g_LanguageID[0].menus[0].header.extra[4], v28, *(v27 + 11)) )
          {
            if ( Math_IsAngleInRange(*(v26 + 33), v28 + 2048, *(v27 + 12)) )
              break;
          }
        }
        if ( v23 == -1 )
          goto LABEL_80;
      }
      ApplyDamage(
        entity_id,
        g_unk_8019B4EC,
        g_AttackStrike,
        g_AttackSlash,
        g_AttackPierce,
        g_AttackWhiteMagic,
        g_AttackFire,
        g_AttackEarth,
        g_AttackWind,
        g_AttackWater,
        damage_multiply,
        17,
        hit_pos);
    }
LABEL_80:
    result = -1;
    if ( g_ActiveWeaponSpell.field_14 >= 4096 )
    {
      g_ActiveWeaponSpell.field_14 = -1;
      byte_8019B562 = 0;
    }
  }
  return result;
}
// 800297F4: conditional instruction was optimized away because $s3.4 is in (1..FFFF)
// 80029804: conditional instruction was optimized away because $s3.4 is in (1..FFFF)
// 8002918C: variable 'v3' is possibly undefined
// 800291CC: variable 'v30' is possibly undefined
// 800291CC: variable 'v31' is possibly undefined
// 800291CC: variable 'v32' is possibly undefined
// 800291CC: variable 'v33' is possibly undefined
// 800291CC: variable 'v34' is possibly undefined
// 8019B4CF: using guessed type char byte_8019B4CF;
// 8019B4DE: using guessed type __int16 g_Stamina_8019B4DE;
// 8019B4E0: using guessed type __int16 g_AttackStartStamina;
// 8019B4EC: using guessed type __int16 g_unk_8019B4EC;
// 8019B4F4: using guessed type __int16 g_AttackStrike;
// 8019B4F6: using guessed type __int16 g_AttackSlash;
// 8019B4F8: using guessed type __int16 g_AttackPierce;
// 8019B4FA: using guessed type __int16 g_AttackWhiteMagic;
// 8019B4FC: using guessed type __int16 g_AttackFire;
// 8019B4FE: using guessed type __int16 g_AttackEarth;
// 8019B500: using guessed type __int16 g_AttackWind;
// 8019B502: using guessed type __int16 g_AttackWater;
// 8019B558: using guessed type __int16 g_AttackHitRange;
// 8019B55E: using guessed type char g_CurrentAttackDir;
// 8019B55F: using guessed type char g_EquippedWeapon;
// 8019B562: using guessed type char byte_8019B562;
// 8019B563: using guessed type char g_FullStaminaBonus;
// 8019B564: using guessed type char byte_8019B564;
// 8019B587: using guessed type char g_EquippedArms;
// 8019B589: using guessed type char g_EquipAccessory1;
// 8019B58A: using guessed type char g_EquipAccessory2;
// 8019B5F8: using guessed type __int16 word_8019B5F8;
// 8019B5FC: using guessed type __int16 word_8019B5FC;
// 8019B606: using guessed type __int16 g_PadKey;

//----- (80029C4C) --------------------------------------------------------
int __fastcall TryCastMagic(int spell_id)
{
  int result; // $v0
  PlayerSpellEntry *spell; // $a2
  int v4; // $v1
  int mana_cost; // $a0
  char v6; // $v0

  result = 255;
  if ( g_CastReadyFlag == 255 )
  {
    result = 2 * spell_id;
    if ( spell_id != 255 )
    {
      spell = (g_SpellEntryTable + 26 * spell_id);
      result = 12;
      //     ?
      if ( g_CurrentMP >= *(&spell->MPCost + 1) )
      {
        if ( g_EquippedWeapon != 12 || (result = spell_id < 7, spell_id >= 11) || spell_id < 7 )
        {
          if ( g_EquippedBody != 31
            || spell_id < 11
            || (result = spell_id < 20, spell_id >= 13) && ((result = spell_id < 18, spell_id >= 20) || spell_id < 18) )
          {
            switch ( spell_id )
            {
              case 14:
              case 16:
              case 19:
                goto LABEL_18;
              case 15:
                result = 1;
                if ( !word_8019B526 )
                  goto LABEL_18;
                return result;
              case 17:
                result = 1;
                if ( word_8019B528 )
                  return result;
LABEL_18:
                g_SpellEffectType = 1;
                g_SpellPowerLevel = 1;
LABEL_19:
                result = -200;
                if ( g_MagicStamina_8019B4E2 >= 0x1388u )
                {
                  g_MagicStamina_8019B4E2 = 0;
                  mana_cost = *(&spell->MPCost + 1);// cost = table[spell_id].cost
                  g_MagicParticlePos = 13172536;
                  LOWORD(g_MagicParticleRadius) = 400;
                  g_CastReadyFlag = spell_id;
                  byte_8019B598 = 1;
                  result = g_CurrentMP - mana_cost;
                  g_CurrentMP -= mana_cost;     // current -= cost
                  switch ( spell_id )
                  {
                    case 0:
                    case 2:
                      result = 1;
                      g_SpellEffectType = 1;
                      g_SpellPowerLevel = 1;
                      LOWORD(g_MagicParticleRadius) = 0;
                      g_MagicParticlePos = 0;
                      break;
                    case 1:
                    case 4:
                    case 5:
                    case 6:
                    case 7:
                    case 8:
                    case 11:
                    case 18:
                      goto LABEL_22;
                    case 3:
                      v6 = 6;
                      goto LABEL_28;
                    case 9:
                      g_SpellEffectType = 6;
                      result = 1;
                      goto LABEL_29;
                    case 10:
                      g_MagicParticlePos = 4261412864;
                      LOWORD(g_MagicParticleRadius) = 2000;
LABEL_22:
                      result = 1;
                      g_SpellEffectType = 1;
                      goto LABEL_29;
                    case 12:
                      LOWORD(g_MagicParticlePos) = -200;
                      v6 = 5;
LABEL_28:
                      g_SpellEffectType = v6;
                      result = 2;
                      goto LABEL_29;
                    case 13:
                      g_SpellEffectType = 7;
                      result = 1;
LABEL_29:
                      g_SpellPowerLevel = result;
                      break;
                    default:
                      break;
                  }
                  *&g_ActiveWeaponSpell.PlayerHas = spell;
                }
                break;
              case 18:
                word_8019B52C = 900;
                v4 = *(&spell->MPCost + 1);
                result = g_CurrentMP - v4;
                g_CurrentMP -= v4;
                return result;
              default:
                goto LABEL_19;
            }
          }
        }
      }
    }
  }
  return result;
}
// 8019B4DC: using guessed type __int16 g_CurrentMP;
// 8019B4E2: using guessed type __int16 g_MagicStamina_8019B4E2;
// 8019B526: using guessed type __int16 word_8019B526;
// 8019B528: using guessed type __int16 word_8019B528;
// 8019B52C: using guessed type __int16 word_8019B52C;
// 8019B55F: using guessed type char g_EquippedWeapon;
// 8019B585: using guessed type char g_EquippedBody;
// 8019B595: using guessed type char g_CastReadyFlag;
// 8019B596: using guessed type char g_SpellEffectType;
// 8019B597: using guessed type char g_SpellPowerLevel;
// 8019B598: using guessed type char byte_8019B598;
// 8019B5DC: using guessed type int g_MagicParticlePos;
// 8019B5E0: using guessed type int g_MagicParticleRadius;

//----- (80029F08) --------------------------------------------------------
int __fastcall sub_80029F08(int a1, int a2)
{
  int v3; // $s3
  int v4; // $s7
  int v5; // $fp
  int v6; // $s2
  int v7; // $s4
  int v8; // $s6
  int v9; // $v0
  __int16 v10; // $s1
  bool v11; // dc
  __int16 v12; // $v0
  int v13; // $s1
  int v14; // $s0
  int v15; // $v0
  int v16; // $s0
  int v17; // $v0
  int result; // $v0
  int v19; // [sp+18h] [-40h]
  int v20; // [sp+18h] [-40h]
  int v21; // [sp+20h] [-38h]
  int v22; // [sp+20h] [-38h]
  __int16 v23; // [sp+28h] [-30h]
  int v25; // [sp+38h] [-20h]
  int v26; // [sp+40h] [-18h]
  int v27; // [sp+48h] [-10h]
  int v28; // [sp+50h] [-8h]

  v3 = (-FixedSin(a1) * a2) >> 12;
  v4 = 0;
  v5 = v3;
  v28 = 0;
  v27 = 0;
  v26 = 0;
  v6 = (FixedCos(a1) * a2) >> 12;
  v25 = v6;
  while ( 1 )
  {
    v19 = v3 + *&g_LanguageID[0].header[2];
    v21 = v6 + *&g_LanguageID[0].menus[0].header.posY;
    v7 = sub_8002E4F4(
           v3 + *&g_LanguageID[0].header[2],
           *&g_LanguageID[0].header[6],
           v6 + *&g_LanguageID[0].menus[0].header.posY,
           800,
           1700,
           49);
    if ( !v7 )
      goto LABEL_3;
    v8 = 0;
    if ( (v7 & 0xFFFFFFFA) != 0 )
      goto LABEL_8;
    v8 = 1;
    if ( g_FinalResultHeight + 1280 < *&g_LanguageID[0].header[6] )
      goto LABEL_8;
    v9 = v7 & 0x30;
    if ( !byte_8019B591 )
      break;
LABEL_9:
    if ( v9 )
    {
      if ( ++v27 == 2 )
        goto LABEL_33;
      sub_8002E394();
      v10 = Math_Atan2_Fixed(
              (dword_801DD5A4 - *&g_LanguageID[0].header[2]),
              (dword_801DD5AC - g_LanguageID[0].menus[0].header.posY));
      v11 = sub_800157D4(a1, v10);
      v12 = v10 + 2016;
      if ( !v11 )
        v12 = v10 + 2080;
      v13 = v12 & 0xFFF;
      v14 = word_801DD5B4 + 880;
      v23 = (-FixedSin(v13) * v14) >> 12;
      v15 = FixedCos(v13);
      v3 = v23 + dword_801DD5A4 - *&g_LanguageID[0].header[2];
      v6 = ((v15 * v14) >> 12) + dword_801DD5AC - *&g_LanguageID[0].menus[0].header.posY;
    }
    else
    {
      if ( !v26 )
      {
        v16 = a2 - 22;
        if ( a2 - 22 >= 0 )
        {
          while ( 1 )
          {
            v20 = ((-FixedSin(a1) * v16) >> 12) + *&g_LanguageID[0].header[2];
            v22 = ((FixedCos(a1) * v16) >> 12) + *&g_LanguageID[0].menus[0].header.posY;
            v16 -= 22;
            if ( !sub_8002E4F4(v20, *&g_LanguageID[0].header[6], v22, 800, 1700, 49) )
              break;
            if ( v16 < 0 )
              goto LABEL_19;
          }
          *&g_LanguageID[0].header[2] = v20;
          *&g_LanguageID[0].menus[0].header.posY = v22;
        }
LABEL_19:
        v26 = 1;
      }
      if ( v8 )
        goto LABEL_22;
      v17 = v7 & 2;
      if ( (v7 & 1) != 0 )
        goto LABEL_22;
      while ( 2 )
      {
        if ( !v17 )
        {
          v28 = 0;
          goto LABEL_33;
        }
        if ( v4 )
        {
LABEL_22:
          if ( v3 )
          {
            v3 = 0;
          }
          else
          {
            v17 = v7 & 2;
            if ( !v6 )
              continue;
            v6 = 0;
            v3 = v5;
          }
        }
        else
        {
          v4 = 1;
          if ( (MapTileSlice->Rotation & 3) != 0 && (MapTileSlice->Rotation & 3) != 2 )
          {
            v3 = (v5 - v25) >> 1;
            v6 = -v3;
          }
          else
          {
            v6 = (v5 + v25) >> 1;
            v3 = v6;
          }
        }
        break;
      }
    }
  }
  if ( g_CurrentWallTopY - g_FinalResultHeight >= -1700 )
  {
LABEL_8:
    v9 = v7 & 0x30;
    goto LABEL_9;
  }
LABEL_3:
  v28 = 1;
  *&g_LanguageID[0].header[2] = v19;
  *&g_LanguageID[0].menus[0].header.posY = v21;
  word_8019B5EC = g_TileLayerOffset;
LABEL_33:
  result = v28;
  *g_LanguageID[0].menus[0].header.pad1 = v3;
  g_LanguageID[0].menus[0].header.refY = v6;
  return result;
}
// 8019B591: using guessed type char byte_8019B591;
// 8019B5EC: using guessed type __int16 word_8019B5EC;
// 801DD57E: using guessed type __int16 g_TileLayerOffset;
// 801DD584: using guessed type int g_FinalResultHeight;
// 801DD588: using guessed type int g_CurrentWallTopY;
// 801DD5A4: using guessed type int dword_801DD5A4;
// 801DD5AC: using guessed type int dword_801DD5AC;
// 801DD5B4: using guessed type __int16 word_801DD5B4;

//----- (8002A338) --------------------------------------------------------
BOOL sub_8002A338()
{
  BOOL result; // $v0

  result = word_8019B5FE < 200;
  if ( word_8019B5FE >= 200 )
  {
    result = g_FinalResultHeight - *&g_LanguageID[0].header[6] < 32001;
    if ( g_FinalResultHeight - *&g_LanguageID[0].header[6] >= 32001 )
    {
      sub_8002C06C(0);
      result = 1;
      byte_8019B599 = 1;
    }
  }
  return result;
}
// 8019B599: using guessed type char byte_8019B599;
// 8019B5FE: using guessed type __int16 word_8019B5FE;
// 801DD584: using guessed type int g_FinalResultHeight;

//----- (8002A398) --------------------------------------------------------
int __fastcall sub_8002A398(int a1)
{
  int result; // $v0
  int v2; // $a0

  result = a1 < 320;
  if ( a1 >= 320 )
  {
    v2 = a1 - 320;
    if ( v2 >= 897 )
      v2 = 896;
    return PlaySoundEffect(12, (v2 >> 3) + 32);
  }
  return result;
}

//----- (8002A3DC) --------------------------------------------------------
int sub_8002A3DC()
{
  int v0; // $s0
  int v1; // $v0
  char v2; // $s1
  int v3; // $v0
  int v4; // $s0
  int v5; // $v0
  bool v6; // dc
  __int16 v7; // $v0
  int v8; // $s0
  __int16 v9; // $v0
  char v10; // $v0
  int v11; // $v0
  int v12; // $v1
  int v13; // $v0

  MAP_CollisionWithTile(
    *&g_LanguageID[0].header[2],
    *&g_LanguageID[0].header[6],
    *&g_LanguageID[0].menus[0].header.posY,
    800,
    1700);
  g_LanguageID[0].menus[0].header.refX = 0;
  if ( g_PlayerIsMoving != 32 )
  {
    if ( g_PlayerIsMoving >= 0x21u )
    {
      if ( g_PlayerIsMoving == 64 )
      {
        sub_8002A338();
        v0 = word_8019B5FE + *&g_LanguageID[0].header[6];
        v1 = sub_8002E4F4(*&g_LanguageID[0].header[2], v0, *&g_LanguageID[0].menus[0].header.posY, 800, 1700, 49);
        v2 = v1;
        if ( !v1 )
        {
          *&g_LanguageID[0].header[6] = v0;
          g_LanguageID[0].menus[0].header.refX = word_8019B5FE;
          word_8019B5FE += 40;
          word_8019B5D4 = word_8019B5FE >> 1;
          goto LABEL_58;
        }
        if ( word_8019B5FE < 0 )
        {
          word_8019B5FE = 0;
          goto LABEL_58;
        }
        sub_8002A398(word_8019B5FE);
        v3 = v2 & 4;
        if ( word_8019B5FE >= 480 )
        {
          sub_80026F34(
            0,
            ((word_8019B5FE * word_8019B5FE) >> 12)
          * ((word_8019B5FE * word_8019B5FE) >> 12)
          * ((word_8019B5FE * word_8019B5FE) >> 12)
          / 118000,
            0);
          v3 = v2 & 4;
        }
        if ( v3 )
        {
          *&g_LanguageID[0].header[6] = g_FinalResultHeight;
        }
        else
        {
          sub_8002E394();
          v4 = dword_801DD5A8 - word_801DD5B6 - 1;
          if ( !sub_8002E4F4(*&g_LanguageID[0].header[2], v4, *&g_LanguageID[0].menus[0].header.posY, 800, 1700, 49) )
            *&g_LanguageID[0].header[6] = v4;
        }
        word_8019B5FC = 1;
        g_PlayerIsMoving = 80;
      }
      else if ( g_PlayerIsMoving != 80 )
      {
        goto LABEL_58;
      }
      if ( word_8019B5FC > 0 )
        word_8019B5FC += word_8019B5FE >> 2;
      v5 = word_8019B5FE - 100;
      word_8019B5FE -= 100;
      if ( word_8019B5D4 > 0 )
      {
        v6 = v5 << 16 > 0;
        v7 = word_8019B5D4 + 10;
        if ( !v6 )
          v7 = word_8019B5D4 - 30;
        word_8019B5D4 = v7;
      }
      if ( word_8019B5FC <= 0 && word_8019B5D4 <= 0 )
      {
        g_PlayerIsMoving = 0;
        word_8019B5FE = 0;
        word_8019B5FC = 0;
        word_8019B5D4 = 0;
      }
    }
    else if ( g_PlayerIsMoving )
    {
      if ( g_PlayerIsMoving == 16 )
      {
        sub_8002A338();
        *&g_LanguageID[0].header[6] += word_8019B5FE;
        g_LanguageID[0].menus[0].header.refX = word_8019B5FE;
        word_8019B5FE += 40;
        if ( g_FinalResultHeight + 100 < *&g_LanguageID[0].header[6] )
        {
          *&g_LanguageID[0].header[6] = g_FinalResultHeight;
          g_PlayerIsMoving = 0;
        }
      }
      goto LABEL_58;
    }
    v8 = g_FinalResultHeight - *&g_LanguageID[0].header[6];
    if ( g_FinalResultHeight - *&g_LanguageID[0].header[6] >= 0 )
    {
      if ( v8 <= 0
        || sub_8002E4F4(
             *&g_LanguageID[0].header[2],
             *&g_LanguageID[0].header[6] + 1,
             *&g_LanguageID[0].menus[0].header.posY,
             800,
             1700,
             49) )
      {
        goto LABEL_58;
      }
      if ( v8 < 257 )
      {
        if ( v8 < 129 )
          *&g_LanguageID[0].header[6] = g_FinalResultHeight;
        else
          *&g_LanguageID[0].header[6] += 128;
        goto LABEL_58;
      }
      if ( v8 < 513 )
      {
        *&g_LanguageID[0].header[6] += 256;
        goto LABEL_58;
      }
      v10 = 16;
      if ( v8 >= 1025 )
        v10 = 64;
      g_PlayerIsMoving = v10;
      v9 = 40;
    }
    else
    {
      if ( g_FinalResultHeight - *&g_LanguageID[0].header[6] >= -256 )
      {
        if ( v8 >= -128 )
          *&g_LanguageID[0].header[6] = g_FinalResultHeight;
        else
          *&g_LanguageID[0].header[6] -= 128;
        goto LABEL_58;
      }
      if ( v8 >= -512 )
      {
        *&g_LanguageID[0].header[6] -= 256;
        goto LABEL_58;
      }
      g_PlayerIsMoving = 32;
      v9 = -150;
      if ( word_8019B5F2 >= 201 )
        v9 = -300;
    }
    word_8019B5FE = v9;
    word_8019B5FC = 0;
    word_8019B5D4 = 0;
    goto LABEL_58;
  }
  sub_8002A338();
  *&g_LanguageID[0].header[6] += word_8019B5FE;
  if ( g_FinalResultHeight >= *&g_LanguageID[0].header[6] || word_8019B5FE >= 0 )
  {
    if ( g_FinalResultHeight < *&g_LanguageID[0].header[6] - word_8019B5FE )
      *&g_LanguageID[0].header[6] = g_FinalResultHeight;
    g_PlayerIsMoving = 0;
  }
  g_LanguageID[0].menus[0].header.refX = word_8019B5FE;
  word_8019B5FE += 5;
LABEL_58:
  if ( !g_PlayerIsMoving )
  {
    if ( g_Option_WalkEffect )
    {
      word_8019B5FA = (word_8019B5FA + word_8019B5F2) & 0xFFF;
      v11 = FixedSin(word_8019B5FA);
      v12 = v11 >> 5;
      v6 = v11 >> 5 >= 0;
      v13 = v11 >> 7;
      if ( !v6 )
      {
        v12 = -v12;
        v13 = v12 >> 2;
      }
      word_8019B5F8 = v12 - v13;
    }
    else
    {
      word_8019B5F8 = 0;
    }
  }
  return Player_CheckHeadroom();
}
// 8019B590: using guessed type char g_Option_WalkEffect;
// 8019B594: using guessed type char g_PlayerIsMoving;
// 8019B5D4: using guessed type __int16 word_8019B5D4;
// 8019B5F2: using guessed type __int16 word_8019B5F2;
// 8019B5F8: using guessed type __int16 word_8019B5F8;
// 8019B5FA: using guessed type __int16 word_8019B5FA;
// 8019B5FC: using guessed type __int16 word_8019B5FC;
// 8019B5FE: using guessed type __int16 word_8019B5FE;
// 801DD584: using guessed type int g_FinalResultHeight;
// 801DD5A8: using guessed type int dword_801DD5A8;
// 801DD5B6: using guessed type __int16 word_801DD5B6;

//----- (8002A964) --------------------------------------------------------
int sub_8002A964()
{
  int v0; // $v1
  int v1; // $s1
  signed int v2; // $a1
  int v3; // $a0
  int v4; // $v1
  int v5; // $v0
  int result; // $v0
  int v7; // [sp+18h] [-10h]
  int v8; // [sp+1Ch] [-Ch]
  int v9; // [sp+20h] [-8h]

  v7 = unk_8019B614 + *&g_LanguageID[0].header[2];
  v8 = word_8019B616 + *&g_LanguageID[0].header[6];
  v9 = word_8019B618 + *&g_LanguageID[0].menus[0].header.posY;
  if ( sub_8002E4F4(v7, v8, v9, 800, 1700, 49) )
  {
    v8 = *&g_LanguageID[0].header[6];
    v0 = sub_8002E4F4(v7, *&g_LanguageID[0].header[6], v9, 800, 1700, 49);
    if ( v0 || (word_8019B616 = 1, (v0 = sub_8002E4F4(v7, v8, v9, 800, 1700, 49)) != 0) )
    {
      result = 1;
      if ( (v0 & 0xFFFFFFFA) != 0 )
        return result;
      result = 1;
      if ( g_FinalResultHeight + 256 < *&g_LanguageID[0].header[6] )
        return result;
      v8 = g_FinalResultHeight;
      v1 = 56;
    }
    else
    {
      v1 = 32;
    }
    v2 = CalculateDistance(unk_8019B614, word_8019B618);
    v3 = v2 - v1;
    if ( v1 >= v2 )
    {
      word_8019B618 = 0;
      unk_8019B614 = 0;
      return 1;
    }
    v4 = unk_8019B614 * v3;
    if ( v2 == -1 && v4 == 0x80000000 )
      _break(6u, 0);
    v5 = word_8019B618 * v3;
    if ( v2 == -1 && v5 == 0x80000000 )
      _break(6u, 0);
    unk_8019B614 = v4 / v2;
    word_8019B618 = v5 / v2;
  }
  if ( word_8019B616 >= 160 && g_FinalResultHeight - *&g_LanguageID[0].header[6] >= 32001 )
  {
    sub_8002C06C(0);
    byte_8019B599 = 1;
  }
  *&g_LanguageID[0].header[2] = v7;
  *&g_LanguageID[0].header[6] = v8;
  *&g_LanguageID[0].menus[0].header.posY = v9;
  word_8019B616 += 32;
  Player_CheckHeadroom();
  return 0;
}
// 8002AB30: conditional instruction was optimized away because $a1.4!=0
// 8002AB6C: conditional instruction was optimized away because $a1.4!=0
// 8019B599: using guessed type char byte_8019B599;
// 8019B616: using guessed type __int16 word_8019B616;
// 8019B618: using guessed type __int16 word_8019B618;
// 801DD584: using guessed type int g_FinalResultHeight;

//----- (8002AC04) --------------------------------------------------------
int sub_8002AC04()
{
  int v0; // $v1
  int v1; // $v1
  int v2; // $v1
  int v3; // $v0
  int result; // $v0
  bool v5; // dc

  if ( (g_PadKey & 0x8000) != 0 )
  {
    v0 = word_8019B5F4 + (dword_8019B610 >> 2);
    word_8019B5F4 += dword_8019B610 >> 2;
    if ( dword_8019B610 < v0 )
      word_8019B5F4 = dword_8019B610;
  }
  else
  {
    if ( (g_PadKey & 0x2000) == 0 )
    {
      v2 = word_8019B5F4;
      if ( word_8019B5F4 <= 0 )
      {
        if ( word_8019B5F4 >= 0 )
          goto LABEL_13;
        word_8019B5F4 += dword_8019B610 >> 2;
        if ( (v2 + (dword_8019B610 >> 2)) << 16 <= 0 )
          goto LABEL_13;
      }
      else
      {
        word_8019B5F4 -= dword_8019B610 >> 2;
        if ( ((v2 - (dword_8019B610 >> 2)) & 0x8000) == 0 )
          goto LABEL_13;
      }
      word_8019B5F4 = 0;
      goto LABEL_13;
    }
    v1 = word_8019B5F4 - (dword_8019B610 >> 2);
    word_8019B5F4 -= dword_8019B610 >> 2;
    if ( v1 < -dword_8019B610 )
      word_8019B5F4 = -dword_8019B610;
  }
LABEL_13:
  g_LanguageID[0].menus[0].items[0].refX = (g_LanguageID[0].menus[0].items[0].refX + word_8019B5F4) & 0xFFF;
  if ( (g_PadKey & 2) != 0 )
  {
    word_8019B5F6 += 3;
    if ( word_8019B5F6 >= 33 )
      word_8019B5F6 = 32;
  }
  else
  {
    if ( (g_PadKey & 1) == 0 )
    {
      if ( word_8019B5F6 <= 0 )
      {
        v3 = word_8019B5F6 + 3;
        if ( word_8019B5F6 >= 0 )
          goto LABEL_25;
        word_8019B5F6 += 3;
        if ( v3 << 16 <= 0 )
        {
          result = word_8019B5F6;
          goto LABEL_29;
        }
      }
      else
      {
        word_8019B5F6 -= 3;
        if ( (word_8019B5F6 & 0x8000) == 0 )
          goto LABEL_25;
      }
      word_8019B5F6 = 0;
      goto LABEL_25;
    }
    word_8019B5F6 -= 3;
    if ( word_8019B5F6 < -32 )
      word_8019B5F6 = -32;
  }
LABEL_25:
  result = word_8019B5F6;
  if ( word_8019B5F6 > 0 )
  {
    *&g_LanguageID[0].menus[0].header.extra[10] = (*&g_LanguageID[0].menus[0].header.extra[10] + word_8019B5F6) & 0xFFF;
    v5 = !sub_800157D4(*&g_LanguageID[0].menus[0].header.extra[10], 700);
    result = 700;
    if ( v5 )
      return result;
    goto LABEL_31;
  }
LABEL_29:
  if ( result < 0 )
  {
    *&g_LanguageID[0].menus[0].header.extra[10] = (*&g_LanguageID[0].menus[0].header.extra[10] + result) & 0xFFF;
    v5 = !sub_800157D4(-700, *&g_LanguageID[0].menus[0].header.extra[10]);
    result = -700;
    if ( !v5 )
LABEL_31:
      *&g_LanguageID[0].menus[0].header.extra[10] = result;
  }
  return result;
}
// 8019B5F4: using guessed type __int16 word_8019B5F4;
// 8019B5F6: using guessed type __int16 word_8019B5F6;
// 8019B606: using guessed type __int16 g_PadKey;
// 8019B610: using guessed type int dword_8019B610;

//----- (8002AF20) --------------------------------------------------------
int sub_8002AF20()
{
  int v0; // $a0
  int v1; // $v1
  int v2; // $s2
  int v3; // $v1
  int v4; // $s0
  int v5; // $s1
  __int16 v6; // $v0
  int v7; // $a0
  int v8; // $s2
  int v9; // $s0
  int v10; // $a1
  int refX; // $a0
  int result; // $v0
  int v13; // $a1
  __int16 v14; // $a0

  if ( (g_PadKey & 0x1000) != 0 )
  {
    v0 = word_8019B5F0 + (dword_8019B60C >> 2);
    if ( dword_8019B60C < v0 )
    {
      word_8019B5F0 = dword_8019B60C;
      goto LABEL_14;
    }
    goto LABEL_6;
  }
  if ( (g_PadKey & 0x4000) == 0 )
  {
    v1 = word_8019B5F0;
    if ( word_8019B5F0 <= 0 )
    {
      if ( word_8019B5F0 >= 0 )
        goto LABEL_14;
      word_8019B5F0 += dword_8019B60C >> 3;
      if ( (v1 + (dword_8019B60C >> 3)) << 16 <= 0 )
        goto LABEL_14;
    }
    else
    {
      word_8019B5F0 -= dword_8019B60C >> 3;
      if ( ((v1 - (dword_8019B60C >> 3)) & 0x8000) == 0 )
        goto LABEL_14;
    }
    word_8019B5F0 = 0;
    goto LABEL_14;
  }
  v0 = word_8019B5F0 - (dword_8019B60C >> 2);
  if ( v0 >= -dword_8019B60C )
  {
LABEL_6:
    word_8019B5F0 = v0;
    goto LABEL_14;
  }
  word_8019B5F0 = -dword_8019B60C;
LABEL_14:
  if ( (g_PadKey & 8) != 0 )
  {
    v2 = word_8019B5EE + (dword_8019B60C >> 2);
    if ( dword_8019B60C < v2 )
    {
      word_8019B5EE = dword_8019B60C;
      goto LABEL_27;
    }
    goto LABEL_19;
  }
  if ( (g_PadKey & 4) == 0 )
  {
    v3 = word_8019B5EE;
    if ( word_8019B5EE <= 0 )
    {
      if ( word_8019B5EE >= 0 )
        goto LABEL_27;
      word_8019B5EE += dword_8019B60C >> 2;
      if ( (v3 + (dword_8019B60C >> 2)) << 16 <= 0 )
        goto LABEL_27;
    }
    else
    {
      word_8019B5EE -= dword_8019B60C >> 2;
      if ( ((v3 - (dword_8019B60C >> 2)) & 0x8000) == 0 )
        goto LABEL_27;
    }
    word_8019B5EE = 0;
    goto LABEL_27;
  }
  v2 = word_8019B5EE - (dword_8019B60C >> 2);
  if ( v2 >= -dword_8019B60C )
  {
LABEL_19:
    word_8019B5EE = v2;
    goto LABEL_27;
  }
  word_8019B5EE = -dword_8019B60C;
LABEL_27:
  v4 = word_8019B5EE * word_8019B5EE;
  v5 = word_8019B5F0 * word_8019B5F0;
  v6 = SquareRoot0(v4 + v5);
  LOWORD(v7) = 0;
  if ( v6 )
  {
    if ( v6 == -1 && v4 == 0x80000000 )
      _break(6u, 0);
    v8 = v4 / v6;
    if ( word_8019B5EE < 0 )
      v8 = -(v4 / v6);
    if ( v6 == -1 && v5 == 0x80000000 )
      _break(6u, 0);
    LOWORD(v7) = v5 / v6;
    if ( word_8019B5F0 < 0 )
      v7 = -(v5 / v6);
  }
  else
  {
    v8 = 0;
  }
  v9 = v7;
  word_8019B5F2 = SquareRoot0(v8 * v8 + v7 * v7);
  v10 = v9;
  if ( v9 < 0 )
  {
    v10 = -v9;
    refX = (g_LanguageID[0].menus[0].items[0].refX + 2048) & 0xFFF;
  }
  else
  {
    refX = g_LanguageID[0].menus[0].items[0].refX;
  }
  sub_80029F08(refX, v10);
  result = v8 << 16;
  v13 = v8;
  if ( v8 > 0 )
  {
    v14 = g_LanguageID[0].menus[0].items[0].refX - 1024;
    return sub_80029F08(v14 & 0xFFF, v13);
  }
  v13 = -v8;
  if ( (v8 & 0x8000u) != 0 )
  {
    v14 = g_LanguageID[0].menus[0].items[0].refX + 1024;
    return sub_80029F08(v14 & 0xFFF, v13);
  }
  g_LanguageID[0].menus[0].header.refY = 0;
  *g_LanguageID[0].menus[0].header.pad1 = 0;
  return result;
}
// 8002B284: conditional instruction was optimized away because $v1.4 is in (1..7FFF|>=FFFF8000u)
// 8019B5EE: using guessed type __int16 word_8019B5EE;
// 8019B5F0: using guessed type __int16 word_8019B5F0;
// 8019B5F2: using guessed type __int16 word_8019B5F2;
// 8019B606: using guessed type __int16 g_PadKey;
// 8019B60C: using guessed type int dword_8019B60C;

//----- (8002B39C) --------------------------------------------------------
BOOL __fastcall IsConsumable(int id)
{
  BOOL result; // $v0

  result = 0;
  if ( id < ItemAPotion )
    return id >= ItemBloodStone;
  return result;
}

//----- (8002B3B8) --------------------------------------------------------
int ProcessPlayerInput()
{
  _WORD *v0; // $gp
  int v1; // $a1
  int v2; // $a2
  int v3; // $v0
  int v4; // $v0
  int result; // $v0
  int v6; // $a0
  int v7; // $a0
  int v8; // $v0
  int v9; // $a0

  v1 = 128;
  v2 = byte_8019B562;
  v0[161] = -1;
  v0[158] = 32;
  v0[159] = 64;
  v0[160] = 128;
  if ( !v2 && (g_PadKey & PAD_SQUARE) != 0 && (g_PadKey_Alt & PAD_SQUARE) == 0 && !byte_8019B55A )
    TryCastMagic(g_EquippedMagic);
  // fast slot
  if ( (g_PadKey & 0x100) != 0 && (g_PadKey_Alt & 0x100) == 0 )
  {
    if ( g_QuickSlotItem != NULL )              // != NULL
      TryCastMagic(g_QuickSlotItem);
    if ( HIBYTE(g_QuickSlotItem) != NULL )
    {
      if ( g_InventoryCounts[HIBYTE(g_QuickSlotItem)] )
      {
        if ( IsConsumable(HIBYTE(g_QuickSlotItem)) )
          UseConsumableItem(HIBYTE(g_QuickSlotItem));
        else
          UseItems_80049108(
            &g_LanguageID[0].header[2],
            &g_LanguageID[0].menus[0].header.extra[10],
            HIBYTE(g_QuickSlotItem));
      }
      else
      {
        MessageQueuePush(20, v1);
      }
    }
  }
  if ( g_CastReadyFlag != NULL && !--byte_8019B598 )
  {
    SpawnMagicProjectile(g_CastReadyFlag, v1);
    if ( --g_SpellEffectType )
      byte_8019B598 = g_SpellPowerLevel;
    else
      g_CastReadyFlag = -1;
  }
  // PAD_CIRCLE       . \ \  
  //           0.
  //       2 :
  //  - !     0
  if ( (g_PadKey & PAD_CIRCLE) == 0 || (g_PadKey_Alt & PAD_CIRCLE) == 0 || g_EquippedLegs == 50 )
  {
    if ( *&g_ActiveWeaponSpell.PlayerHas )
    {
      v6 = sub_800262C0(g_unk_8019B4EE, *(*&g_ActiveWeaponSpell.PlayerHas + 1));
      if ( g_EquippedHead == 24 )
        v6 >>= 1;
      g_MagicStamina_8019B4E2 += v6;
    }
    else
    {
      g_MagicStamina_8019B4E2 += sub_800262C0(g_unk_8019B4EE, 0);
    }
    if ( g_MagicStamina_8019B4E2 >= 5001u )
      g_MagicStamina_8019B4E2 = 5000;
    word_8019B4D4 += 128;
    if ( word_8019B4D4 >= 4097 )
      word_8019B4D4 = 4096;
    byte_8019B4D1 = 1;
    if ( byte_8019B55A )
      --byte_8019B55A;
    else
      dword_8019B53C = dword_800763FC;
    if ( (g_PadKey & 0xE0) != 0 && (g_PadKey_Alt & 0xE0) == 0 && *(*&g_ActiveWeaponSpell.StatusEffect + 36) )
    {
      if ( sub_80028E8C()
        && (v7 = dword_8019B53C, (g_PadKey & *dword_8019B53C) != 0)
        && ((v8 = dword_8019B53C + 2, dword_8019B53C != dword_800763FC)
         || g_Stamina_8019B4DE == 5000 && (v8 = dword_8019B53C + 2, g_MagicStamina_8019B4E2 == 5000)) )
      {
        dword_8019B53C = v8;
        if ( *(v7 + 2) == 0xFFFF )              //  0xFFFF ????
        {
          v9 = 1;
          // if ( word_8019B554 == -1 && (unsigned __int8)g_EquippedWeapon != NULL )
          //   = 0.      .
          //     PAD_CROSS.   0x40.     ?    .     
          return MeleeAttack_800281CC(v9);
        }
        byte_8019B55A = 20;
      }
      else
      {
        byte_8019B55A = 0;
      }
    }
    result = byte_8019B4CF;
    if ( byte_8019B4CF )
      return result;
    result = byte_8019B55A;
    if ( byte_8019B55A )
      return result;
    result = g_PadKey & 0x40;
    if ( (g_PadKey & 0x40) == 0 )
      return result;
    result = g_PadKey_Alt & 0x40;
    v9 = 0;
    if ( (g_PadKey_Alt & 0x40) != 0 )
      return result;
    return MeleeAttack_800281CC(v9);
  }
  if ( byte_8019B4D1 )
    --byte_8019B4D1;
  byte_8019B4CF = 1;
  v3 = g_Stamina_8019B4DE + 65036;
  g_Stamina_8019B4DE -= 500;
  if ( v3 << 16 <= 0 )
  {
    g_Stamina_8019B4DE = 0;
    byte_8019B4CF = 40;
  }
  v4 = g_MagicStamina_8019B4E2 + 65036;
  g_MagicStamina_8019B4E2 -= 500;
  if ( v4 << 16 <= 0 )
    g_MagicStamina_8019B4E2 = 0;
  word_8019B4D4 -= 128;
  result = 1024;
  if ( word_8019B4D4 < 1024 )
    word_8019B4D4 = 1024;
  return result;
}
// 8002B3EC: variable 'v0' is possibly undefined
// 8002B528: variable 'v1' is possibly undefined
// 800763FC: using guessed type int dword_800763FC[2];
// 8019B4CF: using guessed type char byte_8019B4CF;
// 8019B4D1: using guessed type char byte_8019B4D1;
// 8019B4D4: using guessed type __int16 word_8019B4D4;
// 8019B4DE: using guessed type __int16 g_Stamina_8019B4DE;
// 8019B4E2: using guessed type __int16 g_MagicStamina_8019B4E2;
// 8019B4EE: using guessed type __int16 g_unk_8019B4EE;
// 8019B53C: using guessed type int dword_8019B53C;
// 8019B55A: using guessed type char byte_8019B55A;
// 8019B55B: using guessed type char g_EquippedMagic;
// 8019B55C: using guessed type __int16 g_QuickSlotItem;
// 8019B562: using guessed type char byte_8019B562;
// 8019B584: using guessed type char g_EquippedHead;
// 8019B588: using guessed type char g_EquippedLegs;
// 8019B595: using guessed type char g_CastReadyFlag;
// 8019B596: using guessed type char g_SpellEffectType;
// 8019B597: using guessed type char g_SpellPowerLevel;
// 8019B598: using guessed type char byte_8019B598;
// 8019B606: using guessed type __int16 g_PadKey;
// 8019B608: using guessed type __int16 g_PadKey_Alt;

//----- (8002B974) --------------------------------------------------------
int sub_8002B974()
{
  int result; // $v0

  word_8019B61C = sub_80014ED4(0, g_LanguageID[0].menus[0].items[0].ColorAlt, word_8019B61C, 8, 4);
  word_8019B61E = sub_80014ED4(0, word_8019B5C6, word_8019B61E, 8, 4);
  result = sub_80014ED4(0, word_8019B5C8, dword_8019B620, 8, 4);
  LOWORD(dword_8019B620) = result;
  g_LanguageID[0].menus[0].items[0].ColorAlt += word_8019B61C;
  word_8019B5C6 += word_8019B61E;
  word_8019B5C8 += result;
  return result;
}
// 8019B5C6: using guessed type __int16 word_8019B5C6;
// 8019B5C8: using guessed type __int16 word_8019B5C8;
// 8019B61C: using guessed type __int16 word_8019B61C;
// 8019B61E: using guessed type __int16 word_8019B61E;
// 8019B620: using guessed type int dword_8019B620;

//----- (8002BA60) --------------------------------------------------------
int sub_8002BA60()
{
  char v0; // $s1
  char v1; // $s2

  v0 = g_Option_ShowHPMP;
  v1 = g_Option_ShowCompass;
  g_Option_ShowHPMP = 0;
  g_Option_ShowCompass = 0;
  UpdatePlayerSystem(0, 0);
  g_Option_ShowHPMP = v0;
  g_Option_ShowCompass = v1;
  return sub_80037184();
}
// 8019B58D: using guessed type char g_Option_ShowHPMP;
// 8019B58E: using guessed type char g_Option_ShowCompass;

//----- (8002BAD0) --------------------------------------------------------
// write access to const memory has been detected, the output may be wrong!
int UpdateInteract_8002BAD0()
{
  int result; // $v0
  int v1; // $s0

  if ( (g_PadKey & 0x20) != 0 && (g_PadKey_Alt & 0x20) == 0 )
  {
    if ( byte_8019B591 == 1 )
      sub_8002BCF8(&ObjectInstances[17 * unk_8019B614]);
    else
      Interact_8004A5E4(&g_LanguageID[0].header[2], &g_LanguageID[0].menus[0].header.extra[10]);
  }
  result = g_PadKey & 0x10;
  if ( (g_PadKey & 0x10) != 0 )
  {
    result = -1;
    if ( (g_PadKey_Alt & 0x10) == 0 && g_ActiveWeaponSpell.field_14 == -1 )
    {
      sub_8002BA60();
      v1 = GameActionMenu();
      if ( v1 < 0 )
      {
        if ( v1 == -2 )
        {
          dword_80076460 = 9;
        }
        else if ( v1 == -3 )
        {
          LoadSave();
          sub_800260BC(g_TitleColor, g_TitleColor, g_TitleColor, g_TitleColor, g_TitleColor, 255);
        }
      }
      else if ( !IsConsumable(v1) )
      {
        UpdatePlayerSystem(0, 0);
        UseItems_80049108(&g_LanguageID[0].header[2], &g_LanguageID[0].menus[0].header.extra[10], v1);
      }
      return Player_ResetMovement();
    }
  }
  return result;
}
// 8002BC10: write access to const memory at 80076460 has been detected
// 80076460: using guessed type int dword_80076460;
// 801779D8: using guessed type int g_TitleColor;
// 8019B591: using guessed type char byte_8019B591;
// 8019B606: using guessed type __int16 g_PadKey;
// 8019B608: using guessed type __int16 g_PadKey_Alt;

//----- (8002BC74) --------------------------------------------------------
void sub_8002BC74()
{
  byte_8019B591 = 0;
  word_8019B5F0 = 0;
  word_8019B5EE = 0;
  word_8019B5C8 = 0;
  word_8019B5C6 = 0;
  g_LanguageID[0].menus[0].items[0].ColorAlt = 0;
  LOWORD(dword_8019B5D0) = 0;
  dword_8019B5CC = 0;
  word_8019B5D8 = 0;
  word_8019B5D6 = 0;
  word_8019B5D4 = 0;
}
// 8019B591: using guessed type char byte_8019B591;
// 8019B5C6: using guessed type __int16 word_8019B5C6;
// 8019B5C8: using guessed type __int16 word_8019B5C8;
// 8019B5CC: using guessed type int dword_8019B5CC;
// 8019B5D0: using guessed type int dword_8019B5D0;
// 8019B5D4: using guessed type __int16 word_8019B5D4;
// 8019B5D6: using guessed type __int16 word_8019B5D6;
// 8019B5D8: using guessed type __int16 word_8019B5D8;
// 8019B5EE: using guessed type __int16 word_8019B5EE;
// 8019B5F0: using guessed type __int16 word_8019B5F0;

//----- (8002BCDC) --------------------------------------------------------
int __fastcall sub_8002BCDC(char a1)
{
  int result; // $v0

  result = 1;
  byte_8019B591 = 1;
  unk_8019B614 = a1;
  return result;
}
// 8019B591: using guessed type char byte_8019B591;

//----- (8002BCF8) --------------------------------------------------------
int __fastcall sub_8002BCF8(int a1)
{
  int result; // $v0
  int v3; // $a2
  __int16 v4; // $v1
  __int16 v5; // $a0
  __int16 v6; // $a1
  __int64 v7; // [sp+10h] [-10h] BYREF
  int v8[2]; // [sp+18h] [-8h] BYREF

  result = 1;
  if ( byte_8019B591 == 1 )
  {
    result = (-252645135 * (a1 - ObjectInstances)) >> 2;
    if ( unk_8019B614 == result )
    {
      v3 = *(a1 + 64);
      v4 = dword_8019B5CC;
      v5 = HIWORD(dword_8019B5CC);
      v6 = dword_8019B5D0;
      dword_8019B5CC = 0;
      LOWORD(dword_8019B5D0) = 0;
      *&g_LanguageID[0].menus[0].header.extra[10] += v4;
      g_LanguageID[0].menus[0].items[0].refX += v5;
      g_LanguageID[0].menus[0].items[0].refY += v6;
      if ( *(v3 + 1) )
      {
        sub_80014FAC(*(a1 + 38) + 1024, v8);
        sub_8001565C(900, v8);
        byte_8019B591 = 5;
        unk_8019B614 = 0;
        *&word_8019B618 = *(a1 + 20) + v8[0];
        dword_8019B620 = *(a1 + 28) + v8[1];
        result = *(a1 + 24);
        *&word_8019B61C = result;
      }
      else
      {
        LOWORD(v7) = (*(v3 + 12) * *(v3 + 56)) >> 15;
        WORD1(v7) = ((*(v3 + 14) * *(v3 + 56)) >> 15) + 512;
        WORD2(v7) = (*(v3 + 16) * *(v3 + 56)) >> 15;
        return sub_8002BF24(&v7);
      }
    }
  }
  return result;
}
// 8019B591: using guessed type char byte_8019B591;
// 8019B5CC: using guessed type int dword_8019B5CC;
// 8019B5D0: using guessed type int dword_8019B5D0;
// 8019B618: using guessed type __int16 word_8019B618;
// 8019B61C: using guessed type __int16 word_8019B61C;
// 8019B620: using guessed type int dword_8019B620;

//----- (8002BED0) --------------------------------------------------------
unsigned __int64 __fastcall sub_8002BED0(unsigned __int8 a1)
{
  unsigned __int64 result; // $v0

  byte_8019B591 = 2;
  unk_8019B614 = a1;
  unk_8019B615 = 0;
  result = *&g_LanguageID[0].menus[0].header.extra[10];
  *&word_8019B616 = *&g_LanguageID[0].menus[0].header.extra[10];
  unk_8019B61A = *&g_LanguageID[0].menus[0].items[0].refY;
  return result;
}
// 8019B591: using guessed type char byte_8019B591;
// 8019B616: using guessed type __int16 word_8019B616;

//----- (8002BF24) --------------------------------------------------------
__int64 __fastcall sub_8002BF24(__int64 *a1)
{
  __int64 result; // $v0

  byte_8019B591 = 3;
  result = *a1;
  unk_8019B614 = *a1;
  *&word_8019B618 = HIDWORD(result);
  return result;
}
// 8019B591: using guessed type char byte_8019B591;
// 8019B618: using guessed type __int16 word_8019B618;

//----- (8002BF60) --------------------------------------------------------
int __fastcall sub_8002BF60(_DWORD *a1, _DWORD *a2, __int16 a3)
{
  int v3; // $v1
  int v4; // $v1
  int result; // $v0

  byte_8019B591 = 16;
  v3 = a1[1];
  unk_8019B614 = *a1;
  *&word_8019B618 = v3;
  v4 = a2[1];
  *&word_8019B61C = *a2;
  dword_8019B620 = v4;
  word_8019B600 = 3500;
  result = 64;
  word_8019B602 = a3;
  g_PlayerIsMoving = 64;
  word_8019B5FE = word_8019B616;
  return result;
}
// 8019B591: using guessed type char byte_8019B591;
// 8019B594: using guessed type char g_PlayerIsMoving;
// 8019B5FE: using guessed type __int16 word_8019B5FE;
// 8019B600: using guessed type __int16 word_8019B600;
// 8019B602: using guessed type __int16 word_8019B602;
// 8019B616: using guessed type __int16 word_8019B616;
// 8019B618: using guessed type __int16 word_8019B618;
// 8019B61C: using guessed type __int16 word_8019B61C;
// 8019B620: using guessed type int dword_8019B620;

//----- (8002BFF4) --------------------------------------------------------
int __fastcall sub_8002BFF4(_DWORD *a1, _DWORD *a2, __int16 a3)
{
  int v3; // $v1
  int v4; // $v1
  int result; // $v0

  byte_8019B591 = 18;
  v3 = a1[1];
  unk_8019B614 = *a1;
  *&word_8019B618 = v3;
  v4 = a2[1];
  *&word_8019B61C = *a2;
  dword_8019B620 = v4;
  result = 3500;
  word_8019B600 = 3500;
  word_8019B602 = a3;
  return result;
}
// 8019B591: using guessed type char byte_8019B591;
// 8019B600: using guessed type __int16 word_8019B600;
// 8019B602: using guessed type __int16 word_8019B602;
// 8019B618: using guessed type __int16 word_8019B618;
// 8019B61C: using guessed type __int16 word_8019B61C;
// 8019B620: using guessed type int dword_8019B620;

//----- (8002C06C) --------------------------------------------------------
int __fastcall sub_8002C06C(int *a1)
{
  int result; // $v0
  int v3; // $v1

  result = 17;
  if ( byte_8019B591 != 17 )
  {
    byte_8019B591 = 17;
    result = PlaySoundEffect(11, 110);
    if ( a1 )
    {
      result = *a1;
      v3 = a1[1];
      unk_8019B614 = *a1;
      *&word_8019B618 = v3;
    }
    word_8019B61C = 0;
    word_8019B5CA = 0;
  }
  return result;
}
// 8019B591: using guessed type char byte_8019B591;
// 8019B5CA: using guessed type __int16 word_8019B5CA;
// 8019B618: using guessed type __int16 word_8019B618;
// 8019B61C: using guessed type __int16 word_8019B61C;

//----- (8002C0F8) --------------------------------------------------------
int sub_8002C0F8()
{
  int result; // $v0

  result = 4;
  if ( !byte_8019B591 )
  {
    byte_8019B591 = 4;
    unk_8019B614 = 0;
  }
  return result;
}
// 8019B591: using guessed type char byte_8019B591;

//----- (8002C124) --------------------------------------------------------
int __fastcall sub_8002C124(__int16 *a1, _WORD *a2, int a3, int a4)
{
  __int16 v4; // $t0
  int v5; // $t1
  __int16 v6; // $t0
  int result; // $v0

  v4 = *a1;
  v5 = 0;
  if ( a2 )
    v5 = *a2;
  if ( !v4 && !v5 )
    return -1;
  if ( v4 >= v5 )
  {
    LOWORD(v5) = 0;
    v6 = v4 - 1;
  }
  else
  {
    v6 = v4 + 1;
  }
  if ( v6 >= a3 )
  {
    LOWORD(result) = a4;
  }
  else
  {
    if ( a3 == -1 && v6 * a4 == 0x80000000 )
      _break(6u, 0);
    LOWORD(result) = v6 * a4 / a3;
  }
  *a1 = v6;
  if ( a2 )
    *a2 = v5;
  return result;
}
// 8002C188: conditional instruction was optimized away because $a2.4!=0

//----- (8002C1E0) --------------------------------------------------------
int __fastcall sub_8002C1E0(int a1)
{
  int v1; // $v1
  int result; // $v0

  v1 = g_CurrentHP + a1;
  if ( v1 > 0 )
  {
    result = g_MaxHP < v1;
    if ( g_MaxHP >= v1 )
      g_CurrentHP += a1;
    else
      g_CurrentHP = g_MaxHP;
  }
  else
  {
    g_CurrentHP = 0;
    return sub_8002C06C(0);
  }
  return result;
}
// 8019B4D6: using guessed type __int16 g_MaxHP;
// 8019B4D8: using guessed type __int16 g_CurrentHP;

//----- (8002C24C) --------------------------------------------------------
BOOL __fastcall sub_8002C24C(int a1)
{
  int v1; // $v1
  BOOL result; // $v0

  v1 = g_CurrentMP + a1;
  if ( v1 > 0 )
  {
    result = g_MaxMP < v1;
    if ( g_MaxMP >= v1 )
      g_CurrentMP += a1;
    else
      g_CurrentMP = g_MaxMP;
  }
  else
  {
    g_CurrentMP = 0;
  }
  return result;
}
// 8019B4DA: using guessed type __int16 g_MaxMP;
// 8019B4DC: using guessed type __int16 g_CurrentMP;

//----- (8002C29C) --------------------------------------------------------
int __fastcall sub_8002C29C(int a1)
{
  int result; // $v0

  if ( *(a1 + 20) )
  {
    result = g_PlayerJumpState;
    if ( !*(a1 + 20) )
      _break(7u, 0);
    if ( !(g_PlayerJumpState % *(a1 + 20)) )
      result = sub_8002C1E0(1);
  }
  if ( *(a1 + 22) )
  {
    result = g_PlayerJumpState;
    if ( !*(a1 + 22) )
      _break(7u, 0);
    if ( !(g_PlayerJumpState % *(a1 + 22)) )
      return sub_8002C1E0(-1);
  }
  return result;
}
// 8019B538: using guessed type int g_PlayerJumpState;

//----- (8002C348) --------------------------------------------------------
int ControllerInput()
{
  __int16 v0; // $v0
  __int16 v1; // $v0
  int v2; // $v1
  __int16 v3; // $a3
  int v4; // $v0
  Entity **v5; // $s0
  Entity *v6; // $v1
  Entity *v7; // $a0
  int v8; // $v1
  Entity **v9; // $s0
  int v10; // $s1
  BOOL v11; // $v1
  int v12; // $s0
  __int16 v13; // $v0
  char v14; // $v0
  _BYTE *v15; // $v1
  int v16; // $v0
  int v17; // $v1
  int v18; // $v1
  int v19; // $a0
  int v20; // $v1
  __int16 v21; // $a1
  __int16 v22; // $a1
  int v23; // $s1
  int v24; // $v1
  int v25; // $a0
  int v26; // $a1
  unsigned __int8 v27; // $a2
  int v28; // $a0
  int v29; // $v0
  SVECTOR *v30; // $a1

  byte_801779A8 = 4;
  Map_MarkOccupiedTiles(*&g_LanguageID[0].header[2], *&g_LanguageID[0].menus[0].header.posY, 800, -1);
  v0 = sub_8002C124(&word_8019B51E, &word_8019B520, 64, 3072);
  if ( v0 != -1 )
    TriggerLightFlash(0xAu, 0xAu, 0xAu, 3833, v0);
  v1 = sub_8002C124(&word_8019B52A, &word_8019B52C, 64, 3600);
  if ( v1 != -1 )
    TriggerLightFlash(0xDCu, 0xDCu, 0xA0u, 18000, v1);
  v2 = word_8019B600;
  if ( word_8019B600 )
  {
    word_8019B600 -= word_8019B602;
    if ( ((v2 - word_8019B602) & 0x8000) != 0 )
      word_8019B600 = 0;
    v3 = word_8019B600;
    if ( word_8019B600 >= 4096 )
      v3 = 4096;
    sub_80034100(60, 0, 0, v3);
  }
  g_PadKey = PadRead();
  if ( (g_PadKey & 0x100) != 0 )
    nullsub_1();
  if ( (g_PadKey & 0x800) != 0 )
    g_PadKey = 16;
  dword_8019B60C = 200;
  dword_8019B610 = 28;
  if ( (g_PadKey & 0x5000) == 0 )
    dword_8019B610 = 35;
  if ( word_8019B522 )
  {
    if ( word_8019B522 >= 64 )
    {
      word_8019B4D2 -= 100;
      if ( word_8019B4D2 < -3300 )
        word_8019B4D2 = -3300;
    }
    else
    {
      v4 = word_8019B4D2 + 100;
      word_8019B4D2 += 100;
      if ( v4 << 16 > 0 )
        word_8019B4D2 = 0;
    }
    dword_8019B610 >>= 1;
    --word_8019B522;
  }
  else if ( byte_8019B4D1 )
  {
    word_8019B4D2 -= 800;
    if ( (word_8019B4D2 & 0x8000) != 0 )
      word_8019B4D2 = 0;
  }
  else
  {
    word_8019B4D2 += 800;
    if ( word_8019B4D2 >= 2801 )
      word_8019B4D2 = 2800;
  }
  dword_8019B60C += (word_8019B4D2 * dword_8019B60C) >> 12;
  if ( g_AttackCooldown )
  {
    dword_8019B60C = 0;
    --g_AttackCooldown;
    dword_8019B610 = 0;
    if ( (g_AttackCooldown & 3) == 0 )
      sub_80034100(60, 30, 0, 3072);
  }
  if ( byte_8019B564 )
  {
    dword_8019B60C >>= 1;
    dword_8019B610 >>= 1;
  }
  switch ( byte_8019B591 )
  {
    case 0:
      ProcessPlayerInput();
      sub_8002AC04();
      sub_8002AF20();
      goto LABEL_49;
    case 1:
      v5 = &ObjectInstances[17 * unk_8019B614];
      ProcessPlayerInput();
      sub_8002AC04();
      *g_LanguageID[0].menus[0].header.pad1 = *(v5 + 10) - *&g_LanguageID[0].header[2];
      g_LanguageID[0].menus[0].header.refX = *(v5 + 12) - *&g_LanguageID[0].header[6];
      g_LanguageID[0].menus[0].header.refY = *(v5 + 14) - g_LanguageID[0].menus[0].header.posY;
      v6 = v5[6];
      v7 = v5[7];
      *&g_LanguageID[0].header[2] = v5[5];
      *&g_LanguageID[0].header[6] = v6;
      *&g_LanguageID[0].menus[0].header.posY = v7;
      *&g_LanguageID[0].menus[0].header.height = v5[8];
      v8 = v5[10];
      dword_8019B5CC = v5[9];
      dword_8019B5D0 = v8;
      goto LABEL_37;
    case 2:
      v9 = &ObjectInstances[17 * unk_8019B614];
      ProcessPlayerInput();
      v10 = unk_8019B615 << 7;
      *&g_LanguageID[0].header[2] = FixedPointLerp(*&g_LanguageID[0].header[2], v9[5], v10);
      *&g_LanguageID[0].header[6] = FixedPointLerp(*&g_LanguageID[0].header[6], v9[6], v10);
      *&g_LanguageID[0].menus[0].header.posY = FixedPointLerp(*&g_LanguageID[0].menus[0].header.posY, v9[7], v10);
      LOWORD(dword_8019B5CC) = sub_80015D30(0, *(v9 + 18), v10);
      HIWORD(dword_8019B5CC) = sub_80015D30(0, *(v9 + 19), v10);
      LOWORD(dword_8019B5D0) = sub_80015D30(0, *(v9 + 20), v10);
      *&g_LanguageID[0].menus[0].header.extra[10] = sub_80015D30(word_8019B616, 0, v10);
      g_LanguageID[0].menus[0].items[0].refX = sub_80015D30(word_8019B618, 0, v10);
      g_LanguageID[0].menus[0].items[0].refY = sub_80015D30(unk_8019B61A, 0, v10);
      v11 = unk_8019B615 < 0x20u;
      ++unk_8019B615;
      if ( !v11 )
        sub_8002BCDC(unk_8019B614);
      break;
    case 3:
      if ( sub_8002A964() )
        goto LABEL_43;
      goto LABEL_37;
    case 4:
      ProcessPlayerInput();
      sub_8002AC04();
      sub_8002AF20();
      word_8019B5F8 = 0;
      sub_8002A3DC();
      word_8019B5F8 = word_8019B5F8 - 256 + (FixedCos(unk_8019B614) >> 4);
      LOWORD(dword_8019B5D0) = FixedSin(unk_8019B614) >> 6;
      unk_8019B614 = (unk_8019B614 + 128) & 0xFFF;
      if ( !unk_8019B614 )
      {
        LOWORD(dword_8019B5D0) = 0;
        sub_8002BC74();
      }
      goto LABEL_37;
    case 5:
      ++unk_8019B614;
      v12 = unk_8019B614 << 8;
      *&g_LanguageID[0].header[2] = FixedPointLerp(*&g_LanguageID[0].header[2], *&word_8019B618, v12);
      *&g_LanguageID[0].header[6] = FixedPointLerp(*&g_LanguageID[0].header[6], *&word_8019B61C, v12);
      *&g_LanguageID[0].menus[0].header.posY = FixedPointLerp(
                                                 *&g_LanguageID[0].menus[0].header.posY,
                                                 dword_8019B620,
                                                 v12);
      if ( unk_8019B614 >= 0x10u )
        sub_8002BC74();
      break;
    case 16:
      ProcessPlayerInput();
      sub_8002AC04();
      sub_8002AF20();
      word_8019B616 = 1;
      sub_8002A964();
      sub_8002B974();
      if ( !*&g_LanguageID[0].menus[0].items[0].ColorAlt && !word_8019B5C8 )
        sub_8002BC74();
LABEL_49:
      sub_8002A3DC();
      goto LABEL_37;
    case 17:
      g_CurrentHP = 0;
      word_8019B61C = sub_80014ED4(-1024, g_LanguageID[0].menus[0].items[0].ColorAlt, word_8019B61C, 8, 4);
      g_LanguageID[0].menus[0].items[0].ColorAlt += (3 * word_8019B61C) >> 1;
      v13 = word_8019B5F8 + 500;
      if ( word_8019B5F8 >= 1500 )
        v13 = 1500;
      word_8019B5F8 = v13;
      sub_8002A964();
      if ( ++word_8019B5CA == 31
        && dword_8019B5E4 >= -1000
        && dword_8019B5E8 >= 0
        && !byte_8019B599
        && (g_EquipAccessory1 == 54 || g_EquipAccessory2 == 54)
        && byte_8009DEC3 )
      {
        --byte_8009DEC3;
        FadeScreenIn(1u, 0, 4096, 512);
        ResetPlayerBuffers();
        FadeScreenIn(1u, 4096, 0, -512);
      }
      if ( word_8019B5CA >= 0x20 )
      {
        if ( word_8019B5CA >= 0x41 )
        {
          v15 = &g_ParticleArray;
          v16 = 128;
          do
          {
            *v15 = -1;
            --v16;
            v15 += 72;
          }
          while ( v16 );
          if ( byte_8009DEBC && (byte_801B519D & 8) != 0 )
          {
            sub_8003B9A8();
            g_LanguageID[0].menus[0].items[0].refX = 3072;
            *&g_LanguageID[0].menus[0].header.extra[10] = 0;
            g_LanguageID[0].menus[0].items[0].refY = 0;
            *&g_LanguageID[0].header[6] = -9344;
            *&g_LanguageID[0].header[2] = 122880;
            *&g_LanguageID[0].menus[0].header.posY = 139264;
            word_8019B5EC = 5;
            --byte_8009DEBC;
            sub_8004AEC4(g_TitleColor);
            ResetPlayerBuffers();
            sub_800260BC(1u, 1u, 1u, 1u, 1u, 67);
          }
          else
          {
            InitPlayerStats();
            InitPlayerInventory();
            sub_800260BC(0, 0, 0, 0, 0, 255);
          }
        }
        else
        {
          v14 = FixedPointLerp(0, 255, (word_8019B5CA - 32) << 7);
          SetFadeColor(130, v14, v14, v14);
        }
      }
      break;
    case 18:
      sub_8002B974();
      if ( !*&g_LanguageID[0].menus[0].items[0].ColorAlt && !word_8019B5C8 )
LABEL_43:
        sub_8002BC74();
LABEL_37:
      PlayerDoInteract();
      break;
    default:
      break;
  }
  g_PadKey_Alt = g_PadKey;
  if ( g_PoisenStatus )
  {
    if ( !((g_PoisenStatus - 30 * ((((2290649225LL * g_PoisenStatus) >> 32) >> 4) - (g_PoisenStatus << 16 >> 31))) << 16) )
    {
      word_8019B600 = 2400;
      word_8019B602 = 60;
      sub_80026EE0(-1);
    }
    --g_PoisenStatus;
  }
  v17 = word_8019B526;
  if ( word_8019B526 )
  {
    --word_8019B526;
    if ( !((v17 - 1) << 16) )
      CalculatePlayerStats();
  }
  v18 = word_8019B528;
  if ( word_8019B528 )
  {
    --word_8019B528;
    if ( !((v18 - 1) << 16) )
      CalculatePlayerStats();
  }
  v19 = word_8019B530;
  if ( word_8019B530 )
  {
    --word_8019B530;
    g_CurrentMP = g_MaxMP;
    if ( !((v19 - 1) << 16) )
      MessageQueuePush(34, &word_8019B530);
  }
  v20 = word_8019B532;
  if ( word_8019B532 )
  {
    --word_8019B532;
    if ( !((v20 - 1) << 16) )
    {
      CalculatePlayerStats();
      MessageQueuePush(34, v21);
    }
  }
  if ( word_8019B52E )
  {
    if ( word_8019B52E == 1 )
    {
      sub_800633C0(dword_8007634C, 0x240u, 259);
      sub_800633C0(dword_8007635C, 0x240u, 262);
      MessageQueuePush(34, v22);
      word_8019B52E = 0;
      sub_80038214(0);
    }
    else
    {
      if ( (word_8019B52E & 7) == 0 )
        sub_800633C0(dword_80076354, 0x240u, 259);
      if ( (word_8019B52E & 7) == 4 )
        sub_800633C0(dword_80076364, 0x240u, 262);
      if ( (word_8019B52E & 7) == 1 )
        sub_80038214(1);
      --word_8019B52E;
    }
  }
  v23 = sub_8002C124(&word_8019B51A, &word_8019B51C, 64, 3072);
  if ( v23 != -1 )
  {
    if ( !word_8019B51A )
      CalculatePlayerStats();
    sub_80034100(70, 70, 30, v23);
  }
  *&g_LanguageID[0].menus[0].header.extra[2] = *&g_LanguageID[0].menus[0].header.extra[10]
                                             + g_LanguageID[0].menus[0].items[0].ColorAlt
                                             + dword_8019B5CC
                                             + word_8019B5D4;
  *&g_LanguageID[0].menus[0].header.extra[4] = g_LanguageID[0].menus[0].items[0].refX
                                             + word_8019B5C6
                                             + HIWORD(dword_8019B5CC)
                                             + word_8019B5D6;
  *&g_LanguageID[0].menus[0].header.extra[6] = g_LanguageID[0].menus[0].items[0].refY
                                             + word_8019B5C8
                                             + dword_8019B5D0
                                             + word_8019B5D8;
  Map_MarkOccupiedTiles(*&g_LanguageID[0].header[2], *&g_LanguageID[0].menus[0].header.posY, 800, 1);
  byte_801779A8 = 0;
  v24 = Entity_CheckWorldCollision(
          *&g_LanguageID[0].header[2],
          *&g_LanguageID[0].header[6],
          *&g_LanguageID[0].menus[0].header.posY,
          1,
          1700);
  if ( v24 != -1 && (*(&unk_8016E630 + 31 * v24) & 8) != 0 )
    sub_8002C0F8();
  ProcessMeleeAttack(v25, v26, v27);
  if ( g_EquippedWeapon != 255 )
  {
    v29 = *&g_ActiveWeaponSpell.StatusEffect;
    if ( *(*&g_ActiveWeaponSpell.StatusEffect + 22) )
    {
      if ( !(g_PlayerJumpState % *(*&g_ActiveWeaponSpell.StatusEffect + 22)) )
        sub_8002C1E0(1);
      v29 = *&g_ActiveWeaponSpell.StatusEffect;
    }
    if ( *(v29 + 24) && !(g_PlayerJumpState % *(v29 + 24)) )
      sub_8002C24C(1);
  }
  if ( g_EquippedHead != 255 )
    sub_8002C29C(dword_8019B568);
  if ( g_EquippedBody != 255 )
    sub_8002C29C(dword_8019B56C);
  if ( g_EquippedShield != 255 )
    sub_8002C29C(dword_8019B570);
  if ( g_EquippedArms != 255 )
    sub_8002C29C(dword_8019B574);
  if ( g_EquippedLegs != 255 )
    sub_8002C29C(dword_8019B578);
  if ( g_EquipAccessory1 != 255 )
    sub_8002C29C(dword_8019B57C);
  if ( g_EquipAccessory2 != 255 )
    sub_8002C29C(dword_8019B580);
  if ( g_EquippedHead == 25 && rand(v28) < 36 )
  {
    g_MagicParticlePos = -19660800;
    LOWORD(g_MagicParticleRadius) = 400;
    SpawnMagicProjectile(11, v30);
  }
  if ( g_EquippedBody == 31 )
    TriggerLightFlash(0x14u, 0x14u, 0x14u, 5000, 2048);
  return ++g_PlayerJumpState;
}
// 8002D2D8: conditional instruction was optimized away because $v1.4 is in (1..FFFF)
// 8002CFE4: variable 'v21' is possibly undefined
// 8002D038: variable 'v22' is possibly undefined
// 8002D240: variable 'v25' is possibly undefined
// 8002D240: variable 'v26' is possibly undefined
// 8002D240: variable 'v27' is possibly undefined
// 8002D40C: variable 'v28' is possibly undefined
// 8002D43C: variable 'v30' is possibly undefined
// 80062BF0: using guessed type int __fastcall rand(_DWORD);
// 8007634C: using guessed type int dword_8007634C[2];
// 80076354: using guessed type int dword_80076354[2];
// 8007635C: using guessed type int dword_8007635C[2];
// 80076364: using guessed type int dword_80076364[2];
// 8009DEBC: using guessed type char byte_8009DEBC;
// 8009DEC3: using guessed type char byte_8009DEC3;
// 801779A8: using guessed type char byte_801779A8;
// 801779D8: using guessed type int g_TitleColor;
// 8019B4D1: using guessed type char byte_8019B4D1;
// 8019B4D2: using guessed type __int16 word_8019B4D2;
// 8019B4D8: using guessed type __int16 g_CurrentHP;
// 8019B4DA: using guessed type __int16 g_MaxMP;
// 8019B4DC: using guessed type __int16 g_CurrentMP;
// 8019B518: using guessed type __int16 g_PoisenStatus;
// 8019B51A: using guessed type __int16 word_8019B51A;
// 8019B51C: using guessed type __int16 word_8019B51C;
// 8019B51E: using guessed type __int16 word_8019B51E;
// 8019B520: using guessed type __int16 word_8019B520;
// 8019B522: using guessed type __int16 word_8019B522;
// 8019B524: using guessed type __int16 g_AttackCooldown;
// 8019B526: using guessed type __int16 word_8019B526;
// 8019B528: using guessed type __int16 word_8019B528;
// 8019B52A: using guessed type __int16 word_8019B52A;
// 8019B52C: using guessed type __int16 word_8019B52C;
// 8019B52E: using guessed type __int16 word_8019B52E;
// 8019B530: using guessed type __int16 word_8019B530;
// 8019B532: using guessed type __int16 word_8019B532;
// 8019B538: using guessed type int g_PlayerJumpState;
// 8019B55F: using guessed type char g_EquippedWeapon;
// 8019B564: using guessed type char byte_8019B564;
// 8019B568: using guessed type int dword_8019B568;
// 8019B56C: using guessed type int dword_8019B56C;
// 8019B570: using guessed type int dword_8019B570;
// 8019B574: using guessed type int dword_8019B574;
// 8019B578: using guessed type int dword_8019B578;
// 8019B57C: using guessed type int dword_8019B57C;
// 8019B580: using guessed type int dword_8019B580;
// 8019B584: using guessed type char g_EquippedHead;
// 8019B585: using guessed type char g_EquippedBody;
// 8019B586: using guessed type char g_EquippedShield;
// 8019B587: using guessed type char g_EquippedArms;
// 8019B588: using guessed type char g_EquippedLegs;
// 8019B589: using guessed type char g_EquipAccessory1;
// 8019B58A: using guessed type char g_EquipAccessory2;
// 8019B591: using guessed type char byte_8019B591;
// 8019B599: using guessed type char byte_8019B599;
// 8019B5C6: using guessed type __int16 word_8019B5C6;
// 8019B5C8: using guessed type __int16 word_8019B5C8;
// 8019B5CA: using guessed type __int16 word_8019B5CA;
// 8019B5CC: using guessed type int dword_8019B5CC;
// 8019B5D0: using guessed type int dword_8019B5D0;
// 8019B5D4: using guessed type __int16 word_8019B5D4;
// 8019B5D6: using guessed type __int16 word_8019B5D6;
// 8019B5D8: using guessed type __int16 word_8019B5D8;
// 8019B5DC: using guessed type int g_MagicParticlePos;
// 8019B5E0: using guessed type int g_MagicParticleRadius;
// 8019B5E4: using guessed type int dword_8019B5E4;
// 8019B5E8: using guessed type int dword_8019B5E8;
// 8019B5EC: using guessed type __int16 word_8019B5EC;
// 8019B5F8: using guessed type __int16 word_8019B5F8;
// 8019B600: using guessed type __int16 word_8019B600;
// 8019B602: using guessed type __int16 word_8019B602;
// 8019B606: using guessed type __int16 g_PadKey;
// 8019B608: using guessed type __int16 g_PadKey_Alt;
// 8019B60C: using guessed type int dword_8019B60C;
// 8019B610: using guessed type int dword_8019B610;
// 8019B616: using guessed type __int16 word_8019B616;
// 8019B618: using guessed type __int16 word_8019B618;
// 8019B61C: using guessed type __int16 word_8019B61C;
// 8019B620: using guessed type int dword_8019B620;
// 801B519D: using guessed type char byte_801B519D;

//----- (8002D4A4) --------------------------------------------------------
int __fastcall ResolveCurrentMetaTile(int a1, int a2, int a3)
{
  MetaTile *mt; // $a0
  unsigned int v4; // $v0
  int v5; // $v0
  int result; // $v0

  if ( a1 > 0x27FFF || a3 > 0x27FFF )
  {
    mt = dword_8006E22C;
    g_TileLayerOffset = 0;
    g_CurrentFloorBaseHeight = 0;
    goto LABEL_13;
  }
  mt = (&g_MapData[200 * (a3 >> 11)] + 10 * (a1 >> 11));
  v4 = -(a2 >> 7);
  if ( mt->layer2.Elevation >= mt->layer1.Elevation )
  {
    if ( v4 < mt->layer2.Elevation && mt->layer1.Elevation )
      goto LABEL_6;
LABEL_7:
    g_TileLayerOffset = 5;
    v5 = -mt->layer2.Elevation;
    goto LABEL_8;
  }
  if ( v4 < mt->layer1.Elevation && mt->layer2.Elevation )
    goto LABEL_7;
LABEL_6:
  g_TileLayerOffset = 0;
  v5 = -mt->layer1.Elevation;
LABEL_8:
  g_CurrentFloorBaseHeight = v5 << 7;
LABEL_13:
  result = g_CurrentFloorBaseHeight;
  g_CurrentMetaTile = mt;
  return result;
}
// 8006E22C: using guessed type int dword_8006E22C[3];
// 801CBD74: using guessed type _DWORD g_MapData[];
// 801DD57E: using guessed type __int16 g_TileLayerOffset;
// 801DD580: using guessed type int g_CurrentFloorBaseHeight;

//----- (8002D5C0) --------------------------------------------------------
int __fastcall Map_CalculatePhysics(
        __int16 worldX,
        int currentY,
        __int16 worldZ,
        int collisionRadius,
        int entityHeightPacked)
{
  int collisionFlags; // $t1
  int layerSwitched; // $fp
  Tile *pTileData; // $t8
  __int16 *tileGeomHeader; // $t0
  int scaledRadiusRaw; // $lo
  int entityBottomY; // $s0
  int primitivesRemaining; // $s1
  __int16 *primitivePtr; // $t0
  int radiusComplement; // $t5
  int posInTileX; // $t3
  int distToTileEdgeX; // $s5
  int posInTileZ; // $t2
  int distToTileEdgeZ; // $s6
  CollisionPrimitiveType primitiveType; // $v1
  __int16 *floorHeightOffset; // $v0
  BOOL isBelowSurface; // $v0
  __int16 *wallHeights; // $a0
  int wallBottomWorldY; // $v1
  __int16 *edgeParams; // $a1
  int v25; // $v1
  int wallHitFlag; // $a2
  int v27; // $v1
  int v28; // $v0
  int v29; // $v0
  int v30; // $v1
  int v31; // $v1
  int v32; // $v1
  BOOL v33; // $v0
  int v34; // $v1
  int v35; // $v1
  BOOL v36; // $v0
  int v37; // $v1
  int v38; // $v1
  int v39; // $v1
  int v40; // $v1
  int v41; // $v1
  int v42; // $v1
  int diagonalDistance; // $s7
  int diagonalThreshold; // $v0
  __int16 *slopeParams; // $a1
  int v46; // $v1
  int slopeInterpolation; // $a0
  int slopeHeightDelta; // $lo
  int v49; // $v0
  int v50; // $v0
  int v51; // $v1
  int diagSlopePosition; // $a0
  int diagSlopeBound; // $v1
  int v54; // $v1
  int diagDistanceFromMin; // $v0
  int slopeWorldY; // $v0
  __int16 *slopeCheckParams; // $a2
  int checkOrientation; // $v1
  bool v59; // dc
  int checkPosFixed; // $v1
  int checkPosShifted; // $a0
  int checkPosScaled; // $v1
  int checkHeightWorldY; // $a0
  int result; // $v0
  int ceilingWorldY; // $v1
  int stepWorldY; // $v0
  bool ceilingCollisionActive; // [sp+10h] [-48h]
  signed int entityHeightFlags; // [sp+50h] [-8h]
  int entityCollisionHeight; // [sp+90h] [+38h]

  collisionFlags = 0;
  layerSwitched = 0;
  g_FinalResultHeight = 100000;
  g_CeilingHeight = 100000;
  g_StepHeight = 100000;
  *&ceilingCollisionActive = 0;
  pTileData = (&g_CurrentMetaTile->layer1 + g_TileLayerOffset);
  entityHeightFlags = entityHeightPacked & 0xF0000000;
  entityCollisionHeight = entityHeightPacked & 0xFFFFFFF;
  MapTileSlice = pTileData;
  g_CurrentWallTopY = g_CurrentFloorBaseHeight - 40000;
RESTART_LAYER:
  tileGeomHeader = (g_CollisionMeshBuffer + *(g_CollisionMeshBuffer + pTileData->CollisionIndex));
  scaledRadiusRaw = collisionRadius * *tileGeomHeader;
  entityBottomY = currentY - entityCollisionHeight;
  primitivesRemaining = *++tileGeomHeader - 1;
  collisionRadius = scaledRadiusRaw >> 12;
  primitivePtr = tileGeomHeader + 1;
  if ( primitivesRemaining != -1 )
  {
    radiusComplement = 2048 - collisionRadius;
    posInTileX = worldX & 0x7FF;                //  2047
    distToTileEdgeX = 2048 - posInTileX;
    posInTileZ = worldZ & 0x7FF;
    distToTileEdgeZ = 2048 - posInTileZ;
    while ( 1 )
    {
      primitiveType = (*primitivePtr++ - 16);   //   (0-, 34-  ..)
      switch ( primitiveType )
      {
        case PRIM_FLAT_FLOOR:                   // Flat Floor
          floorHeightOffset = primitivePtr++;
          if ( *&ceilingCollisionActive )
            goto LABEL_143;
          if ( *floorHeightOffset + g_CurrentFloorBaseHeight < g_FinalResultHeight )
            g_FinalResultHeight = *floorHeightOffset + g_CurrentFloorBaseHeight;
          isBelowSurface = g_FinalResultHeight < currentY;
          goto LABEL_115;
        case PRIM_VERTICAL_WALL:
          wallHeights = primitivePtr;
          primitivePtr += 2;
          if ( entityBottomY >= *wallHeights + g_CurrentFloorBaseHeight )
            goto LABEL_15;
          wallBottomWorldY = wallHeights[1] + g_CurrentFloorBaseHeight;
          if ( wallBottomWorldY >= entityBottomY )
          {
            --primitivesRemaining;
            if ( wallBottomWorldY < g_FinalResultHeight )
              g_FinalResultHeight = wallHeights[1] + g_CurrentFloorBaseHeight;
            g_CurrentWallTopY = -100000;
          }
          else
          {
            collisionFlags |= 8u;
LABEL_15:
            g_CurrentWallTopY = *wallHeights + g_CurrentFloorBaseHeight;
            --primitivesRemaining;
          }
          goto LABEL_144;
        case PRIM_CEILING:
          ceilingWorldY = *primitivePtr + g_CurrentFloorBaseHeight;
          g_CeilingHeight = ceilingWorldY;
          ++primitivePtr;
          if ( entityHeightFlags < 0 )
          {
            g_FinalResultHeight = ceilingWorldY;
            if ( ceilingWorldY < currentY )
            {
              collisionFlags |= 4u;
              *&ceilingCollisionActive = 1;
            }
          }
          if ( (entityHeightFlags & 0x40000000) != 0 )
          {
            g_CurrentWallTopY = ceilingWorldY;
            if ( ceilingWorldY >= entityBottomY )
              collisionFlags |= 8u;
          }
          goto LABEL_143;
        case PRIM_STEP:
          stepWorldY = *primitivePtr++;
          g_StepHeight = stepWorldY + g_CurrentFloorBaseHeight;
          goto LABEL_143;
        case PRIM_WALL_EDGE_X0:
          edgeParams = primitivePtr;
          primitivePtr += 4;
          v25 = (pTileData->Rotation + edgeParams[3]) & 3;
          wallHitFlag = 5;
          if ( v25 == 1 )
          {
            v28 = radiusComplement - *edgeParams;
            goto LABEL_46;
          }
          if ( ((pTileData->Rotation + edgeParams[3]) & 3u) < 2 )
          {
            if ( *edgeParams + collisionRadius < posInTileX )
              goto LABEL_143;
          }
          else
          {
            if ( v25 != 2 )
            {
              v29 = *edgeParams + collisionRadius;
              goto LABEL_52;
            }
            if ( posInTileX < radiusComplement - *edgeParams )
            {
              --primitivesRemaining;
              goto LABEL_144;
            }
          }
          goto LABEL_21;
        case PRIM_WALL_EDGE_X1:
          edgeParams = primitivePtr;
          primitivePtr += 4;
          v30 = (pTileData->Rotation + edgeParams[3]) & 3;
          wallHitFlag = 5;
          if ( v30 == 1 )
          {
            v32 = radiusComplement - *edgeParams;
            v33 = posInTileX < v32;
            if ( posInTileZ >= v32 )
              goto LABEL_21;
            goto LABEL_49;
          }
          if ( ((pTileData->Rotation + edgeParams[3]) & 3u) < 2 )
          {
            v31 = *edgeParams;
            v28 = radiusComplement - v31;
            if ( v31 + collisionRadius >= posInTileX )
              goto LABEL_21;
            goto LABEL_46;
          }
          if ( v30 == 2 )
          {
            v34 = *edgeParams;
            v29 = v34 + collisionRadius;
            if ( posInTileX >= radiusComplement - v34 )
              goto LABEL_21;
            goto LABEL_52;
          }
          v35 = *edgeParams + collisionRadius;
          v36 = v35 < posInTileX;
          if ( v35 >= posInTileZ )
            goto LABEL_21;
          goto LABEL_55;
        case PRIM_WALL_EDGE_Z0:
          edgeParams = primitivePtr;
          primitivePtr += 4;
          v37 = (pTileData->Rotation + edgeParams[3]) & 3;
          wallHitFlag = 5;
          if ( v37 == 1 )
          {
            v39 = radiusComplement - *edgeParams;
            v33 = posInTileX < v39;
            if ( posInTileZ < v39 )
              goto LABEL_143;
LABEL_49:
            if ( v33 )
            {
              --primitivesRemaining;
              goto LABEL_144;
            }
          }
          else if ( ((pTileData->Rotation + edgeParams[3]) & 3u) < 2 )
          {
            v38 = *edgeParams;
            v28 = radiusComplement - v38;
            if ( v38 + collisionRadius < posInTileX )
              goto LABEL_143;
LABEL_46:
            if ( posInTileZ < v28 )
            {
              --primitivesRemaining;
              goto LABEL_144;
            }
          }
          else if ( v37 == 2 )
          {
            v40 = *edgeParams;
            v29 = v40 + collisionRadius;
            if ( posInTileX < radiusComplement - v40 )
              goto LABEL_143;
LABEL_52:
            if ( v29 < posInTileZ )
            {
              --primitivesRemaining;
              goto LABEL_144;
            }
          }
          else
          {
            v41 = *edgeParams + collisionRadius;
            v36 = v41 < posInTileX;
            if ( v41 < posInTileZ )
              goto LABEL_143;
LABEL_55:
            if ( v36 )
            {
              --primitivesRemaining;
              goto LABEL_144;
            }
          }
          goto LABEL_21;
        case PRIM_WALL_EDGE_Z1:
          edgeParams = primitivePtr;
          primitivePtr += 4;
          v42 = (pTileData->Rotation + edgeParams[3]) & 3;
          wallHitFlag = 6;
          if ( v42 == 1 )
          {
            diagonalDistance = -posInTileX - posInTileZ;
            diagonalThreshold = *edgeParams + collisionRadius - 4096;
          }
          else if ( ((pTileData->Rotation + edgeParams[3]) & 3u) >= 2 )
          {
            if ( v42 == 2 )
            {
              diagonalDistance = posInTileZ - posInTileX;
              diagonalThreshold = *edgeParams + collisionRadius - 2048;
            }
            else
            {
              diagonalDistance = posInTileX + posInTileZ;
              diagonalThreshold = *edgeParams + collisionRadius;
            }
          }
          else
          {
            if ( v42 )
            {
              --primitivesRemaining;
              goto LABEL_144;
            }
            diagonalDistance = posInTileX - posInTileZ;
            diagonalThreshold = *edgeParams + collisionRadius - 2048;
          }
          if ( diagonalThreshold < diagonalDistance )
          {
            --primitivesRemaining;
            goto LABEL_144;
          }
LABEL_21:
          v27 = edgeParams[2] + g_CurrentFloorBaseHeight;
          if ( entityBottomY >= edgeParams[1] + g_CurrentFloorBaseHeight )
          {
            g_CurrentWallTopY = edgeParams[1] + g_CurrentFloorBaseHeight;
          }
          else if ( v27 < g_FinalResultHeight )
          {
            g_FinalResultHeight = edgeParams[2] + g_CurrentFloorBaseHeight;
            if ( v27 < currentY )
              collisionFlags |= wallHitFlag;
          }
          goto LABEL_143;
        case PRIM_SLOPE_LINEAR_X:
          slopeParams = primitivePtr;
          v46 = (pTileData->Rotation + primitivePtr[3]) & 3;
          primitivePtr += 6;
          if ( v46 == 1 )
          {
            if ( collisionRadius + 2048 - slopeParams[1] < posInTileZ || posInTileZ < radiusComplement - slopeParams[2] )
              goto LABEL_143;
            if ( !slopeParams[5] )
              _break(7u, 0);
            slopeInterpolation = -posInTileX;
          }
          else if ( v46 < 2 )
          {
            if ( posInTileX < slopeParams[1] - collisionRadius || slopeParams[2] + collisionRadius < posInTileX )
              goto LABEL_143;
            if ( !slopeParams[5] )
              _break(7u, 0);
            slopeInterpolation = -posInTileZ;
          }
          else if ( v46 == 2 )
          {
            if ( collisionRadius + 2048 - slopeParams[1] < posInTileX || posInTileX < radiusComplement - slopeParams[2] )
              goto LABEL_143;
            v49 = slopeParams[5];
            if ( !slopeParams[5] )
              _break(7u, 0);
            if ( v49 == -1 && distToTileEdgeZ == 0x80000000 )
              _break(6u, 0);
            slopeInterpolation = distToTileEdgeZ / v49;
          }
          else
          {
            if ( posInTileZ < slopeParams[1] - collisionRadius || slopeParams[2] + collisionRadius < posInTileZ )
              goto LABEL_143;
            v50 = slopeParams[5];
            if ( !slopeParams[5] )
              _break(7u, 0);
            if ( v50 == -1 && distToTileEdgeX == 0x80000000 )
              _break(6u, 0);
            slopeInterpolation = distToTileEdgeX / v50;
          }
          slopeHeightDelta = (slopeInterpolation + 1) * slopeParams[4];
LABEL_113:
          slopeWorldY = *slopeParams + g_CurrentFloorBaseHeight - slopeHeightDelta;
          if ( slopeWorldY < g_FinalResultHeight )
          {
            g_FinalResultHeight = *slopeParams + g_CurrentFloorBaseHeight - slopeHeightDelta;
            isBelowSurface = slopeWorldY < currentY;
LABEL_115:
            if ( isBelowSurface )
              collisionFlags |= 4u;
          }
          goto LABEL_143;
        case PRIM_SLOPE_CHECK:
          slopeCheckParams = primitivePtr;
          if ( (collisionFlags & 1) == 0 )
            goto LABEL_143;
          primitivePtr += 5;
          checkOrientation = (pTileData->Rotation + slopeCheckParams[4]) & 3;
          if ( checkOrientation == 1 )
          {
            checkPosShifted = worldX & 0x7FF;
LABEL_126:
            checkPosFixed = checkPosShifted << 16;
            goto LABEL_127;
          }
          if ( ((pTileData->Rotation + slopeCheckParams[4]) & 3u) >= 2 )
          {
            checkPosShifted = 2048 - posInTileZ;
            if ( checkOrientation != 2 )
              checkPosShifted = 2048 - posInTileX;
            goto LABEL_126;
          }
          v59 = checkOrientation == 0;
          checkPosFixed = posInTileZ << 16;
          if ( !v59 )
          {
            --primitivesRemaining;
            goto LABEL_144;
          }
LABEL_127:
          checkPosScaled = checkPosFixed >> 16;
          if ( checkPosScaled >= *slopeCheckParams + collisionRadius
            && slopeCheckParams[1] - collisionRadius >= checkPosScaled )
          {
            checkHeightWorldY = slopeCheckParams[2] + g_CurrentFloorBaseHeight;
            g_FinalResultHeight = checkHeightWorldY;
            g_CurrentWallTopY = slopeCheckParams[3] + g_CurrentFloorBaseHeight;
            if ( entityBottomY < g_CurrentWallTopY )
              collisionFlags |= 8u;
            if ( checkHeightWorldY >= currentY )
              collisionFlags &= 0xFFFFFFFA;
          }
LABEL_143:
          --primitivesRemaining;
LABEL_144:
          if ( primitivesRemaining == -1 )
            return collisionFlags;
          break;
        case PRIM_SLOPE_DIAGONAL:
          slopeParams = primitivePtr;
          v51 = (pTileData->Rotation + primitivePtr[3]) & 3;
          primitivePtr += 6;
          if ( v51 == 1 )
          {
            diagSlopePosition = posInTileX + posInTileZ;
          }
          else if ( v51 >= 2 )
          {
            if ( v51 == 2 )
              diagSlopePosition = posInTileX + 2048 - posInTileZ;
            else
              diagSlopePosition = 4096 - posInTileZ - posInTileX;
          }
          else
          {
            diagSlopePosition = posInTileZ + 2048 - posInTileX;
          }
          diagSlopeBound = slopeParams[1];
          if ( diagSlopePosition < diagSlopeBound
            || (diagSlopeBound = slopeParams[2], diagSlopeBound < diagSlopePosition) )
          {
            diagSlopePosition = diagSlopeBound;
          }
          v54 = slopeParams[5];
          diagDistanceFromMin = diagSlopePosition - slopeParams[1];
          if ( !slopeParams[5] )
            _break(7u, 0);
          if ( v54 == -1 && diagDistanceFromMin == 0x80000000 )
            _break(6u, 0);
          slopeHeightDelta = diagDistanceFromMin / v54 * slopeParams[4];
          goto LABEL_113;
        case PRIM_SWITCH_LAYER:
          result = collisionFlags;
          if ( layerSwitched )
            return result;
          g_TileLayerOffset = g_TileLayerOffset == 0 ? 5 : 0;
          pTileData = (&g_CurrentMetaTile->layer1 + g_TileLayerOffset);
          g_CurrentFloorBaseHeight = -128 * pTileData->Elevation;
          layerSwitched = 1;
          goto RESTART_LAYER;
        default:
          goto LABEL_143;
      }
    }
  }
  return collisionFlags;
}
// 8002D87C: conditional instruction was optimized away because $v1.4==0
// 8002D894: conditional instruction was optimized away because $v1.4==3
// 8002D970: conditional instruction was optimized away because $v1.4==0
// 8002D988: conditional instruction was optimized away because $v1.4==3
// 8002DA48: conditional instruction was optimized away because $v1.4==0
// 8002DA60: conditional instruction was optimized away because $v1.4==3
// 8002DB60: conditional instruction was optimized away because $v1.4==3
// 8002DBF4: conditional instruction was optimized away because $v1.4==0
// 8002DC0C: conditional instruction was optimized away because $v1.4==3
// 8002DC70: conditional instruction was optimized away because $t2.4<10000u
// 8002DCE4: conditional instruction was optimized away because $t3.4<10000u
// 8002DE00: conditional instruction was optimized away because $v1.4==0
// 8002DE18: conditional instruction was optimized away because $v1.4==3
// 8002DF54: conditional instruction was optimized away because $v1.4==3
// 801DBD74: using guessed type _DWORD g_CollisionMeshBuffer[1385];
// 801DD57E: using guessed type __int16 g_TileLayerOffset;
// 801DD580: using guessed type int g_CurrentFloorBaseHeight;
// 801DD584: using guessed type int g_FinalResultHeight;
// 801DD588: using guessed type int g_CurrentWallTopY;
// 801DD58C: using guessed type int g_CeilingHeight;
// 801DD590: using guessed type int g_StepHeight;

//----- (8002E120) --------------------------------------------------------
int __fastcall MAP_CollisionWithTile(int x, int y, int z, int r, int h)
{
  __int16 worldX; // $s1
  __int16 worldZ; // $s3

  worldX = x;
  worldZ = z;
  ResolveCurrentMetaTile(x, y - 1280, z);
  Map_CalculatePhysics(worldX, y, worldZ, r, h);
  return g_FinalResultHeight;
}
// 801DD584: using guessed type int g_FinalResultHeight;

//----- (8002E19C) --------------------------------------------------------
int __fastcall Map_GetCellData(char layer_idx, int X, int Z, int coll_radius, int coll_height)
{
  char *tile; // $v1
  int base_height; // $v0

  tile = &g_MapData[200 * (Z >> 11)] + 10 * (X >> 11);
  if ( layer_idx == 2 )
  {
    g_TileLayerOffset = 5;
    base_height = -tile[6];
  }
  else
  {
    g_TileLayerOffset = 0;
    base_height = -tile[1];
  }
  g_CurrentFloorBaseHeight = base_height << 7;
  g_CurrentMetaTile = (&g_MapData[200 * (Z >> 11)] + 10 * (X >> 11));
  Map_CalculatePhysics(X, base_height << 7, Z, coll_radius, coll_height);
  return g_FinalResultHeight;
}
// 801CBD74: using guessed type _DWORD g_MapData[];
// 801DD57E: using guessed type __int16 g_TileLayerOffset;
// 801DD580: using guessed type int g_CurrentFloorBaseHeight;
// 801DD584: using guessed type int g_FinalResultHeight;

//----- (8002E25C) --------------------------------------------------------
int __fastcall Map_MarkOccupiedTiles(Vector3 *pos, int a2, int a3, int a4)
{
  int v4; // $a2
  int v5; // $t3
  int v6; // $t4
  unsigned int v7; // $t0
  unsigned int v8; // $a1
  char *v9; // $v1
  int v10; // $a3
  char *v11; // $a0
  int result; // $v0
  unsigned int v13; // $t1
  int v14; // $a2
  _BYTE *v15; // $a0

  v4 = a3 + 2048;
  v5 = (pos - v4) >> 11;
  v6 = ((pos + v4) >> 11) - v5;
  v7 = (a2 - v4) >> 11;
  v8 = ((a2 + v4) >> 11) - v7;
  v9 = &g_MapData[200 * v7] + 10 * v5;
  v10 = 4 * a4;
  do
  {
    v11 = v9;
    result = v7 < 0x50;
    v9 += 800;
    if ( v7 < 0x50 )
    {
      v13 = v5;
      v14 = v6;
      v15 = v11 + 2;
      do
      {
        result = v13 < 0x50;
        if ( v13++ < 0x50 )
        {
          result = v10 + *v15;
          *v15 = result;
        }
        --v14;
        v15 += 10;
      }
      while ( v14 != -1 );
    }
    --v8;
    ++v7;
  }
  while ( v8 != -1 );
  return result;
}
// 801CBD74: using guessed type _DWORD g_MapData[];

//----- (8002E318) --------------------------------------------------------
int __fastcall CollisionWithTilemap(int a1, int a2, int a3, int a4, int a5)
{
  __int16 v5; // $s1
  __int16 v7; // $s3

  v5 = a1;
  v7 = a3;
  ResolveCurrentMetaTile(a1, a2 - ((16 * a5) >> 5), a3);
  return Map_CalculatePhysics(v5, a2, v7, a4, a5);
}

//----- (8002E394) --------------------------------------------------------
int sub_8002E394()
{
  int result; // $v0
  Entity **v1; // $v0
  int v2; // $a0
  int v3; // $a1
  Entity **v4; // $v0
  int v5; // $a0
  int v6; // $a2
  int v7; // $a3
  _DWORD *v8; // $v0

  if ( (dword_801DD594 & 0x80) != 0 )
  {
    dword_801DD5A4 = *&g_LanguageID[0].header[2];
    dword_801DD5A8 = *&g_LanguageID[0].header[6];
    dword_801DD5AC = *&g_LanguageID[0].menus[0].header.posY;
    dword_801DD5B0 = *&g_LanguageID[0].menus[0].header.height;
    word_801DD5B4 = 800;
    result = 1700;
  }
  else if ( dword_801DD598 == -1 )
  {
    result = 16 * dword_801DD59C;
    if ( dword_801DD59C == dword_801DD598 )
      return result;
    v4 = &ObjectInstances[17 * dword_801DD59C];
    v5 = *(v4 + 3);
    v6 = v4[6];
    v7 = v4[7];
    dword_801DD5A4 = v4[5];
    dword_801DD5A8 = v6;
    dword_801DD5AC = v7;
    dword_801DD5B0 = v4[8];
    v8 = &GameDB01ObjectClassDeclaration[6 * v5];
    word_801DD5B4 = *(v8 + 2);
    result = *(v8 + 4);
  }
  else
  {
    v1 = &g_ObjectArray[31 * dword_801DD598];
    v2 = v1[12];
    v3 = v1[13];
    dword_801DD5A4 = v1[11];
    dword_801DD5A8 = v2;
    dword_801DD5AC = v3;
    dword_801DD5B0 = v1[14];
    word_801DD5B4 = *(v1 + 14);
    result = *(v1 + 15);
  }
  word_801DD5B6 = result;
  return result;
}
// 801779F0: using guessed type _DWORD GameDB01ObjectClassDeclaration[];
// 801DD594: using guessed type int dword_801DD594;
// 801DD598: using guessed type int dword_801DD598;
// 801DD59C: using guessed type int dword_801DD59C;
// 801DD5A4: using guessed type int dword_801DD5A4;
// 801DD5A8: using guessed type int dword_801DD5A8;
// 801DD5AC: using guessed type int dword_801DD5AC;
// 801DD5B0: using guessed type int dword_801DD5B0;
// 801DD5B4: using guessed type __int16 word_801DD5B4;
// 801DD5B6: using guessed type __int16 word_801DD5B6;

//----- (8002E4F4) --------------------------------------------------------
int __fastcall sub_8002E4F4(int a1, int a2, int a3, int a4, int a5, char a6)
{
  int v10; // $s1
  int v11; // $s2
  int v12; // $v0
  int v13; // $v0

  v10 = 0;
  if ( (a6 & 1) != 0 )
  {
    v10 = CollisionWithTilemap(a1, a2, a3, a4, a5);
    if ( (a6 & 2) != 0 && (MapTileSlice->Flags & 0x40) != 0 )
    {
      g_FinalResultHeight = -100000;
      v10 |= 1u;
    }
  }
  else
  {
    g_CurrentMetaTile = (&g_MapData[200 * (a3 >> 11)] + 10 * (a1 >> 11));
  }
  v11 = a5 & 0xFFFFFFF;
  if ( (g_CurrentMetaTile->layer1.Rotation & 0xFC) != 0 )
  {
    if ( (a6 & 0x10) != 0 )
    {
      dword_801DD598 = Entity_CheckWorldCollision(a1, a2, a3, a4, v11);
      v12 = a6 & 0x20;
      if ( dword_801DD598 != -1 )
        v10 |= 0x10u;
    }
    else
    {
      if ( (a6 & 0x40) != 0 )
      {
        dword_801DD598 = sub_8003D5EC(a1, a2, a3, a4, v11);
        if ( dword_801DD598 != -1 )
          v10 |= 0x10u;
      }
      dword_801DD598 = -1;
      v12 = a6 & 0x20;
    }
    if ( v12 )
    {
      dword_801DD59C = sub_80038AF0(a1, a2, a3, a4, v11);
      v13 = a6 & 0x80;
      if ( dword_801DD59C != -1 )
        v10 |= 0x20u;
    }
    else
    {
      dword_801DD59C = -1;
      v13 = a6 & 0x80;
    }
    if ( v13 && sub_80025EDC(a1, a2, a3, a4, v11) != -1 )
      v10 |= 0x80u;
  }
  else
  {
    dword_801DD598 = -1;
    dword_801DD59C = -1;
  }
  dword_801DD594 = v10;
  return v10;
}
// 801CBD74: using guessed type _DWORD g_MapData[];
// 801DD584: using guessed type int g_FinalResultHeight;
// 801DD594: using guessed type int dword_801DD594;
// 801DD598: using guessed type int dword_801DD598;
// 801DD59C: using guessed type int dword_801DD59C;

//----- (8002E73C) --------------------------------------------------------
int PrepareRenderPrimitives()
{
  int *v0; // $t1
  int *v1; // $t0
  int v2; // $t2
  __int16 *v3; // $a3
  __int16 *v4; // $a2
  int v5; // $v1
  int v6; // $a0
  int v7; // $a1
  int v8; // $v1
  int v9; // $a0
  int v10; // $a1
  __int16 v11; // $v0
  int result; // $v0

  v0 = g_PrimitiveTable;
  v1 = &g_DynamicPrimitiveTable;
  v2 = 79;
  v3 = &unk_8019520A;
  v4 = &word_8006E50E;
  do
  {
    v5 = *(v4 - 9);
    v6 = *(v4 - 7);
    v7 = *(v4 - 5);
    *(v3 - 11) = *(v4 - 11);
    *(v3 - 9) = v5;
    *(v3 - 7) = v6;
    *(v3 - 5) = v7;
    *(v3 - 3) = *(v4 - 3);
    v8 = v0[1];
    v9 = v0[2];
    v10 = v0[3];
    *v1 = *v0;
    v1[1] = v8;
    v1[2] = v9;
    v1[3] = v10;
    v1[4] = v0[4];
    *(v3 - 1) = *(v4 - 1);
    v11 = *v4;
    v4 += 22;
    v0 += 11;
    v1 += 26;
    --v2;
    *v3 = v11;
    v3 += 52;
  }
  while ( v2 != -1 );
  result = 255;
  g_RecalculateOrientationCache = 0;
  byte_80194DFD = 0;
  word_80194E02 = 0;
  word_80194E00 = 0;
  word_80194DFE = 0;
  byte_80194DF9 = -1;
  return result;
}
// 8006E4E4: using guessed type int g_PrimitiveTable[10];
// 8006E50E: using guessed type __int16 word_8006E50E;
// 80194DF9: using guessed type char byte_80194DF9;
// 80194DFD: using guessed type char byte_80194DFD;
// 80194DFE: using guessed type __int16 word_80194DFE;
// 80194E00: using guessed type __int16 word_80194E00;
// 80194E02: using guessed type __int16 word_80194E02;
// 801951A0: using guessed type int g_RecalculateOrientationCache;

//----- (8002E86C) --------------------------------------------------------
int PrecomputeCardinalOrientations()
{
  int result; // $v0
  _WORD *v1; // $s0
  int i; // $s1

  result = g_RecalculateOrientationCache;
  v1 = &g_DynamicPrimitiveTable;
  if ( g_RecalculateOrientationCache )
  {
    for ( i = 79; i != -1; --i )
    {
      RotateMatrixCardinal(v1, v1 + 10, 1);
      RotateMatrixCardinal(v1, v1 + 20, 2);
      result = RotateMatrixCardinal(v1, v1 + 30, 3);
      v1 += 52;
    }
  }
  return result;
}
// 801951A0: using guessed type int g_RecalculateOrientationCache;

//----- (8002E8F8) --------------------------------------------------------
int __fastcall InterpolateAnimationFrame(char a1, int a2, int a3, int a4)
{
  int result; // $v0
  char v9; // $v0
  int v10; // $a0
  char v11; // $v0
  int v12; // $a0

  if ( (a1 & 2) != 0 )
    LerpRotationMatrix((a3 + 80), (a2 + 20), (a3 + 80), a4);
  if ( (a1 & 1) != 0 )
    LerpRotationMatrix(a3, a2, a3, a4);
  result = a1 & 8;
  if ( (a1 & 4) != 0 )
  {
    v9 = FixedPointLerp(*(a3 + 98), *(a2 + 38), a4);
    v10 = *(a3 + 99);
    *(a3 + 98) = v9;
    v11 = FixedPointLerp(v10, *(a2 + 39), a4);
    v12 = *(a3 + 100);
    *(a3 + 99) = v11;
    *(a3 + 100) = FixedPointLerp(v12, *(a2 + 40), a4);
    result = a1 & 8;
  }
  if ( result )
  {
    result = FixedPointLerp(*(a3 + 102), *(a2 + 42), a4);
    *(a3 + 102) = result;
  }
  return result;
}

//----- (8002E9E8) --------------------------------------------------------
int __fastcall UpdateEnvironmentTint(char flags, int targetDataPtr, int interpolationFactor)
{
  char *primitivePtr; // $s1
  int i; // $s0
  int result; // $v0

  primitivePtr = &g_DynamicPrimitiveTable;
  for ( i = 0; i < 62; ++i )                    //   62  /
  {
    if ( i != 38 )                              //  38 . ?  ?
      InterpolateAnimationFrame(flags, targetDataPtr, primitivePtr, interpolationFactor);
    primitivePtr += 104;
  }
  result = 1;
  if ( (flags & 1) != 0 )
    g_RecalculateOrientationCache = 1;
  return result;
}
// 801951A0: using guessed type int g_RecalculateOrientationCache;

//----- (8002EA88) --------------------------------------------------------
int __fastcall TriggerLightFlash(
        unsigned __int8 r,
        unsigned __int8 g,
        unsigned __int8 b,
        int intensity,
        __int16 factor)
{
  char flags; // $t1
  char tempData[42]; // [sp+10h] [-30h] BYREF
  __int16 lightIntensity; // [sp+3Ah] [-6h]

  flags = 0;
  if ( r != 255 || g != 255 || b != 255 )
  {
    flags = 4;
    tempData[38] = r;
    tempData[39] = g;
    tempData[40] = b;
  }
  if ( intensity != -1 )
  {
    lightIntensity = intensity;
    flags |= 8u;
    // (  tempData       42)
  }
  return UpdateEnvironmentTint(flags, tempData, factor);
}

//----- (8002EAFC) --------------------------------------------------------
int sub_8002EAFC()
{
  _DWORD *v0; // $v1
  int result; // $v0

  v0 = byte_80194F60;
  for ( result = 143; result != -1; --result )
    *v0++ = 0;
  return result;
}
// 80194F60: using guessed type _BYTE byte_80194F60[576];

//----- (8002EB24) --------------------------------------------------------
int __fastcall sub_8002EB24(_DWORD *a1, _DWORD *a2, char a3)
{
  int v3; // $t2
  int v4; // $a0
  unsigned __int16 v5; // $t1
  int v6; // $t0
  int v7; // $t3
  int v8; // $t5
  __int16 v9; // $t4
  int v10; // $a3
  int v11; // $a1
  int v12; // $a3
  unsigned int v13; // $a0
  int v14; // $v1
  int v15; // $v0
  int result; // $v0
  int v17; // $a1
  unsigned int v18; // $a0
  int v19; // $v1
  int v20; // $v0

  v3 = (*a1 >> 12) + dword_80194F4C;
  v4 = (a1[1] >> 12) + dword_80194F50;
  v5 = v4;
  v6 = (a2[1] >> 12) + dword_80194F50 - v4;
  v7 = (*a2 >> 12) + dword_80194F4C - v3;
  if ( (v7 & 0x8000) != 0 )
  {
    v7 = v3 - ((*a2 >> 12) + dword_80194F4C);
    v8 = -1;
  }
  else
  {
    v8 = 1;
  }
  v9 = 1;
  if ( (v6 & 0x8000) != 0 )
  {
    v6 = v4 - ((a2[1] >> 12) + dword_80194F50);
    v9 = -1;
  }
  v10 = v6;
  if ( v7 < v6 )
  {
    v17 = v6 << 16 >> 17;
    v18 = v3;
    do
    {
      if ( v18 < 0x18 && v5 < 0x18u )
        byte_80194F60[24 * v5 + v18] = a3;
      v19 = v17 - v7;
      v20 = (v17 - v7) << 16;
      v17 -= v7;
      if ( v20 <= 0 )
      {
        LOWORD(v3) = v3 + v8;
        v17 = v6 + v19;
      }
      v5 += v9;
      result = --v10 << 16;
      v18 = v3;
    }
    while ( (v10 & 0x8000) == 0 );
  }
  else
  {
    v11 = v7 << 16 >> 17;
    v12 = v7;
    v13 = v3;
    do
    {
      if ( v13 < 0x18 && v5 < 0x18u )
        byte_80194F60[24 * v5 + v13] = a3;
      v14 = v11 - v6;
      v15 = (v11 - v6) << 16;
      v11 -= v6;
      if ( v15 <= 0 )
      {
        v5 += v9;
        v11 = v7 + v14;
      }
      v3 += v8;
      result = --v12 << 16;
      v13 = v3;
    }
    while ( (v12 & 0x8000) == 0 );
  }
  return result;
}
// 80194F4C: using guessed type int dword_80194F4C;
// 80194F50: using guessed type int dword_80194F50;
// 80194F60: using guessed type _BYTE byte_80194F60[576];

//----- (8002ECC0) --------------------------------------------------------
unsigned int __fastcall sub_8002ECC0(int a1, unsigned int a2, int a3, unsigned __int8 a4)
{
  BOOL v4; // $t0
  unsigned __int8 *v5; // $v1
  unsigned int result; // $v0
  int v7; // $v0
  bool v8; // dc

  v4 = 0;
  v5 = (a2 + a1);
  while ( 1 )
  {
    result = a2;
    if ( a2 >= 0x18 )
      break;
    v7 = *v5;
    if ( v4 )
    {
      v8 = v7 != a4;
      result = a2;
      if ( v8 )
        return result;
    }
    else
    {
      v4 = v7 == a4;
    }
    v5 += a3;
    a2 += a3;
  }
  return result;
}
// 8002ECE8: conditional instruction was optimized away because $t0.4==1

//----- (8002ED24) --------------------------------------------------------
int __fastcall sub_8002ED24(unsigned __int8 a1)
{
  _BYTE *v2; // $s1
  int i; // $s2
  signed int v5; // $s0
  signed int v6; // $a0
  int result; // $v0
  unsigned __int8 *v8; // $v1

  v2 = byte_80194F60;
  for ( i = 23; i != -1; --i )
  {
    v5 = sub_8002ECC0(v2, 0, 1, a1);
    v6 = sub_8002ECC0(v2, 0x17u, -1, a1);
    result = v6 < v5;
    if ( v6 >= v5 )
    {
      v8 = &v2[v5];
      result = v6 - v5;
      do
      {
        *v8 = a1;
        --result;
        ++v8;
      }
      while ( result != -1 );
    }
    v2 += 24;
  }
  return result;
}
// 80194F60: using guessed type _BYTE byte_80194F60[576];

//----- (8002EDE4) --------------------------------------------------------
int __fastcall sub_8002EDE4(int a1)
{
  int result; // $v0
  char *v2; // $a2
  unsigned __int8 v3; // $a1
  char *v4; // $a0

  result = dword_801B8AC4 < 0x18;
  if ( dword_801B8AC4 < 0x18 )
  {
    result = dword_801B8AC8 < 0x18;
    if ( dword_801B8AC8 < 0x18 )
    {
      result = *dword_801B8ACC;
      if ( *dword_801B8ACC )
      {
        if ( dword_801B8ABC >= 0x50 || dword_801B8AC0 >= 0x50 )
        {
          result = dword_801B8ACC;
          *dword_801B8ACC = 0;
        }
        else
        {
          v2 = &g_MapData[200 * dword_801B8AC0] + 10 * dword_801B8ABC;
          v3 = *(dword_801B8ACC + a1);
          v4 = &v2[dword_801B8AB0];
          if ( (v3 & byte_801B8AB8) == 0 || *v4 == 255 )
          {
            *dword_801B8ACC &= ~byte_801B8AB8;
          }
          else if ( (v4[4] & 0x80) != 0 )
          {
LABEL_10:
            result = dword_801B8ACC;
            *dword_801B8ACC |= byte_801B8AB9;
            return result;
          }
          result = 255;
          if ( v2[dword_801B8AB4] != 255 )
          {
            result = (v3 & byte_801B8AB9);
            if ( (v3 & byte_801B8AB9) != 0 )
              goto LABEL_10;
          }
        }
      }
    }
  }
  return result;
}
// 801B8AB0: using guessed type int dword_801B8AB0;
// 801B8AB4: using guessed type int dword_801B8AB4;
// 801B8AB8: using guessed type char byte_801B8AB8;
// 801B8AB9: using guessed type char byte_801B8AB9;
// 801B8ABC: using guessed type int dword_801B8ABC;
// 801B8AC0: using guessed type int dword_801B8AC0;
// 801B8AC4: using guessed type int dword_801B8AC4;
// 801B8AC8: using guessed type int dword_801B8AC8;
// 801B8ACC: using guessed type int dword_801B8ACC;
// 801CBD74: using guessed type _DWORD g_MapData[];

//----- (8002EF78) --------------------------------------------------------
int __fastcall sub_8002EF78(int a1, int a2, int a3, int a4, int a5, int a6)
{
  unsigned int v7; // $t9
  unsigned int v8; // $a1
  unsigned int v9; // $t7
  unsigned int v10; // $t1
  _BYTE *v11; // $t0
  int v12; // $t8
  int result; // $v0
  int v14; // $t4
  int v15; // $t3
  int v16; // $t2
  unsigned __int8 *v17; // $s1
  unsigned __int8 *v18; // $s0
  unsigned __int8 v19; // $t6
  unsigned __int8 v20; // $t5
  int v21; // $v1
  char *v22; // $a3

  v7 = dword_801B8AC4;
  v8 = dword_801B8AC8;
  v9 = dword_801B8ABC;
  v10 = dword_801B8AC0;
  v11 = dword_801B8ACC;
  v12 = a6 - 1;
  result = a4 << 24;
  if ( a6 )
  {
    v14 = a4;
    v15 = 3 * dword_801B8AC0;
    v16 = 5 * dword_801B8ABC;
    v17 = (dword_801B8ACC + a2);
    v18 = (dword_801B8ACC + a1);
    do
    {
      if ( v7 >= 0x18 || v8 >= 0x18 || !*v11 )
        goto LABEL_21;
      if ( v9 >= 0x50 || v10 >= 0x50 )
      {
        *v11 = 0;
        goto LABEL_21;
      }
      v19 = *v18;
      v20 = *v17;
      if ( (*v18 & byte_801B8AB8) != 0 )
      {
        v21 = 8 * v15;
      }
      else
      {
        v21 = 8 * v15;
        if ( (*v17 & byte_801B8AB8) == 0 )
        {
          v22 = &g_MapData[8 * v21 + 8 * v10] + 2 * v16;
LABEL_11:
          *v11 &= ~byte_801B8AB8;
          goto LABEL_16;
        }
      }
      v22 = &g_MapData[8 * v21 + 8 * v10] + 2 * v16;
      if ( v22[dword_801B8AB0] == 255 )
        goto LABEL_11;
      if ( (v22[dword_801B8AB0 + 4] & 0x80) != 0 )
        goto LABEL_15;
LABEL_16:
      if ( v22[dword_801B8AB4] == 255 )
        goto LABEL_21;
      if ( (v19 & byte_801B8AB9) != 0 || (v20 & byte_801B8AB9) != 0 )
      {
LABEL_15:
        *v11 |= byte_801B8AB9;
LABEL_21:
        v17 += a5;
        goto LABEL_22;
      }
      v17 += a5;
LABEL_22:
      v18 += a5;
      v11 += a5;
      v7 += a3;
      v8 += v14;
      v16 += 5 * a3;
      v9 += a3;
      v15 += 3 * v14;
      --v12;
      result = -1;
      v10 += v14;
    }
    while ( v12 != -1 );
  }
  dword_801B8AC4 = v7;
  dword_801B8AC8 = v8;
  dword_801B8ABC = v9;
  dword_801B8AC0 = v10;
  dword_801B8ACC = v11;
  return result;
}
// 801B8AB0: using guessed type int dword_801B8AB0;
// 801B8AB4: using guessed type int dword_801B8AB4;
// 801B8AB8: using guessed type char byte_801B8AB8;
// 801B8AB9: using guessed type char byte_801B8AB9;
// 801B8ABC: using guessed type int dword_801B8ABC;
// 801B8AC0: using guessed type int dword_801B8AC0;
// 801B8AC4: using guessed type int dword_801B8AC4;
// 801B8AC8: using guessed type int dword_801B8AC8;
// 801B8ACC: using guessed type int dword_801B8ACC;
// 801CBD74: using guessed type _DWORD g_MapData[];

//----- (8002F1C8) --------------------------------------------------------
int sub_8002F1C8()
{
  int v0; // $a3
  int *v1; // $a0
  __int16 *v2; // $a2
  int i; // $a1
  int v4; // $v1
  int v5; // $lo
  int v6; // $s5
  int v7; // $s3
  int v8; // $s6
  int v9; // $a3
  int v10; // $v0
  char *v11; // $s4
  int v12; // $s7
  char v13; // $v0
  int v14; // $t6
  int v15; // $t7
  int v16; // $s0
  int v17; // $t5
  char v18; // $v0
  int v19; // $s1
  char v20; // $v1
  char v21; // $v0
  char v22; // $v1
  char v23; // $v0
  char v24; // $v1
  char v25; // $v0
  char v26; // $v1
  int v27; // $v0
  int result; // $v0
  int v29; // [sp+14h] [-3Ch]
  __int16 v30; // [sp+18h] [-38h] BYREF
  __int16 v31; // [sp+1Ah] [-36h]
  __int16 v32; // [sp+1Ch] [-34h]
  __int16 v33; // [sp+1Eh] [-32h]
  __int16 v34; // [sp+20h] [-30h]
  __int16 v35; // [sp+22h] [-2Eh]
  __int16 v36; // [sp+24h] [-2Ch]
  int v37[2]; // [sp+28h] [-28h] BYREF
  int v38[2]; // [sp+30h] [-20h] BYREF
  int v39[2]; // [sp+38h] [-18h] BYREF
  int v40[4]; // [sp+40h] [-10h] BYREF

  v0 = 4096 - FixedCos(dword_80194F3C);
  v1 = dword_8006F2A4;
  v2 = &v30;
  for ( i = 6; i != -1; --i )
  {
    v4 = *v1;
    v5 = (*(v1++ + 1) - v4) * v0;
    *v2++ = (v5 >> 12) + v4;
  }
  v6 = FixedSin(SHIWORD(dword_80194F3C));
  v7 = FixedCos(SHIWORD(dword_80194F3C));
  sub_8002EAFC();
  v8 = 2 * dword_80194F2C;
  v9 = (((v6 * v30) >> 20) + 12);
  dword_801B8ABC = dword_80194F44;
  dword_80194F4C = v9 - dword_80194F44;
  dword_801B8AC4 = v9;
  dword_801B8AC0 = dword_80194F48;
  dword_80194F54 = dword_80194F44 - v9;
  v10 = (((-v7 * v30) >> 20) + 12);
  dword_80194F50 = v10 - dword_80194F48;
  dword_80194F58 = dword_80194F48 - v10;
  v11 = &byte_80194F60[24 * v10 + v9];
  dword_801B8AC8 = v10;
  dword_801B8ACC = v11;
  v12 = 2 * dword_80194F34;
  ResolveCurrentMetaTile(dword_80194F2C, dword_80194F30, dword_80194F34);
  dword_801B8AB0 = g_TileLayerOffset;
  dword_801B8AB4 = 5 - g_TileLayerOffset;
  if ( g_TileLayerOffset )
  {
    byte_801B8AB8 = 2;
    v13 = 1;
  }
  else
  {
    byte_801B8AB8 = 1;
    v13 = 2;
  }
  byte_801B8AB9 = v13;
  v14 = v33 * v6;
  v15 = v33 * v7;
  v16 = v36 * v6;
  v17 = v36 * v7;
  v37[0] = ((v31 * v7 - v14) >> 8) + v8;
  v37[1] = ((v31 * v6 + v15) >> 8) + v12;
  v38[0] = ((v32 * v7 - v14) >> 8) + v8;
  v38[1] = ((v32 * v6 + v15) >> 8) + v12;
  v39[0] = ((v34 * v7 - v16) >> 8) + v8;
  v39[1] = ((v34 * v6 + v17) >> 8) + v12;
  v40[0] = ((v35 * v7 - v16) >> 8) + v8;
  v40[1] = ((v35 * v6 + v17) >> 8) + v12;
  sub_8002EB24(v37, v38, byte_801B8AB8 | 0x20);
  sub_8002EB24(v38, v40, byte_801B8AB8 | 0x20);
  sub_8002EB24(v40, v39, byte_801B8AB8 | 0x20);
  sub_8002EB24(v39, v37, byte_801B8AB8 | 0x20);
  sub_8002ED24(byte_801B8AB8 | 0x20);
  v18 = 3;
  if ( (*(&unk_801CBD78 + 800 * dword_801B8AC0 + 10 * dword_801B8ABC + dword_801B8AB0) & 0x80) == 0 )
    v18 = byte_801B8AB8;
  *dword_801B8ACC = v18;
  v19 = 0;
  do
  {
    ++dword_801B8AC0;
    dword_801B8ACC += 24;
    ++dword_801B8AC8;
    sub_8002EDE4(-24);
    --dword_801B8ABC;
    --dword_801B8AC4;
    --dword_801B8ACC;
    sub_8002EF78(-24, -23, -1, 0, -1, v19);
    sub_8002EDE4(-23);
    --dword_801B8AC0;
    dword_801B8ACC -= 24;
    --dword_801B8AC8;
    sub_8002EF78(1, -23, 0, -1, -24, v19);
    sub_8002EDE4(1);
    --dword_801B8AC0;
    dword_801B8ACC -= 24;
    --dword_801B8AC8;
    sub_8002EF78(1, 25, 0, -1, -24, v19);
    sub_8002EDE4(25);
    ++dword_801B8ABC;
    ++dword_801B8AC4;
    ++dword_801B8ACC;
    sub_8002EF78(24, 25, 1, 0, 1, v19);
    sub_8002EDE4(24);
    ++dword_801B8ABC;
    ++dword_801B8AC4;
    ++dword_801B8ACC;
    sub_8002EF78(24, 23, 1, 0, 1, v19);
    sub_8002EDE4(23);
    ++dword_801B8AC0;
    dword_801B8ACC += 24;
    ++dword_801B8AC8;
    sub_8002EF78(-1, 23, 0, 1, 24, v19);
    sub_8002EDE4(-1);
    ++dword_801B8AC0;
    dword_801B8ACC += 24;
    ++dword_801B8AC8;
    sub_8002EF78(-1, -25, 0, 1, 24, v19);
    sub_8002EDE4(-25);
    v29 = v19;
    --dword_801B8ABC;
    ++v19;
    --dword_801B8AC4;
    --dword_801B8ACC;
    sub_8002EF78(-24, -25, -1, 0, -1, v29);
  }
  while ( v19 < 14 );
  v20 = *(v11 - 23);
  *(v11 - 25) |= 0x80u;
  v21 = *(v11 - 24);
  *(v11 - 23) = v20 | 0x80;
  v22 = *v11;
  *(v11 - 24) = v21 | 0xC0;
  v23 = *(v11 - 1);
  *v11 = v22 | 0xC0;
  v24 = v11[23];
  *(v11 - 1) = v23 | 0xC0;
  v25 = v11[1];
  v11[23] = v24 | 0x80;
  v26 = v11[25];
  v11[1] = v25 | 0xC0;
  v27 = v11[24];
  v11[25] = v26 | 0x80;
  result = v27 | 0xC0;
  v11[24] = result;
  return result;
}
// 8006F2A4: using guessed type int dword_8006F2A4[7];
// 80194F2C: using guessed type int dword_80194F2C;
// 80194F30: using guessed type int dword_80194F30;
// 80194F34: using guessed type int dword_80194F34;
// 80194F3C: using guessed type int dword_80194F3C;
// 80194F44: using guessed type int dword_80194F44;
// 80194F48: using guessed type int dword_80194F48;
// 80194F4C: using guessed type int dword_80194F4C;
// 80194F50: using guessed type int dword_80194F50;
// 80194F54: using guessed type int dword_80194F54;
// 80194F58: using guessed type int dword_80194F58;
// 80194F60: using guessed type _BYTE byte_80194F60[576];
// 801B8AB0: using guessed type int dword_801B8AB0;
// 801B8AB4: using guessed type int dword_801B8AB4;
// 801B8AB8: using guessed type char byte_801B8AB8;
// 801B8AB9: using guessed type char byte_801B8AB9;
// 801B8ABC: using guessed type int dword_801B8ABC;
// 801B8AC0: using guessed type int dword_801B8AC0;
// 801B8AC4: using guessed type int dword_801B8AC4;
// 801B8AC8: using guessed type int dword_801B8AC8;
// 801B8ACC: using guessed type int dword_801B8ACC;
// 801DD57E: using guessed type __int16 g_TileLayerOffset;

//----- (8002F948) --------------------------------------------------------
unsigned __int8 *VRAM_FindFreeSlot()
{
  unsigned __int8 *v0; // $v1
  int v1; // $a0

  v0 = &unk_80194E0C;
  v1 = 8;
  while ( 1 )
  {
    --v1;
    if ( *v0 == 255 )
      break;
    v0 += 24;
    if ( !v1 )
      return 0;
  }
  return v0;
}

//----- (8002F984) --------------------------------------------------------
unsigned __int8 *__fastcall VRAM_ReserveTextureSpace(
        __int16 vram_x,
        __int16 vram_y,
        char texture_page,
        char clut_index,
        int bpp,
        int width,
        __int16 height)
{
  unsigned __int8 *result; // $v0
  unsigned __int8 *v12; // $s0
  int v13; // $lo

  result = VRAM_FindFreeSlot();
  v12 = result;
  if ( result )
  {
    *(result + 2) = 0;
    result[1] = texture_page;
    result[3] = clut_index;
    result[2] = 0;
    *(result + 4) = vram_x;
    *(result + 5) = vram_y;
    *result = bpp;
    if ( bpp == 1 )
    {
      *(result + 6) = width >> 2;
      v13 = *(result + 6) * height;
      *(result + 7) = height;
      *(result + 4) = AllocateMemory(2 * v13);
    }
    GPU_SetTransferRect((v12 + 8), *(v12 + 4));
    return WaitForDmaComplete(0);
  }
  return result;
}

//----- (8002FA5C) --------------------------------------------------------
int sub_8002FA5C()
{
  _BYTE *v0; // $s1
  int v1; // $s2
  char *v2; // $s0
  __int16 v3; // $a1
  int v4; // $v1
  int v5; // $lo
  int v6; // $v1
  int result; // $v0
  __int16 v8; // [sp+10h] [-10h] BYREF
  __int16 v9; // [sp+12h] [-Eh]
  __int16 v10; // [sp+14h] [-Ch]
  __int16 v11; // [sp+16h] [-Ah]

  v0 = &unk_80194E0C;
  v1 = 7;
  v2 = &unk_80194E0E;
  do
  {
    if ( *v2 )
    {
      --*v2;
    }
    else
    {
      *v2 = *(v2 - 1);
      if ( *v0 == 1 )
      {
        v3 = v2[1] + *(v2 + 1);
        v4 = *(v2 + 6);
        *(v2 + 1) = v3;
        if ( v3 >= v4 )
          *(v2 + 1) = v3 - v4;
        v8 = *(v2 + 3);
        v9 = *(v2 + 4) + *(v2 + 1);
        v10 = *(v2 + 5);
        v11 = *(v2 + 6) - *(v2 + 1);
        SubmitCdDmaTransfer(&v8, *(v2 + 14));
        if ( *(v2 + 1) )
        {
          v5 = v10 * v11;
          v6 = *(v2 + 14);
          v9 = *(v2 + 4);
          v11 = *(v2 + 1);
          SubmitCdDmaTransfer(&v8, 4 * (v5 >> 1) + v6);
          v2 += 24;
          goto LABEL_10;
        }
      }
    }
    v2 += 24;
LABEL_10:
    --v1;
    result = -1;
    v0 += 24;
  }
  while ( v1 != -1 );
  return result;
}

//----- (8002FBC0) --------------------------------------------------------
int __fastcall sub_8002FBC0(int a1)
{
  dword_80194F5C = a1;
  return SetFogNear((a1 & 0x7FFF) >> 1, 200);
}
// 80194F5C: using guessed type int dword_80194F5C;

//----- (8002FBF0) --------------------------------------------------------
int InitGraphicsSystem()
{
  ResetGraph(0);
  sub_80063034(1);
  sub_8005F578();
  sub_8005DB84(160, 120);
  sub_8005DB9C(200);
  sub_8005EF38(&unk_80194B1C, 320, 240, 100, 0, 0x10000);
  sub_800678F8(&unk_80190160, 0, 0, 320, 240);
  sub_800679B8(&unk_80190218, 0, 240, 320, 240);
  sub_800678F8(&unk_801901BC, 0, 240, 320, 240);
  sub_800679B8(&unk_8019022C, 0, 0, 320, 240);
  byte_801901D2 = 1;
  byte_80190176 = 1;
  byte_80190178 = 1;
  byte_801901D4 = 1;
  word_80190220 = 0;
  word_80190222 = 28;
  word_80190234 = 0;
  word_80190236 = 28;
  byte_80190179 = 0;
  byte_8019017A = 0;
  byte_8019017B = 0;
  byte_801901D5 = 0;
  byte_801901D6 = 0;
  byte_801901D7 = 0;
  sub_800637A4(&unk_80190218);
  sub_8005DB9C(200);
  SetBackColor(0, 0, 0);
  SetFarColor(0, 0, 0);
  sub_8002FBC0(23000);
  return sub_8002FD90();
}
// 8005DAD0: using guessed type int __fastcall SetBackColor(_DWORD, _DWORD, _DWORD);
// 8005DAF0: using guessed type int __fastcall SetFarColor(_DWORD, _DWORD, _DWORD);
// 80190176: using guessed type char byte_80190176;
// 80190178: using guessed type char byte_80190178;
// 80190179: using guessed type char byte_80190179;
// 8019017A: using guessed type char byte_8019017A;
// 8019017B: using guessed type char byte_8019017B;
// 801901D2: using guessed type char byte_801901D2;
// 801901D4: using guessed type char byte_801901D4;
// 801901D5: using guessed type char byte_801901D5;
// 801901D6: using guessed type char byte_801901D6;
// 801901D7: using guessed type char byte_801901D7;
// 80190220: using guessed type __int16 word_80190220;
// 80190222: using guessed type __int16 word_80190222;
// 80190234: using guessed type __int16 word_80190234;
// 80190236: using guessed type __int16 word_80190236;

//----- (8002FD90) --------------------------------------------------------
int sub_8002FD90()
{
  unsigned __int8 *v0; // $a1
  int v1; // $a0
  _BYTE *v3; // $v1
  int i; // $v0

  v0 = byte_80194DDC;
  v1 = 7;
  byte_80180138 = -1;
  dword_8018013C = &unk_800FEA80;
  dword_80180140[0] = &unk_800FEA80;
  dword_80180144 = &unk_80117A80;
  dword_8018014C = &unk_80117A80;
  dword_80180150 = &dword_80130A80;
  byte_80194DF6[0] = 0;
  byte_80194DF4 = 0;
  byte_80194DF5 = 0;
  do
    *v0++ = -1;
  while ( v1-- != 0 );
  v3 = &unk_80194E0C;
  for ( i = 7; i != -1; --i )
  {
    *v3 = -1;
    v3 += 24;
  }
  byte_80194DF9 = -1;
  dword_80197224 = 0;
  return sub_800370CC();
}
// 80130A80: using guessed type int dword_80130A80;
// 80180138: using guessed type char byte_80180138;
// 8018013C: using guessed type int dword_8018013C;
// 80180140: using guessed type int dword_80180140[];
// 80180144: using guessed type int dword_80180144;
// 8018014C: using guessed type int dword_8018014C;
// 80180150: using guessed type int dword_80180150;
// 80194DDC: using guessed type unsigned __int8 byte_80194DDC[8];
// 80194DF4: using guessed type char byte_80194DF4;
// 80194DF5: using guessed type char byte_80194DF5;
// 80194DF9: using guessed type char byte_80194DF9;
// 80197224: using guessed type int dword_80197224;

//----- (8002FE74) --------------------------------------------------------
int sub_8002FE74()
{
  int result; // $v0
  int v1; // $v1
  int v2; // $gp

  byte_80180138 = byte_80180138 == 0;
  g_GpuCmdBufferMirror = &dword_80180140[3 * byte_80180138];
  g_GpuCommandBuffer = &dword_8018015C[0x2000 * byte_80180138];
  sub_8006353C(&dword_8018015C[0x2000 * byte_80180138], 0x2000);
  result = g_GpuCmdBufferMirror;
  v1 = *g_GpuCmdBufferMirror;
  *(v2 + 436) = 0;
  *(result + 8) = v1;
  dword_80194E08 = 0;
  dword_80194E04 = 0;
  return result;
}
// 8002FEE4: variable 'v2' is possibly undefined
// 80180138: using guessed type char byte_80180138;
// 80180140: using guessed type int dword_80180140[];
// 80180158: using guessed type int g_GpuCmdBufferMirror;
// 8018015C: using guessed type unsigned int dword_8018015C[16384];
// 8019015C: using guessed type int g_GpuCommandBuffer;
// 80194E04: using guessed type int dword_80194E04;
// 80194E08: using guessed type int dword_80194E08;

//----- (8002FF0C) --------------------------------------------------------
int sub_8002FF0C()
{
  WaitForDmaComplete(0);
  VSync(0);
  sub_800637A4(&unk_80190218 + 20 * byte_80180138);
  sub_800636A8(&unk_80190160 + 23 * byte_80180138);
  return QueueGpuDmaTransfer(g_GpuCommandBuffer + 32764);
}
// 80180138: using guessed type char byte_80180138;
// 8019015C: using guessed type int g_GpuCommandBuffer;

//----- (8002FFA4) --------------------------------------------------------
int __fastcall sub_8002FFA4(unsigned __int16 a1)
{
  int result; // $v0

  result = dword_80190240[a1];
  g_CurrentPrimitiveBuffer = result;
  return result;
}
// 80190240: using guessed type _DWORD dword_80190240[3];
// 80190250: using guessed type int g_CurrentPrimitiveBuffer;

//----- (8002FFD4) --------------------------------------------------------
int __fastcall sub_8002FFD4(unsigned __int16 a1)
{
  return 28 * a1 + 12 + g_CurrentPrimitiveBuffer;
}
// 80190250: using guessed type int g_CurrentPrimitiveBuffer;

//----- (8002FFF8) --------------------------------------------------------
void __fastcall sub_8002FFF8(int a1)
{
  dword_80190B54 = a1;
}
// 80190B54: using guessed type int dword_80190B54;

//----- (80030008) --------------------------------------------------------
int __fastcall sub_80030008(unsigned __int16 a1)
{
  int result; // $v0

  result = *sub_8002FFD4(a1) + 12 + g_CurrentPrimitiveBuffer;
  dword_80190B54 = result;
  return result;
}
// 80190250: using guessed type int g_CurrentPrimitiveBuffer;
// 80190B54: using guessed type int dword_80190B54;

//----- (80030044) --------------------------------------------------------
int __fastcall sub_80030044(int *a1, int *a2)
{
  int v4; // $a0
  int v5; // $a1
  int v6; // $a2
  int v7; // $v1
  __int16 v9[4]; // [sp+10h] [-8h] BYREF

  if ( a1 )
  {
    v4 = a1[1];
    v5 = a1[2];
    v6 = a1[3];
    dword_80194F2C = *a1;
    dword_80194F30 = v4;
    dword_80194F34 = v5;
    dword_80194F38 = v6;
    dword_80194F44 = dword_80194F2C >> 11;
    dword_80194F48 = v5 >> 11;
  }
  if ( a2 )
  {
    v7 = a2[1];
    dword_80194F3C = *a2;
    dword_80194F40 = v7;
  }
  v9[0] = dword_80194F3C;
  v9[2] = dword_80194F40;
  v9[1] = -HIWORD(dword_80194F3C);
  sub_800154CC(v9, word_80194ECC);
  return sub_80015304(v9[0], dword_80194EEC);
}
// 80194ECC: using guessed type _WORD word_80194ECC[16];
// 80194EEC: using guessed type int dword_80194EEC[16];
// 80194F2C: using guessed type int dword_80194F2C;
// 80194F30: using guessed type int dword_80194F30;
// 80194F34: using guessed type int dword_80194F34;
// 80194F38: using guessed type int dword_80194F38;
// 80194F3C: using guessed type int dword_80194F3C;
// 80194F40: using guessed type int dword_80194F40;
// 80194F44: using guessed type int dword_80194F44;
// 80194F48: using guessed type int dword_80194F48;

//----- (80030130) --------------------------------------------------------
int __fastcall ConvertVertexCoordinates(int a1)
{
  int result; // $v0
  int v2; // $t0
  _DWORD *v3; // $t1
  int v4; // $a2
  char *v5; // $a3
  _WORD *v6; // $a1
  unsigned int v7; // $v1
  __int16 v8; // $v1
  int v9; // $v0
  __int16 v10; // $v1
  __int16 v11; // $v1
  __int16 v12; // $v0
  __int16 v13; // $v1
  int v14; // $v0
  __int16 v15; // $v1
  __int16 v16; // $v1
  int v17; // $v0
  __int16 v18; // $v1
  __int16 v19; // $v1
  __int16 v20; // $v0
  __int16 v21; // $v1
  int v22; // $v0
  __int16 v23; // $v1
  __int16 v24; // $v1
  __int16 v25; // $v0
  __int16 v26; // $v1
  int v27; // $v0
  __int16 v28; // $v1
  __int16 v29; // $v0
  __int16 v30; // $v1
  __int16 v31; // $v0
  __int16 v32; // $v1
  int v33; // $v0
  __int16 v34; // $v1
  __int16 v35; // $v1
  __int16 v36; // $v0
  __int16 v37; // $v1
  int v38; // $v0
  __int16 v39; // $v1
  __int16 v40; // $v0
  __int16 v41; // $v1
  __int16 v42; // $v0
  __int16 v43; // $v1
  int v44; // $v0
  __int16 v45; // $v1

  result = -1;
  v2 = *(a1 + 8) - 1;
  if ( *(a1 + 8) )
  {
    v3 = (a1 + 28);
    do
    {
      v4 = v3[1];
      result = *v3 + 12;
      v5 = (a1 + result);
      while ( 1 )
      {
        --v4;
        v6 = v5 + 4;
        if ( v4 == -1 )
          break;
        v7 = *v5;
        result = 4 * v5[1];
        v5 = v6 + result;
        switch ( HIBYTE(v7) & 0xFD )
        {
          case ' ':
            v8 = v6[4];
            v6[3] *= 8;                         //    8
            v9 = v6[5];
            v6[4] = 8 * v8;
            result = 8 * v9;
            v10 = 8 * v6[2];
            v6[5] = result;
            v6[2] = v10;
            break;
          case '$':
            v16 = v6[8];
            v6[7] *= 8;
            v17 = v6[9];
            v6[8] = 8 * v16;
            result = 8 * v17;
            v18 = 8 * v6[6];
            v6[9] = result;
            v6[6] = v18;
            break;
          case '(':
            v24 = v6[5];
            v6[3] *= 8;
            v25 = v6[4];
            v6[5] = 8 * v24;
            v26 = v6[2];
            v6[4] = 8 * v25;
            v27 = v6[6];
            v6[2] = 8 * v26;
            result = 8 * v27;
            v6[6] = result;
            break;
          case ',':
            v35 = v6[11];
            v6[9] *= 8;
            v36 = v6[10];
            v6[11] = 8 * v35;
            v37 = v6[8];
            v6[10] = 8 * v36;
            v38 = v6[12];
            v6[8] = 8 * v37;
            result = 8 * v38;
            v6[12] = result;
            break;
          case '0':
            v11 = v6[5];
            v6[3] *= 8;
            v12 = v6[7];
            v6[5] = 8 * v11;
            v13 = v6[2];
            v6[7] = 8 * v12;
            v14 = v6[4];
            v6[2] = 8 * v13;
            result = 8 * v14;
            v15 = 8 * v6[6];
            v6[4] = result;
            v6[6] = v15;
            break;
          case '4':
            v19 = v6[9];
            v6[7] *= 8;
            v20 = v6[11];
            v6[9] = 8 * v19;
            v21 = v6[6];
            v6[11] = 8 * v20;
            v22 = v6[8];
            v6[6] = 8 * v21;
            result = 8 * v22;
            v23 = 8 * v6[10];
            v6[8] = result;
            v6[10] = v23;
            break;
          case '8':
            v28 = v6[5];
            v6[3] *= 8;
            v29 = v6[7];
            v6[5] = 8 * v28;
            v30 = v6[9];
            v6[7] = 8 * v29;
            v31 = v6[2];
            v6[9] = 8 * v30;
            v32 = v6[4];
            v6[2] = 8 * v31;
            v33 = v6[6];
            v6[4] = 8 * v32;
            result = 8 * v33;
            v34 = 8 * v6[8];
            v6[6] = result;
            v6[8] = v34;
            break;
          case '<':
            v39 = v6[11];
            v6[9] *= 8;
            v40 = v6[13];
            v6[11] = 8 * v39;
            v41 = v6[15];
            v6[13] = 8 * v40;
            v42 = v6[8];
            v6[15] = 8 * v41;
            v43 = v6[10];
            v6[8] = 8 * v42;
            v44 = v6[12];
            v6[10] = 8 * v43;
            result = 8 * v44;
            v45 = 8 * v6[14];
            v6[12] = result;
            v6[14] = v45;
            break;
          default:
            continue;
        }
      }
      --v2;
      v3 += 7;
    }
    while ( v2 != -1 );
  }
  return result;
}

//----- (8003040C) --------------------------------------------------------
int __fastcall RegisterAndTransformModel(unsigned __int16 type, int data_ptr)
{
  dword_80190240[type] = data_ptr;
  g_CurrentPrimitiveBuffer = data_ptr;
  return ConvertVertexCoordinates(data_ptr);
}
// 80190240: using guessed type _DWORD dword_80190240[3];
// 80190250: using guessed type int g_CurrentPrimitiveBuffer;

//----- (8003044C) --------------------------------------------------------
void __fastcall SetStateCallback(unsigned __int16 a1, int a2)
{
  dword_80190240[a1] = a2;
}
// 80190240: using guessed type _DWORD dword_80190240[3];

//----- (80030474) --------------------------------------------------------
int __fastcall sub_80030474(int a1)
{
  int v1; // $s3
  char *v2; // $s2
  int v3; // $s1
  int result; // $v0
  _WORD *v5; // $s0
  int v6; // $s1
  _WORD *v7; // $s0
  __int16 v8; // $v0
  int v9; // $v1
  int v10; // $s1
  _WORD *v11; // $s0
  __int16 v12; // $v0
  int v13; // $v1
  int v14; // [sp+10h] [-8h] BYREF
  int v15; // [sp+14h] [-4h] BYREF

  v1 = dword_80190B54;
  v2 = &unk_80190C48;
  if ( dword_80194F5C < 32000 )
  {
    result = -1;
    if ( (dword_80194F5C & 0x8000) != 0 )
    {
      v6 = a1 - 1;
      if ( a1 )
      {
        v7 = &unk_80190C4E;
        do
        {
          v8 = sub_8005F2C8(v1, v2, &v14, &v15);
          v9 = v14;
          *(v7 - 1) = v8;
          v14 = v9 - 800;
          if ( v9 - 800 < 0 )
            v14 = 0;
          v2 += 8;
          v1 += 8;
          --v6;
          result = 2 * v14;
          *v7 = result;
          v7 += 4;
        }
        while ( v6 != -1 );
      }
    }
    else
    {
      v10 = a1 - 1;
      if ( a1 )
      {
        v11 = &unk_80190C4E;
        do
        {
          v12 = sub_8005F2C8(v1, v2, &v14, &v15);
          v13 = v14;
          *(v11 - 1) = v12;
          v2 += 8;
          if ( v13 >= 2800 )
            v14 = 2 * (v13 - 2800) + v13;
          v1 += 8;
          result = v14;
          --v10;
          *v11 = v14;
          v11 += 4;
        }
        while ( v10 != -1 );
      }
    }
  }
  else
  {
    v3 = a1 - 1;
    result = -1;
    if ( a1 )
    {
      v5 = &unk_80190C4E;
      do
      {
        result = sub_8005F2C8(v1, v2, &v14, &v15);
        *(v5 - 1) = result;
        *v5 = 0;
        v5 += 4;
        v2 += 8;
        --v3;
        v1 += 8;
      }
      while ( v3 != -1 );
    }
  }
  return result;
}
// 80190B54: using guessed type int dword_80190B54;
// 80194F5C: using guessed type int dword_80194F5C;

//----- (800305F4) --------------------------------------------------------
int __fastcall sub_800305F4(int a1)
{
  int v1; // $s3
  char *v2; // $s2
  int v3; // $s1
  int result; // $v0
  _WORD *v5; // $s0
  bool v6; // dc
  int v7; // $s1
  _WORD *v8; // $s0
  int v9; // [sp+10h] [-8h] BYREF
  int v10; // [sp+14h] [-4h] BYREF

  v1 = dword_80190B54;
  v2 = &unk_80190C48;
  if ( dword_80194F5C < 32000 )
  {
    v7 = a1 - 1;
    result = -1;
    if ( a1 )
    {
      v8 = &unk_80190C4E;
      do
      {
        *(v8 - 1) = sub_8005F2C8(v1, v2, &v9, &v10);
        if ( v10 != 4096 )
          *(v8 - 1) = -1;
        v2 += 8;
        if ( v9 >= 2800 )
          v9 += 2 * (v9 - 2800);
        v1 += 8;
        result = v9;
        --v7;
        *v8 = v9;
        v8 += 4;
      }
      while ( v7 != -1 );
    }
  }
  else
  {
    v3 = a1 - 1;
    result = -1;
    if ( a1 )
    {
      v5 = &unk_80190C4E;
      do
      {
        result = sub_8005F2C8(v1, v2, &v9, &v10);
        v6 = v10 == 4096;
        *(v5 - 1) = result;
        if ( !v6 )
          *(v5 - 1) = -1;
        *v5 = 0;
        v5 += 4;
        v2 += 8;
        --v3;
        v1 += 8;
      }
      while ( v3 != -1 );
    }
  }
  return result;
}
// 80190B54: using guessed type int dword_80190B54;
// 80194F5C: using guessed type int dword_80194F5C;

//----- (8003073C) --------------------------------------------------------
int __fastcall sub_8003073C(int a1)
{
  int v1; // $s3
  _WORD *v2; // $s2
  int v3; // $s1
  _WORD *v4; // $s0
  int result; // $v0
  __int16 v6[4]; // [sp+10h] [-20h] BYREF
  int v7; // [sp+18h] [-18h]
  int v8[4]; // [sp+20h] [-10h] BYREF

  v1 = dword_80190B54;
  v2 = &unk_80190C48;
  v3 = a1 - 1;
  if ( a1 )
  {
    v4 = &unk_80190C4C;
    do
    {
      sub_8005F348(v1, v6, v8);
      *v2 = v6[0];
      v1 += 8;
      *(v4 - 1) = v6[2];
      --v3;
      v4[1] = v7;
      v2 += 4;
      result = v7 >> 2;
      *v4 = v7 >> 2;
      v4 += 4;
    }
    while ( v3 != -1 );
  }
  return result;
}
// 80190B54: using guessed type int dword_80190B54;
// 8003073C: using guessed type int var_10[4];

//----- (800307E8) --------------------------------------------------------
int __fastcall sub_800307E8(int a1, __int16 a2)
{
  int v2; // $s3
  _WORD *v4; // $s2
  int v5; // $s1
  __int16 *v6; // $s0
  int result; // $v0
  __int16 v8[8]; // [sp+10h] [-20h] BYREF
  int v9[4]; // [sp+20h] [-10h] BYREF

  v2 = dword_80190B54;
  v4 = &unk_80190C48;
  v5 = a1 - 1;
  if ( a1 )
  {
    v6 = &unk_80190C4C;
    do
    {
      sub_8005F348(v2, v8, v9);
      v2 += 8;
      *v4 = v8[0];
      --v5;
      *(v6 - 1) = v8[2];
      result = v8[4];
      v4 += 4;
      *v6 = a2;
      v6[1] = result;
      v6 += 4;
    }
    while ( v5 != -1 );
  }
  return result;
}
// 80190B54: using guessed type int dword_80190B54;
// 800307E8: using guessed type int var_10[4];

//----- (80030894) --------------------------------------------------------
void __fastcall sub_80030894(int a1)
{
  int v1; // $s3
  char *v2; // $s2
  int v3; // $s1
  char *v4; // $s0
  char v5[4]; // [sp+10h] [-10h] BYREF
  int v6[3]; // [sp+14h] [-Ch] BYREF

  v1 = dword_80190B54;
  v2 = &unk_80190C48;
  v3 = a1 - 1;
  if ( a1 )
  {
    v4 = &unk_80190C4E;
    do
    {
      *(v4 - 2) = sub_8005F2C8(v1, v2, v5, v6);
      v4 += 8;
      v2 += 8;
      --v3;
      v1 += 8;
    }
    while ( v3 != -1 );
  }
}
// 80190B54: using guessed type int dword_80190B54;
// 80030894: using guessed type char var_10[4];
// 80030894: using guessed type int var_C[3];

//----- (80030924) --------------------------------------------------------
int __fastcall sub_80030924(unsigned __int16 a1, int a2, __int16 a3)
{
  _DWORD *v3; // $v0
  _DWORD *v4; // $s1
  int v5; // $v1
  int v6; // $fp
  int result; // $v0
  int v8; // $s7
  unsigned int v9; // $t0
  _WORD *v10; // $s1
  int v11; // $v1
  char *v12; // $s2
  char *v13; // $s4
  char *v14; // $s3
  int v15; // $s0
  unsigned int v16; // $v1
  int v17; // $v0
  int v18; // $v1
  unsigned int *v19; // $a1
  int v20; // $v0
  int v21; // $a0
  char *v22; // $s2
  char *v23; // $s4
  char *v24; // $s3
  int v25; // $s0
  unsigned int v26; // $v1
  int v27; // $v0
  int v28; // $v1
  _DWORD *v29; // $s2
  char *v30; // $s4
  char *v31; // $s3
  int v32; // $s0
  int v33; // $a0
  unsigned int v34; // $v1
  char *v35; // $s5
  char v36; // $v0
  int v37; // $a0
  unsigned int v38; // $v1
  int v39; // $v0
  int v40; // $a0
  __int16 v43; // [sp+28h] [-18h]
  unsigned int v44; // [sp+30h] [-10h]

  v43 = 32 * a3;
  v3 = sub_8002FFD4(a1);
  v4 = (v3[4] + 12 + g_CurrentPrimitiveBuffer);
  v5 = v3[5];
  v6 = v5 - 1;
  result = v3[2] + 12;
  v8 = result + g_CurrentPrimitiveBuffer;
  if ( v5 )
  {
    do
    {
      v9 = *v4;
      v10 = v4 + 1;
      v11 = HIBYTE(v9) & 0xFD;
      v44 = v9;
      if ( v11 == 52 )
      {
        v22 = &unk_80190C48 + v10[7];
        v23 = &unk_80190C48 + v10[11];
        v24 = &unk_80190C48 + v10[9];
        if ( AverageSZ3(*v22, *v24, *v23) <= 0 )
          goto LABEL_29;
        v25 = *(g_GpuCmdBufferMirror + 8);
        *(g_GpuCmdBufferMirror + 8) = v25 + 40;
        v26 = *(g_GpuCmdBufferMirror + 8);
        result = *(g_GpuCmdBufferMirror + 4) < v26;
        if ( *(g_GpuCmdBufferMirror + 4) < v26 )
          return result;
        *(v25 + 14) = v10[1];
        *(v25 + 26) = v43 | v10[3] & 0xFF9F;
        *(v25 + 8) = *v22;
        *(v25 + 20) = *v24;
        *(v25 + 32) = *v23;
        *(v25 + 12) = *v10;
        *(v25 + 24) = v10[2];
        *(v25 + 36) = v10[4];
        NormalColorDpq3(v8 + v10[6], v8 + v10[8], v8 + v10[10], dword_8007636C, *(v22 + 3), v25 + 4, v25 + 16, v25 + 28);
        *(v25 + 3) = 9;
        *(v25 + 7) = 54;
        v27 = (*(v22 + 2) + *(v24 + 2) + *(v23 + 2)) / 3;
        if ( v27 <= 0 )
          goto LABEL_29;
        v28 = v27 + a2;
        v19 = v25;
        if ( (v27 + a2) >= 0x2000 )
          goto LABEL_29;
        v20 = g_GpuCommandBuffer;
        v21 = 4 * v28;
      }
      else
      {
        if ( (HIBYTE(v9) & 0xFD) >= 0x35u )
        {
          if ( v11 != 60 )
            goto LABEL_29;
          v29 = (&unk_80190C48 + v10[9]);
          v30 = &unk_80190C48 + v10[13];
          v31 = &unk_80190C48 + v10[11];
          if ( AverageSZ3(*v29, *v31, *v30) <= 0 )
            goto LABEL_29;
          v32 = *(g_GpuCmdBufferMirror + 8);
          v33 = v10[15];
          *(g_GpuCmdBufferMirror + 8) = v32 + 52;
          v34 = *(g_GpuCmdBufferMirror + 8);
          result = *(g_GpuCmdBufferMirror + 4) < v34;
          v35 = &unk_80190C48 + v33;
          if ( *(g_GpuCmdBufferMirror + 4) < v34 )
            return result;
          *(v32 + 14) = v10[1];
          *(v32 + 26) = v43 | v10[3] & 0xFF9F;
          *(v32 + 8) = *v29;
          *(v32 + 20) = *v31;
          *(v32 + 32) = *v30;
          *(v32 + 44) = *v35;
          *(v32 + 12) = *v10;
          *(v32 + 24) = v10[2];
          *(v32 + 36) = v10[4];
          *(v32 + 48) = v10[6];
          NormalColorDpq3(
            v8 + v10[8],
            v8 + v10[10],
            v8 + v10[12],
            dword_8007636C,
            *(v29 + 3),
            v32 + 4,
            v32 + 16,
            v32 + 28);
          NormalColorDpq(v8 + v10[14], dword_8007636C, *(v29 + 3), v32 + 40);
          *(v32 + 3) = 12;
          v36 = 62;
        }
        else
        {
          if ( v11 == 36 )
          {
            v12 = &unk_80190C48 + v10[7];
            v13 = &unk_80190C48 + v10[9];
            v14 = &unk_80190C48 + v10[8];
            if ( AverageSZ3(*v12, *v14, *v13) <= 0 )
              goto LABEL_29;
            v15 = *(g_GpuCmdBufferMirror + 8);
            *(g_GpuCmdBufferMirror + 8) = v15 + 32;
            v16 = *(g_GpuCmdBufferMirror + 8);
            result = *(g_GpuCmdBufferMirror + 4) < v16;
            if ( *(g_GpuCmdBufferMirror + 4) < v16 )
              return result;
            *(v15 + 14) = v10[1];
            *(v15 + 22) = v43 | v10[3] & 0xFF9F;
            *(v15 + 8) = *v12;
            *(v15 + 16) = *v14;
            *(v15 + 24) = *v13;
            *(v15 + 12) = *v10;
            *(v15 + 20) = v10[2];
            *(v15 + 28) = v10[4];
            NormalColorDpq(v8 + v10[6], dword_8007636C, (*(v12 + 3) + *(v14 + 3) + *(v13 + 3)) / 3, v15 + 4);
            *(v15 + 3) = 7;
            *(v15 + 7) = 38;
            v17 = (*(v12 + 2) + *(v14 + 2) + *(v13 + 2)) / 3;
            if ( v17 <= 0 )
              goto LABEL_29;
            v18 = v17 + a2;
            v19 = v15;
            if ( (v17 + a2) >= 0x2000 )
              goto LABEL_29;
            v20 = g_GpuCommandBuffer;
            v21 = 4 * v18;
            goto LABEL_28;
          }
          if ( v11 != 44 )
            goto LABEL_29;
          v29 = (&unk_80190C48 + v10[9]);
          v30 = &unk_80190C48 + v10[11];
          v31 = &unk_80190C48 + v10[10];
          if ( AverageSZ3(*v29, *v31, *v30) <= 0 )
            goto LABEL_29;
          v32 = *(g_GpuCmdBufferMirror + 8);
          v37 = v10[12];
          *(g_GpuCmdBufferMirror + 8) = v32 + 40;
          v38 = *(g_GpuCmdBufferMirror + 8);
          result = *(g_GpuCmdBufferMirror + 4) < v38;
          v35 = &unk_80190C48 + v37;
          if ( *(g_GpuCmdBufferMirror + 4) < v38 )
            return result;
          *(v32 + 14) = v10[1];
          *(v32 + 22) = v43 | v10[3] & 0xFF9F;
          *(v32 + 8) = *v29;
          *(v32 + 16) = *v31;
          *(v32 + 24) = *v30;
          *(v32 + 32) = *v35;
          *(v32 + 12) = *v10;
          *(v32 + 20) = v10[2];
          *(v32 + 28) = v10[4];
          *(v32 + 36) = v10[6];
          NormalColorDpq(v8 + v10[8], dword_8007636C, (*(v29 + 3) + *(v31 + 3) + *(v30 + 3) + *(v35 + 3)) >> 2, v32 + 4);
          *(v32 + 3) = 9;
          v36 = 46;
        }
        *(v32 + 7) = v36;
        v39 = (*(v29 + 2) + *(v31 + 2) + *(v30 + 2) + *(v35 + 2)) >> 2;
        if ( v39 <= 0 )
          goto LABEL_29;
        v40 = v39 + a2;
        v19 = v32;
        if ( (v39 + a2) >= 0x2000 )
          goto LABEL_29;
        v20 = g_GpuCommandBuffer;
        v21 = 4 * v40;
      }
LABEL_28:
      GPU_Cmd_MergeParams((v21 + v20), v19);
LABEL_29:
      v4 = (v10 + ((v44 >> 6) & 0x3FC));
      result = v6;
    }
    while ( v6-- != 0 );
  }
  return result;
}
// 8005F408: using guessed type int __fastcall NormalColorDpq(_DWORD, _DWORD, _DWORD, _DWORD);
// 8005F42C: using guessed type int __fastcall NormalColorDpq3(_DWORD, _DWORD, _DWORD, _DWORD, _DWORD, _DWORD, _DWORD, _DWORD);
// 8005F524: using guessed type int __fastcall AverageSZ3(_DWORD, _DWORD, _DWORD);
// 8007636C: using guessed type int dword_8007636C[3];
// 80180158: using guessed type int g_GpuCmdBufferMirror;
// 8019015C: using guessed type int g_GpuCommandBuffer;
// 80190250: using guessed type int g_CurrentPrimitiveBuffer;

//----- (80031034) --------------------------------------------------------
int __fastcall sub_80031034(unsigned __int16 a1, int a2)
{
  _DWORD *v2; // $v0
  _DWORD *v3; // $s1
  int v4; // $v1
  int result; // $v0
  int v6; // $s7
  unsigned int v7; // $t0
  _WORD *v8; // $s1
  unsigned int v9; // $fp
  int v10; // $v1
  char *v11; // $s2
  char *v12; // $s4
  char *v13; // $s3
  int v14; // $s0
  unsigned int v15; // $v1
  int v16; // $v0
  int v17; // $v1
  unsigned int *v18; // $a1
  int v19; // $v0
  int v20; // $a0
  char *v21; // $s2
  char *v22; // $s4
  char *v23; // $s3
  int v24; // $s0
  unsigned int v25; // $v1
  int v26; // $v0
  int v27; // $v1
  _DWORD *v28; // $s2
  char *v29; // $s4
  char *v30; // $s3
  int v31; // $s0
  int v32; // $a0
  unsigned int v33; // $v1
  char *v34; // $s5
  char v35; // $v0
  int v36; // $a0
  unsigned int v37; // $v1
  int v38; // $v0
  int v39; // $a0
  unsigned int v42; // [sp+28h] [-18h]
  int v43; // [sp+30h] [-10h]

  v2 = sub_8002FFD4(a1);
  v3 = (v2[4] + 12 + g_CurrentPrimitiveBuffer);
  v4 = v2[5];
  result = v2[2] + 12;
  v6 = result + g_CurrentPrimitiveBuffer;
  v43 = v4 - 1;
  if ( v4 )
  {
    do
    {
      v7 = *v3;
      v8 = v3 + 1;
      v9 = HIBYTE(v7);
      v10 = HIBYTE(v7) & 0xFD;
      v42 = v7;
      if ( v10 == 52 )
      {
        v21 = &unk_80190C48 + v8[7];
        v22 = &unk_80190C48 + v8[11];
        v23 = &unk_80190C48 + v8[9];
        if ( AverageSZ3(*v21, *v23, *v22) <= 0 )
          goto LABEL_29;
        v24 = *(g_GpuCmdBufferMirror + 8);
        *(g_GpuCmdBufferMirror + 8) = v24 + 40;
        v25 = *(g_GpuCmdBufferMirror + 8);
        result = *(g_GpuCmdBufferMirror + 4) < v25;
        if ( *(g_GpuCmdBufferMirror + 4) < v25 )
          return result;
        *(v24 + 14) = v8[1];
        *(v24 + 26) = v8[3];
        *(v24 + 8) = *v21;
        *(v24 + 20) = *v23;
        *(v24 + 32) = *v22;
        *(v24 + 12) = *v8;
        *(v24 + 24) = v8[2];
        *(v24 + 36) = v8[4];
        NormalColorDpq3(v6 + v8[6], v6 + v8[8], v6 + v8[10], dword_8007636C, *(v21 + 3), v24 + 4, v24 + 16, v24 + 28);
        *(v24 + 3) = 9;
        *(v24 + 7) = v9;
        v26 = (*(v21 + 2) + *(v23 + 2) + *(v22 + 2)) / 3;
        if ( v26 <= 0 )
          goto LABEL_29;
        v27 = v26 + a2;
        v18 = v24;
        if ( (v26 + a2) >= 0x2000 )
          goto LABEL_29;
        v19 = g_GpuCommandBuffer;
        v20 = 4 * v27;
      }
      else
      {
        if ( (HIBYTE(v7) & 0xFD) >= 0x35u )
        {
          if ( v10 != 60 )
            goto LABEL_29;
          v28 = (&unk_80190C48 + v8[9]);
          v29 = &unk_80190C48 + v8[13];
          v30 = &unk_80190C48 + v8[11];
          if ( AverageSZ3(*v28, *v30, *v29) <= 0 )
            goto LABEL_29;
          v31 = *(g_GpuCmdBufferMirror + 8);
          v32 = v8[15];
          *(g_GpuCmdBufferMirror + 8) = v31 + 52;
          v33 = *(g_GpuCmdBufferMirror + 8);
          result = *(g_GpuCmdBufferMirror + 4) < v33;
          v34 = &unk_80190C48 + v32;
          if ( *(g_GpuCmdBufferMirror + 4) < v33 )
            return result;
          *(v31 + 14) = v8[1];
          *(v31 + 26) = v8[3];
          *(v31 + 8) = *v28;
          *(v31 + 20) = *v30;
          *(v31 + 32) = *v29;
          *(v31 + 44) = *v34;
          *(v31 + 12) = *v8;
          *(v31 + 24) = v8[2];
          *(v31 + 36) = v8[4];
          *(v31 + 48) = v8[6];
          NormalColorDpq3(v6 + v8[8], v6 + v8[10], v6 + v8[12], dword_8007636C, *(v28 + 3), v31 + 4, v31 + 16, v31 + 28);
          NormalColorDpq(v6 + v8[14], dword_8007636C, *(v28 + 3), v31 + 40);
          v35 = 12;
        }
        else
        {
          if ( v10 == 36 )
          {
            v11 = &unk_80190C48 + v8[7];
            v12 = &unk_80190C48 + v8[9];
            v13 = &unk_80190C48 + v8[8];
            if ( AverageSZ3(*v11, *v13, *v12) <= 0 )
              goto LABEL_29;
            v14 = *(g_GpuCmdBufferMirror + 8);
            *(g_GpuCmdBufferMirror + 8) = v14 + 32;
            v15 = *(g_GpuCmdBufferMirror + 8);
            result = *(g_GpuCmdBufferMirror + 4) < v15;
            if ( *(g_GpuCmdBufferMirror + 4) < v15 )
              return result;
            *(v14 + 14) = v8[1];
            *(v14 + 22) = v8[3];
            *(v14 + 8) = *v11;
            *(v14 + 16) = *v13;
            *(v14 + 24) = *v12;
            *(v14 + 12) = *v8;
            *(v14 + 20) = v8[2];
            *(v14 + 28) = v8[4];
            NormalColorDpq(v6 + v8[6], dword_8007636C, (*(v11 + 3) + *(v13 + 3) + *(v12 + 3)) / 3, v14 + 4);
            *(v14 + 3) = 7;
            *(v14 + 7) = v9;
            v16 = (*(v11 + 2) + *(v13 + 2) + *(v12 + 2)) / 3;
            if ( v16 <= 0 )
              goto LABEL_29;
            v17 = v16 + a2;
            v18 = v14;
            if ( (v16 + a2) >= 0x2000 )
              goto LABEL_29;
            v19 = g_GpuCommandBuffer;
            v20 = 4 * v17;
            goto LABEL_28;
          }
          if ( v10 != 44 )
            goto LABEL_29;
          v28 = (&unk_80190C48 + v8[9]);
          v29 = &unk_80190C48 + v8[11];
          v30 = &unk_80190C48 + v8[10];
          if ( AverageSZ3(*v28, *v30, *v29) <= 0 )
            goto LABEL_29;
          v31 = *(g_GpuCmdBufferMirror + 8);
          v36 = v8[12];
          *(g_GpuCmdBufferMirror + 8) = v31 + 40;
          v37 = *(g_GpuCmdBufferMirror + 8);
          result = *(g_GpuCmdBufferMirror + 4) < v37;
          v34 = &unk_80190C48 + v36;
          if ( *(g_GpuCmdBufferMirror + 4) < v37 )
            return result;
          *(v31 + 14) = v8[1];
          *(v31 + 22) = v8[3];
          *(v31 + 8) = *v28;
          *(v31 + 16) = *v30;
          *(v31 + 24) = *v29;
          *(v31 + 32) = *v34;
          *(v31 + 12) = *v8;
          *(v31 + 20) = v8[2];
          *(v31 + 28) = v8[4];
          *(v31 + 36) = v8[6];
          NormalColorDpq(v6 + v8[8], dword_8007636C, (*(v28 + 3) + *(v30 + 3) + *(v29 + 3) + *(v34 + 3)) >> 2, v31 + 4);
          v35 = 9;
        }
        *(v31 + 3) = v35;
        *(v31 + 7) = v9;
        v38 = (*(v28 + 2) + *(v30 + 2) + *(v29 + 2) + *(v34 + 2)) >> 2;
        if ( v38 <= 0 )
          goto LABEL_29;
        v39 = v38 + a2;
        v18 = v31;
        if ( (v38 + a2) >= 0x2000 )
          goto LABEL_29;
        v19 = g_GpuCommandBuffer;
        v20 = 4 * v39;
      }
LABEL_28:
      GPU_Cmd_MergeParams((v20 + v19), v18);
LABEL_29:
      v3 = (v8 + ((v42 >> 6) & 0x3FC));
      result = v43;
    }
    while ( v43-- != 0 );
  }
  return result;
}
// 8005F408: using guessed type int __fastcall NormalColorDpq(_DWORD, _DWORD, _DWORD, _DWORD);
// 8005F42C: using guessed type int __fastcall NormalColorDpq3(_DWORD, _DWORD, _DWORD, _DWORD, _DWORD, _DWORD, _DWORD, _DWORD);
// 8005F524: using guessed type int __fastcall AverageSZ3(_DWORD, _DWORD, _DWORD);
// 8007636C: using guessed type int dword_8007636C[3];
// 80180158: using guessed type int g_GpuCmdBufferMirror;
// 8019015C: using guessed type int g_GpuCommandBuffer;
// 80190250: using guessed type int g_CurrentPrimitiveBuffer;

//----- (8003171C) --------------------------------------------------------
int __fastcall sub_8003171C(unsigned __int16 a1, __int16 a2, int a3)
{
  _DWORD *v4; // $v0
  _DWORD *v5; // $s1
  int v6; // $v1
  int v7; // $fp
  int result; // $v0
  int v9; // $s5
  unsigned int v10; // $t0
  _WORD *v11; // $s1
  unsigned int v12; // $s7
  int v13; // $v1
  _DWORD *v14; // $s3
  _DWORD *v15; // $s4
  _DWORD *v16; // $s2
  int v17; // $s0
  unsigned int v18; // $v1
  char v19; // $v0
  _DWORD *v20; // $s3
  _DWORD *v21; // $s4
  _DWORD *v22; // $s2
  int v23; // $a0
  unsigned int v24; // $v1
  _DWORD *v25; // $a0
  _DWORD *v26; // $s3
  _DWORD *v27; // $s4
  _DWORD *v28; // $s2
  unsigned int v29; // $v1
  _DWORD *v30; // $s3
  _DWORD *v31; // $s4
  _DWORD *v32; // $s2
  int v33; // $a0
  unsigned int v34; // $v1
  _DWORD *v35; // $a0
  __int16 v38; // [sp+20h] [-18h]
  unsigned int v39; // [sp+28h] [-10h]
  int v40; // [sp+30h] [-8h]

  v4 = sub_8002FFD4(a1);
  v38 = 32 * a2;
  v5 = (v4[4] + 12 + g_CurrentPrimitiveBuffer);
  v6 = v4[5];
  v7 = v6 - 1;
  result = v4[2] + 12;
  v9 = result + g_CurrentPrimitiveBuffer;
  if ( v6 )
  {
    v40 = a3 << 16;
    do
    {
      v10 = *v5;
      v11 = v5 + 1;
      v12 = HIBYTE(v10);
      v13 = HIBYTE(v10) & 0xFD;
      v39 = v10;
      if ( v13 == 52 )
      {
        v14 = (&unk_80190C48 + v11[7]);
        v15 = (&unk_80190C48 + v11[11]);
        v16 = (&unk_80190C48 + v11[9]);
        if ( AverageSZ3(*v14, *v16, *v15) > 0 )
        {
          v17 = *(g_GpuCmdBufferMirror + 8);
          *(g_GpuCmdBufferMirror + 8) = v17 + 40;
          v18 = *(g_GpuCmdBufferMirror + 8);
          result = *(g_GpuCmdBufferMirror + 4) < v18;
          if ( *(g_GpuCmdBufferMirror + 4) < v18 )
            return result;
          *(v17 + 14) = v11[1];
          *(v17 + 26) = v11[3] & 0xFF9F | v38;
          *(v17 + 8) = *v14;
          *(v17 + 20) = *v16;
          *(v17 + 32) = *v15;
          *(v17 + 12) = *v11;
          *(v17 + 24) = v11[2];
          *(v17 + 36) = v11[4];
          NormalColorCol3(v9 + v11[6], v9 + v11[8], v9 + v11[10], dword_8007636C, v17 + 4, v17 + 16, v17 + 28);
          *(v17 + 3) = 9;
          v19 = v12 & 2 | 0x34;
LABEL_22:
          *(v17 + 7) = v19;
          if ( v40 >> 16 > 0 && (v40 >> 16) < 0x2000 )
            GPU_Cmd_MergeParams((4 * (v40 >> 16) + g_GpuCommandBuffer), v17);
        }
      }
      else if ( (HIBYTE(v10) & 0xFD) >= 0x35u )
      {
        if ( v13 == 56 )
        {
          v30 = (&unk_80190C48 + v11[3]);
          v31 = (&unk_80190C48 + v11[7]);
          v32 = (&unk_80190C48 + v11[5]);
          if ( AverageSZ3(*v30, *v32, *v31) > 0 )
          {
            v17 = *(g_GpuCmdBufferMirror + 8);
            v33 = v11[9];
            *(g_GpuCmdBufferMirror + 8) = v17 + 36;
            v34 = *(g_GpuCmdBufferMirror + 8);
            result = *(g_GpuCmdBufferMirror + 4) < v34;
            v35 = (&unk_80190C48 + v33);
            if ( *(g_GpuCmdBufferMirror + 4) < v34 )
              return result;
            *(v17 + 8) = *v30;
            *(v17 + 16) = *v32;
            *(v17 + 24) = *v31;
            *(v17 + 32) = *v35;
            NormalColorCol3(v9 + v11[2], v9 + v11[4], v9 + v11[6], v11, v17 + 4, v17 + 12, v17 + 20);
            NormalColorCol(v9 + v11[8], v11, v17 + 28);
            *(v17 + 3) = 8;
            v19 = 56;
            goto LABEL_22;
          }
        }
        else if ( v13 == 60 )
        {
          v20 = (&unk_80190C48 + v11[9]);
          v21 = (&unk_80190C48 + v11[13]);
          v22 = (&unk_80190C48 + v11[11]);
          if ( AverageSZ3(*v20, *v22, *v21) > 0 )
          {
            v17 = *(g_GpuCmdBufferMirror + 8);
            v23 = v11[15];
            *(g_GpuCmdBufferMirror + 8) = v17 + 52;
            v24 = *(g_GpuCmdBufferMirror + 8);
            result = *(g_GpuCmdBufferMirror + 4) < v24;
            v25 = (&unk_80190C48 + v23);
            if ( *(g_GpuCmdBufferMirror + 4) < v24 )
              return result;
            *(v17 + 14) = v11[1];
            *(v17 + 26) = v11[3] & 0xFF9F | v38;
            *(v17 + 8) = *v20;
            *(v17 + 20) = *v22;
            *(v17 + 32) = *v21;
            *(v17 + 44) = *v25;
            *(v17 + 12) = *v11;
            *(v17 + 24) = v11[2];
            *(v17 + 36) = v11[4];
            *(v17 + 48) = v11[6];
            NormalColorCol3(v9 + v11[8], v9 + v11[10], v9 + v11[12], dword_8007636C, v17 + 4, v17 + 16, v17 + 28);
            NormalColorCol(v9 + v11[14], dword_8007636C, v17 + 40);
            *(v17 + 3) = 12;
            v19 = v12 & 2 | 0x3C;
            goto LABEL_22;
          }
        }
      }
      else if ( v13 == 48 )
      {
        v26 = (&unk_80190C48 + v11[3]);
        v27 = (&unk_80190C48 + v11[7]);
        v28 = (&unk_80190C48 + v11[5]);
        if ( AverageSZ3(*v26, *v28, *v27) > 0 )
        {
          v17 = *(g_GpuCmdBufferMirror + 8);
          *(g_GpuCmdBufferMirror + 8) = v17 + 28;
          v29 = *(g_GpuCmdBufferMirror + 8);
          result = *(g_GpuCmdBufferMirror + 4) < v29;
          if ( *(g_GpuCmdBufferMirror + 4) < v29 )
            return result;
          *(v17 + 8) = *v26;
          *(v17 + 16) = *v28;
          *(v17 + 24) = *v27;
          NormalColorCol3(v9 + v11[2], v9 + v11[4], v9 + v11[6], v11, v17 + 4, v17 + 12, v17 + 20);
          *(v17 + 3) = 6;
          v19 = 48;
          goto LABEL_22;
        }
      }
      v5 = (v11 + ((v39 >> 6) & 0x3FC));
      result = v7;
    }
    while ( v7-- != 0 );
  }
  return result;
}
// 8005F474: using guessed type int __fastcall NormalColorCol(_DWORD, _DWORD, _DWORD);
// 8005F494: using guessed type int __fastcall NormalColorCol3(_DWORD, _DWORD, _DWORD, _DWORD, _DWORD, _DWORD, _DWORD);
// 8005F524: using guessed type int __fastcall AverageSZ3(_DWORD, _DWORD, _DWORD);
// 8007636C: using guessed type int dword_8007636C[3];
// 80180158: using guessed type int g_GpuCmdBufferMirror;
// 8019015C: using guessed type int g_GpuCommandBuffer;
// 80190250: using guessed type int g_CurrentPrimitiveBuffer;

//----- (80031CD0) --------------------------------------------------------
int __fastcall sub_80031CD0(unsigned __int16 a1)
{
  _DWORD *v1; // $s0
  int v2; // $a0
  _DWORD *v3; // $s1
  int result; // $v0
  int v5; // $fp
  unsigned int v6; // $a3
  _WORD *v7; // $s1
  unsigned int v8; // $s7
  int v9; // $v1
  char *v10; // $s4
  char *v11; // $s3
  char *v12; // $s2
  int v13; // $s0
  int v14; // $a0
  unsigned int v15; // $v1
  char *v16; // $s5
  int v17; // $v0
  char *v18; // $s4
  char *v19; // $s3
  char *v20; // $s2
  unsigned int v21; // $v1
  char v23[8]; // [sp+10h] [-18h] BYREF
  unsigned int v24; // [sp+18h] [-10h]
  int v25; // [sp+20h] [-8h]

  v1 = sub_8002FFD4(a1);
  v2 = v1[1];
  v25 = v1[2] + 12 + g_CurrentPrimitiveBuffer;
  sub_80030474(v2);
  v3 = (v1[4] + 12 + g_CurrentPrimitiveBuffer);
  result = v1[5];
  v5 = result - 1;
  if ( result )
  {
    while ( 1 )
    {
      v6 = *v3;
      v7 = v3 + 1;
      v8 = HIBYTE(v6);
      v9 = HIBYTE(v6) & 0xFD;
      v24 = v6;
      if ( v9 != 36 )
        break;
      v18 = &unk_80190C48 + v7[7];
      v19 = &unk_80190C48 + v7[9];
      v20 = &unk_80190C48 + v7[8];
      if ( AverageSZ3(*v18, *v20, *v19) > 0 )
      {
        v13 = *(g_GpuCmdBufferMirror + 8);
        *(g_GpuCmdBufferMirror + 8) = v13 + 40;
        v21 = *(g_GpuCmdBufferMirror + 8);
        result = *(g_GpuCmdBufferMirror + 4) < v21;
        if ( *(g_GpuCmdBufferMirror + 4) < v21 )
          return result;
        *(v13 + 14) = v7[1];
        *(v13 + 26) = v7[3];
        *(v13 + 8) = *v18;
        *(v13 + 20) = *v20;
        *(v13 + 32) = *v19;
        *(v13 + 12) = *v7;
        *(v13 + 24) = v7[2];
        *(v13 + 36) = v7[4];
        NormalColorCol(v25 + v7[6], dword_8007636C, v23);
        DpqColor(v23, *(v18 + 3), v13 + 4);
        DpqColor(v23, *(v20 + 3), v13 + 16);
        DpqColor(v23, *(v19 + 3), v13 + 28);
        *(v13 + 3) = 9;
        *(v13 + 7) = v8 | 0x34;
        v17 = (*(v18 + 2) + *(v20 + 2) + *(v19 + 2)) / 3;
LABEL_10:
        if ( (v17 + 240) < 0x2000 )
          GPU_Cmd_MergeParams((4 * (v17 + 240) + g_GpuCommandBuffer), v13);
      }
LABEL_12:
      v3 = (v7 + ((v24 >> 6) & 0x3FC));
      result = v5;
      if ( v5-- == 0 )
        return result;
    }
    if ( v9 != 44 )
      goto LABEL_12;
    v10 = &unk_80190C48 + v7[9];
    v11 = &unk_80190C48 + v7[11];
    v12 = &unk_80190C48 + v7[10];
    if ( AverageSZ3(*v10, *v12, *v11) <= 0 )
      goto LABEL_12;
    v13 = *(g_GpuCmdBufferMirror + 8);
    v14 = v7[12];
    *(g_GpuCmdBufferMirror + 8) = v13 + 52;
    v15 = *(g_GpuCmdBufferMirror + 8);
    result = *(g_GpuCmdBufferMirror + 4) < v15;
    v16 = &unk_80190C48 + v14;
    if ( *(g_GpuCmdBufferMirror + 4) < v15 )
      return result;
    *(v13 + 14) = v7[1];
    *(v13 + 26) = v7[3];
    *(v13 + 8) = *v10;
    *(v13 + 20) = *v12;
    *(v13 + 32) = *v11;
    *(v13 + 44) = *v16;
    *(v13 + 12) = *v7;
    *(v13 + 24) = v7[2];
    *(v13 + 36) = v7[4];
    *(v13 + 48) = v7[6];
    NormalColorCol(v25 + v7[8], dword_8007636C, v23);
    DpqColor(v23, *(v10 + 3), v13 + 4);
    DpqColor(v23, *(v12 + 3), v13 + 16);
    DpqColor(v23, *(v11 + 3), v13 + 28);
    DpqColor(v23, *(v16 + 3), v13 + 40);
    *(v13 + 3) = 12;
    *(v13 + 7) = v8 | 0x3C;
    v17 = (*(v10 + 2) + *(v12 + 2) + *(v11 + 2) + *(v16 + 2)) >> 2;
    goto LABEL_10;
  }
  return result;
}
// 8005F394: using guessed type int __fastcall DpqColor(_DWORD, _DWORD, _DWORD);
// 8005F474: using guessed type int __fastcall NormalColorCol(_DWORD, _DWORD, _DWORD);
// 8005F524: using guessed type int __fastcall AverageSZ3(_DWORD, _DWORD, _DWORD);
// 8007636C: using guessed type int dword_8007636C[3];
// 80180158: using guessed type int g_GpuCmdBufferMirror;
// 8019015C: using guessed type int g_GpuCommandBuffer;
// 80190250: using guessed type int g_CurrentPrimitiveBuffer;

//----- (800320BC) --------------------------------------------------------
int __fastcall sub_800320BC(int a1, int a2, __int16 a3, __int16 a4, char a5, int a6)
{
  int result; // $v0
  int v11; // $s4
  int v12; // $s3
  int v13; // $s1
  int *v14; // $s2
  int v15; // $s0
  int v16; // $a2
  unsigned int v17; // $v1
  int v18; // $v1
  int v19; // $a0
  char v20[8]; // [sp+10h] [-10h] BYREF
  int v21; // [sp+18h] [-8h] BYREF

  result = AverageSZ3(*(dword_80194ACC + 24), *(dword_80194AD0 + 24), *(dword_80194AD4 + 24));
  if ( result > 0 )
  {
    NormalColorCol(a2, dword_8007636C, v20);
    v11 = dword_80194ACC;
    v12 = a1 - 2;
    DpqColor(v20, *(dword_80194ACC + 20) >> 1, &v21);
    v13 = dword_80194AD0;
    v14 = &dword_80194AD4;
    DpqColor(v20, *(dword_80194AD0 + 20) >> 1, dword_80194AD0 + 28);
    for ( result = v12; ; result = v12 )
    {
      --v12;
      if ( result <= 0 )
        break;
      v15 = *v14;
      DpqColor(v20, *(*v14 + 20) >> 1, *v14 + 28);
      v16 = *(g_GpuCmdBufferMirror + 8);
      *(g_GpuCmdBufferMirror + 8) = v16 + 40;
      v17 = *(g_GpuCmdBufferMirror + 8);
      result = *(g_GpuCmdBufferMirror + 4) < v17;
      ++v14;
      if ( *(g_GpuCmdBufferMirror + 4) < v17 )
        break;
      *(v16 + 14) = a3;
      *(v16 + 26) = a4;
      *(v16 + 8) = *(v11 + 24);
      *(v16 + 20) = *(v13 + 24);
      *(v16 + 32) = *(v15 + 24);
      *(v16 + 12) = *(v11 + 32);
      *(v16 + 24) = *(v13 + 32);
      *(v16 + 36) = *(v15 + 32);
      *(v16 + 4) = v21;
      *(v16 + 16) = *(v13 + 28);
      v18 = *(v15 + 28);
      *(v16 + 3) = 9;
      *(v16 + 7) = a5 | 0x34;
      *(v16 + 28) = v18;
      v19 = (*(v11 + 16) + *(v13 + 16) + *(v15 + 16)) / 12 + a6;
      if ( v19 < 16 )
        LOWORD(v19) = 16;
      v13 = v15;
      GPU_Cmd_MergeParams((4 * (v19 & 0x1FFF) + g_GpuCommandBuffer), v16);
    }
  }
  return result;
}
// 8005F394: using guessed type int __fastcall DpqColor(_DWORD, _DWORD, _DWORD);
// 8005F474: using guessed type int __fastcall NormalColorCol(_DWORD, _DWORD, _DWORD);
// 8005F524: using guessed type int __fastcall AverageSZ3(_DWORD, _DWORD, _DWORD);
// 8007636C: using guessed type int dword_8007636C[3];
// 80180158: using guessed type int g_GpuCmdBufferMirror;
// 8019015C: using guessed type int g_GpuCommandBuffer;
// 80194ACC: using guessed type int dword_80194ACC;
// 80194AD0: using guessed type int dword_80194AD0;
// 80194AD4: using guessed type int dword_80194AD4;

//----- (800322FC) --------------------------------------------------------
int __fastcall sub_800322FC(unsigned __int16 a1, int a2, int a3)
{
  int v4; // $v0
  int *v5; // $s2
  int v6; // $s7
  unsigned int *v7; // $s1
  int result; // $v0
  unsigned int v9; // $t7
  __int16 *v10; // $s1
  int v11; // $t7
  __int16 *v12; // $s4
  __int16 *v13; // $s3
  int v14; // $t0
  int v15; // $a2
  int v16; // $a3
  int v17; // $a1
  __int16 *v18; // $s2
  __int16 *v19; // $s5
  int v20; // $t1
  int v21; // $t4
  int v22; // $v0
  int v23; // $v1
  int v24; // $a0
  int v25; // $t2
  int v26; // $t3
  int v27; // $t0
  int v28; // $a2
  int v29; // $a3
  int v30; // $v0
  int v31; // $t5
  int v32; // $a1
  int v33; // $s0
  unsigned int v34; // $v1
  int v35; // $t7
  int v36; // $v0
  int v37; // $a0
  char v38; // $t7^3
  int v39; // $a1
  __int16 *v40; // $s4
  __int16 *v41; // $s2
  int v42; // $a0
  int v43; // $v1
  __int16 *v44; // $s3
  int v45; // $v0
  int v46; // $t3
  int v47; // $t1
  int v48; // $t2
  int v49; // $a0
  int v50; // $v0
  int v51; // $v1
  __int16 *v52; // $a3
  unsigned int v53; // $v1
  __int16 v54; // $a0
  char v56[8]; // [sp+50h] [-30h] BYREF
  int v57; // [sp+58h] [-28h]
  unsigned int v58; // [sp+60h] [-20h]
  int v59; // [sp+68h] [-18h]
  int v60; // [sp+70h] [-10h]
  int v61; // [sp+78h] [-8h]

  v57 = a2;
  if ( a3 )
  {
    v4 = a3 + *(a3 + 12) + 12;
    v59 = a3 + *(a3 + 20) + 12;
    dword_80190B54 = v4;
    v5 = (a3 + 12);
  }
  else
  {
    v5 = sub_8002FFD4(a1);
    v59 = v5[2] + 12 + g_CurrentPrimitiveBuffer;
  }
  v6 = dword_80190B54;
  sub_800305F4(v5[1]);
  if ( a3 )
    v7 = (a3 + v5[4] + 12);
  else
    v7 = (v5[4] + 12 + g_CurrentPrimitiveBuffer);
  result = v5[5];
  v60 = result - 1;
  if ( result )
  {
    do
    {
      v9 = *v7;
      v10 = (v7 + 1);
      v58 = v9;
      v11 = HIBYTE(v9);
      v61 = v11;
      if ( (v11 & 0xFD) == 36 )
      {
        v40 = (&unk_80190C48 + v10[7]);
        v41 = (&unk_80190C48 + v10[9]);
        v42 = v40[1];
        v43 = v41[1];
        v44 = (&unk_80190C48 + v10[8]);
        v45 = v44[1];
        v46 = v43 - v42;
        v47 = v42 - v45;
        v48 = v45 - v43;
        v49 = *v40;
        v50 = *v44;
        v51 = *v41;
        if ( (v40[2] | v44[2] | v41[2]) == -1
          || (v47 + 511) >= 0x3FF
          || (v48 + 511) >= 0x3FF
          || (v46 + 511) >= 0x3FF
          || (v49 - v50 + 1023) >= 0x7FF
          || (v50 - v51 + 1023) >= 0x7FF )
        {
          v52 = v10;
        }
        else
        {
          v52 = v10;
          if ( (v51 - v49 + 1023) < 0x7FF )
          {
            if ( AverageSZ3(*v40, *v44, *v41) > 0 )
            {
              v33 = *(g_GpuCmdBufferMirror + 8);
              *(g_GpuCmdBufferMirror + 8) = v33 + 40;
              v53 = *(g_GpuCmdBufferMirror + 8);
              result = *(g_GpuCmdBufferMirror + 4) < v53;
              if ( *(g_GpuCmdBufferMirror + 4) < v53 )
                return result;
              *(v33 + 14) = v10[1];
              *(v33 + 26) = v10[3];
              *(v33 + 8) = *v40;
              *(v33 + 20) = *v44;
              *(v33 + 32) = *v41;
              *(v33 + 12) = *v10;
              *(v33 + 24) = v10[2];
              *(v33 + 36) = v10[4];
              NormalColorCol(v59 + v10[6], dword_8007636C, v56);
              DpqColor(v56, v40[3], v33 + 4);
              DpqColor(v56, v44[3], v33 + 16);
              DpqColor(v56, v41[3], v33 + 28);
              *(v33 + 3) = 9;
              *(v33 + 7) = v61 & 2 | 0x34;
              v35 = v57;
              v36 = (v40[2] + v44[2] + v41[2]) / 3;
              goto LABEL_36;
            }
            goto LABEL_43;
          }
        }
        v37 = sub_8005E1AC((v6 + v10[7]), (v6 + v10[8]), (v6 + v10[9]), v52, v10 + 2, v10 + 4, &dword_80194ACC);
        if ( v37 >= 3 )
        {
          v38 = HIBYTE(v58);
          v39 = v10[6];
          goto LABEL_42;
        }
      }
      else if ( (v11 & 0xFD) == 44 )
      {
        v12 = (&unk_80190C48 + v10[9]);
        v13 = (&unk_80190C48 + v10[10]);
        v14 = v12[1];
        v15 = v13[1];
        v16 = *v12;
        v17 = *v13;
        v18 = (&unk_80190C48 + v10[11]);
        v19 = (&unk_80190C48 + v10[12]);
        v20 = v14 - v15;
        v21 = v16 - v17;
        v22 = v19[1];
        v23 = v18[1];
        v24 = *v18;
        v25 = v15 - v22;
        v26 = v22 - v23;
        v27 = v23 - v14;
        v28 = v15 - v23;
        v29 = v24 - v16;
        v30 = *v19;
        v31 = v17 - v30;
        v32 = v17 - v24;
        if ( (v12[2] | v13[2] | v18[2] | v19[2]) == -1
          || (v20 + 511) >= 0x3FF
          || (v25 + 511) >= 0x3FF
          || (v26 + 511) >= 0x3FF
          || (v27 + 511) >= 0x3FF
          || (v28 + 511) >= 0x3FF
          || (v21 + 1023) >= 0x7FF
          || (v31 + 1023) >= 0x7FF
          || (v30 - v24 + 1023) >= 0x7FF
          || (v29 + 1023) >= 0x7FF
          || (v32 + 1023) >= 0x7FF )
        {
          v37 = sub_8005E234(
                  (v6 + v10[9]),
                  (v6 + v10[10]),
                  (v6 + v10[11]),
                  (v6 + v10[12]),
                  v10,
                  v10 + 2,
                  v10 + 4,
                  v10 + 6,
                  &dword_80194ACC);
          if ( v37 >= 3 )
          {
            v38 = HIBYTE(v58);
            v39 = v10[8];
LABEL_42:
            sub_800320BC(v37, v59 + v39, v10[1], v10[3], v38 & 2, v57);
          }
        }
        else if ( AverageSZ3(*v12, *v13, *v18) > 0 )
        {
          v33 = *(g_GpuCmdBufferMirror + 8);
          *(g_GpuCmdBufferMirror + 8) = v33 + 52;
          v34 = *(g_GpuCmdBufferMirror + 8);
          result = *(g_GpuCmdBufferMirror + 4) < v34;
          if ( *(g_GpuCmdBufferMirror + 4) < v34 )
            return result;
          *(v33 + 14) = v10[1];
          *(v33 + 26) = v10[3];
          *(v33 + 8) = *v12;
          *(v33 + 20) = *v13;
          *(v33 + 32) = *v18;
          *(v33 + 44) = *v19;
          *(v33 + 12) = *v10;
          *(v33 + 24) = v10[2];
          *(v33 + 36) = v10[4];
          *(v33 + 48) = v10[6];
          NormalColorCol(v59 + v10[8], dword_8007636C, v56);
          DpqColor(v56, v12[3], v33 + 4);
          DpqColor(v56, v13[3], v33 + 16);
          DpqColor(v56, v18[3], v33 + 28);
          DpqColor(v56, v19[3], v33 + 40);
          *(v33 + 3) = 12;
          *(v33 + 7) = v61 & 2 | 0x3C;
          v35 = v57;
          v36 = (v12[2] + v13[2] + v18[2] + v19[2]) >> 2;
LABEL_36:
          v54 = v36 + v35;
          if ( v36 + v35 < 16 )
            v54 = 16;
          GPU_Cmd_MergeParams((4 * (v54 & 0x1FFF) + g_GpuCommandBuffer), v33);
        }
      }
LABEL_43:
      v7 = (v10 + ((v58 >> 6) & 0x3FC));
      result = v60;
    }
    while ( v60-- != 0 );
  }
  return result;
}
// 8005F394: using guessed type int __fastcall DpqColor(_DWORD, _DWORD, _DWORD);
// 8005F474: using guessed type int __fastcall NormalColorCol(_DWORD, _DWORD, _DWORD);
// 8005F524: using guessed type int __fastcall AverageSZ3(_DWORD, _DWORD, _DWORD);
// 8007636C: using guessed type int dword_8007636C[3];
// 80180158: using guessed type int g_GpuCmdBufferMirror;
// 8019015C: using guessed type int g_GpuCommandBuffer;
// 80190250: using guessed type int g_CurrentPrimitiveBuffer;
// 80190B54: using guessed type int dword_80190B54;
// 80194ACC: using guessed type int dword_80194ACC;

//----- (80032A1C) --------------------------------------------------------
int *__fastcall sub_80032A1C(int a1, int a2, int a3)
{
  unsigned int v3; // $t5
  int v4; // $t8
  int v5; // $t9
  int v6; // $a0
  int *v7; // $t6
  int v8; // $s7
  int *v9; // $t7
  char *v10; // $t4
  int *v11; // $t6
  int *v12; // $v0
  int *v13; // $v0
  int *v14; // $v1
  int *v15; // $a1
  int *v16; // $v0
  int v17; // $a3
  char *v18; // $t4
  int v19; // $t3
  int v20; // $t8
  int v21; // $t9
  unsigned int v22; // $t5
  int *v23; // $t7
  unsigned int v24; // $t8
  unsigned int v25; // $t9
  char v26; // $s0
  char v27; // $s1
  int v28; // $a0
  unsigned int v29; // $t5
  char v30; // $s6
  int v31; // $v0
  unsigned int v32; // $t2
  __int16 v33; // $t3
  unsigned int v34; // $t1
  __int16 v35; // $fp
  __int16 v36; // $s2
  __int16 v37; // $s3
  __int16 v38; // $s4
  int v39; // $s7
  char v40; // $t8
  char v41; // $t5
  char v42; // $s5
  int *v43; // $t7
  char v44; // $t9
  char v45; // $t5
  char v46; // $s1
  int *v47; // $t7
  char v48; // $t3
  char v49; // $t2
  int *v50; // $t6
  int v51; // $t4
  int *v52; // $t7
  int *v53; // $t6
  int *v54; // $v0
  int *v55; // $v0
  int *v56; // $v1
  int *v57; // $a1
  int v58; // $a3
  char *v59; // $t4
  int v60; // $t2
  int v61; // $t8
  int v62; // $t9
  int v63; // $t5
  int v64; // $a0
  int v65; // $t0
  int *v66; // $a1
  unsigned int v67; // $t8
  unsigned int v68; // $t9
  char v69; // $s2
  unsigned int v70; // $a3
  int v71; // $v1
  int v72; // $v0
  __int16 v73; // $t3
  unsigned int v74; // $t9
  __int16 v75; // $fp
  char v76; // $s3
  __int16 v77; // $s5
  __int16 v78; // $s4
  int v79; // $t5
  int v80; // $s7
  char v81; // $t8
  char v82; // $s0
  __int16 v83; // $s1
  int *v84; // $t7
  char v85; // $t9
  char v86; // $t5
  int *v87; // $t7
  int *v88; // $t6
  int v89; // $t4
  int v90; // $fp
  int v91; // $s0
  _DWORD *v92; // $s7
  int v93; // $a0
  int v94; // $v0
  _DWORD *v95; // $t3
  int v97; // [sp+10h] [-4A8h]
  int v98; // [sp+10h] [-4A8h]
  int v99; // [sp+14h] [-4A4h]
  int v100; // [sp+14h] [-4A4h]
  int v101; // [sp+18h] [-4A0h]
  int v102; // [sp+18h] [-4A0h]
  int v103; // [sp+1Ch] [-49Ch]
  int v104; // [sp+1Ch] [-49Ch]
  int v105; // [sp+20h] [-498h]
  int v106; // [sp+20h] [-498h]
  int v107; // [sp+24h] [-494h]
  int v108; // [sp+28h] [-490h]
  int v109; // [sp+30h] [-488h] BYREF
  unsigned __int8 v110; // [sp+34h] [-484h]
  unsigned __int8 v111; // [sp+35h] [-483h]
  unsigned __int8 v112; // [sp+38h] [-480h]
  unsigned __int8 v113; // [sp+39h] [-47Fh]
  unsigned __int8 v114; // [sp+3Ch] [-47Ch]
  unsigned __int8 v115; // [sp+3Dh] [-47Bh]
  int v116; // [sp+40h] [-478h] BYREF
  char v117; // [sp+44h] [-474h] BYREF
  int v118; // [sp+440h] [-78h]
  int v119; // [sp+448h] [-70h]
  int v120; // [sp+450h] [-68h]
  _DWORD *v121; // [sp+458h] [-60h]
  int *v122; // [sp+460h] [-58h]
  int v123; // [sp+468h] [-50h]
  int v124; // [sp+470h] [-48h]
  unsigned int v125; // [sp+478h] [-40h]
  unsigned int v126; // [sp+480h] [-38h]
  int v127; // [sp+488h] [-30h]
  char *v128; // [sp+490h] [-28h]
  unsigned int v129; // [sp+494h] [-24h]
  int *v130; // [sp+498h] [-20h]
  int *v131; // [sp+49Ch] [-1Ch]
  int v132; // [sp+4A0h] [-18h]
  int v133; // [sp+4A4h] [-14h]
  int v134; // [sp+4A8h] [-10h]
  unsigned int v135; // [sp+4B0h] [-8h]

  v6 = a1 + 12;
  v120 = 0;
  v123 = 0;
  v122 = (a3 + 12);
  *(a3 + 28) = 28;
  v119 = v6;
  v121 = (v6 + 28 * a2);
  v7 = &v116;
  v122[5] = v121[5];
  v8 = a3 + 40;
  v9 = (v6 + v121[4]);
  v124 = v121[5] - 1;
  if ( v124 != -1 )
  {
    v127 = -65281;
    v10 = &v117;
    do
    {
      v118 = *v9;
      v118 = *v9;
      if ( HIBYTE(v118) == 44 || HIBYTE(v118) == 46 )
      {
        v128 = v10;
        v129 = v3;
        v130 = v7;
        v131 = v9;
        v132 = v4;
        v133 = v5;
        MemcpyDword(v8, v9, 8);
        v11 = v130;
        v118 = v131[5];
        v12 = (v119 + *v121 + SHIWORD(v118));
        v97 = *v12;
        v99 = v12[1];
        v118 = v131[6];
        v13 = (v119 + *v121 + v118);
        v101 = *v13;
        v14 = (v119 + *v121 + SHIWORD(v118));
        v103 = v13[1];
        v105 = *v14;
        v15 = v131 + 1;
        v107 = v14[1];
        v118 = v131[7];
        v16 = (v119 + *v121 + v118);
        v108 = *v16;
        v17 = v16[1];
        *v130 = (v97 + v101) >> 1;
        v11 += 2;
        v18 = v128;
        *(v128 - 1) = (SHIWORD(v97) + SHIWORD(v101)) >> 1;
        v19 = v127;
        v20 = v132 & v127;
        *v18 = (v99 + v103) >> 1;
        v18 += 8;
        *v11 = (v97 + v105) >> 1;
        v11 += 2;
        *(v18 - 1) = (SHIWORD(v97) + SHIWORD(v105)) >> 1;
        v21 = v133 & v19;
        *v18 = (v99 + v107) >> 1;
        v18 += 8;
        *v11 = (v97 + v108) >> 1;
        v11 += 2;
        *(v18 - 1) = (SHIWORD(v97) + SHIWORD(v108)) >> 1;
        v22 = v129;
        *v18 = (v99 + v17) >> 1;
        *v11 = (v105 + v108) >> 1;
        v18 += 8;
        *(v18 - 1) = (SHIWORD(v105) + SHIWORD(v108)) >> 1;
        v125 &= v19;
        *v18 = (v107 + v17) >> 1;
        v11 += 2;
        *v11 = (v101 + v108) >> 1;
        v18 += 8;
        *(v18 - 1) = (SHIWORD(v101) + SHIWORD(v108)) >> 1;
        v126 &= v19;
        *v18 = (v103 + v17) >> 1;
        v128 = v18;
        v129 = v22 & v19;
        v130 = v11;
        v132 = v20;
        v133 = v21;
        MemcpyDword(&v109, v15, 4);
        v23 = v131;
        v24 = v132 & 0xFFFFFF00 | ((BYTE1(v109) + v111) >> 1 << 8) | ((v109 + v110) >> 1);
        v25 = v133 & 0xFFFFFF00 | ((BYTE1(v109) + v113) >> 1 << 8) | ((v109 + v112) >> 1);
        v26 = BYTE1(v24);
        v135 = v110;
        v27 = (v133 & 0xFF00 | (((BYTE1(v109) + v113) >> 1) << 8) | ((v109 + v112) >> 1)) >> 8;
        v134 = v115;
        v28 = v114;
        v29 = v129 & 0xFFFFFF00 | ((BYTE1(v109) + v115) >> 1 << 8) | ((v109 + v114) >> 1);
        v30 = (v129 & 0xFF00 | (((BYTE1(v109) + v115) >> 1) << 8) | ((v109 + v114) >> 1)) >> 8;
        v125 = v125 & 0xFFFFFF00 | ((v113 + v115) >> 1 << 8) | ((v112 + v114) >> 1);
        v31 = v121[1];
        v32 = v126;
        v33 = v120;
        v34 = (v111 + v115) >> 1 << 8;
        *(v8 + 8) = (v109 + v110) >> 1;
        *(v8 + 9) = BYTE1(v24);
        *(v8 + 12) = v25;
        *(v8 + 16) = v29;
        v35 = v33 + v31;
        v36 = 8 * (v33 + v31);
        v37 = 8 * (v33 + v31 + 1);
        LOWORD(v118) = v36;
        HIWORD(v118) = v37;
        v38 = 8 * (v33 + v31 + 2);
        v126 = (v32 | v34) & 0xFFFFFF00;
        *(v8 + 24) = v118;
        LOWORD(v118) = v38;
        v135 += v28;
        v126 |= v135 >> 1;
        *(v8 + 28) = v118;
        v39 = v8 + 32;
        v129 = v29;
        v132 = v24;
        v133 = v25;
        MemcpyDword(v39, v23, 8);
        v40 = v132;
        *(v39 + 5) = v26;
        *(v39 + 4) = v40;
        v41 = v129;
        *(v39 + 13) = v30;
        *(v39 + 12) = v41;
        *(v39 + 16) = v126;
        v42 = BYTE1(v126);
        *(v39 + 17) = BYTE1(v126);
        HIBYTE(v118) = HIBYTE(v36);
        *(v39 + 22) = v36;
        *(v39 + 23) = HIBYTE(v118);
        HIWORD(v118) = v38;
        *(v39 + 26) = v38;
        *(v39 + 27) = HIBYTE(v118);
        LOWORD(v118) = 8 * (v35 + 4);
        v43 = v131;
        *(v39 + 28) = 8 * (v35 + 4);
        *(v39 + 29) = BYTE1(v118);
        v39 += 32;
        MemcpyDword(v39, v43, 8);
        v44 = v133;
        *(v39 + 5) = v27;
        *(v39 + 4) = v44;
        v45 = v129;
        *(v39 + 9) = v30;
        *(v39 + 8) = v45;
        *(v39 + 16) = v125;
        v46 = BYTE1(v125);
        *(v39 + 17) = BYTE1(v125);
        HIWORD(v118) = v37;
        *(v39 + 22) = v37;
        *(v39 + 23) = HIBYTE(v118);
        BYTE1(v118) = HIBYTE(v38);
        *(v39 + 24) = v38;
        *(v39 + 25) = BYTE1(v118);
        LOWORD(v118) = 8 * (v35 + 3);
        v47 = v131;
        *(v39 + 28) = 8 * (v35 + 3);
        *(v39 + 29) = BYTE1(v118);
        v39 += 32;
        MemcpyDword(v39, v47, 8);
        v3 = v129;
        *(v39 + 5) = v30;
        *(v39 + 4) = v3;
        v48 = v126;
        *(v39 + 9) = v42;
        *(v39 + 8) = v48;
        v49 = v125;
        *(v39 + 13) = v46;
        *(v39 + 12) = v49;
        HIBYTE(v118) = HIBYTE(v38);
        *(v39 + 22) = v38;
        *(v39 + 23) = HIBYTE(v118);
        LOWORD(v118) = 8 * (v35 + 4);
        HIWORD(v118) = 8 * (v35 + 3);
        v123 += 128;
        *(v39 + 24) = v118;
        v50 = v130;
        *(v39 + 25) = BYTE1(v118);
        v51 = v128;
        v7 = v50 + 2;
        *(v39 + 26) = BYTE2(v118);
        v120 += 5;
        *(v39 + 27) = HIBYTE(v118);
        v10 = (v51 + 8);
        v122[5] += 3;
        v52 = v131;
        v4 = v132;
        v5 = v133;
        v8 = v39 + 32;
      }
      else if ( HIBYTE(v118) == 36 || HIBYTE(v118) == 38 )
      {
        v128 = v10;
        v129 = v3;
        v130 = v7;
        v131 = v9;
        v132 = v4;
        v133 = v5;
        MemcpyDword(v8, v9, 6);
        v53 = v130;
        v118 = v131[4];
        v54 = (v119 + *v121 + SHIWORD(v118));
        v98 = *v54;
        v100 = v54[1];
        v118 = v131[5];
        v55 = (v119 + *v121 + v118);
        v102 = *v55;
        v56 = (v119 + *v121 + SHIWORD(v118));
        v57 = v131 + 1;
        v104 = v55[1];
        v106 = *v56;
        v58 = v56[1];
        *v130 = (v98 + *v55) >> 1;
        v53 += 2;
        v59 = v128;
        *(v128 - 1) = (SHIWORD(v98) + SHIWORD(v102)) >> 1;
        v60 = v127;
        v61 = v132 & v127;
        *v59 = (v100 + v104) >> 1;
        v59 += 8;
        *v53 = (v98 + v106) >> 1;
        v53 += 2;
        *(v59 - 1) = (SHIWORD(v98) + SHIWORD(v106)) >> 1;
        v62 = v133;
        *v59 = (v100 + v58) >> 1;
        *v53 = (v102 + v106) >> 1;
        v59 += 8;
        *(v59 - 1) = (SHIWORD(v102) + SHIWORD(v106)) >> 1;
        v63 = v129 & v60;
        *v59 = (v104 + v58) >> 1;
        v128 = v59;
        v129 = v63;
        v130 = v53;
        v132 = v61;
        v133 = v62 & v60;
        MemcpyDword(&v109, v57, 3);
        v64 = v109;
        v65 = v110;
        v66 = v131;
        v67 = v132 & 0xFFFFFF00 | ((BYTE1(v109) + v111) >> 1 << 8) | ((v109 + v110) >> 1);
        v68 = v133 & 0xFFFFFF00 | ((BYTE1(v109) + v113) >> 1 << 8);
        v69 = BYTE1(v67);
        v70 = (v111 + v113) >> 1 << 8;
        v71 = v112;
        v72 = v121[1];
        v73 = v120;
        *(v8 + 8) = (v109 + v110) >> 1;
        *(v8 + 9) = BYTE1(v67);
        v74 = v68 | ((v64 + v71) >> 1);
        v75 = v73 + v72;
        v76 = BYTE1(v74);
        v77 = 8 * (v73 + v72);
        v78 = 8 * (v73 + v72 + 1);
        *(v8 + 12) = v74;
        LOWORD(v118) = v77;
        HIWORD(v118) = v78;
        *(v8 + 20) = 8 * (v73 + v72);
        v79 = v129 | v70;
        *(v8 + 21) = *(&v118 + 1);
        *(v8 + 23) = HIBYTE(v118);
        v80 = v8 + 24;
        v129 = v79 & 0xFFFFFF00 | ((v65 + v71) >> 1);
        v132 = v67;
        v133 = v74;
        MemcpyDword(v80, v66, 6);
        v81 = v132;
        *(v80 + 5) = v69;
        *(v80 + 4) = v81;
        v82 = BYTE1(v129);
        *(v80 + 12) = v129;
        *(v80 + 13) = v82;
        HIBYTE(v118) = HIBYTE(v77);
        *(v80 + 18) = v77;
        v83 = 8 * (v75 + 2);
        *(v80 + 19) = HIBYTE(v118);
        HIWORD(v118) = v83;
        v84 = v131;
        *(v80 + 22) = 8 * (v75 + 2);
        *(v80 + 23) = HIBYTE(v118);
        v80 += 24;
        MemcpyDword(v80, v84, 6);
        v85 = v133;
        *(v80 + 5) = v76;
        *(v80 + 4) = v85;
        v86 = v129;
        *(v80 + 9) = v82;
        *(v80 + 8) = v86;
        HIWORD(v118) = v78;
        *(v80 + 18) = v78;
        *(v80 + 19) = HIBYTE(v118);
        LOWORD(v118) = v83;
        v87 = v131;
        *(v80 + 20) = v83;
        *(v80 + 21) = BYTE1(v118);
        v80 += 24;
        MemcpyDword(v80, v87, 6);
        v4 = v132;
        *(v80 + 5) = v69;
        *(v80 + 4) = v4;
        v3 = v129;
        *(v80 + 9) = v82;
        *(v80 + 8) = v3;
        v5 = v133;
        *(v80 + 13) = v76;
        *(v80 + 12) = v5;
        HIBYTE(v118) = HIBYTE(v77);
        *(v80 + 18) = v77;
        *(v80 + 19) = HIBYTE(v118);
        LOWORD(v118) = v83;
        HIWORD(v118) = v78;
        v123 += 96;
        *(v80 + 20) = v83;
        v88 = v130;
        *(v80 + 21) = BYTE1(v118);
        v89 = v128;
        v7 = v88 + 2;
        *(v80 + 22) = BYTE2(v118);
        v120 += 3;
        *(v80 + 23) = HIBYTE(v118);
        v10 = (v89 + 8);
        v122[5] += 3;
        v52 = v131;
        v8 = v80 + 24;
      }
      else
      {
        v128 = v10;
        v129 = v3;
        v130 = v7;
        v131 = v9;
        v132 = v4;
        v133 = v5;
        v90 = BYTE1(v118) + 1;
        MemcpyDword(v8, v9, v90);
        v90 *= 4;
        v8 += v90;
        v123 += v90;
        v5 = v133;
        v4 = v132;
        v52 = v131;
        v7 = v130;
        v3 = v129;
        v10 = v128;
      }
      v118 = *v52;
      v9 = &v52[BYTE1(v118) + 1];
      --v124;
    }
    while ( v124 != -1 );
  }
  *v122 = v123 + v122[4];
  v122[1] = v120 + v121[1];
  v91 = v121[1];
  MemcpyDword(v8, (v119 + *v121), 2 * v91);
  v91 *= 8;
  v92 = (v8 + v91);
  v123 = v91;
  MemcpyDword(v92, &v116, 2 * v120);
  v93 = 2 * v120;
  v94 = *v122;
  v123 = v91 + 8 * v120;
  v122[2] = v123 + v94;
  v95 = v121;
  v122[3] = v121[3];
  return MemcpyDword(&v92[v93], (v119 + v95[2]), 2 * v95[3]);
}
// 80032B00: variable 'v3' is possibly undefined
// 80032B0C: variable 'v4' is possibly undefined
// 80032B14: variable 'v5' is possibly undefined

//----- (800336D4) --------------------------------------------------------
int __fastcall sub_800336D4(unsigned __int8 *a1, int a2, char a3)
{
  int v6; // $s2
  char *v7; // $s0
  unsigned int v8; // $s0
  unsigned __int16 v9; // $s1
  int result; // $v0
  unsigned __int16 v11; // $a0
  __int16 v12[10]; // [sp+10h] [-1028h] BYREF
  char v13[12]; // [sp+24h] [-1014h] BYREF
  int v14; // [sp+30h] [-1008h] BYREF
  char v15[4096]; // [sp+38h] [-1000h] BYREF

  v6 = a1[2] & 3;
  SetRotMatrix(word_80194ECC);
  SetTransMatrix(word_80194ECC);
  sub_8005F348(a2, v13, &v14);
  RotateMatrixCardinal(word_80194ECC, v12, v6);
  SetRotMatrix(v12);
  SetTransMatrix(v12);
  v7 = &g_DynamicPrimitiveTable + 104 * (a1[4] & 0x3F);
  SetLightMatrix(&v7[20 * v6]);
  SetColorMatrix(v7 + 80);
  sub_8002FBC0(*(v7 + 51));
  SetBackColor(v7[98], v7[99], v7[100]);
  v8 = *a1;
  v9 = *a1;
  if ( g_bStartKeyState != 1 || !byte_801779EA || (result = v8 < *(g_CurrentPrimitiveBuffer + 4)) != 0 )
  {
    sub_80030008(v8);
    if ( (a3 & 0x80) != 0 )
    {
      v11 = v8;
      if ( (a3 & 0x40) != 0 )
      {
        if ( *(sub_8002FFD4(v8) + 20) < 0x10u )
        {
          sub_80032A1C(g_CurrentPrimitiveBuffer, v8, v15);
          return sub_800322FC(v9, 240, v15);
        }
        v11 = v8;
      }
      return sub_800322FC(v11, 240, 0);
    }
    else
    {
      return sub_80031CD0(v8);
    }
  }
  return result;
}
// 8005DAD0: using guessed type int __fastcall SetBackColor(_DWORD, _DWORD, _DWORD);
// 8005E0F8: using guessed type int __fastcall SetRotMatrix(_DWORD);
// 8005E128: using guessed type int __fastcall SetLightMatrix(_DWORD);
// 8005E158: using guessed type int __fastcall SetColorMatrix(_DWORD);
// 801779D4: using guessed type __int16 g_bStartKeyState;
// 801779EA: using guessed type char byte_801779EA;
// 80190250: using guessed type int g_CurrentPrimitiveBuffer;
// 80194ECC: using guessed type _WORD word_80194ECC[16];
// 800336D4: using guessed type char var_1014[12];
// 800336D4: using guessed type _WORD var_1028[10];

//----- (800338A0) --------------------------------------------------------
int __fastcall sub_800338A0(int a1, int a2, char a3)
{
  __int16 v3; // $a3
  char v4; // $s1
  unsigned __int8 *v5; // $s0
  char v6; // $s2
  __int16 v7; // $v0
  int result; // $v0
  unsigned __int8 *v9; // $a0
  __int16 v10; // $v0
  __int16 v11; // [sp+10h] [-8h] BYREF
  __int16 v12; // [sp+12h] [-6h]
  __int16 v13; // [sp+14h] [-4h]

  v3 = a1;
  v4 = a3;
  v5 = &g_MapData[200 * a2] + 10 * a1;
  if ( (a3 & 1) != 0 && *v5 < 0xF0u )
  {
    v6 = a3;
    v11 = (a1 << 11) - dword_80194F2C + 1024;
    v7 = v5[1];
    v13 = (a2 << 11) - dword_80194F34 + 1024;
    v12 = -128 * v7 - dword_80194F30;
    sub_800336D4(v5, &v11, a3);
    result = v5[5] < 0xF0u;
    if ( (v4 & 2) != 0 )
    {
      v9 = v5 + 5;
      if ( v5[5] < 0xF0u )
      {
        v10 = v5[6];
        a3 = v6;
LABEL_9:
        v12 = -128 * v10 - dword_80194F30;
        return sub_800336D4(v9, &v11, a3);
      }
    }
  }
  else
  {
    result = v5[5] < 0xF0u;
    if ( (a3 & 2) != 0 )
    {
      v9 = v5 + 5;
      if ( v5[5] < 0xF0u )
      {
        v11 = (v3 << 11) - dword_80194F2C + 1024;
        v10 = v5[6];
        v13 = (a2 << 11) - dword_80194F34 + 1024;
        goto LABEL_9;
      }
    }
  }
  return result;
}
// 80194F2C: using guessed type int dword_80194F2C;
// 80194F30: using guessed type int dword_80194F30;
// 80194F34: using guessed type int dword_80194F34;
// 801CBD74: using guessed type _DWORD g_MapData[];

//----- (80033A1C) --------------------------------------------------------
int sub_80033A1C()
{
  char *v0; // $s2
  int v1; // $s4
  int v2; // $s5
  unsigned int v3; // $s3
  int result; // $v0
  int v5; // $s1
  int v6; // $s0
  int v7; // $a0

  sub_8002FFA4(0);
  v0 = byte_80194F60;
  v1 = 24;
  v2 = dword_80194F54;
  v3 = dword_80194F58;
  do
  {
    result = v3 < 0x50;
    v5 = v2;
    if ( v3 >= 0x50 )
    {
      v0 += 24;
      --v1;
    }
    else
    {
      v6 = 24;
      do
      {
        v7 = v5;
        result = v5 < 0x50u;
        if ( v5++ < 0x50u )
        {
          if ( *v0 )
            result = sub_800338A0(v7, v3, *v0);
        }
        --v6;
        ++v0;
      }
      while ( v6 );
      --v1;
    }
    ++v3;
  }
  while ( v1 );
  return result;
}
// 80194F54: using guessed type int dword_80194F54;
// 80194F58: using guessed type int dword_80194F58;
// 80194F60: using guessed type _BYTE byte_80194F60[576];

//----- (80033AE8) --------------------------------------------------------
int UpdateCamera()
{
  char *v0; // $s2
  __int16 *v1; // $s1
  int v2; // $v1
  int v3; // $v1
  int *v4; // $s0
  int v5; // $s0
  int result; // $v0
  __int16 v7[10]; // [sp+18h] [-50h] BYREF
  int v8; // [sp+2Ch] [-3Ch]
  int v9; // [sp+30h] [-38h]
  int v10; // [sp+34h] [-34h]
  int v11[4]; // [sp+38h] [-30h] BYREF
  int v12[8]; // [sp+48h] [-20h] BYREF

  v0 = &byte_8006E2B8;
  v1 = &algn_8006E2BC[2];
  v2 = 1;
  do
  {
    if ( v2 == 1 )
    {
      v3 = *(v1 - 4);
      v8 = v1[5];
      v9 = v1[6];
      v10 = v1[7];
      v4 = (&g_DynamicPrimitiveTable + 104 * v3);
      RotMatrix(v0 + 24, v7);
      sub_8002FBC0(*(v4 + 51));
      SetBackColor(*(v4 + 98), *(v4 + 99), *(v4 + 100));
      SetColorMatrix(v4 + 20);
      sub_800611CC(v4, v7, v12);
      SetLightMatrix(v12);
      v11[0] = v1[1];
      v11[1] = v1[2];
      v11[2] = v1[3];
      ScaleMatrix(v7, v11);
      SetRotMatrix(v7);
      SetTransMatrix(v7);
      GetPrimitiveBuffer(*(v1 - 1));
      v5 = sub_8002FFD4(0);
      if ( SubmitDisplayListToGPU(v0 + 8, *(v1 - 1), *(v1 - 5), *v1, *(v5 + 4)) )
        sub_80030008(0);
      sub_8003073C(*(v5 + 4));
      sub_80031034(0, 0);
    }
    v0 += 36;
    v2 = *v0;
    result = 255;
    v1 += 18;
  }
  while ( v2 != 255 );
  return result;
}
// 8005DAD0: using guessed type int __fastcall SetBackColor(_DWORD, _DWORD, _DWORD);
// 8005DFD4: using guessed type int __fastcall ScaleMatrix(_DWORD, _DWORD);
// 8005E0F8: using guessed type int __fastcall SetRotMatrix(_DWORD);
// 8005E128: using guessed type int __fastcall SetLightMatrix(_DWORD);
// 8005E158: using guessed type int __fastcall SetColorMatrix(_DWORD);
// 8005F698: using guessed type int __fastcall RotMatrix(_DWORD, _DWORD);
// 8006E2B8: using guessed type char byte_8006E2B8;
// 80033AE8: using guessed type int var_20[8];
// 80033AE8: using guessed type unsigned __int16 var_50[10];

//----- (80033C78) --------------------------------------------------------
unsigned int __fastcall RenderFadeOverlay(
        __int16 x,
        __int16 y,
        __int16 width,
        int height,
        char vram_x,
        char vram_y,
        char semi_trans,
        char dither,
        unsigned __int8 primitive_type,
        __int16 palette_idx,
        __int16 clut_addr,
        char r,
        char g,
        char b,
        int priority)
{
  int v16; // $a1
  unsigned int result; // $v0

  v16 = *(g_GpuCmdBufferMirror + 8);
  *(g_GpuCmdBufferMirror + 8) = v16 + 40;
  result = 9;
  if ( *(g_GpuCmdBufferMirror + 4) >= *(g_GpuCmdBufferMirror + 8) )
  {
    *(v16 + 3) = 9;
    *(v16 + 7) = 44;
    if ( primitive_type != 255 && primitive_type )
      *(v16 + 7) = 46;
    *(v16 + 29) = vram_y + dither;
    *(v16 + 37) = vram_y + dither;
    *(v16 + 24) = x;
    *(v16 + 8) = x;
    *(v16 + 32) = width;
    *(v16 + 16) = width;
    *(v16 + 18) = y;
    *(v16 + 10) = y;
    result = height;
    *(v16 + 4) = r;
    *(v16 + 5) = g;
    *(v16 + 6) = b;
    *(v16 + 22) = palette_idx;
    *(v16 + 14) = clut_addr;
    *(v16 + 12) = vram_x;
    *(v16 + 13) = vram_y;
    *(v16 + 20) = vram_x + semi_trans;
    *(v16 + 21) = vram_y;
    *(v16 + 28) = vram_x;
    *(v16 + 36) = vram_x + semi_trans;
    *(v16 + 34) = height;
    *(v16 + 26) = height;
    if ( priority > 0 )
    {
      result = priority < 0x2000;
      if ( priority < 0x2000 )
        return GPU_Cmd_MergeParams((4 * priority + g_GpuCommandBuffer), v16);
    }
  }
  return result;
}
// 80180158: using guessed type int g_GpuCmdBufferMirror;
// 8019015C: using guessed type int g_GpuCommandBuffer;

//----- (80033DB4) --------------------------------------------------------
unsigned int sub_80033DB4()
{
  unsigned int result; // $v0
  __int16 v1; // $a1

  result = dword_8019B5E4 < 240;
  if ( dword_8019B5E4 < 240 )
  {
    v1 = dword_8019B5E4 + 120;
    if ( dword_8019B5E4 + 120 < 0 )
      v1 = 0;
    // (60,60,60)
    // RGB  (!)
    return RenderFadeOverlay(0, v1, 320, 240, 128, 192, 15, 15, 1u, 55, 31708, 60, 60, 60, 12);
  }
  return result;
}
// 8019B5E4: using guessed type int dword_8019B5E4;

//----- (80033E44) --------------------------------------------------------
unsigned int sub_80033E44()
{
  unsigned int result; // $v0
  __int16 v1; // $a1

  result = dword_8019B5E8 < 240;
  if ( dword_8019B5E8 < 240 )
  {
    v1 = dword_8019B5E8 + 120;
    if ( dword_8019B5E8 + 120 < 0 )
      v1 = 0;
    return RenderFadeOverlay(0, v1, 320, 240, 144, 192, 15, 15, 1u, 55, 31708, 60, 60, 60, 12);
  }
  return result;
}
// 8019B5E8: using guessed type int dword_8019B5E8;

//----- (80033ED4) --------------------------------------------------------
int sub_80033ED4()
{
  int result; // $v0
  __int16 v1; // [sp+24h] [-1Ch]

  result = 128;
  if ( byte_80194DF9 != 255 )
  {
    v1 = (32 * (byte_80194DF9 & 3)) | 0x17;
    if ( (byte_80194DF9 & 0x80) != 0 )
      return RenderFadeOverlay(
               0,
               0,
               320,
               240,
               128,
               208,
               15,
               15,
               1u,
               v1,
               31708,
               byte_80194DFA,
               byte_80194DFB,
               byte_80194DFC,
               1);
    else
      return RenderFadeOverlay(
               0,
               0,
               320,
               240,
               128,
               208,
               15,
               15,
               1u,
               v1,
               31708,
               byte_80194DFA,
               byte_80194DFB,
               byte_80194DFC,
               12);
  }
  return result;
}
// 80194DF9: using guessed type char byte_80194DF9;
// 80194DFA: using guessed type char byte_80194DFA;
// 80194DFB: using guessed type char byte_80194DFB;
// 80194DFC: using guessed type char byte_80194DFC;

//----- (80033F94) --------------------------------------------------------
void __fastcall SetFadeColor(char a1, char a2, char a3, char a4)
{
  byte_80194DF9 = a1;
  byte_80194DFA = a2;
  byte_80194DFB = a3;
  byte_80194DFC = a4;
}
// 80194DF9: using guessed type char byte_80194DF9;
// 80194DFA: using guessed type char byte_80194DFA;
// 80194DFB: using guessed type char byte_80194DFB;
// 80194DFC: using guessed type char byte_80194DFC;

//----- (80033FBC) --------------------------------------------------------
unsigned int sub_80033FBC()
{
  unsigned int result; // $v0

  result = byte_80194DFD;
  if ( byte_80194DFD )
  {
    if ( byte_80194DFD == -1 && word_80194DFE == 0x80000000 )
      _break(6u, 0);
    if ( !byte_80194DFD )
      _break(7u, 0);
    return RenderFadeOverlay(
             0,
             0,
             320,
             240,
             128,
             208,
             15,
             15,
             1u,
             55,
             31708,
             word_80194DFE / byte_80194DFD,
             word_80194E00 / byte_80194DFD,
             word_80194E02 / byte_80194DFD,
             12);
  }
  return result;
}
// 80034038: conditional instruction was optimized away because $v0.4<100u
// 80034074: conditional instruction was optimized away because $v0.4<100u
// 80194DFD: using guessed type char byte_80194DFD;
// 80194DFE: using guessed type __int16 word_80194DFE;
// 80194E00: using guessed type __int16 word_80194E00;
// 80194E02: using guessed type __int16 word_80194E02;

//----- (80034100) --------------------------------------------------------
int __fastcall sub_80034100(int a1, int a2, int a3, int a4)
{
  int result; // $v0

  ++byte_80194DFD;
  word_80194DFE += (a1 * a4) >> 12;
  word_80194E00 += (a2 * a4) >> 12;
  result = (a3 * a4) >> 12;
  word_80194E02 += result;
  return result;
}
// 80194DFD: using guessed type char byte_80194DFD;
// 80194DFE: using guessed type __int16 word_80194DFE;
// 80194E00: using guessed type __int16 word_80194E00;
// 80194E02: using guessed type __int16 word_80194E02;

//----- (8003417C) --------------------------------------------------------
int UpdateTileLighting()
{
  int result; // $v0
  char *v1; // $s0
  int v2; // $s0
  _DWORD v3[8]; // [sp+18h] [-20h] BYREF

  result = -1;
  if ( g_ActiveWeaponSpell.field_14 != -1 )
  {
    v1 = &g_DynamicPrimitiveTable
       + 104
       * (*(&unk_801CBD78
          + 800 * (*&g_LanguageID[0].menus[0].header.posY >> 11)
          + 10 * (*&g_LanguageID[0].header[2] >> 11)
          + word_8019B5EC) & 0x3F);
    SetColorMatrix(v1 + 80);
    SetLightMatrix(v1);
    sub_8002FBC0(*(v1 + 51));
    SetBackColor(v1[98], v1[99], v1[100]);
    v3[5] = *(*&g_ActiveWeaponSpell.StatusEffect + 52);
    v3[6] = *(*&g_ActiveWeaponSpell.StatusEffect + 54);
    v3[7] = *(*&g_ActiveWeaponSpell.StatusEffect + 56);
    RotMatrix(*&g_ActiveWeaponSpell.StatusEffect + 60, v3);
    SetRotMatrix(v3);
    SetTransMatrix(v3);
    GetPrimitiveBuffer(0x20u);
    v2 = sub_8002FFD4(0);
    result = SubmitDisplayListToGPU(
               &g_ActiveWeaponSpell.DmgFire,
               32,
               g_CurrentAttackDir,
               g_ActiveWeaponSpell.field_14,
               *(v2 + 4));
    if ( result )
    {
      sub_80030474(*(v2 + 4));
      return sub_80031034(0, 100);
    }
  }
  return result;
}
// 8005DAD0: using guessed type int __fastcall SetBackColor(_DWORD, _DWORD, _DWORD);
// 8005E0F8: using guessed type int __fastcall SetRotMatrix(_DWORD);
// 8005E128: using guessed type int __fastcall SetLightMatrix(_DWORD);
// 8005E158: using guessed type int __fastcall SetColorMatrix(_DWORD);
// 8005F698: using guessed type int __fastcall RotMatrix(_DWORD, _DWORD);
// 8019B55E: using guessed type char g_CurrentAttackDir;
// 8019B5EC: using guessed type __int16 word_8019B5EC;

//----- (80034304) --------------------------------------------------------
int __fastcall sub_80034304(
        char a1,
        unsigned __int16 a2,
        int *a3,
        __int16 *a4,
        __int16 *a5,
        int *a6,
        int *a7,
        unsigned __int16 a8,
        unsigned __int16 a9,
        unsigned __int8 a10,
        __int16 a11,
        unsigned __int8 a12,
        int a13)
{
  int v13; // $s4
  unsigned __int8 v14; // $s7
  char *v18; // $a0
  int v19; // $v1
  int v20; // $v0
  int v21; // $s2
  __int16 *v22; // $a0
  __int16 *v23; // $s3
  __int16 *v24; // $a0
  int *v25; // $a0
  int v26; // $a1
  int v27; // $a0
  int v28; // $a1
  int v29; // $s1
  int v30; // $v0
  int v31; // $s0
  int v32; // $s3
  int v33; // $s2
  unsigned __int16 v34; // $s1
  int v35; // $s0
  __int16 v37; // [sp+18h] [-A8h] BYREF
  __int16 v38; // [sp+1Ah] [-A6h]
  __int16 v39; // [sp+1Ch] [-A4h]
  int v40[4]; // [sp+20h] [-A0h] BYREF
  int v41[5]; // [sp+30h] [-90h] BYREF
  int v42[3]; // [sp+44h] [-7Ch] BYREF
  int v43[8]; // [sp+50h] [-70h] BYREF
  __int16 v44[16]; // [sp+70h] [-50h] BYREF
  int v45; // [sp+90h] [-30h] BYREF
  unsigned __int16 v46; // [sp+98h] [-28h]
  int *v47; // [sp+A0h] [-20h]
  unsigned __int16 v48; // [sp+A8h] [-18h]
  unsigned __int16 v49; // [sp+B0h] [-10h]
  unsigned __int8 v50; // [sp+B8h] [-8h]

  v13 = a13;
  v14 = a12;
  v47 = a6;
  v48 = a8;
  v49 = a9;
  v46 = a2;
  v50 = a10;
  SetRotMatrix(word_80194ECC);
  SetTransMatrix(word_80194ECC);
  if ( a7 )
  {
    v37 = *a3 - dword_80194F2C;
    v38 = *(a3 + 2) - dword_80194F30;
    v39 = *(a3 + 4) - dword_80194F34;
    sub_8005F348(&v37, v42, &v45);
    v18 = &g_MapData[200 * (a3[2] >> 11)] + 10 * (*a3 >> 11);
    if ( a1 != 1 )
      v18 += 5;
    v19 = 104 * (v18[4] & 0x3F);
    v20 = &g_DynamicPrimitiveTable;
  }
  else
  {
    v42[0] = *a3;
    v42[1] = a3[1];
    v42[2] = a3[2];
    v20 = 104 * (*(&unk_801CBD78 + 800 * (dword_80194F34 >> 11) + 10 * (dword_80194F2C >> 11) + word_8019B5EC) & 0x3F);
    v19 = &g_DynamicPrimitiveTable;
  }
  v21 = v20 + v19;
  if ( a12 == 128 )
  {
    v14 = -1;
  }
  else
  {
    v22 = a4;
    if ( v38 > 0 )
      goto LABEL_11;
    v13 = a13 + 240;
  }
  v22 = a4;
LABEL_11:
  sub_80015460(v22, v41);
  if ( a5 )
  {
    v40[0] = *a5;
    v40[1] = a5[1];
    v40[2] = a5[2];
    ScaleMatrix(v41, v40);
  }
  if ( v50 == 255 )
  {
    SetColorMatrix(v21 + 80);
    sub_8002FBC0(*(v21 + 102));
    SetBackColor(*(v21 + 98), *(v21 + 99), *(v21 + 100));
    sub_800611CC(v21, v41, v43);
  }
  else
  {
    v23 = (&g_DynamicPrimitiveTable + 104 * v50);
    if ( v23[40] == -1 )
    {
      v24 = (v21 + 80);
    }
    else
    {
      LerpRotationMatrix((v21 + 80), v23 + 40, v44, a11);
      v24 = v44;
    }
    SetColorMatrix(v24);
    v25 = v21;
    if ( *v23 != -1 )
      v25 = v23;
    sub_800611CC(v25, v41, v43);
    v26 = v23[51];
    if ( v26 == -1 )
      v27 = *(v21 + 102);
    else
      v27 = FixedPointLerp(*(v21 + 102), v26, a11);
    sub_8002FBC0(v27);
    v28 = *(v23 + 98);
    if ( v28 == 255 )
    {
      SetBackColor(*(v21 + 98), *(v21 + 99), *(v21 + 100));
    }
    else
    {
      v29 = FixedPointLerp(*(v21 + 98), v28, a11);
      v31 = FixedPointLerp(*(v21 + 99), *(v23 + 99), a11);
      v30 = FixedPointLerp(*(v21 + 100), *(v23 + 100), a11);
      SetBackColor(v29, v31, v30);
    }
  }
  SetLightMatrix(v43);
  if ( a7 )
    sub_8005DDF8(a7, v41);
  SetRotMatrix(v41);
  SetTransMatrix(v41);
  v32 = v46;
  GetPrimitiveBuffer(v46);
  v33 = v48;
  v34 = 0;
  if ( v48 >= 0x80u )
  {
    v34 = v48 & 0x7F;
    sub_80030008(v34);
    v35 = sub_8002FFD4(v34);
  }
  else
  {
    v35 = sub_8002FFD4(0);
    if ( !SubmitDisplayListToGPU(v47, v32, v33, v49, *(v35 + 4)) )
      sub_80030008(0);
  }
  if ( a7 )
    sub_80030474(*(v35 + 4));
  else
    sub_800307E8(*(v35 + 4), v13);
  if ( v14 == 255 )
    return sub_80031034(v34, v13);
  if ( v14 == 254 )
    return sub_800322FC(v34, v13, 0);
  return sub_80030924(v34, v13, v14);
}
// 8005DAD0: using guessed type int __fastcall SetBackColor(_DWORD, _DWORD, _DWORD);
// 8005DFD4: using guessed type int __fastcall ScaleMatrix(_DWORD, _DWORD);
// 8005E0F8: using guessed type int __fastcall SetRotMatrix(_DWORD);
// 8005E128: using guessed type int __fastcall SetLightMatrix(_DWORD);
// 8005E158: using guessed type int __fastcall SetColorMatrix(_DWORD);
// 80194ECC: using guessed type _WORD word_80194ECC[16];
// 80194F2C: using guessed type int dword_80194F2C;
// 80194F30: using guessed type int dword_80194F30;
// 80194F34: using guessed type int dword_80194F34;
// 8019B5EC: using guessed type __int16 word_8019B5EC;
// 801CBD74: using guessed type _DWORD g_MapData[];
// 80034304: using guessed type int var_90[5];
// 80034304: using guessed type _WORD var_50[16];
// 80034304: using guessed type int var_70[8];

//----- (80034824) --------------------------------------------------------
int __fastcall sub_80034824(
        unsigned __int16 a1,
        __int16 *a2,
        int *a3,
        unsigned __int16 a4,
        unsigned __int16 a5,
        __int16 a6,
        char a7,
        __int16 a8)
{
  char *v11; // $s0
  __int16 *v12; // $a0
  int v13; // $s0
  int v14; // $a0
  int v16[8]; // [sp+18h] [-38h] BYREF
  __int16 v17[12]; // [sp+38h] [-18h] BYREF

  memset(&v16[5], 0, 12);
  sub_80015460(a2, v16);
  sub_8005DDF8(word_80194ECC, v16);
  SetRotMatrix(v16);
  SetTransMatrix(v16);
  v11 = &g_DynamicPrimitiveTable + 104 * (a7 & 0x7F);
  SetColorMatrix(v11 + 80);
  SetBackColor(v11[98], v11[99], v11[100]);
  if ( (a7 & 0x80) != 0 )
  {
    v17[0] = -*v11;
    v17[1] = -*(v11 + 1);
    v17[2] = -*(v11 + 2);
    v17[3] = -*(v11 + 3);
    v17[4] = -*(v11 + 4);
    v17[5] = -*(v11 + 5);
    v17[6] = -*(v11 + 6);
    v17[7] = -*(v11 + 7);
    v12 = v17;
    v17[8] = -*(v11 + 8);
  }
  else
  {
    v12 = (&g_DynamicPrimitiveTable + 104 * (a7 & 0x7F));
  }
  SetLightMatrix(v12);
  GetPrimitiveBuffer(a1);
  v13 = sub_8002FFD4(0);
  if ( SubmitDisplayListToGPU(a3, a1, a4, a5, *(v13 + 4)) )
  {
    v14 = *(v13 + 4);
  }
  else
  {
    sub_80030008(0);
    v14 = *(sub_8002FFD4(0) + 4);
  }
  sub_80030894(v14);
  return sub_8003171C(0, a6, a8);
}
// 8005DAD0: using guessed type int __fastcall SetBackColor(_DWORD, _DWORD, _DWORD);
// 8005E0F8: using guessed type int __fastcall SetRotMatrix(_DWORD);
// 8005E128: using guessed type int __fastcall SetLightMatrix(_DWORD);
// 8005E158: using guessed type int __fastcall SetColorMatrix(_DWORD);
// 80194ECC: using guessed type _WORD word_80194ECC[16];

//----- (80034A2C) --------------------------------------------------------
int __fastcall sub_80034A2C(unsigned __int16 a1)
{
  int v1; // $s0
  int result; // $v0
  bool v3; // dc

  v1 = g_PrimitiveTypeTable[a1];
  if ( a1 < 0x68u )
    return v1;
  result = 0;
  if ( v1 )
  {
    v3 = (sub_80017BA4(v1) - 1) >= 2u;
    result = 0;
    if ( !v3 )
      return v1;
  }
  return result;
}
// 80190254: using guessed type _DWORD g_PrimitiveTypeTable[385];

//----- (80034A98) --------------------------------------------------------
void __fastcall MOLoadedCallback(int a1)
{
  ConvertVertexCoordinates(a1 + *(a1 + 8));
  MO_Something01Set(a1, 2);
}

//----- (80034AD4) --------------------------------------------------------
int __fastcall sub_80034AD4(int *a1)
{
  unsigned int v1; // $a1
  int result; // $v0
  unsigned int v3; // $a0

  v1 = (a1[2] >> 11) + dword_80194F50;
  result = 0;
  if ( v1 < 0x18 )
  {
    v3 = (*a1 >> 11) + dword_80194F4C;
    if ( v3 >= 0x18 )
      return 0;
    else
      return byte_80194F60[24 * v1 + v3];
  }
  return result;
}
// 80194F4C: using guessed type int dword_80194F4C;
// 80194F50: using guessed type int dword_80194F50;
// 80194F60: using guessed type _BYTE byte_80194F60[576];

//----- (80034B44) --------------------------------------------------------
int __fastcall sub_80034B44(int *a1, int a2)
{
  unsigned __int8 v2; // $t1
  int v3; // $t0
  int v4; // $a2
  int v5; // $t4
  int v6; // $t2
  _BYTE *v7; // $a3
  int v8; // $v1
  int v9; // $a1
  _BYTE *v10; // $a0

  v2 = 0;
  v3 = 2 * a2;
  v4 = (a1[2] >> 11) + dword_80194F50 - a2;
  v5 = (*a1 >> 11) + dword_80194F4C - a2;
  v6 = 2 * a2;
  v7 = &byte_80194F60[24 * v4];
  do
  {
    if ( v4 >= 0 && v4 < 0x18 )
    {
      v8 = v5;
      v9 = v6;
      v10 = &v7[v5];
      do
      {
        --v9;
        if ( v8 >= 0 && v8 < 0x18 )
          v2 |= *v10;
        ++v10;
        ++v8;
      }
      while ( v9 != -1 );
    }
    v7 += 24;
    --v3;
    ++v4;
  }
  while ( v3 != -1 );
  return v2;
}
// 80194F4C: using guessed type int dword_80194F4C;
// 80194F50: using guessed type int dword_80194F50;
// 80194F60: using guessed type _BYTE byte_80194F60[576];

//----- (80034C04) --------------------------------------------------------
BOOL __fastcall sub_80034C04(int *a1, int a2, int a3)
{
  int v3; // $a3
  BOOL result; // $v0
  int v5; // $a0

  v3 = a1[2] >> 11;
  result = 0;
  if ( dword_80194F48 >= v3 - a3 && v3 + a3 >= dword_80194F48 )
  {
    v5 = *a1 >> 11;
    if ( dword_80194F44 >= v5 - a2 )
      return v5 + a2 >= dword_80194F44;
  }
  return result;
}
// 80194F44: using guessed type int dword_80194F44;
// 80194F48: using guessed type int dword_80194F48;

//----- (80034C68) --------------------------------------------------------
unsigned __int8 *__fastcall sub_80034C68(unsigned __int16 a1, unsigned __int16 fileID, int slot)
{
  int size; // $v0
  unsigned __int8 *result; // $v0
  unsigned __int8 *v8; // $s0

  size = TGetFileSize(a1, fileID);
  result = FMOAllocateBuffer(g_ResourceBuffer, size, &g_PrimitiveTypeTable[slot]);
  v8 = result;
  if ( result )
  {
    MO_Something01Set(result, 3);
    MO_Something02Set(v8, slot);
    return TLoadFileASync1(a1, fileID, v8, MOLoadedCallback);
  }
  return result;
}
// 80190254: using guessed type _DWORD g_PrimitiveTypeTable[385];

//----- (80034D08) --------------------------------------------------------
BOOL __fastcall sub_80034D08(unsigned __int16 a1, int a2, int a3, int a4, unsigned __int8 *a5)
{
  int v7; // $s0
  int v8; // $s3
  BOOL result; // $v0
  int v11; // $v1
  _WORD *v12; // $a0

  v7 = a2;
  v8 = a4 + a2;
  result = a2 < a4 + a2;
  if ( a2 < a4 + a2 )
  {
    while ( 1 )
    {
      v11 = *a5;
      v12 = *(&unk_8019A658 + 2 * a3);
      ++a5;
      if ( !v11 )
        break;
      if ( v12 )
      {
        if ( *v12 == 2 )
          *v12 = 1;
LABEL_10:
        ++v7;
        goto LABEL_11;
      }
      StartAudioStream(a1, v7++, a3);
LABEL_11:
      result = v7 < v8;
      ++a3;
      if ( v7 >= v8 )
        return result;
    }
    if ( v12 && *v12 == 1 )
      *v12 = 2;
    goto LABEL_10;
  }
  return result;
}

//----- (80034DFC) --------------------------------------------------------
BOOL __fastcall sub_80034DFC(unsigned __int16 a1, int a2, int a3, int a4, unsigned __int8 *a5)
{
  int v6; // $s3
  int v7; // $s1
  int v8; // $s5
  BOOL result; // $v0
  int *v11; // $s2
  int v13; // $s0
  char v14; // $v0
  int v15; // $a0
  char v16; // $a1
  int v17; // $s0
  char v18; // $v0

  v6 = a3;
  v7 = a2;
  v8 = a4 + a2;
  result = a2 < a4 + a2;
  if ( a2 < a4 + a2 )
  {
    v11 = &g_PrimitiveTypeTable[a3];
    while ( *a5++ )
    {
      v13 = *v11;
      if ( *v11 )
      {
        v14 = sub_80017BA4(*v11);
        v15 = v13;
        if ( v14 == 1 )
        {
          v16 = 2;
          goto LABEL_11;
        }
        goto LABEL_12;
      }
      sub_80034C68(a1, v7++, v6);
LABEL_13:
      ++v11;
      result = v7 < v8;
      ++v6;
      if ( v7 >= v8 )
        return result;
    }
    v17 = *v11;
    if ( *v11 )
    {
      v18 = sub_80017BA4(*v11);
      v15 = v17;
      if ( v18 != 3 )
      {
        v16 = 1;
LABEL_11:
        MO_Something01Set(v15, v16);
      }
    }
LABEL_12:
    ++v7;
    goto LABEL_13;
  }
  return result;
}
// 80190254: using guessed type _DWORD g_PrimitiveTypeTable[385];

//----- (80034F14) --------------------------------------------------------
int sub_80034F14()
{
  Entity **v0; // $s2
  int v1; // $s6
  unsigned __int8 *v2; // $s0
  int *v3; // $s3
  int v4; // $s1
  int *v5; // $a2
  EntityDefinition **v6; // $v0
  int v7; // $s5
  Entity **v8; // $s3
  int v9; // $s6
  Entity **v10; // $s0
  int *v11; // $s4
  char v12; // $a0
  int v13; // $v1
  int v14; // $v1
  bool v15; // dc
  int v16; // $v1
  int v17; // $v1
  int v18; // $v0
  int v19; // $a0
  int v20; // $a0
  int v21; // $a1
  char *v22; // $v0
  char *v23; // $v1
  int v24; // $v1
  int v25; // $a1
  int v26; // $a1
  int v27; // $v0
  BOOL v28; // $v0
  Entity *v29; // $v0
  int v30; // $v1
  int v31; // $a0
  unsigned __int8 v32; // $s2
  _DWORD *v33; // $s1
  unsigned __int8 v34; // $v1
  unsigned __int8 *v35; // $s4
  int v36; // $s6
  char *v37; // $s0
  int *v38; // $s3
  __int16 *v39; // $s2
  __int16 *v40; // $s5
  int *v41; // $s1
  int v42; // $v1
  int *v43; // $s2
  int v44; // $s6
  _BYTE *v45; // $s0
  int v46; // $v0
  int v47; // $a0
  unsigned int v48; // $v1
  __int16 v50; // [sp+38h] [-2A0h] BYREF
  __int16 v51; // [sp+3Ah] [-29Eh]
  __int16 v52; // [sp+3Ch] [-29Ch]
  int v53[4]; // [sp+48h] [-290h] BYREF
  _DWORD v54[80]; // [sp+58h] [-280h] BYREF
  char v55[320]; // [sp+198h] [-140h] BYREF

  memset_0(v54, 0, 32);
  memset_0(v55, 0, 16);
  v0 = g_ObjectArray;
  v1 = 199;
  v2 = g_ObjectArray + 3;
  v3 = &unk_8016E634;
  do
  {
    if ( v2[6] != 1 )
      goto LABEL_14;
    if ( (*(v2 + 37) & 0x2000) != 0 )
      v4 = *v2 | 0x20;
    else
      v4 = *v2;
    if ( (*(v2 + 37) & 0x80000) != 0 )
    {
      if ( (sub_80034B44(v3, 3) & *v2) == 0 )
        goto LABEL_14;
    }
    else if ( (sub_80034AD4(v3) & v4) == 0 )
    {
      goto LABEL_14;
    }
    if ( sub_80034A2C(*(v2 - 2) + 128) )
    {
      v5 = sub_8003EBC0(v0, v53);
      if ( (*(v2 + 37) & 0x20) != 0 )
      {
        v52 = 0;
        v51 = 0;
        v50 = 0;
        sub_80034304(
          *v2,
          *(v2 - 2) + 128,
          v3,
          &v50,
          v0 + 36,
          v0 + 23,
          dword_800679F4,
          v2[9],
          *(v2 + 21),
          v2[17],
          *(v2 + 19),
          v2[16],
          v2[18]);
      }
      else
      {
        v50 = *(v2 + 61);
        v51 = *(v2 + 63) + 2048;
        v52 = *(v2 + 0x41);
        sub_80034304(
          *v2,
          *(v2 - 2) + 128,
          v5,
          &v50,
          v0 + 36,
          v0 + 23,
          word_80194ECC,
          v2[9],
          *(v2 + 21),
          v2[17],
          *(v2 + 19),
          v2[16],
          v2[18]);
      }
    }
    v6 = &g_ObjectTypeTable[30 * *(v2 - 1)];
    v55[*(v6 + 7)] = 1;
    v55[*(v6 + 8)] = 1;
    *(v54 + *(v2 - 2)) = 1;
LABEL_14:
    v2 += 124;
    v3 += 31;
    --v1;
    v0 += 31;
  }
  while ( v1 != -1 );
  sub_80034DFC(0, 0, 128, 128, v54);
  sub_80034D08(4u, 32, 2, 64, v55);
  v7 = dword_801BA5B0;
  memset_0(v54, 0, 80);
  memset_0(v55, 0, 16);
  v8 = ObjectInstances;
  v9 = 395;
  v10 = &ObjectInstances[5];
  v11 = &ObjectInstances[13];
  do
  {
    if ( *(v10 - 7) != 255 )
    {
      v12 = *(v10 - 17);
      v13 = *(v10 - 16);
      *(v10 - 17) = v12 & 0x7F;
      if ( v13 == 31 )
      {
        if ( !sub_8003955C(*v10 >> 11, v10[2] >> 11, *(v10 + 36), *(v10 + 37), 0x8000) )
        {
          v10[11] = (v7 + 6 * *(v10 + 21));
          goto LABEL_57;
        }
        v14 = word_8019AA8C[5 * *(v10 + 38)];
        v15 = (v14 - 66) >= 0x40;
        v16 = v14 << 16;
        if ( !v15 )
          *(&v54[63] + (v16 >> 16) + 2) = 1;
        if ( v10[11] - v7 >= 0 )
          goto LABEL_57;
        v17 = *(v10 + 36);
        v10[11] = (v7 + 6 * *(v10 + 21));
        v18 = *v10 + 1024 * v17;
        v19 = *&g_LanguageID[0].header[2] - v18;
        if ( *&g_LanguageID[0].header[2] - v18 < 0 )
          v19 = v18 - *&g_LanguageID[0].header[2];
        v20 = (v17 << 10) - v19;
        v21 = *(v10 + 37) << 10;
        v22 = &v10[2]->active + v21;
        v23 = (*&g_LanguageID[0].menus[0].header.posY - v22);
        if ( *&g_LanguageID[0].menus[0].header.posY - v22 < 0 )
          v23 = &v22[-*&g_LanguageID[0].menus[0].header.posY];
        v24 = v21 - v23;
        if ( v24 < v20 )
          v20 = v24;
        v25 = *(v10 + 40) << 11;
        if ( v20 < v25 )
        {
          if ( !v25 )
            goto LABEL_57;
          v27 = *(v10 + 39) * v20;
          if ( v25 == -1 && v27 == 0x80000000 )
            _break(6u, 0);
          v26 = v27 / v25;
        }
        else
        {
          v26 = *(v10 + 39);
        }
        v28 = v26 < 20;
        if ( (*(v10 + 41) & 1) != 0 )
        {
          v29 = v10[1];
          v30 = *&g_LanguageID[0].header[6] - v29;
          if ( *&g_LanguageID[0].header[6] - v29 < 0 )
            v30 = v29 - *&g_LanguageID[0].header[6];
          v26 -= (*(v10 + 39) * v30) >> 13;
          v28 = v26 < 20;
        }
        if ( !v28 )
        {
          v31 = *(v10 + 38);
          v10 += 17;
          PlaySoundEffect(v31, v26);
          v11 += 17;
          goto LABEL_58;
        }
      }
      else if ( v13 == 240 )
      {
        if ( sub_80034C04(v10, *(v10 + 36), *(v10 + 37)) && (*v8 & byte_801B8AB8) != 0 )
        {
          if ( sub_80034A2C(*(v10 - 7) + 256) )
          {
            sub_80034824(
              *(v10 - 7) + 256,
              v8 + 18,
              v11,
              *(v10 - 19),
              *(v10 - 5),
              *(v10 + 40),
              *(v10 + 39),
              0x1FFF - *(v10 + 38));
            *(v10 - 17) |= 0x80u;
          }
          *(v54 + *(v10 - 7)) = 1;
        }
      }
      else if ( (v12 & 2) != 0 )
      {
        v33 = &GameDB01ObjectClassDeclaration[6 * *(v10 - 7)];
        v32 = sub_80034B44(v10, *(v33 + 12));
        if ( (v32 & *v8) != 0 )
          goto LABEL_51;
      }
      else
      {
        v32 = sub_80034AD4(v10);
        if ( (v32 & *v8) != 0 )
        {
          v33 = &GameDB01ObjectClassDeclaration[6 * *(v10 - 7)];
LABEL_51:
          *(v54 + *(v10 - 7)) = 1;
          v55[*(v33 + 2)] = 1;
          if ( sub_80034A2C(*(v10 - 7) + 256) )
          {
            v50 = *(v10 + 8);
            v51 = *(v10 + 9) + 2048;
            v52 = *(v10 + 10);
            v34 = *(v10 - 18);
            if ( (*(v10 - 17) & 1) != 0 )
            {
              v34 = -1;
              if ( (v32 & 0x80) != 0 )
                v34 = -2;
            }
            sub_80034304(
              *v8,
              *(v10 - 7) + 256,
              v10,
              &v50,
              v8 + 22,
              v11,
              word_80194ECC,
              *(v10 - 19),
              *(v10 - 5),
              *(v10 - 15),
              *(v10 - 2),
              v34,
              *(v10 - 3));
            *(v10 - 17) |= 0x80u;
          }
        }
      }
    }
LABEL_57:
    v10 += 17;
    v11 += 17;
LABEL_58:
    --v9;
    v8 += 17;
  }
  while ( v9 != -1 );
  sub_80034DFC(0, 128, 256, 320, v54);
  sub_80034D08(4u, 96, 66, 64, v55);
  v35 = &g_ParticleArray;
  v36 = 127;
  v37 = &unk_8019ED89;
  v38 = &unk_8019EDBC;
  v39 = &unk_8019EDAC;
  v40 = &unk_8019EDA4;
  v41 = &unk_8019ED94;
  while ( 2 )
  {
    if ( *v35 == 255 || (*(v37 - 1) & 3) == 0 || (*(v37 - 1) & 3) != 2 && (sub_80034AD4(v41) & v37[1]) == 0 )
      goto LABEL_75;
    v42 = *(v37 - 1) & 0xC;
    if ( v42 == 4 )
    {
      sub_80034304(
        v37[1],
        *(v37 - 6) + 40,
        v41,
        v40,
        v39,
        v38,
        dword_800679F4,
        *(v37 - 5),
        *(v37 + 9),
        v37[3],
        *(v37 + 7),
        *v37,
        -60);
      goto LABEL_75;
    }
    if ( (*(v37 - 1) & 0xCu) >= 5 )
    {
      if ( v42 == 8 )
      {
        sub_80034304(
          v37[1],
          *(v37 - 6) + 40,
          v41,
          v40,
          v39,
          v38,
          dword_80194EEC,
          *(v37 - 5),
          *(v37 + 9),
          v37[3],
          *(v37 + 7),
          *v37,
          -60);
        goto LABEL_75;
      }
      if ( v42 == 12 )
      {
        sub_80034304(
          v37[1],
          *(v37 - 6) + 40,
          v41,
          v40,
          v39,
          v38,
          0,
          *(v37 - 5),
          *(v37 + 9),
          v37[3],
          *(v37 + 7),
          *v37,
          20);
        goto LABEL_75;
      }
      v37 += 72;
    }
    else
    {
      if ( (*(v37 - 1) & 0xC) != 0 )
      {
        v37 += 72;
        goto LABEL_76;
      }
      v50 = *(v37 + 27);
      v51 = *(v37 + 29) + 2048;
      v52 = *(v37 + 31);
      sub_80034304(
        v37[1],
        *(v37 - 6) + 40,
        v41,
        &v50,
        v39,
        v38,
        word_80194ECC,
        *(v37 - 5),
        *(v37 + 9),
        v37[3],
        *(v37 + 7),
        *v37,
        -60);
LABEL_75:
      v37 += 72;
    }
LABEL_76:
    v38 += 18;
    v39 += 36;
    v40 += 36;
    v41 += 18;
    --v36;
    v35 += 72;
    if ( v36 != -1 )
      continue;
    break;
  }
  v43 = &unk_80197228;
  v44 = 127;
  v45 = &unk_8019722D;
  v52 = 0;
  v51 = 0;
  v50 = 0;
  do
  {
    if ( *v43 != 0xFFFF )
    {
      v46 = sub_80034AD4(v43 + 2);
      v47 = *(v45 - 3);
      if ( (v46 & v47) != 0 )
        sub_80034304(v47, *v43 + 40, v43 + 2, &v50, 0, 0, dword_80194EEC, *v45 + 128, 0, 0x46u, 4096, 1u, 0);
      if ( *(v45 - 1) )
      {
        if ( !(dword_80197224 % *(v45 - 1)) )
        {
          v48 = *(v45 - 2);
          if ( ++*v45 >= v48 )
            *v45 = 0;
        }
      }
    }
    v45 += 24;
    --v44;
    v43 += 6;
  }
  while ( v44 != -1 );
  return ++dword_80197224;
}
// 8003543C: conditional instruction was optimized away because $a1.4!=0
// 80035A24: conditional instruction was optimized away because $v1.4 is in (1..FF)
// 800679F4: using guessed type int dword_800679F4[2];
// 801779F0: using guessed type _DWORD GameDB01ObjectClassDeclaration[];
// 80194ECC: using guessed type _WORD word_80194ECC[16];
// 80194EEC: using guessed type int dword_80194EEC[16];
// 80197224: using guessed type int dword_80197224;
// 8019AA8C: using guessed type __int16 word_8019AA8C[1180];
// 801B8AB8: using guessed type char byte_801B8AB8;
// 801BA5B0: using guessed type int dword_801BA5B0;
// 80034F14: using guessed type unsigned __int8 var_140[320];
// 80034F14: using guessed type int var_290[4];

//----- (80035ADC) --------------------------------------------------------
unsigned int __fastcall sub_80035ADC(int a1, __int16 a2, _BYTE *a3)
{
  int v4; // $a1
  unsigned int result; // $v0
  __int16 v6; // $v0
  __int16 v7; // $v0
  __int16 v8; // $v0
  __int16 v9; // $v0

  v4 = *(g_GpuCmdBufferMirror + 8);
  *(g_GpuCmdBufferMirror + 8) = v4 + 40;
  result = 9;
  if ( *(g_GpuCmdBufferMirror + 4) >= *(g_GpuCmdBufferMirror + 8) )
  {
    *(v4 + 3) = 9;
    *(v4 + 7) = 46;
    v6 = *(a1 + 6);
    *(v4 + 24) = v6;
    *(v4 + 8) = v6;
    v7 = *(a1 + 6) + *(a1 + 10);
    *(v4 + 32) = v7;
    *(v4 + 16) = v7;
    v8 = *(a1 + 8);
    *(v4 + 18) = v8;
    *(v4 + 10) = v8;
    v9 = *(a1 + 8) + *(a1 + 12);
    *(v4 + 34) = v9;
    *(v4 + 26) = v9;
    *(v4 + 14) = *(a1 + 14);
    *(v4 + 22) = a2 | *(a1 + 16);
    LOBYTE(v9) = *(a1 + 1);
    *(v4 + 28) = v9;
    *(v4 + 12) = v9;
    LOBYTE(v9) = *(a1 + 1) + *(a1 + 3);
    *(v4 + 36) = v9;
    *(v4 + 20) = v9;
    LOBYTE(v9) = *(a1 + 2);
    *(v4 + 21) = v9;
    *(v4 + 13) = v9;
    LOBYTE(v9) = *(a1 + 2) + *(a1 + 4);
    *(v4 + 37) = v9;
    *(v4 + 29) = v9;
    *(v4 + 4) = *a3;
    *(v4 + 5) = a3[1];
    *(v4 + 6) = a3[2];
    return GPU_Cmd_MergeParams((g_GpuCommandBuffer + 4), v4);
  }
  return result;
}
// 80180158: using guessed type int g_GpuCmdBufferMirror;
// 8019015C: using guessed type int g_GpuCommandBuffer;

//----- (80035C30) --------------------------------------------------------
int UpdateStatusEffects()
{
  char *v0; // $s0
  int result; // $v0
  char v2[8]; // [sp+10h] [-8h] BYREF

  v0 = &byte_8006E238;
  v2[2] = byte_80194DF8;
  v2[1] = byte_80194DF8;
  v2[0] = byte_80194DF8;
  do
  {
    if ( *v0 )
    {
      sub_80035ADC(v0, 32, v2);
      sub_80035ADC(v0, 64, v2);
    }
    v0 += 18;
    result = *v0;
  }
  while ( result != 255 );
  return result;
}
// 8006E238: using guessed type char byte_8006E238;
// 80194DF8: using guessed type char byte_80194DF8;

//----- (80035CC4) --------------------------------------------------------
int __fastcall MessageQueuePush(int a1, __int16 a2)
{
  int result; // $v0

  if ( a1 < 240 )
  {
    result = 255;
    if ( byte_80194DDC[byte_80194DF5] == 255 )
    {
      byte_80194DDC[byte_80194DF5] = a1;
      if ( a1 == 21 )
        word_80194DE4[byte_80194DF5] = a2;
      result = (byte_80194DF5 + 1) & 7;
      byte_80194DF5 = (byte_80194DF5 + 1) & 7;
    }
  }
  return result;
}
// 80194DDC: using guessed type unsigned __int8 byte_80194DDC[8];
// 80194DE4: using guessed type _WORD word_80194DE4[8];
// 80194DF5: using guessed type char byte_80194DF5;

//----- (80035D64) --------------------------------------------------------
int __fastcall sub_80035D64(int a1, int a2)
{
  int result; // $v0

  result = 15 * a2;
  *(a1 + 2) = 15 * a2;
  return result;
}

//----- (80035D74) --------------------------------------------------------
// write access to const memory has been detected, the output may be wrong!
int sub_80035D74()
{
  int result; // $v0
  unsigned int v1; // $a0
  int v2; // $v1
  char v3[24]; // [sp+18h] [-18h] BYREF

  if ( byte_80194DF6[0] == 1 )
  {
    byte_80194DF8 += 20;
    result = 2;
    if ( byte_80194DF8 >= 0x64u )
      byte_80194DF6[0] = 2;
  }
  else if ( byte_80194DF6[0] >= 2u )
  {
    result = 3;
    if ( byte_80194DF6[0] == 2 )
    {
      --byte_80194DF7;
      result = 3;
      if ( !byte_80194DF7 )
        byte_80194DF6[0] = 3;
    }
    else if ( byte_80194DF6[0] == 3 )
    {
      byte_80194DF8 -= 20;
      result = byte_80194DF8;
      if ( !byte_80194DF8 )
      {
        byte_8006E292 = 0;
        byte_8006E280 = 0;
        byte_8006E26E = 0;
        byte_8006E25C = 0;
        byte_8006E24A = 0;
        byte_8006E238 = 0;
        v2 = byte_80194DDC[byte_80194DF4];
        do
        {
          byte_80194DDC[byte_80194DF4] = -1;
          byte_80194DF4 = (byte_80194DF4 + 1) & 7;
          result = byte_80194DDC[byte_80194DF4];
        }
        while ( v2 == result && v2 != 21 );
        byte_80194DF6[0] = 0;
      }
    }
  }
  else
  {
    result = 255;
    if ( !byte_80194DF6[0] )
    {
      v1 = byte_80194DDC[byte_80194DF4];
      if ( v1 != 255 )
      {
        byte_80194DF6[0] = 1;
        byte_80194DF7 = 15;
        byte_80194DF8 = 0;
        if ( v1 == 21 )
        {
          byte_8006E238 = 0;
          byte_8006E24B = 0x80;
          byte_8006E24C = 42;
          byte_8006E24A = 1;
          FormatNumberForUI(*&byte_80194DF6[2 * byte_80194DF4 - 18], 4, 0, 0, v3);
          byte_8006E25C = 1;
          sub_80035D64(&byte_8006E25C, v3[3]);
          byte_8006E26E = 1;
          sub_80035D64(&byte_8006E26E, v3[2]);
          byte_8006E280 = 1;
          sub_80035D64(&byte_8006E280, v3[1]);
          byte_8006E292 = 1;
          return sub_80035D64(&byte_8006E292, v3[0]);
        }
        else
        {
          byte_8006E238 = 1;
          byte_8006E292 = 0;
          byte_8006E280 = 0;
          byte_8006E26E = 0;
          byte_8006E25C = 0;
          byte_8006E24A = 0;
          result = v1 % 0x12;
          byte_8006E239 = (v1 / 0x12) << 7;
          byte_8006E23A = 14 * result;
        }
      }
    }
  }
  return result;
}
// 80035E30: write access to const memory at 8006E24B has been detected
// 80035E3C: write access to const memory at 8006E24C has been detected
// 80035E4C: write access to const memory at 8006E24A has been detected
// 80035EBC: write access to const memory at 8006E238 has been detected
// 80035EC4: write access to const memory at 8006E292 has been detected
// 80035ECC: write access to const memory at 8006E280 has been detected
// 80035ED4: write access to const memory at 8006E26E has been detected
// 80035EDC: write access to const memory at 8006E25C has been detected
// 80035EE4: write access to const memory at 8006E24A has been detected
// 80035F0C: write access to const memory at 8006E239 has been detected
// 80035F20: write access to const memory at 8006E23A has been detected
// 80035FD0: write access to const memory at 8006E292 has been detected
// 80035FD8: write access to const memory at 8006E280 has been detected
// 80035FE0: write access to const memory at 8006E26E has been detected
// 80035FE8: write access to const memory at 8006E25C has been detected
// 80035FF0: write access to const memory at 8006E24A has been detected
// 80035FF8: write access to const memory at 8006E238 has been detected
// 80035E2C: write access to const memory at 8006E238 has been detected
// 80035EA8: write access to const memory at 8006E292 has been detected
// 80035E98: write access to const memory at 8006E280 has been detected
// 80035E88: write access to const memory at 8006E26E has been detected
// 80035E78: write access to const memory at 8006E25C has been detected
// 8006E238: using guessed type char byte_8006E238;
// 8006E239: using guessed type char byte_8006E239;
// 8006E23A: using guessed type char byte_8006E23A;
// 8006E24A: using guessed type char byte_8006E24A;
// 8006E24B: using guessed type char byte_8006E24B;
// 8006E24C: using guessed type char byte_8006E24C;
// 8006E25C: using guessed type char byte_8006E25C;
// 8006E26E: using guessed type char byte_8006E26E;
// 8006E280: using guessed type char byte_8006E280;
// 8006E292: using guessed type char byte_8006E292;
// 80194DDC: using guessed type unsigned __int8 byte_80194DDC[8];
// 80194DF4: using guessed type char byte_80194DF4;
// 80194DF7: using guessed type char byte_80194DF7;
// 80194DF8: using guessed type char byte_80194DF8;

//----- (800360A0) --------------------------------------------------------
// write access to const memory has been detected, the output may be wrong!
int __fastcall UpdatePlayerSystem(int *a1, int *a2)
{
  int v2; // $v0
  int v3; // $gp
  int v4; // $v1
  int v5; // $v0

  sub_80030044(a1, a2);
  sub_8002FA5C();
  sub_80035D74();
  sub_8002F1C8();
  sub_8002FE74();
  sub_800370FC();
  UpdateTileLighting();
  byte_8006E2B8 = g_Option_ShowCompass;
  byte_8006E48C = g_Option_ShowHPMP;
  byte_8006E468 = g_Option_ShowHPMP;
  byte_8006E444 = g_Option_ShowHPMP;
  byte_8006E420 = g_Option_ShowHPMP;
  byte_8006E3FC = g_Option_ShowHPMP;
  byte_8006E3D8 = g_Option_ShowHPMP;
  byte_8006E3B4 = g_Option_ShowHPMP;
  byte_8006E390 = g_Option_ShowHPMP;
  byte_8006E36C = g_Option_ShowHPMP;
  byte_8006E348 = g_Option_ShowHPMP;
  byte_8006E324 = g_Option_ShowHPMP;
  byte_8006E300 = g_Option_ShowHPMP;
  byte_8006E2DC = g_Option_ShowHPMP;
  v2 = sub_800157E4(0, SHIWORD(dword_80194F3C));
  v4 = v2 + *(v3 + 176);
  *(v3 + 176) = v4;
  v5 = v4 + 7;
  if ( v4 > 0 )
    goto LABEL_4;
  if ( v4 < 0 )
  {
    v5 = v4 - 7;
LABEL_4:
    *(v3 + 176) = v4 - (v5 >> 3);
  }
  word_8006E2D2 = *(v3 + 176) >> 6;
  word_8006E2D0 = dword_80194F3C;
  word_8006E328 = g_CurrentHP % 1000u / 100 + 3;//    UI  \   ? 
  word_8006E34C = (((1717986919LL * (g_CurrentHP % 1000u % 100)) >> 32) >> 2) + 3;
  word_8006E370 = (g_CurrentHP % 1000u) % 10 + 3;
  word_8006E394 = g_CurrentMP % 1000u / 100 + 3;
  word_8006E3B8 = (((1717986919LL * (g_CurrentMP % 1000u % 100)) >> 32) >> 2) + 3;
  word_8006E3DC = (g_CurrentMP % 1000u) % 10 + 3;
  word_8006E404 = ((358880595420LL * g_Stamina_8019B4DE) >> 32) >> 11;
  word_8006E428 = ((358880595420LL * g_MagicStamina_8019B4E2) >> 32) >> 11;
  UpdateCamera();
  UpdateStatusEffects();
  sub_80033A1C();
  sub_80034F14();
  sub_80033DB4();
  sub_80033E44();
  sub_80033ED4();
  sub_80033FBC();
  sub_8002FF0C();
  sub_80017CC8();
  return sub_800371F4();
}
// 80036100: write access to const memory at 8006E2B8 has been detected
// 80036108: write access to const memory at 8006E48C has been detected
// 80036110: write access to const memory at 8006E468 has been detected
// 80036118: write access to const memory at 8006E444 has been detected
// 80036120: write access to const memory at 8006E420 has been detected
// 80036128: write access to const memory at 8006E3FC has been detected
// 80036130: write access to const memory at 8006E3D8 has been detected
// 80036138: write access to const memory at 8006E3B4 has been detected
// 80036140: write access to const memory at 8006E390 has been detected
// 80036148: write access to const memory at 8006E36C has been detected
// 80036150: write access to const memory at 8006E348 has been detected
// 80036158: write access to const memory at 8006E324 has been detected
// 80036160: write access to const memory at 8006E300 has been detected
// 80036168: write access to const memory at 8006E2DC has been detected
// 80036310: write access to const memory at 8006E2D0 has been detected
// 8003633C: write access to const memory at 8006E328 has been detected
// 80036344: write access to const memory at 8006E34C has been detected
// 8003634C: write access to const memory at 8006E370 has been detected
// 80036354: write access to const memory at 8006E394 has been detected
// 80036378: write access to const memory at 8006E3B8 has been detected
// 800363A0: write access to const memory at 8006E3DC has been detected
// 800363A8: write access to const memory at 8006E404 has been detected
// 800363B8: write access to const memory at 8006E428 has been detected
// 800362F4: write access to const memory at 8006E2D2 has been detected
// 80036178: variable 'v3' is possibly undefined
// 8006E2B8: using guessed type char byte_8006E2B8;
// 8006E2D0: using guessed type __int16 word_8006E2D0;
// 8006E2D2: using guessed type __int16 word_8006E2D2;
// 8006E2DC: using guessed type char byte_8006E2DC;
// 8006E300: using guessed type char byte_8006E300;
// 8006E324: using guessed type char byte_8006E324;
// 8006E328: using guessed type __int16 word_8006E328;
// 8006E348: using guessed type char byte_8006E348;
// 8006E34C: using guessed type __int16 word_8006E34C;
// 8006E36C: using guessed type char byte_8006E36C;
// 8006E370: using guessed type __int16 word_8006E370;
// 8006E390: using guessed type char byte_8006E390;
// 8006E394: using guessed type __int16 word_8006E394;
// 8006E3B4: using guessed type char byte_8006E3B4;
// 8006E3B8: using guessed type __int16 word_8006E3B8;
// 8006E3D8: using guessed type char byte_8006E3D8;
// 8006E3DC: using guessed type __int16 word_8006E3DC;
// 8006E3FC: using guessed type char byte_8006E3FC;
// 8006E404: using guessed type __int16 word_8006E404;
// 8006E420: using guessed type char byte_8006E420;
// 8006E428: using guessed type __int16 word_8006E428;
// 8006E444: using guessed type char byte_8006E444;
// 8006E468: using guessed type char byte_8006E468;
// 8006E48C: using guessed type char byte_8006E48C;
// 80194F3C: using guessed type int dword_80194F3C;
// 8019B4D8: using guessed type __int16 g_CurrentHP;
// 8019B4DC: using guessed type __int16 g_CurrentMP;
// 8019B4DE: using guessed type __int16 g_Stamina_8019B4DE;
// 8019B4E2: using guessed type __int16 g_MagicStamina_8019B4E2;
// 8019B58D: using guessed type char g_Option_ShowHPMP;
// 8019B58E: using guessed type char g_Option_ShowCompass;

//----- (80036428) --------------------------------------------------------
int sub_80036428()
{
  int v0; // $v0

  SetBackColor(60, 60, 60);
  sub_8005DB9C(200);
  sub_8002FFA4(3u);
  sub_80030008(0);
  sub_8002FBC0(23000);
  v0 = sub_8002FFD4(0);
  sub_80030474(*(v0 + 4));
  return sub_80031034(0, 0);
}
// 8005DAD0: using guessed type int __fastcall SetBackColor(_DWORD, _DWORD, _DWORD);

//----- (80036490) --------------------------------------------------------
int __fastcall RegisterPrimitiveTypes(unsigned __int16 primitive_type, _WORD *a2)
{
  int *v3; // $s0
  int result; // $v0
  int v5; // $s1
  int v6; // $s2
  bool v7; // dc

  v3 = (a2 + 2);
  result = *a2;
  v5 = result - 1;
  if ( *a2 )
  {
    do
    {
      v6 = *v3;
      if ( *v3 >= 5 )
      {
        g_PrimitiveTypeTable[primitive_type] = v3;//   !
        GetPrimitiveBuffer(primitive_type);     //     a1
        ConvertVertexCoordinates(g_CurrentPrimitiveBuffer);
      }
      v3 = (v3 + v6);                           //  
      ++primitive_type;                         //  
      result = v5;
      v7 = v5 != 0;
      v5 += 0xFFFF;
    }
    while ( v7 );
  }
  return result;
}
// 80190250: using guessed type int g_CurrentPrimitiveBuffer;
// 80190254: using guessed type _DWORD g_PrimitiveTypeTable[385];

//----- (8003654C) --------------------------------------------------------
int __fastcall sub_8003654C(unsigned __int16 a1, int a2)
{
  g_PrimitiveTypeTable[a1] = a2;
  GetPrimitiveBuffer(a1);
  return ConvertVertexCoordinates(g_CurrentPrimitiveBuffer);
}
// 80190250: using guessed type int g_CurrentPrimitiveBuffer;
// 80190254: using guessed type _DWORD g_PrimitiveTypeTable[385];

//----- (80036594) --------------------------------------------------------
int __fastcall GetPrimitiveBuffer(unsigned __int16 a1)
{
  int result; // $v0

  result = g_PrimitiveTypeTable[a1] + *(g_PrimitiveTypeTable[a1] + 8);
  g_CurrentPrimitiveBuffer = result;            // //      
  return result;
}
// 80190250: using guessed type int g_CurrentPrimitiveBuffer;
// 80190254: using guessed type _DWORD g_PrimitiveTypeTable[385];

//----- (800365CC) --------------------------------------------------------
_WORD *__fastcall sub_800365CC(int a1, int a2, int a3, _DWORD *a4, int *a5)
{
  _WORD *v5; // $t4
  int v6; // $t2
  int v7; // $t0
  _WORD *v8; // $v0
  _DWORD *v9; // $t1
  int v10; // $v1
  int v11; // $t3
  unsigned int v12; // $a1
  unsigned int v13; // $v0
  int v14; // $lo
  int v15; // $a0
  _WORD *result; // $v0

  v6 = 0;
  v7 = 0;
  v8 = (a1 + *(4 * a2 + a1 + *(a1 + 16)));
  v9 = v8 + 2;
  v10 = *v8 - 1;
  v11 = 0;
  if ( *v8 )
  {
    while ( 1 )
    {
      v5 = (a1 + *v9);
      v12 = v5[1];
      v7 += v12;
      ++v9;
      if ( a3 < v7 )
        break;
      v11 = v7;
      --v10;
      ++v6;
      if ( v10 == -1 )
        goto LABEL_8;
    }
    v13 = (a3 - v11) << 12;
    if ( !v5[1] )
      _break(7u, 0);
    v14 = v13 / v12;
    v15 = v13 / v12;
    result = v5;
    if ( *v5 )
      v15 = 4096 - v14;
  }
  else
  {
LABEL_8:
    --v6;
    v15 = 4096;
    result = v5;
  }
  *a4 = v6;
  *a5 = v15;
  return result;
}
// 80036680: variable 'v5' is possibly undefined

//----- (80036690) --------------------------------------------------------
int __fastcall sub_80036690(_WORD *a1, _WORD *a2, __int16 *a3)
{
  int result; // $v0
  int v4; // $t1
  __int16 *v5; // $a2
  __int16 v6; // $v1
  __int16 *v7; // $a2
  int v8; // $v1
  unsigned __int16 *v9; // $t0
  _WORD *v10; // $a3
  __int16 v11; // $v0
  __int16 v12; // $v0
  unsigned __int16 *v13; // $a2

  result = -1;
  v4 = *a3 - 1;
  v5 = a3 + 1;
  while ( v4 != -1 )
  {
    v6 = *v5;
    result = v6;
    v7 = v5 + 1;
    if ( v6 == -32768 )
    {
      v8 = *v7 - 1;
      v5 = v7 + 1;
      if ( v8 != -1 )
      {
        v9 = a2 + 2;
        v10 = a1 + 2;
        do
        {
          v11 = *a2;
          a2 += 4;
          --v8;
          *a1 = v11;
          a1 += 4;
          *(v10 - 1) = *(v9 - 1);
          result = *v9;
          v9 += 4;
          *v10 = result;
          v10 += 4;
        }
        while ( v8 != -1 );
        --v4;
        continue;
      }
    }
    else
    {
      *a1 = v6;
      v12 = *v7;
      v13 = (v7 + 1);
      a2 += 4;
      a1[1] = v12;
      result = *v13;
      v5 = (v13 + 1);
      a1[2] = result;
      a1 += 4;
    }
    --v4;
  }
  return result;
}

//----- (80036754) --------------------------------------------------------
int __fastcall sub_80036754(_WORD *a1, __int16 *a2)
{
  int result; // $v0
  int v3; // $a2
  __int16 *i; // $a1
  __int16 v5; // $v1
  __int16 *v6; // $a1
  int v7; // $v0
  __int16 v8; // $v0
  unsigned __int16 *v9; // $a1

  result = -1;
  v3 = *a2 - 1;
  for ( i = a2 + 1; v3 != -1; --v3 )
  {
    v5 = *i;
    v6 = i + 1;
    if ( v5 == -32768 )
    {
      v7 = *v6;
      i = v6 + 1;
      result = 8 * v7;
      a1 = (a1 + result);
    }
    else
    {
      *a1 = v5;
      v8 = *v6;
      v9 = (v6 + 1);
      a1[1] = v8;
      result = *v9;
      i = (v9 + 1);
      a1[2] = result;
      a1 += 4;
    }
  }
  return result;
}

//----- (800367D0) --------------------------------------------------------
int __fastcall sub_800367D0(_WORD *a1, __int16 *a2, int a3)
{
  _WORD *v3; // $s3
  __int16 *v4; // $s2
  int v5; // $s1
  _WORD *v6; // $s0
  int result; // $v0
  int v8; // $s4
  __int16 *v9; // $a0
  __int16 v10; // $a1
  __int16 *v11; // $s2
  int v12; // $v0
  int v13; // $s1
  __int16 *v14; // $a0
  _WORD *v15; // $a1
  __int16 v16; // $v1
  __int16 *v17; // $a0
  __int16 v18; // $v1
  __int16 v19; // $v1
  _WORD *v20; // $a0
  __int16 v21; // $v0
  __int16 *v22; // $s2
  __int16 v23; // $v0
  __int16 v24; // $v1
  int v25; // $s1
  __int16 *v26; // $a0
  _WORD *v27; // $a1
  __int16 v28; // $v1
  unsigned __int16 *v29; // $a0
  __int16 v30; // $v1
  int v31; // $v1
  __int16 v32[16]; // [sp+10h] [-30h] BYREF
  int v33[4]; // [sp+30h] [-10h] BYREF

  v3 = a1;
  v33[2] = a3;
  v33[1] = a3;
  v33[0] = a3;
  v4 = a2 + 1;
  v5 = 0;
  v6 = a1;
  result = -1;
  v8 = *a2 - 1;
  v9 = v32;
  if ( *a2 )
  {
    do
    {
      v10 = *v4;
      v11 = v4 + 1;
      if ( v10 == -32768 )
      {
        v12 = *v11;
        v4 = v11 + 1;
        v3 += 4 * v12;
        if ( v5 )
        {
          ScaleMatrix(v32, v33);
          v13 = v5 - 1;
          v14 = v32;
          if ( v13 != -1 )
          {
            v15 = v6 + 2;
            do
            {
              v16 = *v14;
              v17 = v14 + 1;
              --v13;
              *v6 += v16;
              v18 = *v17++;
              v6 += 4;
              *(v15 - 1) += v18;
              v19 = *v17;
              v14 = v17 + 1;
              *v15 += v19;
              v15 += 4;
            }
            while ( v13 != -1 );
          }
          v5 = 0;
          v9 = v32;
        }
      }
      else
      {
        *v9 = v10 - *v3;
        v20 = v9 + 1;
        v21 = *v11;
        v22 = v11 + 1;
        *v20++ = v21 - v3[1];
        v23 = *v22;
        v4 = v22 + 1;
        v24 = v3[2];
        v3 += 4;
        *v20 = v23 - v24;
        v9 = v20 + 1;
        if ( v5 != 2 )
        {
          ++v5;
          goto LABEL_12;
        }
        ScaleMatrix(v32, v33);
        *v6 += v32[0];
        v6[1] += v32[1];
        v6[2] += v32[2];
        v6[4] += v32[3];
        v6[5] += v32[4];
        v6[6] += v32[5];
        v6[8] += v32[6];
        v5 = 0;
        v6[9] += v32[7];
        v9 = v32;
        v6[10] += v32[8];
      }
      v6 = v3;
LABEL_12:
      --v8;
      result = -1;
    }
    while ( v8 != -1 );
  }
  if ( v5 )
  {
    ScaleMatrix(v32, v33);
    v25 = v5 - 1;
    result = -1;
    v26 = v32;
    if ( v25 != -1 )
    {
      v27 = v6 + 2;
      do
      {
        v28 = *v26;
        v29 = (v26 + 1);
        --v25;
        *v6 += v28;
        v30 = *v29++;
        v6 += 4;
        *(v27 - 1) += v30;
        v31 = *v29;
        v26 = (v29 + 1);
        result = *v27 + v31;
        *v27 = result;
        v27 += 4;
      }
      while ( v25 != -1 );
    }
  }
  return result;
}
// 8005DFD4: using guessed type int __fastcall ScaleMatrix(_DWORD, _DWORD);

//----- (80036A8C) --------------------------------------------------------
__int16 *__fastcall sub_80036A8C(__int16 *a1, int a2)
{
  int v2; // $v1
  int v3; // $a2
  __int16 *i; // $a0
  __int16 *v5; // $a0
  __int16 *result; // $v0

  v2 = 0;
  v3 = *a1 - 1;
  for ( i = a1 + 1; v3 != -1; --v3 )
  {
    if ( *i == -32768 )
    {
      v5 = i + 1;
      v2 += *v5;
      i = v5 + 1;
      if ( a2 < v2 )
        return 0;
    }
    else
    {
      result = i;
      if ( v2 == a2 )
        return result;
      ++v2;
      i += 3;
    }
  }
  return 0;
}

//----- (80036B08) --------------------------------------------------------
int __fastcall SubmitDisplayListToGPU(int *a1, int a2, int a3, int a4, int a5)
{
  unsigned __int16 v6; // $s0
  int *v8; // $at
  int v9; // $s3
  ResourceHandle *v10; // $s1
  int result; // $v0
  int Memor_0; // $v0
  int v14; // $a0
  unsigned __int16 *v15; // $s5
  int v16; // $a0
  int v17; // $s4
  unsigned __int16 *v18; // $s2
  __int16 v19; // $s0
  int v20; // $v0
  int v21; // $a1
  int *v22; // $a0
  _DWORD *Data; // $v1
  int v24; // $v0
  int *v25; // $a0
  _DWORD *v26; // $v1
  int v27; // $v0
  _DWORD *v28; // $a1
  int *v29; // $v1
  __int16 v30; // $v0
  int v31; // $v0
  int *v32; // $v1
  _DWORD *v33; // $a1
  int v34; // $v0
  int v35; // [sp+18h] [-8h] BYREF
  int v36; // [sp+1Ch] [-4h] BYREF

  v6 = a2;
  v8 = &g_PrimitiveTypeTable[a2];
  v9 = *v8;
  v10 = *a1;
  if ( !*(*v8 + 4) )
  {
    if ( v10 )
      Resource_UnlinkAndFree(*a1);
    GetPrimitiveBuffer(v6);
    sub_80030008(0);
    return 1;
  }
  if ( !v10 )
  {
    v10 = sub_80037264();
    result = 0;
    if ( !v10 )
      return result;
    goto LABEL_7;
  }
  v14 = *v8;
  if ( *v10->gap2 != a2 )
  {
    Resource_UnlinkAndFree(v10);
    *&v10->gap2[2] = 255;
LABEL_7:
    *v10->gap2 = v6;
    v10->Owner = a1;
    while ( 1 )
    {
      Memor_0 = AllocateMemor_0();
      v10->Data = Memor_0;
      if ( Memor_0 )
        break;
      sub_80037184();
    }
    *a1 = v10;
    v14 = v9;
  }
  v15 = sub_800365CC(v14, a3, a4, &v35, &v36);
  if ( *&v10->gap2[2] != a3 || (v16 = a5, *&v10->gap2[4] != v35) )
  {
    sub_80030008(0);
    v17 = v9 + *(v9 + 12);
    if ( v15[3] )
    {
      v18 = v15 + 5;
      v19 = v15[3] - 1;
      sub_80036690(v10->Data, dword_80190B54, (v9 + *(4 * v15[4] + v17)));
      while ( v19 )
      {
        v20 = *v18++;
        --v19;
        sub_80036754(v10->Data, (v9 + *(4 * v20 + v17)));
      }
    }
    else
    {
      v21 = a5;
      v22 = dword_80190B54;
      Data = v10->Data;
      do
      {
        v24 = *v22;
        v25 = v22 + 1;
        v21 += 0xFFFF;
        *Data = v24;
        v26 = Data + 1;
        v27 = *v25;
        v22 = v25 + 1;
        *v26 = v27;
        Data = v26 + 1;
      }
      while ( v21 );
    }
    *&v10->gap2[6] = *(4 * v15[2] + v17);
    v16 = a5;
  }
  v28 = word_80192B8C;
  v29 = v10->Data;
  v30 = v35;
  *&v10->gap2[2] = a3;
  *&v10->gap2[4] = v30;
  do
  {
    v31 = *v29;
    v32 = v29 + 1;
    v16 += 0xFFFF;
    *v28 = v31;
    v33 = v28 + 1;
    v34 = *v32;
    v29 = v32 + 1;
    *v33 = v34;
    v28 = v33 + 1;
  }
  while ( v16 );
  sub_800367D0(word_80192B8C, (v9 + *&v10->gap2[6]), v36);
  sub_8002FFF8(word_80192B8C);
  result = v10;
  v10->id = 2;
  return result;
}
// 80190254: using guessed type _DWORD g_PrimitiveTypeTable[385];
// 80190B54: using guessed type int dword_80190B54;
// 80192B8C: using guessed type _WORD word_80192B8C[4000];

//----- (80036DD8) --------------------------------------------------------
int __fastcall sub_80036DD8(unsigned __int16 a1, int a2, int a3, int a4, _WORD *a5)
{
  _DWORD *v8; // $s1
  int result; // $v0
  char *v10; // $a2
  char *v11; // $v0
  int v12; // $a0
  int v13; // $a1
  char *v14; // $s0
  _WORD *v15; // $v0
  char *v16; // $v1
  _WORD *v17; // $s4
  int v18; // $s0
  char *v19; // $s3
  unsigned __int16 *v20; // $s2
  int v21; // $v0
  __int16 *v22; // $v0
  __int16 *v23; // $v0
  int v24; // [sp+18h] [-28h]
  int v25; // [sp+1Ch] [-24h]
  int v26; // [sp+20h] [-20h] BYREF
  int v27[7]; // [sp+24h] [-1Ch] BYREF

  v8 = sub_80034A2C(a1);
  result = 1;
  if ( !v8 )
  {
    a5[2] = 0;
    a5[1] = 0;
    *a5 = 0;
    return result;
  }
  v10 = v8 + v8[2];
  if ( a2 < 128 )
  {
    if ( v8[1] )
    {
      v13 = a2;
      v14 = &v10[*(v10 + 3) + 12];
      v15 = sub_800365CC(v8, v13, a3, &v26, v27);
      v16 = &v14[8 * a4];
      v24 = *v16;
      v25 = *(v16 + 1);
      v17 = v15;
      v18 = v15[3] - 1;
      v19 = v8 + v8[3];
      v20 = v15 + 4;
      if ( v15[3] )
      {
        do
        {
          v21 = *v20++;
          v22 = sub_80036A8C((v8 + *&v19[4 * v21]), a4);
          --v18;
          if ( v22 )
          {
            v24 = *v22;
            LOWORD(v25) = v22[2];
          }
        }
        while ( v18 != -1 );
      }
      v23 = sub_80036A8C((v8 + *&v19[4 * v17[2]]), a4);
      if ( v23 )
      {
        LOWORD(v24) = (((*v23 - v24) * v27[0]) >> 12) + v24;
        HIWORD(v24) += ((v23[1] - SHIWORD(v24)) * v27[0]) >> 12;
        LOWORD(v25) = (((v23[2] - v25) * v27[0]) >> 12) + v25;
      }
      *a5 = v24;
      *(a5 + 1) = v25;
      return 0;
    }
    LOBYTE(a2) = 0;
  }
  v11 = &v10[8 * a4 + 12 + *&v10[28 * (a2 & 0x7F) + 12]];
  v12 = *(v11 + 1);
  *a5 = *v11;
  *(a5 + 1) = v12;
  *(a5 + 1) = v12;
  return 0;
}
// 80036DD8: using guessed type int var_1C[7];

//----- (8003706C) --------------------------------------------------------
int __fastcall sub_8003706C(int a1, int a2)
{
  _DWORD *v2; // $at
  int result; // $v0
  int v4; // $a0

  v2 = &g_PrimitiveTypeTable[a1];
  result = 0;
  if ( *v2 )
  {
    v4 = *v2 + *(*v2 + 8);
    if ( a2 >= 128 )
      return *(28 * (a2 & 0x7F) + v4 + 16);
    else
      return *(v4 + 16);
  }
  return result;
}
// 80190254: using guessed type _DWORD g_PrimitiveTypeTable[385];

//----- (800370CC) --------------------------------------------------------
int sub_800370CC()
{
  _DWORD *v0; // $v1
  int v1; // $a0
  int result; // $v0

  v0 = &unk_80190B58;
  v1 = 12;
  do
  {
    *v0 = 0;
    v0[3] = 0;
    v1 += 0xFFFF;
    result = v1;
    v0 += 5;
  }
  while ( v1 );
  return result;
}

//----- (800370FC) --------------------------------------------------------
int sub_800370FC()
{
  _WORD *v0; // $v1
  unsigned __int16 v1; // $a0
  int result; // $v0

  v0 = &unk_80190B58;
  v1 = 12;
  do
  {
    --v1;
    if ( *v0 )
      *v0 = 1;
    result = v1;
    v0 += 10;
  }
  while ( v1 );
  return result;
}

//----- (80037138) --------------------------------------------------------
_DWORD *__fastcall Resource_UnlinkAndFree(ResourceHandle *res)
{
  _DWORD *pOwnerPointer; // $v0
  int pData; // $a0

  pOwnerPointer = res->Owner;
  res->id = 0;
  *pOwnerPointer = 0;
  pData = res->Data;
  if ( pData )
  {
    pOwnerPointer = Mem_FreeBlock(pData);
    res->Data = 0;
  }
  return pOwnerPointer;
}

//----- (80037184) --------------------------------------------------------
int sub_80037184()
{
  ResourceHandle *v0; // $s0
  int v1; // $s1
  int result; // $v0

  v0 = &unk_80190B58;
  v1 = 11;
  do
  {
    result = v1 - 1;
    if ( v0->id )
    {
      Resource_UnlinkAndFree(v0);
      result = v1 - 1;
    }
    v1 = result;
    result = result;
    ++v0;
  }
  while ( result != -1 );
  return result;
}

//----- (800371F4) --------------------------------------------------------
int sub_800371F4()
{
  ResourceHandle *v0; // $s0
  unsigned __int16 v1; // $s1
  int result; // $v0

  v0 = &unk_80190B58;
  v1 = 12;
  do
  {
    --v1;
    if ( v0->id == 1 )
      Resource_UnlinkAndFree(v0);
    result = v1;
    ++v0;
  }
  while ( v1 );
  return result;
}

//----- (80037264) --------------------------------------------------------
_WORD *sub_80037264()
{
  _WORD *v0; // $v1
  __int16 v1; // $a0

  v0 = &unk_80190B58;
  v1 = 12;
  while ( 1 )
  {
    --v1;
    if ( !*v0 )
      break;
    v0 += 10;
    if ( !v1 )
      return 0;
  }
  v0[2] = 255;
  return v0;
}

//----- (800372AC) --------------------------------------------------------
int __fastcall sub_800372AC(_WORD *a1)
{
  _WORD *v1; // $s2
  _WORD *v2; // $s3
  int v3; // $s4
  __int16 *v4; // $s1
  char *v5; // $s0
  char v6; // $a0
  int v7; // $a0
  int result; // $v0

  v1 = a1;
  v2 = &unk_80197228;
  v3 = 127;
  v4 = a1 + 7;
  v5 = &unk_8019722D;
  do
  {
    if ( *v1 == 0xFFFF )
    {
      *v2 = -1;
    }
    else
    {
      *v2 = *v1;
      *(v5 - 3) = *(v4 - 10);
      v6 = *(v5 - 3);
      *(v5 - 2) = *(v4 - 12);
      *(v5 - 1) = *(v4 - 11);
      *(v5 + 3) = (*(v4 - 8) << 11) + *(v4 - 1);
      *(v5 + 11) = (*(v4 - 9) << 11) + *(v4 - 2);
      *(v5 + 7) = Map_GetCellData(v6, *(v5 + 3), *(v5 + 11), 0, 0) + *v4;
      *v5 = (rand(v7) * *(v5 - 2)) >> 15;
    }
    v5 += 24;
    v2 += 12;
    v4 += 8;
    --v3;
    result = -1;
    v1 += 8;
  }
  while ( v3 != -1 );
  return result;
}
// 80037370: variable 'v7' is possibly undefined
// 80062BF0: using guessed type int __fastcall rand(_DWORD);

//----- (800373DC) --------------------------------------------------------
int __fastcall ProcessTIMContainer(int a1)
{
  int result; // $v0
  char v2[4]; // [sp+10h] [-18h] BYREF
  int v3; // [sp+14h] [-14h]
  int v4; // [sp+18h] [-10h]
  int v5; // [sp+1Ch] [-Ch]
  int v6; // [sp+20h] [-8h]

  OpenTIM(a1);
  while ( 1 )
  {
    result = ReadTIM(v2);
    if ( !result )
      break;
    if ( v4 )
      SubmitCdDmaTransfer(v3, v4);
    if ( v6 )
      SubmitCdDmaTransfer(v5, v6);
  }
  return result;
}
// 800373DC: using guessed type char var_18[4];

//----- (8003744C) --------------------------------------------------------
int __fastcall sub_8003744C(int a1, int a2)
{
  int v3; // $s0
  int v4; // $s1
  int v5; // $s0
  int v6; // $s0
  int v7; // $s0
  int v8; // $v1
  int v11; // [sp+18h] [-8h]

  v11 = -1;
  while ( 1 )
  {
    sub_8002FE74();
    v3 = *(g_GpuCmdBufferMirror + 8);
    *(g_GpuCmdBufferMirror + 8) = v3 + 40;
    v4 = 128 - (a1 >> 1);
    if ( *(g_GpuCmdBufferMirror + 4) >= *(g_GpuCmdBufferMirror + 8) )
    {
      GPU_Cmd_SetBaseParams(v3);
      *(v3 + 8) = 0;
      *(v3 + 10) = 0;
      *(v3 + 16) = 192;
      *(v3 + 24) = 0;
      *(v3 + 26) = 240;
      *(v3 + 32) = 192;
      *(v3 + 34) = 240;
      *(v3 + 12) = 0;
      *(v3 + 13) = 0;
      *(v3 + 20) = 192;
      *(v3 + 28) = 0;
      *(v3 + 29) = -16;
      *(v3 + 36) = -64;
      *(v3 + 37) = -16;
      *(v3 + 14) = 0;
      *(v3 + 22) = GetTPage(2, 0, 320, 0);
      *(v3 + 4) = v4;
      *(v3 + 5) = v4;
      *(v3 + 6) = v4;
      GPU_Cmd_MergeParams((g_GpuCommandBuffer + 8), v3);
      v5 = *(g_GpuCmdBufferMirror + 8);
      *(g_GpuCmdBufferMirror + 8) = v5 + 40;
      if ( *(g_GpuCmdBufferMirror + 4) >= *(g_GpuCmdBufferMirror + 8) )
      {
        GPU_Cmd_SetBaseParams(v5);
        *(v5 + 20) = 0x80;
        *(v5 + 8) = 192;
        *(v5 + 16) = 320;
        *(v5 + 24) = 192;
        *(v5 + 26) = 240;
        *(v5 + 32) = 320;
        *(v5 + 34) = 240;
        *(v5 + 12) = 0;
        *(v5 + 13) = 0;
        *(v5 + 21) = 0;
        *(v5 + 28) = 0;
        *(v5 + 29) = -16;
        *(v5 + 36) = 0x80;
        *(v5 + 37) = -16;
        *(v5 + 14) = 0;
        *(v5 + 22) = GetTPage(2, 0, 512, 0);
        *(v5 + 4) = v4;
        *(v5 + 5) = v4;
        *(v5 + 6) = v4;
        GPU_Cmd_MergeParams((g_GpuCommandBuffer + 8), v5);
        v6 = *(g_GpuCmdBufferMirror + 8);
        *(g_GpuCmdBufferMirror + 8) = v6 + 40;
        if ( *(g_GpuCmdBufferMirror + 4) >= *(g_GpuCmdBufferMirror + 8) )
        {
          GPU_Cmd_SetBaseParams(v6);
          GPU_Cmd_SetBlendFlag(v6, 1);
          *(v6 + 8) = 32;
          *(v6 + 10) = 10;
          *(v6 + 16) = 287;
          *(v6 + 18) = 10;
          *(v6 + 24) = 32;
          *(v6 + 26) = 265;
          *(v6 + 32) = 287;
          *(v6 + 34) = 265;
          *(v6 + 12) = 0;
          *(v6 + 13) = 0;
          *(v6 + 20) = 255;
          *(v6 + 28) = 0;
          *(v6 + 29) = -1;
          *(v6 + 36) = -1;
          *(v6 + 37) = -1;
          *(v6 + 14) = sub_800670D8(576, 511);
          *(v6 + 22) = GetTPage(0, 1, 960, 256);
          *(v6 + 4) = a1;
          *(v6 + 5) = a1;
          *(v6 + 6) = a1;
          GPU_Cmd_MergeParams(g_GpuCommandBuffer, v6);
          v7 = *(g_GpuCmdBufferMirror + 8);
          *(g_GpuCmdBufferMirror + 8) = v7 + 40;
          if ( *(g_GpuCmdBufferMirror + 4) >= *(g_GpuCmdBufferMirror + 8) )
          {
            GPU_Cmd_SetBaseParams(v7);
            GPU_Cmd_SetBlendFlag(v7, 1);
            *(v7 + 8) = 32;
            *(v7 + 10) = 10;
            *(v7 + 16) = 287;
            *(v7 + 18) = 10;
            *(v7 + 24) = 32;
            *(v7 + 26) = 265;
            *(v7 + 32) = 287;
            *(v7 + 34) = 265;
            *(v7 + 12) = 0;
            *(v7 + 13) = 0;
            *(v7 + 20) = 255;
            *(v7 + 28) = 0;
            *(v7 + 29) = -1;
            *(v7 + 36) = -1;
            *(v7 + 37) = -1;
            *(v7 + 14) = sub_800670D8(576, 511);
            *(v7 + 22) = GetTPage(0, 2, 960, 256);
            *(v7 + 4) = a1;
            *(v7 + 5) = a1;
            *(v7 + 6) = a1;
            GPU_Cmd_MergeParams((g_GpuCommandBuffer + 4), v7);
          }
        }
      }
    }
    WaitForDmaComplete(0);
    sub_8002FF0C();
    a1 += a2;
    if ( (a1 - 1) >= 0x77 )
      break;
    v8 = PadRead();
    if ( v11 == -1 )
    {
      if ( !v8 )
        v11 = -2;
    }
    else if ( v8 )
    {
      WaitForDmaComplete(0);
      return a1;
    }
  }
  WaitForDmaComplete(0);
  return v11;
}
// 80067010: using guessed type int __fastcall GetTPage(_DWORD, _DWORD, _DWORD, _DWORD);
// 800670D8: using guessed type int __fastcall sub_800670D8(_DWORD, _DWORD);
// 80180158: using guessed type int g_GpuCmdBufferMirror;
// 8019015C: using guessed type int g_GpuCommandBuffer;

//----- (800378A0) --------------------------------------------------------
int __fastcall sub_800378A0(unsigned __int16 a1, unsigned __int16 a2)
{
  int v4; // $gp
  int v5; // $s0
  int v6; // $a0
  int v7; // $v0
  int result; // $v0

  WaitForDmaComplete(0);
  ExtractFileSections(a1, a2, dword_8018013C);
  ProcessTIMContainer(dword_8018013C);
  WaitForDmaComplete(0);
  dword_80180144 = dword_80180140[0] + 25600;
  dword_8018014C = dword_80180140[0] + 25600;
  dword_80180150 = dword_80180140[0] + 51200;
  GPU_SetTransferRect(dword_80076378, dword_80180140[0] + 51200);
  WaitForDmaComplete(0);
  sub_800633C0(&unk_80190160 + 92 * byte_80180138, *(v4 + 184), *(v4 + 186));
  WaitForDmaComplete(0);
  v5 = sub_8003744C(0, 12);
  v6 = v5;
  if ( v5 < 0 )
  {
    do
    {
      while ( 1 )
      {
        v7 = PadRead();
        if ( v5 != -1 )
          break;
        if ( !v7 )
          v5 = -2;
      }
    }
    while ( !v7 );
    v6 = 80;
  }
  sub_8003744C(v6, -12);
  SubmitCdDmaTransfer(dword_80076378, dword_80180150);
  dword_80180144 = dword_80180140[0] + 102400;
  dword_8018014C = dword_80180140[0] + 102400;
  result = dword_80180140[0] + 204800;
  dword_80180150 = dword_80180140[0] + 204800;
  return result;
}
// 8003792C: variable 'v4' is possibly undefined
// 80076378: using guessed type int dword_80076378[2];
// 80180138: using guessed type char byte_80180138;
// 8018013C: using guessed type int dword_8018013C;
// 80180140: using guessed type int dword_80180140[];
// 80180144: using guessed type int dword_80180144;
// 8018014C: using guessed type int dword_8018014C;
// 80180150: using guessed type int dword_80180150;

//----- (80037A1C) --------------------------------------------------------
int __fastcall sub_80037A1C(char a1, int a2, int a3, int a4, unsigned __int8 *a5, int a6, int a7)
{
  unsigned __int8 *v7; // $s2
  int v10; // $s5
  int v11; // $v0
  int v12; // $s4
  int v13; // $a0
  int v14; // $s1
  int v15; // $t1
  int v16; // $s0
  int result; // $v0
  unsigned __int8 *v18; // $a3
  char *v19; // $a0
  unsigned __int8 *v20; // $v1
  char *v21; // $a1
  char *v22; // $a0

  v7 = a5;
  v10 = a2 >> 11;
  v12 = a3 >> 11;
  v11 = FixedCos(a4);
  v13 = a4;
  v14 = v11;
  v15 = FixedSin(v13);
  v16 = a1 != 1 ? 5 : 0;
  result = 255;
  if ( *a5 != 255 )
  {
    v18 = a5 + 9;
    do
    {
      v19 = &g_MapData[200 * ((*v18 * v14 + *(v18 - 1) * v15) >> 12) + 200 * v12]
          + 10 * ((*(v18 - 1) * v14 - *v18 * v15) >> 12)
          + 10 * v10;
      v20 = &v7[4 * a6];
      v21 = &v19[v16];
      v22 = &v19[v16 == 0 ? 5 : 0];
      if ( *v20 != 254 )
        v21[3] = *v20;
      if ( v20[1] != 254 )
        v22[3] = v20[1];
      if ( v20[2] != 255 )
        *v21 = v20[2];
      if ( v20[3] != 255 )
        *v22 = v20[3];
      v7 += 10;
      if ( a7 != 255 )
      {
        v21[4] = v21[4] & 0x7F | a7;
        v22[4] = v22[4] & 0x7F | a7;
      }
      result = *v7;
      v18 += 10;
    }
    while ( result != 255 );
  }
  return result;
}
// 801CBD74: using guessed type _DWORD g_MapData[];

//----- (80037C0C) --------------------------------------------------------
int __fastcall sub_80037C0C(char a1, int a2, int a3, int a4, int a5, int a6, int a7, int a8, char a9)
{
  int v9; // $t1
  int result; // $v0
  int v12; // $t7
  int v13; // $t8
  int v14; // $t2
  _BYTE *v15; // $s1
  int v16; // $t1
  int v17; // $s3
  _BYTE *v18; // $a3
  _BYTE *v19; // $s2
  _BYTE *v20; // $a0
  int v21; // $a2
  _BYTE *v22; // $a1
  int v23; // $v0
  int v24; // $v0
  bool v25; // dc
  int v26; // $v0

  v9 = a5;
  result = 255;
  if ( a6 != 255 )
  {
    v12 = -(a8 >> 10) & 3;
    if ( v12 == 1 )
    {
      v13 = -80;
      v14 = 1;
      v9 = a5 - 1 + a6;
    }
    else if ( (-(a8 >> 10) & 3u) >= 2 )
    {
      if ( v12 == 2 )
      {
        v13 = -1;
        v14 = -80;
        a4 = a4 - 1 + a6;
        v9 = a5 - 1 + a7;
      }
      else
      {
        v13 = 80;
        v14 = -1;
        a4 = a4 - 1 + a7;
      }
    }
    else
    {
      v13 = 1;
      v14 = 80;
    }
    result = g_MapData + 10 * a4;
    v15 = (800 * v9 + result);
    v16 = a7 - 1;
    if ( a7 )
    {
      result = 5 * v14;
      v17 = a1 & 1;
      v18 = &g_MapData[200 * a3] + 10 * a2;
      do
      {
        v19 = v18 + 800;
        v20 = v15;
        v21 = a6 - 1;
        v15 += 10 * v14;
        if ( a6 )
        {
          v22 = v18 + 9;
          do
          {
            v23 = a1 & 2;
            if ( v17 )
            {
              if ( (a9 & 1) != 0 )
                *v20 = *v18;
              if ( (a9 & 2) != 0 )
                v20[1] = *(v22 - 8);
              if ( (a9 & 4) != 0 )
                v20[2] = v20[2] & 0xFC | (*(v22 - 7) + v12) & 3;
              if ( (a9 & 8) != 0 )
                v20[3] = *(v22 - 6);
              if ( (a9 & 0x10) != 0 )
                v20[4] = *(v22 - 5) & 0x3F | v20[4] & 0xC0;
              v24 = a9 & 0x40;
              if ( (a9 & 0x20) != 0 )
              {
                v20[4] = *(v22 - 5) & 0x40 | v20[4] & 0xBF;
                v24 = a9 & 0x40;
              }
              v25 = v24 == 0;
              v23 = a1 & 2;
              if ( !v25 )
              {
                v20[4] = *(v22 - 5) & 0x80 | v20[4] & 0x7F;
                v23 = a1 & 2;
              }
            }
            if ( v23 )
            {
              if ( (a9 & 1) != 0 )
                v20[5] = *(v22 - 4);
              if ( (a9 & 2) != 0 )
                v20[6] = *(v22 - 3);
              if ( (a9 & 4) != 0 )
                v20[7] = v20[7] & 0xFC | (*(v22 - 2) + v12) & 3;
              if ( (a9 & 8) != 0 )
                v20[8] = *(v22 - 1);
              if ( (a9 & 0x10) != 0 )
                v20[9] = *v22 & 0x3F | v20[9] & 0xC0;
              v26 = a9 & 0x40;
              if ( (a9 & 0x20) != 0 )
              {
                v20[9] = *v22 & 0x40 | v20[9] & 0xBF;
                v26 = a9 & 0x40;
              }
              if ( v26 )
                v20[9] = *v22 & 0x80 | v20[9] & 0x7F;
            }
            v22 += 10;
            v18 += 10;
            result = 10 * v13;
            --v21;
            v20 += 10 * v13;
          }
          while ( v21 != -1 );
        }
        --v16;
        v18 = v19;
      }
      while ( v16 != -1 );
    }
  }
  return result;
}
// 80037C6C: conditional instruction was optimized away because $t7.4==0
// 80037C88: conditional instruction was optimized away because $t7.4==3
// 801CBD74: using guessed type _DWORD g_MapData[];

//----- (80037F78) --------------------------------------------------------
int __fastcall sub_80037F78(int a1, __int16 a2)
{
  return sub_800143E0(a2, (a1 + 20), 120, 0);
}

//----- (80037FA8) --------------------------------------------------------
int InitProjectileSystem()
{
  int v0; // $a0
  Entity **v1; // $v1
  int result; // $v0
  bool v3; // dc

  v0 = 395;
  v1 = &ObjectInstances[13];
  do
  {
    *(v1 - 23) = 255;
    *(v1 - 48) = -1;
    v1[2] = 0;
    v1[1] = 0;
    *v1 = 0;
    v1 += 17;
    result = v0;
    v3 = v0 != 0;
    v0 += 0xFFFF;
  }
  while ( v3 );
  word_80180132 = 0;
  word_80180130 = 0;
  word_8018012E = 0;
  return result;
}
// 8018012E: using guessed type __int16 word_8018012E;
// 80180130: using guessed type __int16 word_80180130;
// 80180132: using guessed type __int16 word_80180132;

//----- (80038004) --------------------------------------------------------
int __fastcall InitProjectileInstance(int a1)
{
  int result; // $v0

  *(a1 + 1) = 0x80;
  result = 4096;
  *(a1 + 10) = 0;
  *(a1 + 2) = -1;
  *a1 = 0;
  *(a1 + 40) = 0;
  *(a1 + 36) = 0;
  *(a1 + 38) = 0;
  *(a1 + 48) = 4096;
  *(a1 + 46) = 4096;
  *(a1 + 44) = 4096;
  *(a1 + 4) = -1;
  *(a1 + 14) = 0;
  *(a1 + 5) = -1;
  *(a1 + 16) = 0;
  return result;
}

//----- (8003804C) --------------------------------------------------------
int __fastcall sub_8003804C(int a1, int a2, unsigned __int16 a3)
{
  int result; // $v0
  Entity **v4; // $a2
  _DWORD *v5; // $v1

  result = 0xFFFF;
  if ( a1 != 0xFFFF )
  {
    v4 = &ObjectInstances[17 * a1];
    v5 = &GameDB01ObjectClassDeclaration[6 * *(v4 + 3)];
    if ( a2 == 1 )
    {
      result = a3;
      *v4 = a3;
    }
    else if ( a2 >= 2 )
    {
      result = 3;
      if ( a2 == 2 )
      {
        result = 255;
        *(v4 + 56) = -1;
      }
      else if ( a2 == 3 )
      {
        result = a3;
        *(v4 + 7) = a3;
      }
    }
    else
    {
      result = 16;
      if ( !a2 )
      {
        *v4 = 0;
        *(v4 + 56) = 0;
        result = 1024;
        if ( *(v5 + 1) == 16 )
          *(v4 + 20) = 1024;
      }
    }
  }
  return result;
}
// 801779F0: using guessed type _DWORD GameDB01ObjectClassDeclaration[];

//----- (80038120) --------------------------------------------------------
int __fastcall sub_80038120(int a1, int a2, char a3)
{
  char *v4; // $a0
  int result; // $v0
  _BYTE *v6; // $a0

  if ( a2 || word_8019B52E )
  {
    v6 = &g_MapData[200 * (*(a1 + 28) >> 11)] + 10 * (*(a1 + 20) >> 11);
    if ( *a1 != 1 )
      v6 += 5;
    *v6 = -2;
    result = 4096;
    *(a1 + 48) = 4096;
    *(a1 + 46) = 4096;
    *(a1 + 44) = 4096;
  }
  else
  {
    v4 = &g_MapData[200 * (*(a1 + 28) >> 11)] + 10 * (*(a1 + 20) >> 11);
    result = 1;
    if ( *a1 != 1 )
      v4 += 5;
    *v4 = a3;
    *(a1 + 48) = 0;
    *(a1 + 46) = 0;
    *(a1 + 44) = 0;
  }
  return result;
}
// 8019B52E: using guessed type __int16 word_8019B52E;
// 801CBD74: using guessed type _DWORD g_MapData[];

//----- (80038214) --------------------------------------------------------
int __fastcall sub_80038214(int a1)
{
  Entity **v2; // $s1
  int v3; // $s2
  unsigned __int16 *v4; // $s0
  int v5; // $v1
  int result; // $v0
  int v7; // $a0
  char v8; // $a2

  v2 = ObjectInstances;
  v3 = 396;
  v4 = &ObjectInstances[1] + 1;
  do
  {
    v5 = *(v4 - 2);
    if ( v5 == 5 )
    {
      result = 254;
      if ( *(v4 + 50) == 254 )
        goto LABEL_9;
      sub_8003804C(v4[26], a1, *v2);
      v7 = v2;
      v8 = GameDB01ObjectClassDeclaration[6 * *v4 + 3];
      goto LABEL_8;
    }
    result = 255;
    if ( v5 == 81 )
    {
      v7 = v2;
      if ( *(v4 + 53) != 255 )
      {
        v8 = HIBYTE(GameDB01ObjectClassDeclaration[6 * *v4 + 5]);
LABEL_8:
        result = sub_80038120(v7, a1, v8);
      }
    }
LABEL_9:
    v4 += 34;
    --v3;
    v2 += 17;
  }
  while ( v3 );
  return result;
}
// 801779F0: using guessed type _DWORD GameDB01ObjectClassDeclaration[];

//----- (8003830C) --------------------------------------------------------
int __fastcall sub_8003830C(int a1)
{
  int v1; // $fp
  char *v2; // $s5
  char *v3; // $s2
  int v4; // $s7
  char *v5; // $s0
  __int16 *v6; // $s3
  int v7; // $a0
  __int16 v8; // $v1
  _DWORD *v9; // $s1
  __int16 v10; // $v1
  char v11; // $v0
  char *v12; // $v1
  int v13; // $v1
  int v14; // $v1
  Vector3 *v15; // $a0
  int v16; // $a1
  __int16 v17; // $v1
  int v18; // $v0
  Vector3 *v19; // $a0
  int v20; // $a1
  char v21; // $a2
  int v22; // $a0
  int v23; // $v1
  char v24; // $v0
  int v25; // $v1
  char v26; // $a0
  int v27; // $a3
  int v28; // $v1
  int v29; // $v0
  int v30; // $v1
  char *v31; // $a0
  int v32; // $v0
  int v33; // $v1
  int result; // $v0

  v1 = dword_801BA5B0;
  v2 = a1;
  v3 = ObjectInstances;
  v4 = 349;
  v5 = ObjectInstances + 2;
  v6 = (a1 + 12);
  do
  {
    if ( *(v6 - 4) == 0xFFFF )
      *(v5 + 2) = 255;
    else
      *(v5 + 2) = *(v6 - 4);
    v7 = *(v5 + 2);
    v5[2] = -1;
    if ( v7 != 255 )
    {
      *(v5 + 3) = 0;
      *(v5 - 1) = 0x80;
      *(v5 + 4) = 0;
      *v5 = -1;
      *(v5 + 19) = 0;
      *(v5 + 17) = 0;
      v8 = *(v6 - 3);
      *(v5 + 23) = 4096;
      *(v5 + 22) = 4096;
      *(v5 + 21) = 4096;
      *(v5 + 18) = -v8 & 0xFFF;
      *v3 = *v2;
      v9 = &GameDB01ObjectClassDeclaration[6 * v7];
      v5[1] = *(v9 + 3);
      v10 = *(v9 + 5);
      v11 = v5[1];
      v5[3] = -1;
      *(v5 + 7) = 0;
      *(v5 + 6) = v10;
      if ( (v11 & 0x20) != 0 )
        *v5 = 0x80;
      *(v5 + 5) = *(v9 + 4);
      *(v5 + 18) = (*(v6 - 10) << 11) + *(v6 - 1);
      *(v5 + 26) = (*(v6 - 11) << 11) + *(v6 - 2);
      v12 = &g_MapData[200 * *(v6 - 11)] + 10 * *(v6 - 10);
      if ( *v3 != 1 )
        v12 += 5;
      *(v5 + 22) = *v6 - (v12[1] << 7);
      v13 = *(v6 + 2);
      *(v5 + 54) = *(v6 + 1);
      *(v5 + 58) = v13;
      memset(v3 + 64, 255, 4);
      if ( *(v9 + 2) )
        Map_MarkOccupiedTiles(*(v5 + 18), *(v5 + 26), *(v9 + 2), 1);
      switch ( *v9 )
      {
        case 2:
          v5[2] = 2;
          *(v5 - 1) = 0;
          sub_80037A1C(*v3, *(v5 + 18), *(v5 + 26), *(v5 + 18), dword_8006F3B0, 0, 255);
          break;
        case 3:
          v18 = v5[56];
          *(v5 - 1) = 0;
          sub_80037C0C(*v3, v5[57] + 2 * *(v9 + 13), v5[58], v5[55], v18, *(v9 + 13), *(v9 + 14), *(v5 + 18), 45);
          v19 = *(v5 + 18);
          v20 = *(v5 + 26);
          v5[2] = 3;
          Map_MarkOccupiedTiles(v19, v20, 4400, 1);
          break;
        case 4:
          sub_80037C0C(*v3, v5[57] + 2, v5[58], v5[55], v5[56], 2, 2, 0, 45);
          v15 = *(v5 + 18);
          v16 = *(v5 + 26);
          v17 = *(v5 + 18);
          v5[2] = 4;
          *(v5 + 3) = 2;
          *(v5 + 31) = 999;
          *(v5 + 32) = v17;
          Map_MarkOccupiedTiles(v15, v16, 3000, 1);
          break;
        case 5:
          v5[2] = 5;
          *(v5 - 1) = 0;
          v21 = *(v9 + 12);
          v22 = v3;
          goto LABEL_46;
        case 8:
          v5[2] = 8;
          break;
        case 9:
          v5[2] = 9;
          v5[62] = *v3;
          break;
        case 0xB:
        case 0x14:
          goto LABEL_51;
        case 0xD:
          if ( v5[56] != 255 )
            *(v5 + 17) = v5[56] << 6;
          if ( v5[57] != 255 )
            *(v5 + 18) = v5[57] << 6;
          if ( v5[58] != 255 )
            *(v5 + 19) = v5[58] << 6;
          break;
        case 0xF:
          v5[2] = 15;
          break;
        case 0x11:
          v5[2] = 17;
          break;
        case 0x12:
          v5[2] = 18;
          *(v5 + 62) = v1 + 30;
          break;
        case 0x13:
          v5[2] = 19;
          break;
        case 0x15:
          v5[2] = 9;
          goto LABEL_59;
        case 0x16:
          v5[2] = 22;
          break;
        case 0x1F:
          *v3 = 0;
          v25 = *(v5 + 30);
          v5[2] = 31;
          *(v5 + 62) = v1 + 6 * v25;
          break;
        case 0x21:
        case 0xFF:
          break;
        case 0x22:
          v24 = 34;
          *(v5 - 1) = 0;
          *(v5 + 4) = 0;
          goto LABEL_34;
        case 0x30:
          v5[2] = 48;
          v32 = v5[58];
          v33 = *(v5 + 22);
          *v5 = 1;
          *(v5 + 22) = v33 - (v32 << 8);
          break;
        case 0x40:
          if ( *(v9 + 1) != 32 )
          {
            if ( v5[56] != 255 )
              *(v5 + 17) = v5[56] << 6;
            if ( v5[57] != 255 )
              *(v5 + 18) = v5[57] << 6;
            if ( v5[58] != 255 )
              *(v5 + 19) = v5[58] << 6;
            if ( !v5[55] )
            {
              v14 = *(v5 + 22);
              v5[2] = 16;
              v5[3] = 68;
              *v5 = 1;
              *(v5 + 7) = 4096;
              *(v5 + 62) = v14;
            }
          }
          break;
        case 0x51:
          v28 = v5[57];
          *(v5 - 1) = 0;
          v5[2] = 81;
          v5[62] = 0;
          if ( v28 != 255 )
          {
            v22 = v3;
            v21 = *(v9 + 23);
LABEL_46:
            sub_80038120(v22, 0, v21);
          }
          break;
        case 0x53:
          v5[2] = 83;
          *(v5 - 1) = 0;
          *(v5 + 3) = 9;
          break;
        case 0x54:
          *(v5 - 1) = 0;
          v5[62] = *v3;
          *v3 = 3;
          v26 = v5[62];
          v27 = *(v5 + 18);
          v5[2] = 84;
          sub_80037A1C(v26, *(v5 + 18), *(v5 + 26), v27, &dword_8006F2C0[15 * *(v9 + 14)] + 30 * (v5[60] & 1), 0, 0);
          *(v5 + 23) = 0;
          *(v5 + 22) = 0;
          *(v5 + 21) = 0;
          break;
        case 0x58:
          *(v5 - 1) = 0;
          v5[2] = 88;
          *(v5 + 3) = 1;
          break;
        case 0x59:
          v5[2] = 89;
          v5[3] = 66;
          *(v5 + 7) = 4096;
          v29 = *(v5 + 22);
          v30 = *(v5 + 26);
          *v5 = 1;
          *(v5 + 22) = v29 + 256;
          v31 = &g_MapData[200 * (v30 >> 11)] + 10 * (*(v5 + 18) >> 11);
          if ( *v3 != 1 )
            v31 += 5;
          v31[3] = 117;
          v5[64] = *v3;
          goto LABEL_51;
        case 0xE0:
          *v3 = 0;
          v5[2] = -32;
          *(v5 + 18) -= *(v6 - 1);
          *(v5 + 26) -= *(v6 - 2);
          *(v5 + 22) -= *v6;
          if ( *(v6 - 1) == 255 )
          {
            v5[64] = 127;
            v5[63] = 127;
            v5[62] = 127;
          }
          else
          {
            v5[62] = *(v6 - 2) - *(v6 - 10);
            v23 = -*(v5 + 22);
            v5[63] = *(v6 - 4) - *(v6 - 11);
            v5[64] = *v6 - (v23 >> 7);
          }
          break;
        case 0xE1:
          v24 = -31;
          *v3 = 0;
LABEL_34:
          v5[2] = v24;
          v5[62] = 0;
          break;
        case 0xE2:
LABEL_59:
          v5[62] = *v3;
LABEL_51:
          *v3 = 0;
          break;
        case 0xF0:
          v5[2] = -16;
          break;
        default:
          (*&g_CurrentStateVTable[1].gap0[4])(v3, v9);
          break;
      }
      if ( *(v5 + 2) == 163 )
        *v5 = 3;
    }
    v6 += 12;
    v2 += 24;
    v5 += 68;
    --v4;
    result = -1;
    v3 += 68;
  }
  while ( v4 != -1 );
  return result;
}
// 80062B80: using guessed type int __fastcall memset(_DWORD, _DWORD, _DWORD);
// 8006F2C0: using guessed type int dword_8006F2C0[33];
// 8006F3B0: using guessed type int dword_8006F3B0[8];
// 801779F0: using guessed type _DWORD GameDB01ObjectClassDeclaration[];
// 801BA5B0: using guessed type int dword_801BA5B0;
// 801CBD74: using guessed type _DWORD g_MapData[];

//----- (80038AF0) --------------------------------------------------------
int __fastcall sub_80038AF0(int a1, int a2, int a3, int a4, int a5)
{
  Entity **v9; // $s0
  int v10; // $s2
  Entity **i; // $s1
  int v12; // $v1
  int v13; // $v0
  bool v14; // dc
  signed int v15; // $v0
  int result; // $v0

  v9 = ObjectInstances;
  v10 = 0;
  for ( i = &ObjectInstances[3]; ; i += 17 )
  {
    v12 = *(i - 3);
    if ( v12 != 255 )
    {
      if ( *v9 )
      {
        if ( v9 != dword_80180128 )
        {
          v13 = word_801779F4[12 * v12];
          v14 = v13 == 0;
          v15 = v13 + a4;
          if ( !v14 )
          {
            v14 = GetDistanceIfInRange((v9 + 5), a1, a2, a3, v15, *i, a5) != -1;
            result = v10;
            if ( v14 )
              break;
          }
        }
      }
    }
    ++v10;
    v9 += 17;
    if ( v10 >= 396 )
      return -1;
  }
  return result;
}
// 801779F4: using guessed type unsigned __int16 word_801779F4[3838];
// 80180128: using guessed type int dword_80180128;

//----- (80038C0C) --------------------------------------------------------
int __fastcall FindInteractableInCone(int id, VECTOR *pos, int radius, int height, __int16 param1, __int16 param2)
{
  int v9; // $s5
  Entity **v10; // $v0
  Entity **v11; // $s2
  Vector3 *v12; // $s4
  int v13; // $v1
  _DWORD *v14; // $s1
  bool v15; // dc
  int v16; // $v0
  Entity *v17; // $v0
  int v18; // $a1
  int v19; // $a0
  int v20; // $v0
  __int16 v21; // $v0
  __int16 v23[4]; // [sp+20h] [-38h] BYREF
  int v24; // [sp+28h] [-30h] BYREF
  int v25; // [sp+30h] [-28h]
  int v26[8]; // [sp+38h] [-20h] BYREF

  v9 = id;
  v10 = &ObjectInstances[17 * id];
  if ( id < 0x18C )
  {
    v11 = v10 + 7;
    v12 = (v10 + 5);
    do
    {
      v13 = *(v11 - 11);
      if ( v13 == 255 )
        goto LABEL_12;
      v14 = &GameDB01ObjectClassDeclaration[6 * v13];
      if ( *v14 == 4 )
      {
        v23[0] = 1792;
        v23[1] = 0;
        v23[2] = 0;
        sub_80015378(*(v11 + 5), v26);
        ApplyMatrix(v26, v23, &v24);
        v24 += pos->x;
        v25 += *&pos->z;
        v15 = GetDistanceIfInRange(v12, v24, pos->y, v25, *(v14 + 3) + radius, *(v11 - 8), height) == -1;
        v16 = v9 + 1;
        if ( !v15 )
        {
          v17 = *v11;
          v18 = v25;
          v19 = *(v11 - 2) - v24;
          goto LABEL_10;
        }
      }
      else
      {
        v15 = GetDistanceIfInRange(v12, pos->x, pos->y, *&pos->z, *(v14 + 3) + radius, *(v14 + 4), height) == -1;
        v16 = v9 + 1;
        if ( !v15 )
        {
          v20 = v9 << 16;
          if ( (*(v11 - 25) & 4) != 0 )
            return v20 >> 16;
          v17 = *v11;
          v18 = *&pos->z;
          v19 = *(v11 - 2) - pos->x;
LABEL_10:
          v21 = Math_Atan2_Fixed(v19, v17 - v18);
          v15 = Math_IsAngleInRange(param1, v21, param2) == 0;
          v20 = v9 << 16;
          if ( !v15 )
            return v20 >> 16;
LABEL_12:
          v16 = v9 + 1;
        }
      }
      v9 = v16;
      v11 += 17;
      v12 = (v12 + 68);
    }
    while ( v16 < 396 );
  }
  return -1;
}
// 801779F0: using guessed type _DWORD GameDB01ObjectClassDeclaration[];
// 80038C0C: using guessed type int var_20[8];

//----- (80038E4C) --------------------------------------------------------
int __fastcall SetProjectileModel(Projectile *a1, char a2)
{
  int result; // $v0

  result = 255;
  if ( a1->type[4] == 255 )
  {
    a1->type[4] = a2;
    *a1->parentIndex = 0;
  }
  return result;
}

//----- (80038E6C) --------------------------------------------------------
Entity **__fastcall FindFreeOrOldestProjectileSlot(int a1, int a2, int a3)
{
  Entity **v3; // $a0
  Entity **v4; // $t0
  int v5; // $a3
  Entity **result; // $v0
  int v7; // $v1
  BOOL v8; // $v0

  v3 = &ObjectInstances[17 * a1];
  v4 = 0;
  v5 = 0;
  while ( 1 )
  {
    result = v3;
    if ( *(v3 + 3) == 255 )
      break;
    if ( a3 != -1 )
    {
      v7 = a3 - *(v3 + 30);
      v8 = v5 < v7;
      if ( v7 < 0 )
      {
        v7 += 0x10000;
        v8 = v5 < v7;
      }
      if ( v8 )
      {
        v4 = v3;
        v5 = v7;
      }
    }
    --a2;
    v3 += 17;
    if ( !a2 )
      return v4;
  }
  return result;
}

//----- (80038EF4) --------------------------------------------------------
int __fastcall SpawnProjectile(char a1, unsigned __int8 a2, _DWORD *a3, int a4)
{
  __int16 *v7; // $s0
  int v8; // $a0
  Entity **FreeOrOldestProjectileSlot; // $v0
  __int16 v10; // $v1
  Projectile *proj; // $s1
  int flags; // $v1
  int v13; // $a0
  _DWORD *v14; // $s0
  int result; // $v0

  if ( a1 )
  {
    v8 = 360;
    v7 = &word_80180130;
  }
  else
  {
    v7 = &word_80180132;
    v8 = 370;
  }
  FreeOrOldestProjectileSlot = FindFreeOrOldestProjectileSlot(v8, 10, *v7);
  v10 = *v7;
  proj = FreeOrOldestProjectileSlot;
  ++*v7;
  *(FreeOrOldestProjectileSlot + 30) = v10;
  *(FreeOrOldestProjectileSlot + 3) = a2;
  InitProjectileInstance(FreeOrOldestProjectileSlot);
  flags = proj->flags;
  proj->dword14 = *a3;
  proj->dword18 = a4 + a3[1];
  proj->dword1C = a3[2];
  v14 = &GameDB01ObjectClassDeclaration[6 * flags];
  proj->word26 = rand(v13) >> 3;
  switch ( *(v14 + 1) )
  {
    case 16:
    case 19:
    case 22:
      SetProjectileModel(proj, 96);
      result = 255;
      break;
    case 17:
    case 18:
    case 20:
    case 21:
    case 24:
    case 25:
    case 32:
      SetProjectileModel(proj, 98);
      if ( a2 == 103 )
        proj->word2A = 1024;
      else
        proj->word2A = 0;
      goto LABEL_10;
    case 23:
      SetProjectileModel(proj, 97);
      result = 255;
      break;
    default:
LABEL_10:
      result = 255;
      break;
  }
  proj->word3E = 0;
  proj->byte38 = -1;
  return result;
}
// 80038FA4: variable 'v13' is possibly undefined
// 80062BF0: using guessed type int __fastcall rand(_DWORD);
// 801779F0: using guessed type _DWORD GameDB01ObjectClassDeclaration[];
// 80180130: using guessed type __int16 word_80180130;
// 80180132: using guessed type __int16 word_80180132;

//----- (80039068) --------------------------------------------------------
int __fastcall sub_80039068(__int16 a1, _DWORD *a2, int a3)
{
  Entity **FreeOrOldestProjectileSlot; // $s1
  __int16 v7; // $v1
  int v8; // $a0
  int v9; // $s0
  int v10; // $a0
  int result; // $v0

  FreeOrOldestProjectileSlot = FindFreeOrOldestProjectileSlot(350, 10, word_8018012E);
  InitProjectileInstance(FreeOrOldestProjectileSlot);
  v7 = word_8018012E++;
  *(FreeOrOldestProjectileSlot + 30) = v7;
  *(FreeOrOldestProjectileSlot + 3) = 70;
  *(FreeOrOldestProjectileSlot + 29) = a1;
  v9 = (rand(v8) >> 3);
  FreeOrOldestProjectileSlot[5] = (((600 * FixedSin(v9)) >> 12) + *a2);
  FreeOrOldestProjectileSlot[6] = (a3 + a2[1]);
  FreeOrOldestProjectileSlot[7] = (((600 * FixedCos(v9)) >> 12) + a2[2]);
  *(FreeOrOldestProjectileSlot + 19) = rand(v10) >> 3;
  *(FreeOrOldestProjectileSlot + 56) = -1;
  SetProjectileModel(FreeOrOldestProjectileSlot, 98);
  result = -120;
  *(FreeOrOldestProjectileSlot + 31) = -120;
  return result;
}
// 800390D0: variable 'v8' is possibly undefined
// 80039140: variable 'v10' is possibly undefined
// 80062BF0: using guessed type int __fastcall rand(_DWORD);
// 8018012E: using guessed type __int16 word_8018012E;

//----- (80039190) --------------------------------------------------------
int __fastcall sub_80039190(int a1)
{
  int result; // $v0
  int v2; // $a2
  int v3; // $a1
  BOOL v4; // $t2
  Entity **v5; // $a0
  int v6; // $v1
  int v7; // $v0
  unsigned int v8; // $v1

  result = a1 + 106;
  if ( a1 != 255 )
  {
    v2 = 395;
    v3 = a1;
    v4 = (a1 + 106) < 0x31u;
    v5 = &ObjectInstances[14];
    do
    {
      v6 = *(v5 - 52);
      if ( v6 == 84 )
        goto LABEL_19;
      if ( *(v5 - 52) >= 0x55u )
      {
        if ( v6 == 95 )
          goto LABEL_19;
        if ( *(v5 - 52) >= 0x60u )
        {
          if ( *(v5 - 52) < 0xA4u && *(v5 - 52) >= 0xA2u )
          {
LABEL_19:
            if ( *v5 == v3 )
              *v5 = -1;
          }
LABEL_35:
          v5 += 17;
          goto LABEL_36;
        }
        if ( v6 == 88 )
        {
          if ( *(v5 + 1) == v3 )
          {
            v7 = *v5;
            *(v5 - 24) = 1;
            *v5 = v7 == 0;
          }
          goto LABEL_35;
        }
        if ( v6 == 89 )
        {
          if ( *v5 == v3 )
            *(v5 - 24) = 1;
          goto LABEL_35;
        }
        v5 += 17;
      }
      else
      {
        if ( v6 == 80 )
          goto LABEL_19;
        if ( *(v5 - 52) >= 0x51u )
        {
          if ( v6 == 81 )
          {
            if ( *(v5 + 5) == v3 )
              *v5 = -(*v5 == 0);
            goto LABEL_35;
          }
          v5 += 17;
        }
        else
        {
          if ( *(v5 - 52) >= 5u )
            goto LABEL_35;
          if ( *(v5 - 52) >= 2u )
          {
            if ( v4 )
            {
              if ( (*v5 & 0xFE) == v3 )
                *v5 ^= 1u;
            }
            else
            {
              v8 = *v5;
              if ( v8 == v3 )
              {
                if ( v8 >= 0xC8 || !*(v5 - 24) && (*(v5 - 24) = 1, v8 >= 0x64) )
                  *v5 = -1;
              }
            }
            goto LABEL_35;
          }
          v5 += 17;
        }
      }
LABEL_36:
      result = v2;
    }
    while ( v2-- != 0 );
  }
  return result;
}

//----- (80039348) --------------------------------------------------------
int __fastcall sub_80039348(int a1, int a2)
{
  int result; // $v0
  unsigned int v3; // $v1

  switch ( *(a1 + 4) )
  {
    case 2:
    case 3:
    case 4:
      result = 0;
      if ( !*(a1 + 8) )
        goto LABEL_3;
      break;
    case 5:
    case 8:
    case 0x16:
LABEL_3:
      v3 = *(a1 + 56);
      result = 2;
      if ( v3 < 0xFE )
      {
        if ( v3 == a2 )
        {
          *(a1 + 56) = -1;
          result = 1;
        }
        else
        {
          result = 3;
        }
      }
      break;
    case 0xF:
    case 0x11:
      result = 4;
      break;
    default:
      result = 0;
      break;
  }
  return result;
}

//----- (80039448) --------------------------------------------------------
int __fastcall sub_80039448(int a1, int a2, _DWORD *a3)
{
  int result; // $v0
  __int16 v6[4]; // [sp+18h] [-10h] BYREF
  __int16 v7; // [sp+20h] [-8h] BYREF
  __int16 v8; // [sp+22h] [-6h]
  __int16 v9; // [sp+24h] [-4h]

  sub_80036DD8(*(a1 + 6) + 256, *(a1 + 1), *(a1 + 10), a2, &v7);
  v7 = (v7 * *(a1 + 44)) >> 12;
  v8 = (v8 * *(a1 + 46)) >> 12;
  v9 = (v9 * *(a1 + 48)) >> 12;
  v6[0] = *(a1 + 36);
  v6[1] = *(a1 + 38) + 2048;
  v6[2] = *(a1 + 40);
  sub_80015614(v6, &v7, a3);
  *a3 += *(a1 + 20);
  a3[1] += *(a1 + 24);
  result = a3[2] + *(a1 + 28);
  a3[2] = result;
  return result;
}

//----- (8003955C) --------------------------------------------------------
int __fastcall sub_8003955C(int a1, int a2, int a3, int a4, int a5)
{
  int v5; // $v1
  int result; // $v0

  v5 = *&g_LanguageID[0].menus[0].header.posY >> 11;
  if ( *&g_LanguageID[0].header[2] >> 11 < a1 || *&g_LanguageID[0].header[2] >> 11 >= a1 + a3 )
    return 0;
  result = 0;
  if ( v5 < a2 )
    return result;
  if ( v5 >= a2 + a4 )
    return 0;
  if ( a5 == 0x8000 )
    return 1;
  result = 0;
  if ( a5 + 2048 >= *&g_LanguageID[0].header[6] )
  {
    result = 0;
    if ( *&g_LanguageID[0].header[6] >= a5 - 3200 )
      return 1;
  }
  return result;
}

//----- (800395EC) --------------------------------------------------------
int __fastcall sub_800395EC(int a1, int a2, int a3, int a4, int a5, int a6)
{
  int result; // $v0
  __int16 v11; // $v1
  __int16 *v12; // $a0
  int v13; // $s0
  int v14; // $lo
  int v15[4]; // [sp+10h] [-20h] BYREF
  int v16[4]; // [sp+20h] [-10h] BYREF

  if ( *(a1 + 8) )
  {
    result = 0;
    if ( *(a1 + 8) != 1 )
      return result;
  }
  else
  {
    result = 0;
    if ( *(a1 + 56) == 255 )
      return result;
    if ( *(a2 + 56) )
      *(a1 + 64) = a6 - 1;
    else
      *(a1 + 64) = 0;
    *(a1 + 8) = 1;
    InitProjectileInstance(a2);
    *(a2 + 4) = 112;
    *a2 = *a1;
    if ( a5 )
      *(a2 + 1) = 0;
    else
      *(a2 + 1) = 0x80;
    sub_80015614((a1 + 36), a3, a2 + 20);
    *(a2 + 20) += *(a1 + 20);
    *(a2 + 24) += *(a1 + 24);
    *(a2 + 28) += *(a1 + 28);
    v11 = *(a1 + 38);
    *(a2 + 64) = (-252645135 * (a1 - ObjectInstances)) >> 2;
    *(a2 + 38) = v11;
  }
  if ( a5 )
  {
    *(a2 + 10) += 204;
    v12 = (a1 + 36);
    if ( *(a2 + 10) < 0x1000u )
      goto LABEL_16;
    *(a2 + 10) = 4095;
  }
  v12 = (a1 + 36);
LABEL_16:
  sub_80015614(v12, a3, v15);
  sub_80015614((a1 + 36), a4, v16);
  v13 = ++*(a1 + 64) << 12;
  v14 = v13 / a6;
  if ( a6 == -1 && v13 == 0x80000000 )
    _break(6u, 0);
  *(a2 + 20) = FixedPointLerp(v15[0], v16[0], v14) + *(a1 + 20);
  *(a2 + 24) = FixedPointLerp(v15[1], v16[1], v14) + *(a1 + 24);
  *(a2 + 28) = FixedPointLerp(v15[2], v16[2], v14) + *(a1 + 28);
  if ( *(a1 + 64) < a6 )
    return 0;
  if ( a5 )
    *(a2 + 10) = 4095;
  sub_80037F78(a2, 66);
  result = 1;
  *(a2 + 56) = -1;
  *(a1 + 8) = 99;
  return result;
}
// 8003979C: conditional instruction was optimized away because $s3.4!=0

//----- (80039898) --------------------------------------------------------
int __fastcall FadeScreenIn(unsigned __int8 a1, int a2, int a3, int a4)
{
  int v8; // $a1
  int result; // $v0
  bool v10; // dc
  int v11[4]; // [sp+10h] [-18h] BYREF
  char v12[8]; // [sp+20h] [-8h] BYREF

  do
  {
    // // Q16  8-bit: (4096 * 4096) >> 16 = 4096  clamp to 255
    v8 = (a2 * a2) >> 16;
    if ( v8 >= 256 )
      LOBYTE(v8) = -1;
    //    (R=G=B=v8)
    SetFadeColor(a1, v8, v8, v8);
    //    ,   
    ProcessCDAudioLoad();
    ProcessAssetLoadQueue();
    GatherCameraContext(v11, v12);
    result = UpdatePlayerSystem(v11, v12);
    v10 = a2 != a3;
    a2 += a4;
  }
  while ( v10 );
  return result;
}
// 80039898: using guessed type char var_8[8];
// 80039898: using guessed type int var_18[4];

//----- (80039948) --------------------------------------------------------
int __fastcall RenderScene(int a1, int a2, int a3)
{
  Entity **v3; // $s4
  unsigned __int16 *v4; // $s1
  int result; // $v0
  _DWORD *v6; // $s3
  unsigned int v7; // $v1
  __int16 v8; // $a1
  int v9; // $v0
  int v10; // $v1
  char v11; // $v1
  char v12; // $v1
  bool v13; // dc
  int v14; // $v0
  int v15; // $v0
  __int16 v16; // $v0
  int v17; // $v1
  Entity **v18; // $s2
  signed __int16 v19; // $v0
  int v20; // $v1
  unsigned __int16 v21; // $v0
  __int16 v22; // $v0
  unsigned int v23; // $v1
  int v24; // $a0
  unsigned __int16 v25; // $v0
  unsigned __int16 v26; // $v1
  int v27; // $v1
  unsigned int v28; // $v1
  unsigned __int16 v29; // $a0
  int v30; // $v1
  int v31; // $a0
  int v32; // $v1
  int v33; // $v1
  int v34; // $a0
  unsigned __int16 v35; // $v0
  unsigned int v36; // $v1
  int v37; // $v1
  int v38; // $a0
  int v39; // $v1
  int v40; // $v0
  int v41; // $v0
  unsigned int v42; // $v1
  __int16 v43; // $v0
  int v44; // $v0
  int v45; // $v0
  int v46; // $v1
  int v47; // $v1
  char *v48; // $a0
  int v49; // $v0
  unsigned __int16 v50; // $v1
  int v51; // $v1
  int v52; // $v1
  signed __int16 v53; // $v0
  int v54; // $v1
  char v55; // $v0
  char v56; // $a0
  int v57; // $a3
  int v58; // $v1
  Entity **v59; // $v1
  int v60; // $v1
  int v61; // $s0
  unsigned int v62; // $v1
  __int16 v63; // $a1
  int v64; // $a0
  unsigned __int8 v65; // $v0
  int v66; // $v1
  char *v67; // $a1
  int v68; // $v1
  int v69; // $v1
  char *v70; // $a1
  int v71; // $v1
  Entity **v72; // $s0
  Entity *v73; // $v1
  Entity *v74; // $v1
  char v75; // $v0
  int v76; // $s2
  __int16 v77; // $v0
  unsigned int v78; // $v1
  int v79; // $v0
  int v80; // $v0
  __int16 v81; // $v1
  unsigned int v82; // $v1
  int v83; // $v0
  char v84; // $a3
  int v85; // $s0
  unsigned __int16 v86; // $v1
  __int16 v87; // $v0
  unsigned __int16 v88; // $v1
  int v89; // $v0
  int v90; // $v1
  int v91; // $v1
  unsigned int v92; // $v1
  int v93; // $a0
  int v94; // $s0
  Entity **v95; // $v1
  int v96; // [sp+40h] [-40h] BYREF
  int v97; // [sp+44h] [-3Ch]
  int v98; // [sp+48h] [-38h] BYREF
  int v99; // [sp+4Ch] [-34h]
  int v100; // [sp+50h] [-30h]
  int v101[8]; // [sp+58h] [-28h] BYREF
  int v102; // [sp+78h] [-8h]

  v3 = ObjectInstances;
  v4 = &ObjectInstances[2] + 1;
  v102 = 396;
  do
  {
    result = *(v4 - 6);
    if ( result != 255 )
    {
      dword_80180128 = v3;
      v6 = &GameDB01ObjectClassDeclaration[6 * *(v4 - 2)];
      dword_80180124 = v6;
      switch ( *(v4 - 6) )
      {
        case 2:
          v7 = *(v4 - 1);
          result = v7 < 2;
          if ( v7 == 1 )
          {
            if ( !*v4 )
              sub_80037F78(v3, *(v6 + 15));
            *v4 += 72;
            if ( *v4 == 3096 )
              sub_80037A1C(*v3, *(v4 + 5), *(v4 + 9), v4[14], dword_8006F3B0, 1, 255);
            result = 4095;
            if ( *v4 >= 0x1000u )
            {
              *v4 = 4095;
              *(v4 - 1) = 2;
            }
            break;
          }
          if ( *(v4 - 1) < 2u )
          {
            if ( !*(v4 - 1) )
              break;
            goto LABEL_194;
          }
          if ( v7 != 20 )
          {
            if ( v7 != 21 )
              goto LABEL_194;
            v9 = *v4 + 65464;
            *v4 -= 72;
            result = v9 << 16;
            if ( result <= 0 )
            {
              *v4 = 0;
LABEL_21:
              *(v4 - 1) = 0;
            }
            break;
          }
          result = sub_8002E4F4(*(v4 + 5), *(v4 + 7), *(v4 + 9), 1792, 3200, 192);
          if ( result )
            break;
          sub_80037A1C(*v3, *(v4 + 5), *(v4 + 9), v4[14], dword_8006F3B0, 0, 255);
          *(v4 - 1) = 21;
          v8 = *(v6 + 15);
          goto LABEL_214;
        case 3:
          v10 = *(v4 - 1);
          if ( v10 == 1 )
          {
            if ( !*v4 )
            {
              sub_80037C0C(
                *v3,
                *(v4 + 49) + *(v6 + 13),
                *(v4 + 50),
                *(v4 + 47),
                *(v4 + 48),
                *(v6 + 13),
                *(v6 + 14),
                v4[14],
                45);
              sub_80037F78(v3, *(v6 + 15));
            }
            *v4 += 72;
            if ( *v4 == 3096 )
              sub_80037C0C(*v3, *(v4 + 49), *(v4 + 50), *(v4 + 47), *(v4 + 48), *(v6 + 13), *(v6 + 14), v4[14], 45);
            result = 4095;
            if ( *v4 >= 0x1000u )
            {
              *v4 = 4095;
              goto LABEL_269;
            }
          }
          else if ( *(v4 - 1) >= 2u )
          {
            if ( v10 == 20 )
            {
              v12 = *(v4 + 46);
              result = v12 & 1;
              if ( (v12 + 106) >= 0x31u || (v12 & 1) == 0 )
              {
                v13 = sub_8002E4F4(*(v4 + 5), *(v4 + 7), *(v4 + 9), 4400, 3200, 192) != 0;
                result = 21;
                if ( !v13 )
                {
                  *(v4 - 1) = 21;
                  sub_80037C0C(
                    *v3,
                    *(v4 + 49) + *(v6 + 13),
                    *(v4 + 50),
                    *(v4 + 47),
                    *(v4 + 48),
                    *(v6 + 13),
                    *(v6 + 14),
                    v4[14],
                    45);
                  v8 = *(v6 + 15);
                  goto LABEL_214;
                }
              }
            }
            else
            {
              if ( v10 != 21 )
                goto LABEL_194;
              v14 = *v4 + 65464;
              *v4 -= 72;
              result = v14 << 16;
              if ( result <= 0 )
              {
                v15 = *(v4 + 48);
                *v4 = 0;
                *(v4 - 1) = 0;
                result = sub_80037C0C(
                           *v3,
                           *(v4 + 49) + 2 * *(v6 + 13),
                           *(v4 + 50),
                           *(v4 + 47),
                           v15,
                           *(v6 + 13),
                           *(v6 + 14),
                           v4[14],
                           45);
                goto LABEL_161;
              }
            }
          }
          else
          {
            if ( *(v4 - 1) )
              goto LABEL_194;
            v11 = *(v4 + 46);
            result = v11 & 1;
            if ( (v11 + 106) < 0x31u && (v11 & 1) != 0 )
              *(v4 - 1) = 1;
          }
          break;
        case 4:
          result = *(v4 - 1);
          if ( !*(v4 - 1) )
            break;
          if ( (*(v4 - 7) & 0x80) != 0 )
          {
            v13 = ((Math_Atan2_Fixed(
                      *&g_LanguageID[0].header[2] - *(v4 + 5),
                      *&g_LanguageID[0].menus[0].header.posY - *(v4 + 9))
                  - v4[28]) & 0xFFFu) < 0x801;
            v16 = -200;
            if ( !v13 )
              v16 = 240;
            v4[2] = v16;
          }
          v17 = *(v4 + 51);
          if ( v17 == 255 )
          {
            v18 = 0;
          }
          else
          {
            v18 = &ObjectInstances[17 * v17];
            if ( (*(v18 + 3) & 0x80) != 0 )
            {
              if ( ((Math_Atan2_Fixed(
                       *&g_LanguageID[0].header[2] - v18[5],
                       *&g_LanguageID[0].menus[0].header.posY - v18[7])
                   - v4[28]) & 0xFFFu) >= 0x801 )
                *(v18 + 7) = -200;
              else
                *(v18 + 7) = 240;
            }
          }
          if ( *(v4 - 1) == 1 )
          {
            *(v4 - 1) = 2;
            v4[27] = 0;
            sub_80037F78(v3, *(v6 + 15));
          }
          v19 = v4[27];
          v4[27] = v19 + 1;
          v20 = v19;
          a1 = 129;
          if ( v19 >= 32 )
          {
            result = v19 < 332;
            if ( v20 < 300 )
              break;
            if ( v20 >= 332 )
            {
              result = -50;
              *(v4 - 1) = 0;
              *(v4 - 9) = 0x80;
              v4[2] = -50;
              if ( v18 )
              {
                *(v18 + 1) = 0x80;
                *(v18 + 7) = -50;
              }
            }
            else
            {
              if ( v20 == 300 )
              {
                v96 = 63744;
                LOWORD(v97) = 0;
                sub_80015378(v4[28], v101);
                ApplyMatrix(v101, &v96, &v98);
                v98 += *(v4 + 5);
                v100 += *(v4 + 9);
                v13 = sub_8002E4F4(v98, *(v4 + 7), v100, 3000, v4[1], 192) == 0;
                result = 300;
                if ( !v13 )
                {
                  v4[27] = 300;
                  break;
                }
                sub_80037C0C(*v3, *(v4 + 49) + 2, *(v4 + 50), *(v4 + 47), *(v4 + 48), 2, 2, 0, 45);
                sub_80037F78(v3, *(v6 + 15));
              }
              result = v4[14] - 32;
              v4[14] = result;
              if ( v18 )
              {
                result = *(v18 + 19) + 32;
                *(v18 + 19) = result;
              }
            }
          }
          else
          {
            v21 = v4[14];
            *(v4 - 9) = -127;
            v4[14] = v21 + 32;
            if ( v18 )
            {
              v22 = *(v18 + 19);
              *(v18 + 1) = -127;
              *(v18 + 19) = v22 - 32;
            }
            if ( v20 == 24 )
            {
              result = sub_80037C0C(*v3, *(v4 + 49), *(v4 + 50), *(v4 + 47), *(v4 + 48), 2, 2, 0, 45);
              v4 += 34;
              goto LABEL_326;
            }
            result = 280;
            if ( v20 == 31 )
              v4[27] = 280;
          }
          break;
        case 5:
          v36 = *(v4 - 1);
          result = v36 < 2;
          if ( v36 == 1 )
          {
            result = 2;
            if ( *(v4 + 46) != 254 )
              break;
            v38 = v4[24];
            *(v4 - 1) = 2;
            sub_8003804C(v38, 1, *v3);
            sub_80037F78(v3, *(v6 + 15));
            result = sub_80038120(v3, 1, *(v6 + 12));
            v4 += 34;
            goto LABEL_326;
          }
          if ( *(v4 - 1) >= 2u )
          {
            if ( v36 != 2 )
            {
              v4 += 34;
              goto LABEL_326;
            }
            *v4 += 128;
            result = *v4 < 0xFFFu;
            a2 = 2;
            if ( *v4 >= 0xFFFu )
            {
              v34 = v4[24];
              *v4 = 4095;
              goto LABEL_120;
            }
          }
          else
          {
            result = 0xFFFF;
            if ( *(v4 - 1) )
            {
              v4 += 34;
              goto LABEL_326;
            }
            v37 = v4[24];
            if ( v37 != 0xFFFF )
              HIWORD(ObjectInstances[17 * v37 + 3]) += 200;
            if ( *(v4 + 46) == 254 )
            {
              sub_80038120(v3, 1, *(v6 + 12));
              *v4 = 4095;
              goto LABEL_121;
            }
            result = sub_8003804C(v4[24], 0, a3);
            *(v4 - 1) = 1;
          }
          break;
        case 8:
          v23 = *(v4 - 1);
          result = v23 < 2;
          if ( v23 == 1 )
          {
            result = -16;
            if ( *(v4 + 46) != 254 )
              break;
            v24 = v4[24];
            v4[27] = -16;
            *(v4 - 1) = 2;
            sub_8003804C(v24, 1, *v3);
            v8 = *(v6 + 15);
            goto LABEL_214;
          }
          if ( *(v4 - 1) < 2u )
          {
            result = 254;
            if ( *(v4 - 1) )
            {
              v4 += 34;
              goto LABEL_326;
            }
            result = 2560;
            if ( *(v4 + 46) == 254 )
            {
              v4[13] = 2560;
              *(v4 - 1) = 3;
              break;
            }
            goto LABEL_98;
          }
          a1 = 2560;
          if ( v23 != 2 )
          {
            v4 += 34;
            goto LABEL_326;
          }
          v25 = sub_80014ED4(2560, v4[13], v4[27], 8, 4);
          v26 = v4[13];
          v4[27] = v25;
          v27 = (v26 + v25) & 0xFFF;
          v4[13] = v27;
          if ( v27 < 3072 )
            sub_8003804C(v4[24], 2, a3);
          result = 2560;
          if ( v4[27] )
            break;
          result = 3;
          if ( v4[13] != 2560 )
            break;
          goto LABEL_122;
        case 9:
          v58 = v4[24];
          result = 16 * v58;
          if ( v58 != 0xFFFF )
          {
            v59 = &ObjectInstances[17 * v58];
            result = *(v59 + 3);
            if ( result != 255 )
            {
              *v59 = 0;
              *(v59 + 56) = 0;
            }
          }
          *(v4 - 6) = -1;
          break;
        case 0xF:
          v67 = &unk_8017FCE0 + 68 * *(v4 + 47);
          if ( !*(v4 - 1) || *(v67 + 3) != 255 )
            goto LABEL_248;
          v68 = *(v4 + 46);
          if ( v68 == 115 )
          {
            v69 = 44;
          }
          else if ( *(v4 + 46) >= 0x74u )
          {
            v13 = v68 == 116;
            v69 = 48;
            if ( !v13 )
            {
              *(v4 + 46) = -1;
              goto LABEL_247;
            }
          }
          else
          {
            v13 = v68 == 114;
            v69 = 40;
            if ( !v13 )
            {
              *(v4 + 46) = -1;
              goto LABEL_247;
            }
          }
          *&byte_801B519C[v69] = -1;
          *(v4 + 46) = -1;
LABEL_247:
          *(v4 - 1) = 0;
LABEL_248:
          result = sub_800395EC(v3, v67, dword_80076380, dword_80076388, 1, 32);
          v4 += 34;
          goto LABEL_326;
        case 0x10:
          v53 = v4[14] + 128;
          v4[14] = v53;
          result = (FixedSin(v53) >> 6) + *(v4 + 27);
          *(v4 + 7) = result;
          break;
        case 0x11:
          v70 = &unk_8017FCE0 + 68 * *(v4 + 47);
          if ( *(v4 - 1) && *(v70 + 3) == 255 )
          {
            v71 = *(v4 + 49);
            *(v4 + 46) = -1;
            *(v4 - 1) = 0;
            LOBYTE(ObjectInstances[17 * v71 + 14]) &= ~*(v4 + 48);
          }
          result = sub_800395EC(v3, v70, dword_80076390, &dword_80076398, 0, 20);
          if ( result )
          {
            a1 = *(v4 + 48);
            result = &ObjectInstances[17 * *(v4 + 49)];
            *(result + 56) |= a1;
          }
          break;
        case 0x12:
          result = dword_801BA5B0 + 30;
          if ( *(v4 + 27) - dword_801BA5B0 >= 0 )
            break;
          *(v4 + 27) = result;
          result = sub_80037F78(v3, 238);
          v4 += 34;
          goto LABEL_326;
        case 0x13:
          a1 = *(v4 - 1);
          v72 = &ObjectInstances[17 * v4[24]];
          if ( a1 == 1 )
          {
            v76 = byte_8009DEBC;
            result = byte_8009DEBC < 0x10u;
            if ( byte_8009DEBC < 0x10u )
            {
              result = rand(1) < v76 << 11;
              if ( !result )
              {
                v77 = *(v72 + 24) + 1;
                *(v72 + 24) = v77;
                v78 = *(v72 + 24);
                *(v72 + 23) = v77;
                *(v72 + 22) = v77;
                *(v4 + 46) = v78 >> 5;
                result = *(v72 + 22) < 4096;
                if ( *(v72 + 22) >= 4096 )
                  goto LABEL_268;
              }
            }
          }
          else
          {
            result = *(v4 - 1) < 2u;
            if ( *(v4 - 1) >= 2u )
            {
              if ( a1 != 2 )
              {
                v4 += 34;
                goto LABEL_326;
              }
              result = *(v72 + 3);
              if ( result == 255 )
                *(v4 + 46) = 0;
            }
            else
            {
              v13 = a1 == 0;
              a1 = v3;
              if ( !v13 )
              {
                v4 += 34;
                goto LABEL_326;
              }
              sub_80039448(v3, 2, v72 + 5);
              result = *(v4 + 7);
              if ( v72[6] != result )
              {
                v73 = *(v4 + 15);
                v72[9] = *(v4 + 13);
                v72[10] = v73;
                if ( *(v4 + 46) != 255 )
                {
                  v74 = v72[6];
                  *(v72 + 3) = 76;
                  *(v72 + 4) = -1;
                  v72[6] = (v74 + 300);
                  v75 = *v3;
                  *(v72 + 56) = 0;
                  *v72 = v75;
                  result = 32 * *(v4 + 46);
                  *(v72 + 24) = result;
                  *(v72 + 23) = result;
                  *(v72 + 22) = result;
                  *(v4 - 1) = 1;
                  break;
                }
LABEL_268:
                *(v4 + 46) = -1;
                *(v72 + 56) = -1;
                SetProjectileModel(v72, 98);
                goto LABEL_269;
              }
            }
          }
          break;
        case 0x16:
          v28 = *(v4 - 1);
          result = v28 < 2;
          if ( v28 != 1 )
          {
            if ( *(v4 - 1) >= 2u )
            {
              if ( v28 == 2 )
              {
                sub_80014FAC(v4[14] + 2048, &v98);
                sub_8001565C(10, &v98);
                v32 = *(v4 + 9);
                *(v4 + 5) += v98;
                a1 = v99;
                LOWORD(result) = v4[27] - 1;
                v33 = v32 + v99;
                v4[27] = result;
                result = result;
                *(v4 + 9) = v33;
                if ( !result )
                {
                  v34 = v4[24];
LABEL_120:
                  sub_8003804C(v34, 2, a3);
LABEL_121:
                  result = 3;
LABEL_122:
                  *(v4 - 1) = 3;
                }
              }
              else
              {
                a2 = 3396;
                if ( v28 != 3 )
                {
                  v4 += 34;
                  goto LABEL_326;
                }
                v35 = sub_80014C84(v4[13], 3396, 50);
                v4[13] = v35;
                v13 = v35 != 3396;
                result = 4;
                if ( !v13 )
LABEL_140:
                  *(v4 - 1) = 4;
              }
            }
            else
            {
              result = 254;
              if ( *(v4 - 1) )
              {
                v4 += 34;
                goto LABEL_326;
              }
              if ( *(v4 + 46) == 254 )
              {
                v29 = v4[14];
                v4[13] = 3396;
                sub_80014FAC(v29 + 2048, &v96);
                sub_8001565C(160, &v96);
                v30 = *(v4 + 9);
                *(v4 + 5) += v96;
                a1 = v97;
                result = 3;
                *(v4 - 1) = 3;
                *(v4 + 9) = v30 + a1;
              }
              else
              {
LABEL_98:
                sub_8003804C(v4[24], 0, a3);
                result = sub_8003804C(v4[24], 3, 0);
                *(v4 - 1) = 1;
              }
            }
            break;
          }
          result = 16;
          if ( *(v4 + 46) != 254 )
            break;
          v31 = v4[24];
          v4[27] = 16;
          *(v4 - 1) = 2;
          sub_8003804C(v31, 1, *v3);
          v8 = *(v6 + 15);
          goto LABEL_214;
        case 0x22:
          if ( sub_8003955C(*(v4 + 46), *(v4 + 47), *(v4 + 48), *(v4 + 49), *(v4 + 7)) )
          {
            v94 = 396;
            if ( !*(v4 + 54) )
            {
              PlaySoundEffect(20, 110);
              FadeScreenIn(1u, 0, 4096, 256);
              v95 = &ObjectInstances[16];
              do
              {
                --v94;
                if ( *(v95 - 60) == 34 )
                  *v95 = 1;
                v95 += 17;
              }
              while ( v94 );
              Map_MarkOccupiedTiles(*&g_LanguageID[0].header[2], *&g_LanguageID[0].menus[0].header.posY, 800, -1);
              *&g_LanguageID[0].header[2] = (*(v4 + 50) << 11) + 1024;
              *&g_LanguageID[0].menus[0].header.posY = (*(v4 + 51) << 11) + 1024;
              word_8019B5EC = *(v4 + 52) != 1 ? 5 : 0;
              g_LanguageID[0].menus[0].items[0].refX = -16 * *(v4 + 53);
              Player_Spawn();
              *&g_LanguageID[0].menus[0].header.extra[4] = g_LanguageID[0].menus[0].items[0].refX
                                                         + word_8019B5C6
                                                         + HIWORD(dword_8019B5CC)
                                                         + word_8019B5D6;
              FadeScreenIn(1u, 4096, 0, -256);
              SetFadeColor(255, 0, 0, 0);
            }
          }
          else
          {
            *(v4 + 54) = 0;
          }
          result = (*v4 + 64) & 0xFFF;
          *v4 = result;
          break;
        case 0x51:
          v60 = *(v4 - 1);
          v61 = 4 * *(v4 + 48);
          if ( v60 != 1 )
          {
            result = *(v4 - 1) < 2u;
            if ( *(v4 - 1) >= 2u )
            {
              if ( v60 == 2 )
              {
                *v4 += 64;
                result = 4095;
                if ( *v4 >= 0xFFFu )
                {
                  v66 = *(v4 + 46);
                  *v4 = 4095;
                  if ( v66 == 255 )
                  {
                    *(v4 - 9) = 2;
                    result = 3;
                    *(v4 - 1) = 3;
                  }
                }
              }
              else
              {
                if ( v60 != 3 )
                {
                  v4 += 34;
                  goto LABEL_326;
                }
                *v4 += 64;
                result = *v4 < 0xFFFu;
                if ( *v4 >= 0xFFFu )
                  *(v4 - 1) = 0;
              }
            }
            else
            {
              if ( *(v4 - 1) )
              {
                v4 += 34;
                goto LABEL_326;
              }
              result = 254;
              if ( !*(v4 + 46) )
              {
                *(v4 - 1) = 2;
                result = 4095;
                *v4 = 0;
                *(v4 - 9) = 1;
                *v4 = 4095;
                break;
              }
              a3 = *(v4 + 49);
              if ( a3 != 254
                && (a3 == 255
                 || (result = sub_8003955C(*(v4 + 5) >> 11, *(v4 + 9) >> 11, a3, *(v4 + 50), *(v4 + 7))) != 0) )
              {
                *(v4 - 1) = 1;
                *(v4 - 9) = 0;
                *(v4 + 54) = 0;
                v8 = *(v6 + 22);
LABEL_214:
                result = sub_80037F78(v3, v8);
                v4 += 34;
                goto LABEL_326;
              }
            }
            break;
          }
          if ( *(v4 + 49) == 255 )
            goto LABEL_222;
          v62 = *v4;
          if ( *v4 )
          {
            if ( v62 < 0x5DC )
              goto LABEL_222;
            a1 = v3;
            if ( v62 >= v61 + 1500 )
              goto LABEL_222;
            v63 = 78;
          }
          else
          {
            sub_80038120(v3, 1, *(v6 + 23));
            v63 = *(v6 + 22);
            a1 = v3;
          }
          sub_80037F78(a1, v63);
LABEL_222:
          if ( !*(v4 + 46) )
          {
            result = 2;
            if ( *v4 >= 4096 - v61 )
            {
              *(v4 - 1) = 2;
              *(v4 - 9) = 1;
              break;
            }
          }
          *v4 += v61;
          v64 = v3;
          if ( *v4 >= 0xFFFu )
          {
            if ( *(v4 + 49) != 255 )
            {
              *v4 = 0;
              *(v4 - 1) = 0;
              result = sub_80038120(v3, 0, *(v6 + 23));
              v4 += 34;
              goto LABEL_326;
            }
            sub_80037F78(v3, *(v6 + 22));
            *v4 &= 0xFFFu;
            v64 = v3;
          }
          sub_80039448(v64, *(v6 + 6), &v96);
          result = sub_8002E4F4(v96, v97, v98, *(v6 + 7), *(v6 + 8), 144);
          a1 = result;
          if ( !result )
          {
LABEL_314:
            *(v4 + 54) = 0;
            break;
          }
          result = *(v4 + 54);
          a2 = 32;
          if ( *(v4 + 54) )
            break;
          v65 = *(v4 + 47);
          *(v4 + 54) = 1;
          result = sub_800425A0(
                     a1,
                     32,
                     0x1388u,
                     5u,
                     v65,
                     *(v6 + 18),
                     *(v6 + 19),
                     *(v6 + 20),
                     *(v6 + 21),
                     0,
                     0,
                     0,
                     0,
                     0,
                     &v96);
          v4 += 34;
          goto LABEL_326;
        case 0x53:
          result = *(v4 - 1);
          switch ( *(v4 - 1) )
          {
            case 1u:
              sub_80037F78(v3, *(v6 + 15));
              v39 = *(v4 + 46);
              if ( v39 == 2 )
              {
                *(v4 - 1) = 2;
                result = 3;
                *(v4 + 46) = 3;
              }
              else
              {
                if ( *(v4 + 46) < 3u )
                {
                  result = 2;
                  goto LABEL_270;
                }
                result = 3;
                if ( v39 != 3 )
                {
                  v4 += 34;
                  goto LABEL_326;
                }
                *(v4 - 1) = 3;
                result = 2;
                *(v4 + 46) = 2;
              }
              goto LABEL_325;
            case 2u:
              *v4 += 256;
              result = 4095;
              if ( *v4 < 0x1000u )
                goto LABEL_325;
              *v4 = 4095;
              goto LABEL_133;
            case 3u:
              v40 = *v4 + 65280;
              *v4 -= 256;
              result = v40 << 16;
              if ( result > 0 )
                goto LABEL_325;
              *v4 = 0;
LABEL_133:
              sub_80039190(*(v4 + 47));
              if ( *(v4 + 46) == 1 )
              {
                sub_80037F78(v3, *(v6 + 15));
                result = 4;
                goto LABEL_140;
              }
              if ( *(v4 + 46) >= 2u )
              {
                result = *(v4 + 46) < 4u;
                if ( *(v4 + 46) < 4u )
                  *(v4 - 1) = 0;
                goto LABEL_325;
              }
              result = 99;
              if ( !*(v4 + 46) )
                goto LABEL_300;
              v4 += 34;
              break;
            case 4u:
              v41 = *v4 + 65280;
              *v4 -= 256;
              v13 = v41 << 16 > 0;
              result = 99;
              if ( !v13 )
                goto LABEL_300;
              goto LABEL_325;
            case 9u:
              result = 4095;
              if ( *(v4 + 46) == 3 )
                *v4 = 4095;
              goto LABEL_21;
            default:
              goto LABEL_325;
          }
          goto LABEL_326;
        case 0x54:
          v54 = *(v4 - 1);
          if ( v54 == 1 )
          {
            *v4 += 256;
            result = *v4 < 0xFFFu;
            if ( *v4 >= 0xFFFu )
            {
              v55 = *(v4 + 52);
              *(v4 - 9) = 1;
              *v4 = 0;
              if ( (v55 & 2) != 0 )
              {
                result = 99;
                *(v4 - 1) = 99;
                *(v4 + 46) = -1;
              }
              else
              {
LABEL_269:
                result = 2;
LABEL_270:
                *(v4 - 1) = 2;
              }
            }
          }
          else if ( *(v4 - 1) >= 2u )
          {
            result = 99;
            if ( v54 != 32 )
            {
              if ( v54 == 99 )
                break;
LABEL_194:
              result = *(v4 - 1) + 1;
              *(v4 - 1) = result;
              break;
            }
            *v4 += 128;
            result = *v4 < 0xFFFu;
            if ( *v4 >= 0xFFFu )
            {
              v56 = *(v4 + 54);
              v57 = v4[14];
              *(v4 - 9) = 0;
              *v4 = 0;
              *(v4 - 1) = 0;
              result = sub_80037A1C(
                         v56,
                         *(v4 + 5),
                         *(v4 + 9),
                         v57,
                         &dword_8006F2C0[15 * *(v6 + 14)] + 30 * (v4[26] & 1),
                         0,
                         0);
              v4[19] = 0;
              v4[18] = 0;
              v4[17] = 0;
            }
          }
          else
          {
            if ( *(v4 - 1) )
              goto LABEL_194;
            if ( sub_8003955C(
                   *(v4 + 47) - ((*(v4 + 49) - 1) >> 1),
                   *(v4 + 48) - ((*(v4 + 50) - 1) >> 1),
                   *(v4 + 49),
                   *(v4 + 50),
                   -128 * *(v4 + 51))
              || (result = *(v4 + 46), result == 255) )
            {
              sub_80037A1C(
                *(v4 + 54),
                *(v4 + 5),
                *(v4 + 9),
                v4[14],
                &dword_8006F2C0[15 * *(v6 + 14)] + 30 * (v4[26] & 1),
                1,
                128);
              result = 4096;
              *(v4 - 1) = 1;
              v4[19] = 4096;
              v4[18] = 4096;
              v4[17] = 4096;
            }
          }
          break;
        case 0x58:
          v42 = *(v4 - 1);
          result = v42 < 3;
          if ( v42 == 2 )
          {
            v44 = *v4 + 65472;
            *v4 -= 64;
            v13 = v44 << 16 > 0;
            result = 99;
            if ( v13 )
              break;
            *(v4 - 1) = 99;
            v45 = *(v4 + 49);
            *v4 = 0;
            result = sub_80037C0C(*v3, *(v4 + 50), *(v4 + 51), *(v4 + 48), v45, *(v4 + 52), *(v4 + 53), v4[14], 45);
            goto LABEL_161;
          }
          if ( *(v4 - 1) < 3u )
          {
            if ( v42 != 1 )
            {
              v4 += 34;
              goto LABEL_326;
            }
            if ( *(v4 + 46) )
            {
              v43 = 3;
              if ( *(v4 + 46) != 1 )
                goto LABEL_158;
            }
            else
            {
              v43 = 2;
            }
            *(v4 - 1) = v43;
            sub_80037F78(v3, 68);
LABEL_158:
            result = sub_80037C0C(
                       *v3,
                       *(v4 + 50) + *(v4 + 52),
                       *(v4 + 51),
                       *(v4 + 48),
                       *(v4 + 49),
                       *(v4 + 52),
                       *(v4 + 53),
                       v4[14],
                       45);
LABEL_161:
            v4 += 34;
            goto LABEL_326;
          }
          if ( v42 != 3 )
          {
            v4 += 34;
            goto LABEL_326;
          }
          *v4 += 64;
          result = 4095;
          if ( *v4 >= 0x1000u )
          {
            *v4 = 4095;
LABEL_299:
            result = 99;
LABEL_300:
            *(v4 - 1) = 99;
          }
          break;
        case 0x59:
          result = *(v4 - 1);
          switch ( *(v4 - 1) )
          {
            case 1u:
              result = v4[24];
              a1 = *(v4 + 56);
              *(v4 - 1) = 2;
              v4[27] = result;
              *v3 = a1;
              goto LABEL_325;
            case 2u:
              v46 = v4[27];
              result = v46 - 1;
              v4[27] = v46 - 1;
              if ( v46 )
                goto LABEL_325;
              v47 = *(v4 + 9);
              *(v4 - 1) = 3;
              v48 = &g_MapData[200 * (v47 >> 11)] + 10 * (*(v4 + 5) >> 11);
              if ( *v3 != 1 )
                v48 += 5;
              v48[3] = 116;
              result = sub_80037F78(v3, 227);
              v4 += 34;
              break;
            case 3u:
              v49 = v4[3] + 65280;
              v4[3] -= 256;
              v13 = v49 << 16 > 0;
              result = 4;
              if ( !v13 )
              {
                v50 = v4[25];
                v4[3] = 0;
                *(v4 - 1) = 4;
                v4[27] = v50;
              }
              goto LABEL_325;
            case 4u:
              v51 = v4[27];
              result = v51 - 1;
              v4[27] = v51 - 1;
              if ( !v51 )
              {
                sub_80037F78(v3, 227);
                result = 5;
                *(v4 - 1) = 5;
              }
              goto LABEL_325;
            case 5u:
              v4[3] += 256;
              result = 4096;
              if ( v4[3] >= 0x1000u )
              {
                v52 = *(v4 + 9);
                v4[3] = 4096;
                *(v4 - 1) = 0;
                a1 = &g_MapData[200 * (v52 >> 11)] + 10 * (*(v4 + 5) >> 11);
                if ( *v3 != 1 )
                  a1 += 5;
                result = 117;
                *(a1 + 3) = 117;
                *v3 = 0;
              }
              goto LABEL_325;
            default:
              goto LABEL_325;
          }
          goto LABEL_326;
        case 0x60:
          result = *(v4 - 1);
          if ( *(v4 - 1) )
          {
            if ( result != 1 )
            {
              v4 += 34;
              goto LABEL_326;
            }
            v4[15] += v4[26];
            result = v4[26] + 16;
            v13 = v4[15] < 1024;
            v4[26] = result;
            if ( !v13 )
            {
              v4[15] = 1024;
              goto LABEL_299;
            }
          }
          else
          {
            v79 = MAP_CollisionWithTile(*(v4 + 5), *(v4 + 7), *(v4 + 9), *(v6 + 2), *(v6 + 4));
            a1 = 2;
            a2 = v79;
            if ( !g_TileLayerOffset )
              a1 = 1;
            *v3 = a1;
            *(v4 + 7) += v4[26];
            result = v4[26] + 20;
            v13 = *(v4 + 7) < a2;
            v4[26] = result;
            if ( !v13 )
            {
              result = 16;
              *(v4 + 7) = a2;
              v4[26] = 16;
              *(v4 - 1) = 1;
            }
          }
          break;
        case 0x61:
          result = *(v4 - 1);
          if ( !*(v4 - 1) )
          {
            v80 = MAP_CollisionWithTile(*(v4 + 5), *(v4 + 7), *(v4 + 9), *(v6 + 2), *(v6 + 4));
            a1 = 2;
            a2 = v80;
            if ( !g_TileLayerOffset )
              a1 = 1;
            *v3 = a1;
            v81 = v4[14] + 256;
            *(v4 + 7) += 20;
            result = *(v4 + 7) < v80;
            v13 = *(v4 + 7) < a2;
            v4[14] = v81 & 0xFFF;
            if ( !v13 )
            {
              result = 99;
              *(v4 + 7) = a2;
              *(v4 - 1) = 99;
            }
          }
          break;
        case 0x62:
          v82 = *(v4 - 1);
          result = v82 < 2;
          if ( v82 < 2 )
          {
            v83 = MAP_CollisionWithTile(*(v4 + 5), *(v4 + 7), *(v4 + 9), *(v6 + 2), *(v6 + 4));
            v84 = 2;
            v85 = v83;
            if ( !g_TileLayerOffset )
              v84 = 1;
            *v3 = v84;
            *(v4 + 7) += v4[26];
            sub_80044814(v3 + 5, 4096, 6000, 300);
            v86 = v4[13];
            v87 = v86 - 160;
            if ( !*(v4 - 1) )
              v87 = v86 + 160;
            v88 = v87 & 0xFFF;
            v89 = v4[26];
            v4[13] = v88;
            result = v89 + 30;
            a1 = result << 16;
            v90 = result;
            v4[26] = result;
            if ( (result & 0x8000u) == 0 )
            {
              result = result < 80;
              if ( *(v4 + 7) >= v85 )
              {
                result = 2;
                if ( v90 >= 80 )
                {
                  v91 = *(v4 - 1);
                  result = -(a1 >> 17);
                  v4[26] = result;
                  *(v4 - 1) = v91 == 0;
                }
                else
                {
                  *(v4 + 7) = v85;
                  *(v4 - 1) = 2;
                }
              }
            }
            break;
          }
          if ( v82 != 2 )
            break;
          LOWORD(result) = sub_80014C84(v4[13], v4[16], 160);
          v4[13] = result;
          result = result;
          if ( result != v4[16] )
            break;
          goto LABEL_299;
        case 0xE0:
          result = sub_8003955C(*(v4 + 5) >> 11, *(v4 + 9) >> 11, *(v4 + 46), *(v4 + 47), *(v4 + 7));
          if ( !result )
            break;
          result = sub_800166F8(
                     *(v4 + 48),
                     *(v4 + 49),
                     *(v4 + 50),
                     *(v4 + 51),
                     *(v4 + 52),
                     *(v4 + 54),
                     *(v4 + 55),
                     *(v4 + 56));
          v4 += 34;
          goto LABEL_326;
        case 0xE1:
          result = sub_8003955C(*(v4 + 5) >> 11, *(v4 + 9) >> 11, *(v4 + 46), *(v4 + 47), *(v4 + 7));
          if ( !result )
            goto LABEL_314;
          result = *(v4 + 54);
          if ( *(v4 + 54) )
            break;
          if ( (v4[24] & 0x80) == 0 )
            *(v4 + 54) = 1;
          v92 = v4[24] & 0xF;
          result = v92 < 2;
          if ( v92 == 1 )
          {
            v93 = *(v4 + 49);
            v4 += 34;
            result = sub_80039190(v93);
          }
          else if ( (v4[24] & 0xFu) >= 2 )
          {
            if ( v92 == 2 )
            {
              result = *(v4 + 50);
              byte_801B51DC[*(v4 + 49)] = result;
            }
            v4 += 34;
          }
          else
          {
            if ( (v4[24] & 0xF) == 0 )
              result = (*&g_CurrentStateVTable->gap0[12])(v3);
            v4 += 34;
          }
          goto LABEL_326;
        default:
          result = (*&g_CurrentStateVTable[1].gap0[8])(a1, a2, a3);
          break;
      }
    }
LABEL_325:
    v4 += 34;
LABEL_326:
    v3 += 17;
    v13 = v102-- != 1;
  }
  while ( v13 );
  dword_80180128 = 0;
  return result;
}
// 8003A16C: variable 'a3' is possibly undefined
// 8003B6EC: variable 'a1' is possibly undefined
// 8003B6EC: variable 'a2' is possibly undefined
// 80062BF0: using guessed type int __fastcall rand(_DWORD);
// 8006F2C0: using guessed type int dword_8006F2C0[33];
// 8006F3B0: using guessed type int dword_8006F3B0[8];
// 80076380: using guessed type int dword_80076380[2];
// 80076388: using guessed type int dword_80076388[2];
// 80076390: using guessed type int dword_80076390[2];
// 80076398: using guessed type int dword_80076398;
// 8009DEBC: using guessed type char byte_8009DEBC;
// 801779F0: using guessed type _DWORD GameDB01ObjectClassDeclaration[];
// 80180124: using guessed type int dword_80180124;
// 80180128: using guessed type int dword_80180128;
// 8019B5C6: using guessed type __int16 word_8019B5C6;
// 8019B5CC: using guessed type int dword_8019B5CC;
// 8019B5D6: using guessed type __int16 word_8019B5D6;
// 8019B5EC: using guessed type __int16 word_8019B5EC;
// 801B51DC: using guessed type _BYTE byte_801B51DC[192];
// 801BA5B0: using guessed type int dword_801BA5B0;
// 801CBD74: using guessed type _DWORD g_MapData[];
// 801DD57E: using guessed type __int16 g_TileLayerOffset;
// 80039948: using guessed type int var_28[8];

//----- (8003B748) --------------------------------------------------------
unsigned __int8 *sub_8003B748()
{
  unsigned __int8 *v0; // $v1
  int v1; // $a0
  unsigned __int8 *result; // $v0

  v0 = &unk_80174210;
  v1 = 9;
  while ( 1 )
  {
    result = v0;
    if ( *v0 == 255 )
      break;
    --v1;
    v0 += 124;
    if ( v1 == -1 )
      return 0;
  }
  return result;
}

//----- (8003B784) --------------------------------------------------------
int __fastcall Entity_UpdatePhysics(Entity *e)
{
  int fine_z; // $a1
  int coll_radius; // $a3
  int v4; // $v0
  char current_layer; // $a0
  int v6; // $v1
  int height; // $v0
  int floorY; // $v0
  int result; // $v0

  fine_z = e->fine_z;
  coll_radius = e->coll_radius;
  // grid_x (1 )     (0255).
  // unk_24 (short):      (02047).
  v4 = (e->grid_x << 11) + e->fine_x;
  current_layer = e->current_layer;
  v6 = e->grind_z << 11;
  e->pos.X = v4;
  height = e->height;
  e->pos.Z = v6 + fine_z;
  floorY = Map_GetCellData(current_layer, e->pos.X, e->pos.Z, coll_radius, height);
  e->pos.Y = floorY;
  if ( floorY >= 0 )
    e->pos.Y = 0;
  if ( (e->bit_flags & 0x400) != 0 )
    e->pos.Y = g_CurrentFloorBaseHeight;
  result = e->bit_flags & 0x10;
  if ( !result )
  {
    result = e->vertical_velocity + e->pos.Y;
    e->pos.Y = result;
  }
  return result;
}
// 801DD580: using guessed type int g_CurrentFloorBaseHeight;

//----- (8003B848) --------------------------------------------------------
int __fastcall Entity_LoadStats(Entity *e)
{
  EntityDefinition *def; // $v0
  int result; // $v0

  def = &g_ObjectTypeTable[30 * e->type_id];    // field_2 = id?
  e->flags = def->flags[0];                     //  Definition + 0x00 -> Entity + 0x01
  e->hp_current = *&def->unk_param[4];
  e->coll_radius = def->coll_radius;
  e->height = def->coll_height;
  e->bit_flags = *&def->unk_param[30];
  result = *&def->unk_param[28];
  *&e->ai_scratchpad[8] = result;
  *&e->ai_scratchpad[6] = result;
  *&e->ai_scratchpad[4] = result;
  return result;
}

//----- (8003B8BC) --------------------------------------------------------
int __fastcall Entity_EnterCombatState(Entity *e)
{
  int v2; // $a0
  char init_flags; // $v0
  int bit_flag; // $v0

  Entity_LoadStats(e);
  init_flags = e->init_flags;
  e->current_state = 1;                         // mb E_COMBAT_STATE
  LOBYTE(e->anim_frame) = 0;
  e->anim_timer = 0;
  e->ai_substate = 0;
  HIBYTE(e->anim_frame) = 0;
  e->ai_timer_1 = 0;
  e->ai_timer_2 = -1;
  *&e->ai_scratchpad[28] = 0;
  if ( (init_flags & 1) == 0 )
    e->unk_42 = rand(v2) >> 3;
  e->action_id = 71;
  bit_flag = e->bit_flags;
  *&e->ai_scratchpad[16] = 0;
  *&e->ai_scratchpad[14] = 0;
  *&e->ai_scratchpad[12] = 0;
  *&e->ai_scratchpad[20] = 0;
  e->speed = 2048;                              // (0.5  fixed point 4096)
  if ( (bit_flag & 0x80) != 0 )
    HIBYTE(e->angle_speed) = 1;
  else
    HIBYTE(e->angle_speed) = -1;
  return Map_MarkOccupiedTiles(e->pos.X, e->pos.Z, e->coll_radius, 1);
}
// 8003B90C: variable 'v2' is possibly undefined
// 80062BF0: using guessed type int __fastcall rand(_DWORD);

//----- (8003B984) --------------------------------------------------------
int __fastcall sub_8003B984(int a1)
{
  *(a1 + 9) = 3;
  return Entity_UpdatePhysics(a1);
}

//----- (8003B9A8) --------------------------------------------------------
int sub_8003B9A8()
{
  Entity **v0; // $s1
  int v1; // $s2
  unsigned __int16 *v2; // $s0
  int result; // $v0

  v0 = g_ObjectArray;
  v1 = 199;
  v2 = &unk_8016E620;
  do
  {
    if ( *v0 == 1 && *(v2 - 15) == 1 && (*(v2 - 3) & 0xFFFF0000) == -268238848 && (v2[44] || *v2 >= 0x801u) )
    {
      (*&g_CurrentStateVTable[2].gap0[20])(v0);
      sub_8003B984(v0);
    }
    v2 += 62;
    --v1;
    result = -1;
    v0 += 31;
  }
  while ( v1 != -1 );
  return result;
}

//----- (8003BA7C) --------------------------------------------------------
int __fastcall Entity_Alert(#15 *e)
{
  char v2; // $v0
  __int16 v3; // $v1
  int result; // $v0

  v2 = *(e + 6);
  v3 = *(e + 16);
  *(e + 34) = 0;
  *(e + 32) = 0;
  *(e + 3) = v2;
  *(e + 33) = v3;
  Entity_UpdatePhysics(e);
  Entity_EnterCombatState(e);
  result = 3;
  if ( *e == 3 )
    *(e + 3) = 0;
  return result;
}

//----- (8003BB10) --------------------------------------------------------
BOOL InitEntitySystem()
{
  Entity **v0; // $a0
  int v1; // $a1
  _DWORD *v2; // $v1
  BOOL result; // $v0

  g_FrameCounter = 0;
  v0 = g_ObjectArray;
  v1 = 0;
  v2 = &unk_8016E664;
  do
  {
    ++v1;
    *v0 = -1;
    *(v2 - 83) = 0;
    *v2 = 0;
    v2 += 31;
    result = v1 < 200u;
    v0 += 31;
  }
  while ( v1 < 200u );
  byte_801779A8 = 0;
  return result;
}
// 801779A8: using guessed type char byte_801779A8;
// 801779CC: using guessed type int g_FrameCounter;

//----- (8003BB60) --------------------------------------------------------
int __fastcall sub_8003BB60(int a1, unsigned __int8 *a2)
{
  int result; // $v0

  *(a1 + 16) = *(a1 + 14);
  if ( a2 )
  {
    *(a1 + 96) = a2;
    result = *a2;
    *(a1 + 15) = 0;
    *(a1 + 14) = result;
  }
  else
  {
    result = 255;
    *(a1 + 96) = 0;
    *(a1 + 14) = -1;
    *(a1 + 15) = -1;
  }
  return result;
}

//----- (8003BB98) --------------------------------------------------------
int __fastcall sub_8003BB98(Action *action, int distance)
{
  int v2; // $s0
  Entity *e; // $s2
  int result; // $v0
  int v7; // $s0
  int base_priority; // $a0
  int RandomizedWeight; // $s0
  unsigned int ai_timer_1; // $v1
  bool v11; // dc
  __int16 v12; // $v0
  __int16 player_angle; // $v0
  int v14; // $v1
  int v15; // $v0
  __int16 v16; // $v0
  __int16 v17; // $v0
  __int16 v18; // $v0

  e = g_CurrentEntityPtr;
  if ( action->type == 255 )
    return 0;
  switch ( action->type )
  {
    case 2:
    case 3:
    case 22:
      return 0;
    case 4:
    case 18:
    case 23:
    case 24:
    case 132:
      v7 = 0;
      if ( (g_CurrentEntityPtr->bit_flags & 0x100) != 0 || action->attack_range < distance )
        return v7;
      //   ?
      if ( !Math_IsTargetInVerticalRange(
              g_CurrentEntityPtr->pos.Y,
              g_CurrentEntityPtr->height,
              *&g_LanguageID[0].header[6] + 200,
              2100) )
        return 0;
      //  PS1 atan2    0  4095 ( )
      //  e->pos.x ( 44), e->pos.z ( 52)
      //  g_PlayerPosX - e->pos.x, g_PlayerPosZ - e->pos.z
      player_angle = Math_Atan2_Fixed(
                       *&g_LanguageID[0].header[2] - e->pos.X,
                       *&g_LanguageID[0].menus[0].header.posY - e->pos.Z);
      //  ?
      if ( !Math_IsAngleInRange(e->unk_42, player_angle, 16 * LOBYTE(action->tolerance)) )
        return 0;
      if ( action == *&e->ai_scratchpad[28] )
      {
        base_priority = action->base_priority;
        return AI_GetRandomizedWeight(base_priority);
      }
      v14 = LOBYTE(action->unsigned___int16E) << 6;
      if ( distance < (v14 + action->attack_range) >> 1 )
      {
        base_priority = action->field_2;
        if ( distance < v14 )
          return AI_GetRandomizedWeight(base_priority);
        v15 = 715827883;
      }
      else
      {
        v15 = 1431655766;
      }
      base_priority = action->field_2 - ((action->field_2 * v15) >> 32);
      return AI_GetRandomizedWeight(base_priority);
    case 5:
    case 13:
      if ( action != *&g_CurrentEntityPtr->ai_scratchpad[28] )
      {
        RandomizedWeight = 0;
        if ( action->tolerance >= distance )
          RandomizedWeight = AI_GetRandomizedWeight(action->field_2);
        ai_timer_1 = e->ai_timer_1;             // ai_phase ?
        if ( ai_timer_1 >= 0x19 )
        {
          result = RandomizedWeight;
          if ( ai_timer_1 != 132 )
            return result;
        }
        else if ( e->ai_timer_1 < 0x17u && ai_timer_1 != 4 )
        {
          result = RandomizedWeight;
          if ( ai_timer_1 != 18 )
            return result;
        }
        return 2 * RandomizedWeight;
      }
      v7 = 0;
      if ( action->unsigned___int1612 < distance )
        return v7;
      base_priority = action->base_priority;
      return AI_GetRandomizedWeight(base_priority);
    case 9:
      if ( action->unsigned___int16C < distance )
        return 0;
      if ( (*&g_LanguageID[0].header[6] - g_CurrentEntityPtr->pos.Y + 1023) < 0x7FF )
      {
        v11 = rand(action) >= 4096;
        result = v2;
        if ( v11 )
          return result;
      }
      v12 = Math_Atan2_Fixed(*&g_LanguageID[0].header[2] - e->pos.X, *&g_LanguageID[0].menus[0].header.posY - e->pos.Z);
      v11 = Math_IsAngleInRange(e->unk_42, v12, 320) != 0;
      result = v2;
      if ( !v11 )
        return result;
      goto LABEL_49;
    case 11:
      v7 = 0;
      if ( action->attack_range < distance )
        return v7;
      v17 = Math_Atan2_Fixed(
              *&g_LanguageID[0].header[2] - g_CurrentEntityPtr->pos.X,
              *&g_LanguageID[0].menus[0].header.posY - g_CurrentEntityPtr->pos.Z);
      if ( Math_IsAngleInRange(e->unk_42, v17, 320) )
        goto LABEL_49;
      return 0;
    case 19:
    case 20:
      v7 = 0;
      if ( action->unsigned___int16E < distance )
        return v7;
      result = 0;
      if ( g_ActiveWeaponSpell.field_14 == -1 )
        return result;
      v18 = Math_Atan2_Fixed(
              *&g_LanguageID[0].header[2] - g_CurrentEntityPtr->pos.X,
              *&g_LanguageID[0].menus[0].header.posY - g_CurrentEntityPtr->pos.Z);
      if ( Math_IsAngleInRange(e->unk_42, v18, 32 * LOBYTE(action->unsigned___int16C)) )
        goto LABEL_49;
      return 0;
    case 25:
      v7 = 0;
      if ( (g_CurrentEntityPtr->bit_flags & 0x100) != 0 )
        return v7;
      result = 0;
      if ( action->unsigned___int1616 < distance )
        return result;
      result = 0;
      if ( distance < action->unsigned___int1614 )
        return result;
      v16 = Math_Atan2_Fixed(
              *&g_LanguageID[0].header[2] - g_CurrentEntityPtr->pos.X,
              *&g_LanguageID[0].menus[0].header.posY - g_CurrentEntityPtr->pos.Z);
      if ( !Math_IsAngleInRange(e->unk_42, v16, 16 * HIBYTE(action->unsigned___int16C)) )
        return 0;
LABEL_49:
      if ( action == *&e->ai_scratchpad[28] )
        base_priority = action->base_priority;
      else
        base_priority = action->field_2;
      return AI_GetRandomizedWeight(base_priority);
    case 27:
      if ( distance < action->unsigned___int16C )
        return 0;
      goto LABEL_49;
    case 112:
      return -1;
    default:
      if ( action->type < 0x80u )
        goto LABEL_49;
      v11 = (*&g_CurrentStateVTable[2].gap0[8])(action, distance) == 0;
      result = v2;
      if ( !v11 )
        goto LABEL_49;
      return result;
  }
}
// 8003BCE4: variable 'v2' is possibly undefined
// 80062BF0: using guessed type int __fastcall rand(_DWORD);

//----- (8003C038) --------------------------------------------------------
int __fastcall Entity_SelectAction(int a1)
{
  Entity *v2; // $s5
  int result; // $v0
  Action **actions; // $s2
  int v5; // $s3
  unsigned __int8 *v6; // $s4
  int i; // $s1
  Action *v8; // $s0
  int v10; // $v1

  v2 = g_CurrentEntityPtr;
  result = 240;
  if ( g_CurrentEntityPtr->ai_timer_2 != 240 )
  {
    actions = &g_CurrentEntityDef->unk_param[34];
    if ( g_CurrentEntityPtr->ai_timer_2 )
    {
      v5 = -2;
      v6 = 0;
      for ( i = 15; i != -1; --i )
      {
        v8 = *actions;
        if ( *actions++ == 0 )                  // NULL
          break;
        v10 = sub_8003BB98(v8, a1);
        result = v5 < v10;
        if ( v5 < v10 )
        {
          v5 = v10;
          v6 = v8;
        }
      }
      if ( v6 )
      {
        if ( v6 != *&v2->ai_scratchpad[28] )
          return sub_8003BB60(v2, v6);
        result = 255;
        if ( v2->ai_timer_2 == 255 )
          return sub_8003BB60(v2, v6);
      }
    }
  }
  return result;
}

//----- (8003C138) --------------------------------------------------------
int Entity_UpdateAIByDistance()
{
  int v0; // $v0

  v0 = CalculateDistance(
         g_CurrentEntityPtr->pos.X - *&g_LanguageID[0].header[2],
         g_CurrentEntityPtr->pos.Z - *&g_LanguageID[0].menus[0].header.posY);
  return Entity_SelectAction(v0);
}

//----- (8003C184) --------------------------------------------------------
unsigned __int8 *__fastcall sub_8003C184(int a1, unsigned __int8 a2)
{
  unsigned __int8 **v2; // $a0
  int i; // $a2
  unsigned __int8 *v4; // $v1
  unsigned __int8 *result; // $v0

  v2 = (a1 + 56);
  for ( i = 15; i != -1; --i )
  {
    v4 = *v2;
    if ( *v2++ == 0 )
      break;
    result = v4;
    if ( *v4 == a2 )
      return result;
  }
  return 0;
}

//----- (8003C1CC) --------------------------------------------------------
int __fastcall sub_8003C1CC(int a1, unsigned __int8 a2)
{
  unsigned __int8 *v3; // $v0

  v3 = sub_8003C184(&g_ObjectTypeTable[30 * *(a1 + 2)], a2);
  return sub_8003BB60(a1, v3);
}

//----- (8003C220) --------------------------------------------------------
int sub_8003C220()
{
  Entity *v0; // $v1

  v0 = g_CurrentEntityPtr;
  *&g_CurrentEntityPtr->ai_scratchpad[28] = 0;
  v0->ai_timer_2 = -1;
  return Entity_UpdateAIByDistance();
}

//----- (8003C250) --------------------------------------------------------
int __fastcall sub_8003C250(unsigned __int8 a1)
{
  int result; // $v0

  result = 255;
  if ( a1 != 255 )
  {
    result = g_CurrentEntityPtr;
    LOBYTE(g_CurrentEntityPtr->anim_frame) = a1;
    *(result + 24) = 0;
  }
  return result;
}

//----- (8003C27C) --------------------------------------------------------
int __fastcall sub_8003C27C(unsigned __int8 a1)
{
  Entity *v1; // $v1
  int result; // $v0

  v1 = g_CurrentEntityPtr;
  result = 255;
  if ( a1 != 255 )
  {
    result = LOBYTE(g_CurrentEntityPtr->anim_frame);
    if ( result != a1 )
    {
      LOBYTE(g_CurrentEntityPtr->anim_frame) = a1;
      v1->anim_timer = 0;
    }
  }
  return result;
}

//----- (8003C2B4) --------------------------------------------------------
unsigned int Entity_UpdateDetection()
{
  Entity *e; // $s0
  EntityDefinition *edef; // $s3
  unsigned int current_state; // $v1
  int active; // $s4
  unsigned int result; // $v0
  int v5; // $a0
  int DistanceIfInRange; // $s2
  int aggression; // $s1
  int v8; // $s1
  int v9; // $v1
  int v10; // $v0
  int v11; // $v0
  unsigned __int8 *v12; // $v0
  Entity *v13; // $a0
  Entity *v14; // $a0

  e = g_CurrentEntityPtr;
  edef = g_CurrentEntityDef;
  current_state = g_CurrentEntityPtr->current_state;
  active = g_CurrentEntityPtr->active;
  result = current_state < 2;
  if ( current_state == 1 )
  {
    result = GetDistanceIfInRange(
               &g_CurrentEntityPtr->pos,
               *&g_LanguageID[0].header[2],
               0xFFFF,
               *&g_LanguageID[0].menus[0].header.posY,
               g_CurrentEntityDef->combat_vision << 11,
               0,
               0);
    if ( result != -1 )
      return result;
    Map_MarkOccupiedTiles(e->pos.X, e->pos.Z, e->coll_radius, -1);
    v14 = e;
    e->current_state = 0;
    return Entity_UpdatePhysics(v14);
  }
  if ( g_CurrentEntityPtr->current_state >= 2u )
  {
    result = active - 3;
    if ( current_state != 2 )
      return result;
    if ( result >= 2 )
    {
      result = GetDistanceIfInRange(
                 &g_CurrentEntityPtr->pos,
                 *&g_LanguageID[0].header[2],
                 0xFFFF,
                 *&g_LanguageID[0].menus[0].header.posY,
                 g_CurrentEntityDef->combat_vision << 11,
                 0,
                 0);
      if ( result != -1 )
        return result;
      e->current_state = 0;
    }
    else
    {
      result = *(dword_801779BC + 9);
      if ( result == 1 )
        return result;
      g_CurrentEntityPtr->current_state = 0;
    }
    v14 = e;
    return Entity_UpdatePhysics(v14);
  }
  if ( g_CurrentEntityPtr->current_state )
    return result;
  DistanceIfInRange = GetDistanceIfInRange(
                        &g_CurrentEntityPtr->pos,
                        *&g_LanguageID[0].header[2],
                        0xFFFF,
                        *&g_LanguageID[0].menus[0].header.posY,
                        (g_CurrentEntityDef->idle_vision + 1) << 11,
                        0,
                        0);
  result = active - 3;
  if ( DistanceIfInRange == -1 )
    return result;
  if ( result < 2 )
  {
    result = *(dword_801779BC + 9);
    if ( result != 1 )
      return result;
    Entity_Alert(g_CurrentEntityPtr);
    return Entity_SelectAction(DistanceIfInRange);
  }
  if ( active == 2 )
  {
    aggression = e->aggression;
    if ( aggression != 255 )
    {
      result = aggression < rand(v5) >> 4;
      if ( result )
        return result;
    }
    goto LABEL_21;
  }
  if ( DistanceIfInRange < edef->idle_vision << 11 && !g_PhysicsReady )
    goto LABEL_26;
  if ( active == 1 )
    goto LABEL_21;
  if ( active )
  {
LABEL_26:
    v9 = active;
  }
  else
  {
    v8 = e->aggression;
    v9 = active;
    if ( e->aggression )
    {
      v10 = rand(v5);
      v9 = active;
      if ( v8 >= v10 >> 7 )
      {
LABEL_21:
        v11 = Entity_CheckWorldCollision(e->pos.X, e->pos.Y, e->pos.Z, edef->coll_radius, edef->coll_height);
        v9 = active;
        if ( v11 == -1 )
        {
          Entity_Alert(g_CurrentEntityPtr);
          v12 = sub_8003C184(edef, 0x15u);
          v13 = e;
          if ( v12 )
            return sub_8003BB60(v13, v12);
          v12 = sub_8003C184(edef, 0x1Au);
          v13 = e;
          if ( v12 )
            return sub_8003BB60(v13, v12);
          return Entity_SelectAction(DistanceIfInRange);
        }
      }
    }
  }
  result = 2;
  if ( v9 != 2 )
    e->current_state = 2;
  return result;
}
// 8003C3C0: variable 'v5' is possibly undefined
// 80062BF0: using guessed type int __fastcall rand(_DWORD);
// 801779BC: using guessed type int dword_801779BC;
// 8019B4CE: using guessed type char g_PhysicsReady;

//----- (8003C69C) --------------------------------------------------------
int __fastcall sub_8003C69C(int a1, int a2, int a3)
{
  int v3; // $a1
  int v4; // $v1
  int v5; // $a0
  int v7; // $a1
  int v8; // $a0
  int v9; // $v1

  v3 = 16 * a2;
  v4 = 16 * a3;
  v5 = 16 * a1;
  if ( !v3 )
    return 0;
  v7 = v3 + v5;
  v8 = v7 - v4;
  if ( v7 - v4 < 0 )
    v8 = 0;
  if ( !v4 )
    v4 = 16;
  v9 = 2 * v4;
  if ( v9 == -1 && v7 * v7 == 0x80000000 )
    _break(6u, 0);
  return v8 + v7 * v7 / v9;
}
// 8003C6E0: conditional instruction was optimized away because $v1.4!=0

//----- (8003C718) --------------------------------------------------------
int __fastcall ApplyDamage(
        unsigned __int16 entity_id,
        unsigned __int16 unk_8019B4EC,
        unsigned __int16 AttackStrike,
        unsigned __int16 AttackSlash,
        unsigned __int16 AttackPierce,
        unsigned __int16 AttackWhiteMagic,
        unsigned __int16 AttackFire,
        unsigned __int16 AttackEarth,
        unsigned __int16 AttackWind,
        unsigned __int16 AttackWater,
        unsigned __int16 damage_multiply,
        char unk_val17,
        _DWORD *hit_pos)
{
  Entity **v14; // $s2
  int v16; // $v0
  int v17; // $a0
  EntityDefinition **v18; // $s7
  int result; // $v0
  int v20; // $s3
  int v21; // $s0
  int v22; // $a2
  int v23; // $s5
  int v24; // $a2
  int v25; // $s5
  int v26; // $a2
  int v27; // $s5
  int v28; // $a2
  int v29; // $s5
  int v30; // $s5
  int v31; // $s5
  int v32; // $s5
  int v33; // $s5
  int v34; // $s5
  int v35; // $a0
  __int16 v36; // $a1
  unsigned __int8 *v37; // $s0
  __int16 v38; // $v0
  int v39; // $v0
  __int16 v40; // $s6
  int *v41; // $s4
  int v42; // $a0
  int i; // $s3
  int v44; // $s0
  int v46; // $s1
  int v47; // $a0
  int v48; // $v0
  int v49; // $s0
  int v50; // $v0
  int v51; // $lo
  int v52; // $a0
  int v53; // $v1
  __int16 v54; // $v0
  int v55; // $v1
  Entity **v56; // $t1
  int v57; // $v1
  __int16 v58[4]; // [sp+28h] [-60h] BYREF
  unsigned __int16 v59; // [sp+30h] [-58h]
  unsigned __int16 v60; // [sp+38h] [-50h]
  unsigned __int16 v61; // [sp+40h] [-48h]
  unsigned __int16 v62; // [sp+48h] [-40h]
  _DWORD *v63; // [sp+50h] [-38h]
  Entity **v64; // [sp+58h] [-30h]
  int v65; // [sp+60h] [-28h]
  int v66; // [sp+68h] [-20h]
  int v67; // [sp+70h] [-18h]
  int v68; // [sp+78h] [-10h]
  int v69; // [sp+80h] [-8h]

  v63 = hit_pos;
  v59 = AttackEarth;
  v14 = &g_ObjectArray[31 * entity_id];
  v60 = AttackWind;
  v61 = AttackWater;
  v16 = *v14;
  v62 = damage_multiply;
  if ( v16 == 3 )
    v14 = &g_ObjectArray[31 * *(v14 + 17)];
  v17 = *(v14 + 14);
  v18 = &g_ObjectTypeTable[30 * *(v14 + 2)];
  if ( v17 != 3 || (result = *(v14 + 12) < 0x60Cu) != 0 )
  {
    result = 26;
    if ( v17 == 21 )
    {
      result = 1;
      if ( !*(v14 + 56) )
        *(v14 + 56) = 1;
      return result;
    }
    if ( v17 != 26 )
    {
      v65 = unk_val17 & 0x30;
      v20 = unk_val17 & 3;
      if ( v65 != 32 || (result = v14[10] & 0x100000) == 0 )
      {
        v21 = unk_8019B4EC;
        v22 = *(v18 + 16);
        v66 = AttackStrike;
        v23 = sub_8003C69C(unk_8019B4EC, AttackStrike, v22);
        v24 = *(v18 + 17);
        v67 = AttackSlash;
        v25 = v23 + sub_8003C69C(v21, AttackSlash, v24);
        v26 = *(v18 + 18);
        v68 = AttackPierce;
        v27 = v25 + sub_8003C69C(v21, AttackPierce, v26);
        v28 = *(v18 + 19);
        v69 = AttackWhiteMagic;
        v29 = v27 + sub_8003C69C(v21, AttackWhiteMagic, v28);
        v30 = v29 + sub_8003C69C(v21, AttackFire, *(v18 + 20));
        v31 = v30 + sub_8003C69C(v21, v59, *(v18 + 21));
        v32 = v31 + sub_8003C69C(v21, v60, *(v18 + 22));
        v33 = v32 + sub_8003C69C(v21, v61, *(v18 + 23));
        if ( v33 > 429495 )
          v33 = 429495;
        v34 = (v33 * v62 / 5000 + 128) >> 4;
        result = (*&g_CurrentStateVTable[2].gap0[16])(v14, v34, v66, v67, v68, v69, AttackFire, v59, v60, v61);
        if ( v34 )
        {
          if ( *(v14 + 13) && v65 == 16 )
          {
            if ( v20 == 2 )
            {
              sub_80026B7C(v35, v36);
            }
            else
            {
              if ( v20 != 1 )
                goto LABEL_22;
              if ( v62 >= 0x9C4u )
                sub_80026AE4(v35, v36);
            }
          }
          if ( v20 == 1 )
          {
            if ( *(v14 + 14) == 19 && *(v14 + 56) == 16 )
              goto LABEL_44;
            goto LABEL_29;
          }
LABEL_22:
          if ( v20 == 2 )
          {
            if ( (v14[10] & 0x40000) != 0 )
              goto LABEL_44;
            v37 = sub_8003C184(v18, 0x16u);
            if ( v37 )
            {
              v38 = Math_Atan2_Fixed(v14[11] - *v63, v14[13] - v63[2]);
              if ( Math_IsAngleInRange(*(v14 + 33), v38 + 2048, 512) )
              {
                sub_8003BB60(v14, v37);
                goto LABEL_44;
              }
            }
          }
LABEL_29:
          v39 = *(v14 + 13);
          v40 = v39 - v34;
          v41 = (v18 + 14);
          if ( v39 - v34 <= 0 )
          {
            if ( *(v14 + 13) )
            {
              v42 = v14;
              if ( v65 != 16 )
              {
LABEL_34:
                sub_8003C1CC(v42, 3u);
                *(v14 + 13) = 0;
                goto LABEL_44;
              }
              sub_80026C14(*(v18 + 15));
            }
            v42 = v14;
            goto LABEL_34;
          }
          for ( i = 15; i != -1; --i )
          {
            v44 = *v41;
            if ( *v41++ == 0 )
              break;
            if ( *v44 == 2 && v34 >= *(v44 + 12) )
            {
              v46 = *(v44 + 2);
              v47 = v14;
              if ( v46 == 255 || (v48 = rand(v14), v47 = v14, v48 >> 7 < v46) )
              {
                sub_8003BB60(v47, v44);
                *(v14 + 13) = v40;
                goto LABEL_44;
              }
            }
          }
          *(v14 + 13) = v40;
LABEL_44:
          if ( (v14[10] & 0x10) != 0 )
          {
            v64 = &g_ObjectArray[31 * *(v14 + 17)];
            v49 = BYTE2(g_ObjectArray[30 * *(v64 + 2) + 6200]);
          }
          else
          {
            v49 = *(v18 + 2);
          }
          if ( v63 && v49 < 240 )
          {
            sub_800159DC(v14[11] - *v63, v14[12] - (*(v14 + 15) >> 1) - v63[1], v14[13] - v63[2], v58);
            sub_80015538(v58, v14 + 40);
            v50 = SquareRoot0(v34 << 11);
            v51 = 32 * ((SquareRoot0(v50) << 10) / v49) / v49;
            v52 = v51 << 16;
            if ( v51 >= 513 )
              HIWORD(v52) = 512;
            sub_80015694(SHIWORD(v52), v14 + 40);
            v53 = *(v14 + 42) << 16;
            *(v14 + 40) >>= 3;
            v54 = *(v14 + 41);
            *(v14 + 42) = v53 >> 19;
            v55 = v14[10] & 0x10;
            *(v14 + 41) = v54 >> 6;
            if ( v55 )
            {
              v56 = v64;
              *(v64 + 40) = *(v14 + 40);
              v57 = *(v56 + 14);
              *(v56 + 41) = *(v14 + 41);
              *(v56 + 42) = *(v14 + 42);
              result = 16;
              if ( v57 == 3 )
              {
LABEL_55:
                *(v14 + 13) = 16;
                return result;
              }
              sub_8003C1CC(v64, 2u);
            }
          }
          result = 16;
          goto LABEL_55;
        }
      }
    }
  }
  return result;
}
// 8003CC64: conditional instruction was optimized away because $s0.4 is in (1..EF)
// 8003CC74: conditional instruction was optimized away because $s0.4 is in (1..EF)
// 8003CC98: conditional instruction was optimized away because $s0.4 is in (1..EF)
// 8003CCA8: conditional instruction was optimized away because $s0.4 is in (1..EF)
// 8003C9E8: variable 'v35' is possibly undefined
// 8003C9E8: variable 'v36' is possibly undefined
// 80062BF0: using guessed type int __fastcall rand(_DWORD);
// 8003C718: using guessed type _WORD var_60[4];

//----- (8003CD9C) --------------------------------------------------------
BOOL __fastcall sub_8003CD9C(
        _DWORD *a1,
        int a2,
        int a3,
        int a4,
        unsigned __int16 a5,
        unsigned __int16 a6,
        unsigned __int16 a7,
        unsigned __int16 a8,
        unsigned __int16 a9,
        unsigned __int16 a10,
        unsigned __int16 a11,
        unsigned __int16 a12,
        unsigned __int16 a13,
        unsigned __int16 a14,
        __int16 a15,
        char a16)
{
  Entity **v19; // $s4
  int v20; // $s5
  unsigned __int16 *v21; // $s0
  Vector3 *v22; // $s2
  int v23; // $v0
  int DistanceIfInRange; // $v1
  int v25; // $v0
  unsigned int v26; // $v0
  BOOL result; // $v0
  _DWORD *v29; // [sp+90h] [-10h]

  v29 = a1;
  if ( (a15 & 0x8000) != 0 )
    v29 = 0;
  v19 = g_ObjectArray;
  v20 = 0;
  v21 = &unk_8016E626;
  v22 = &unk_8016E634;
  do
  {
    v23 = v20 + 1;
    if ( *(v21 - 21) != 1 )
      goto LABEL_21;
    v23 = v20 + 1;
    if ( v19 == g_CurrentEntityPtr )
      goto LABEL_21;
    if ( a4 == 0x8000 )
      goto LABEL_9;
    if ( a4 == 32769 )
    {
      if ( a1[1] < *(v21 + 9) - *v21 )
        goto LABEL_11;
LABEL_9:
      DistanceIfInRange = sub_80015B74(a1, a3, v22, *(v21 - 1), *v21);
      goto LABEL_12;
    }
    DistanceIfInRange = GetDistanceIfInRange(v22, *a1, a1[1], a1[2], a3, *v21, a4);
    if ( DistanceIfInRange == -1 )
LABEL_11:
      DistanceIfInRange = -9999999;
LABEL_12:
    if ( DistanceIfInRange >= a2 )
    {
      v25 = DistanceIfInRange << 12;
      if ( a5 == 4096 )
      {
        LOWORD(v26) = a15 & 0x7FFF;
      }
      else
      {
        if ( a3 == -1 && v25 == 0x80000000 )
          _break(6u, 0);
        v26 = ((a15 & 0x7FFF) * (4096 - (((v25 / a3) * (4096 - a5)) >> 12))) >> 12;
      }
      ApplyDamage(v20, a6, a7, a8, a9, a10, a11, a12, a13, a14, v26, a16, v29);
    }
    v23 = v20 + 1;
LABEL_21:
    v20 = v23;
    v21 += 62;
    v22 = (v22 + 124);
    result = v23 < 200;
    v19 += 31;
  }
  while ( result );
  return result;
}
// 8003CF6C: conditional instruction was optimized away because $s3.4!=0

//----- (8003D090) --------------------------------------------------------
int __fastcall sub_8003D090(
        int a1,
        int a2,
        int a3,
        __int16 a4,
        unsigned __int16 a5,
        unsigned __int16 a6,
        unsigned __int16 a7,
        char a8)
{
  __int16 v8; // $s2
  Entity *v9; // $s1
  int v10; // $s0
  int DistanceIfInRange; // $v1
  int result; // $v0
  __int16 v13; // $v0
  Vector3 v14; // [sp+30h] [-10h] BYREF

  v8 = 16 * a4;
  v9 = g_CurrentEntityPtr;
  v10 = a1 << 6;
  v14.X = g_CurrentEntityPtr->pos.X;
  v14.Y = g_CurrentEntityPtr->pos.Y - 32 * a3;
  v14.Z = g_CurrentEntityPtr->pos.Z;
  DistanceIfInRange = GetDistanceIfInRange(
                        &v14,
                        *&g_LanguageID[0].header[2],
                        *&g_LanguageID[0].header[6],
                        *&g_LanguageID[0].menus[0].header.posY,
                        a2 << 6,
                        0,
                        1700);
  if ( DistanceIfInRange == -1 )
    return 0;
  result = 0;
  if ( DistanceIfInRange < v10 )
    return result;
  v13 = Math_Atan2_Fixed(*&g_LanguageID[0].header[2] - v14.X, *&g_LanguageID[0].menus[0].header.posY - v14.Z);
  if ( !Math_IsAngleInRange(v9->unk_42, v13, v8) )
    return 0;
  ApplyStatusEffect(a5, a6, a7, a8, 0, 0, 0, 0, 0, 0x1000u, 0xAu, &v14);
  return 1;
}

//----- (8003D200) --------------------------------------------------------
Entity **__fastcall sub_8003D200(int *a1, __int16 a2, __int16 a3, int a4, int a5, int a6, int *a7, int a8)
{
  int v9; // $s7
  int v10; // $fp
  Entity *v11; // $s4
  int v12; // $s6
  Entity **v13; // $s1
  signed int v14; // $v1
  int DistanceIfInRange; // $s2
  int v16; // $a0
  unsigned __int16 v17; // $v1
  unsigned __int16 v18; // $v1
  int v19; // $s0
  unsigned __int16 v22; // [sp+20h] [-40h] BYREF
  unsigned __int16 v23; // [sp+22h] [-3Eh]
  __int16 v24; // [sp+28h] [-38h]
  __int16 v25; // [sp+30h] [-30h]
  int v26; // [sp+38h] [-28h]
  int v27; // [sp+40h] [-20h]
  int v28; // [sp+48h] [-18h]
  int *v29; // [sp+50h] [-10h]
  Entity **v30; // [sp+58h] [-8h]

  v9 = 30000;
  v10 = -1;
  v11 = g_ObjectArray;
  v27 = a5;
  v12 = 199;
  v28 = a6;
  v13 = g_ObjectArray;
  v26 = a4;
  v24 = a2;
  v25 = a3;
  v30 = 0;
  v29 = a7;
  do
  {
    if ( *(v13 + 9) == 1 && *(v13 + 14) != 3 && v11 != g_CurrentEntityPtr )
    {
      v14 = v26;
      if ( (v13[10] & 0x20000) != 0 )
        v14 = 2 * v26;
      DistanceIfInRange = GetDistanceIfInRange(&v11->pos, *a1, 0xFFFF, a1[2], v14, 0, 0);
      if ( DistanceIfInRange != -1 )
      {
        sub_800159DC(v13[11] - *a1, v13[12] - a1[1], v13[13] - a1[2], &v22);
        v17 = (v23 - v24) & 0xFFF;
        v23 = v17;
        if ( v17 >= 0x800u )
          v23 = 4096 - v17;
        v18 = (v22 - v25) & 0xFFF;
        v22 = v18;
        if ( v18 >= 0x800u )
          v22 = 4096 - v18;
        if ( (v13[10] & 0x20000) != 0 && a8 >= 0 )
        {
          DistanceIfInRange >>= 2;
          v22 -= 512;
          v23 -= 512;
        }
        else if ( v27 < v23 || v28 < v22 )
        {
          goto LABEL_21;
        }
        v19 = v23 + v22 + (DistanceIfInRange >> 7);
        if ( a8 > 0 )
          v19 += (rand(v16) * a8) >> 15;
        if ( v19 < v9 )
        {
          v9 = v19;
          v30 = v13;
          v10 = DistanceIfInRange;
        }
      }
    }
LABEL_21:
    v13 += 31;
    v11 = (v11 + 124);
  }
  while ( v12-- != 0 );
  *v29 = v10;
  return v30;
}
// 8003D3F4: variable 'v16' is possibly undefined
// 80062BF0: using guessed type int __fastcall rand(_DWORD);

//----- (8003D480) --------------------------------------------------------
int __fastcall Entity_CheckWorldCollision(int x, int y, int z, int radius, int max_dist)
{
  Entity **v9; // $s2
  int v10; // $s1
  unsigned __int16 *v11; // $s0
  int v12; // $v1
  Vector3 *v13; // $a0
  int v14; // $a1
  int v15; // $a2
  bool v16; // dc
  int result; // $v0
  int v18[4]; // [sp+20h] [-10h] BYREF

  v9 = g_ObjectArray;                           // //   
  v10 = 0;
  v11 = &unk_8016E626;                          // //   
  do
  {
    if ( *(v11 - 21) == 1 && *(v11 - 16) != 3 ) //     == 1   
                                                // != 3    3 (,  /)
    {
      v12 = *(v11 + 5);
      if ( (byte_801779A8 & v12) == 0 && v9 != g_CurrentEntityPtr )//   . /  collided      (dword_801779B4)
      {
        v13 = (v9 + 0xB);
        if ( (v12 & 0x10) != 0 )
        {
          v13 = v18;
          if ( v11[2] == dword_801779C0 )
            goto LABEL_11;
          v18[0] = *(v11 + 7);
          v14 = x;
          v18[2] = *(v11 + 0xB);
          v15 = y;
          v18[1] = v11[4] + *(v11 + 9);
        }
        else
        {
          v14 = x;
          v15 = y;
        }
        v16 = GetDistanceIfInRange(v13, v14, v15, z, *(v11 - 1) + radius, *v11, max_dist) != -1;
        result = v10;
        if ( v16 )
          return result;
      }
    }
LABEL_11:
    ++v10;
    v11 += 62;
    v9 += 31;
  }
  while ( v10 < 200 );
  return -1;
}
// 801779A8: using guessed type char byte_801779A8;
// 801779C0: using guessed type int dword_801779C0;

//----- (8003D5EC) --------------------------------------------------------
int __fastcall sub_8003D5EC(int a1, int a2, int a3, int a4, int a5)
{
  Entity **v9; // $s2
  int v10; // $s1
  unsigned __int16 *v11; // $s0
  int v12; // $v1
  Vector3 *v13; // $a0
  int v14; // $a1
  int v15; // $a2
  bool v16; // dc
  int result; // $v0
  int v18[4]; // [sp+20h] [-10h] BYREF

  v9 = g_ObjectArray;
  v10 = 0;
  v11 = &unk_8016E626;
  do
  {
    if ( *(v11 - 21) == 1 )
    {
      v12 = *(v11 + 5);
      if ( (byte_801779A8 & v12) == 0 && v9 != g_CurrentEntityPtr )
      {
        v13 = (v9 + 11);
        if ( (v12 & 0x10) != 0 )
        {
          v13 = v18;
          if ( v11[2] == dword_801779C0 )
            goto LABEL_10;
          v18[0] = *(v11 + 7);
          v14 = a1;
          v18[2] = *(v11 + 11);
          v15 = a2;
          v18[1] = v11[4] + *(v11 + 9);
        }
        else
        {
          v14 = a1;
          v15 = a2;
        }
        v16 = GetDistanceIfInRange(v13, v14, v15, a3, *(v11 - 1) + a4, *v11, a5) != -1;
        result = v10;
        if ( v16 )
          return result;
      }
    }
LABEL_10:
    ++v10;
    v11 += 62;
    v9 += 31;
  }
  while ( v10 < 200 );
  return -1;
}
// 801779A8: using guessed type char byte_801779A8;
// 801779C0: using guessed type int dword_801779C0;

//----- (8003D748) --------------------------------------------------------
EntityDefinition **__fastcall Entity_SetContext(#15 *e)
{
  EntityDefinition **result; // $v0

  if ( e )
  {
    g_CurrentEntityPtr = e;
    g_CurrentEntityDef = &g_ObjectTypeTable[30 * *(e + 2)];
    dword_801779C4 = *(e + 2);
    result = (*&g_CurrentEntityDef->unk_param[30] & 0x10);
    if ( result )
    {
      dword_801779BC = &g_ObjectArray[31 * *(e + 17)];
      result = &g_ObjectTypeTable[30 * *(dword_801779BC + 2)];
      dword_801779B8 = result;
    }
  }
  else
  {
    g_CurrentEntityPtr = 0;
    g_CurrentEntityDef = 0;
    dword_801779C4 = 0;
    dword_801779BC = 0;
    dword_801779B8 = 0;
  }
  return result;
}
// 801779B8: using guessed type int dword_801779B8;
// 801779BC: using guessed type int dword_801779BC;
// 801779C4: using guessed type int dword_801779C4;

//----- (8003D824) --------------------------------------------------------
int __fastcall sub_8003D824(int a1, __int16 a2)
{
  int result; // $v0

  if ( (a2 & 0x8000) != 0 )
    *(a1 + 102) = -a2;
  else
    *(a1 + 102) = a2;
  result = (a2 + *(a1 + 24)) & 0xFFF;
  *(a1 + 24) = result;
  return result;
}

//----- (8003D858) --------------------------------------------------------
int __fastcall sub_8003D858(int a1, __int16 a2)
{
  __int16 v2; // $v0
  int v3; // $v1
  bool v4; // dc
  int result; // $v0

  if ( (a2 & 0x8000) != 0 )
    *(a1 + 102) = -a2;
  else
    *(a1 + 102) = a2;
  v2 = a2 + *(a1 + 24);
  *(a1 + 24) = v2;
  v3 = v2;
  v4 = v2 < 4096;
  result = 4095;
  if ( v4 )
  {
    if ( v3 < 0 )
      *(a1 + 24) = 0;
  }
  else
  {
    *(a1 + 24) = 4095;
  }
  return result;
}

//----- (8003D8B4) --------------------------------------------------------
BOOL __fastcall sub_8003D8B4(int a1, unsigned __int16 a2)
{
  unsigned int v2; // $v1
  int v3; // $a2

  v2 = *(a1 + 24);
  v3 = 0;
  if ( a2 < v2 )
    return a2 >= (v2 - *(a1 + 102));
  return v3;
}

//----- (8003D8E4) --------------------------------------------------------
int __fastcall sub_8003D8E4(__int16 *a1, char a2)
{
  Entity *v2; // $s2
  int result; // $v0
  int v5; // $s3
  int v6; // $s0
  int v7; // $s7
  int v8; // $s6
  int v9; // $s5
  int v10; // $s4
  int v11; // $s1
  int v12; // $v0
  __int16 v13; // $s1
  __int16 v14; // $v0
  bool v15; // dc
  __int16 v16; // $v0
  int v17; // $s1
  unsigned int v18; // $s0
  int v19; // $v0
  int v20; // $v0
  unsigned int v21; // $v0
  unsigned int v22; // $v0
  int v23; // $v0
  int v24; // [sp+18h] [-38h]
  int v25; // [sp+20h] [-30h]
  int v27; // [sp+30h] [-20h]
  int v28; // [sp+38h] [-18h]
  int v29; // [sp+40h] [-10h]
  int v30; // [sp+48h] [-8h]

  v30 = 0;
  v2 = g_CurrentEntityPtr;
  if ( !*a1 )
  {
    result = 0;
    if ( !a1[2] )
      return result;
  }
  v29 = 0;
  v28 = 0;
  v27 = 0;
  v5 = *a1;
  v6 = a1[2];
  v7 = v5;
  v8 = v6;
  while ( 1 )
  {
    while ( 1 )
    {
LABEL_4:
      v24 = v5 + v2->pos.X;
      v25 = v6 + v2->pos.Z;
      v9 = sub_8002E4F4(
             v24,
             v2->pos.Y,
             v25,
             v2->coll_radius,
             v2->height | ((v2->bit_flags & 0xC000) << 16),
             dword_801779AC);
      if ( !v9 )
        goto LABEL_5;
      v30 |= v9;
      if ( (a2 & 3) == 0 )
        goto LABEL_55;
      if ( (v9 & 0xB0) == 0 )
        break;
      if ( ++v29 == 2 )
        goto LABEL_55;
      sub_8002E394();
      v13 = Math_Atan2_Fixed(dword_801DD5A4 - v2->pos.X, dword_801DD5AC - v2->pos.Z);
      v14 = Math_Atan2_Fixed(v5, v6);
      v15 = sub_800157D4(v14, v13);
      v16 = v13 + 1024;
      if ( !v15 )
        v16 = v13 - 1024;
      v17 = v16 & 0xFFF;
      v18 = SquareRoot0(v5 * v5 + v6 * v6);
      v5 = -(FixedSin(v17) * v18) >> 13;
      v6 = (FixedCos(v17) * v18) >> 13;
    }
    v19 = v9 & 1;
    if ( (a2 & 0x10) == 0 )
    {
      if ( (v2->bit_flags & 0x4000) != 0 )
        goto LABEL_34;
      v19 = v9 & 1;
      if ( (v9 & 0xFFFFFFFA) == 0 )
        break;
    }
    v15 = v19 == 0;
    v20 = v9 & 2;
    if ( v15 )
      goto LABEL_48;
    while ( 1 )
    {
LABEL_34:
      if ( v27 )
      {
        LOWORD(v6) = 0;
        LOWORD(v5) = 0;
        goto LABEL_55;
      }
      if ( v5 )
      {
        v5 = 0;
        if ( (a2 & 1) != 0 )
        {
          v21 = SquareRoot0(v7 * v7 + v8 * v8);
          v6 = v21;
          if ( v8 <= 0 )
            v6 = -v21;
        }
        else
        {
          v6 = v8;
        }
        goto LABEL_4;
      }
      if ( v6 )
        break;
      v20 = v9 & 2;
LABEL_48:
      if ( !v20 )
        goto LABEL_55;
      if ( !v28 )
      {
        if ( (MapTileSlice->Rotation & 3) != 0 && (v23 = v7 - v8, (MapTileSlice->Rotation & 3) != 2) )
        {
          v5 = v23 >> 1;
          v6 = -(v23 >> 1);
        }
        else
        {
          v6 = (v7 + v8) >> 1;
          v5 = v6;
        }
        v28 = 1;
        goto LABEL_4;
      }
    }
    v6 = 0;
    if ( (a2 & 1) != 0 )
    {
      v22 = SquareRoot0(v7 * v7 + v8 * v8);
      v5 = v22;
      if ( v7 <= 0 )
        v5 = -v22;
    }
    else
    {
      v6 = v8;
    }
    v27 = 1;
  }
  if ( g_FinalResultHeight + 800 < v2->pos.Y )
    goto LABEL_34;
LABEL_5:
  if ( !HIBYTE(v2->anim_frame) && (a2 & 0x24) != 0 )
  {
    v10 = g_FinalResultHeight;
    v11 = 0;
    if ( v5 )
    {
      if ( v5 <= 0 )
        v11 = -2 * v2->coll_radius;
      else
        v11 = 2 * v2->coll_radius;
    }
    v12 = 0;
    if ( v6 )
    {
      if ( v6 <= 0 )
        v12 = -2 * v2->coll_radius;
      else
        v12 = 2 * v2->coll_radius;
    }
    CollisionWithTilemap(
      v2->pos.X,
      v2->pos.Y,
      v12 + v2->pos.Z,
      v2->coll_radius,
      v2->height | ((v2->bit_flags & 0xC000) << 16));
    if ( v10 < g_FinalResultHeight )
      v10 = g_FinalResultHeight;
    CollisionWithTilemap(
      v11 + v2->pos.X,
      v2->pos.Y,
      v2->pos.Z,
      v2->coll_radius,
      v2->height | ((v2->bit_flags & 0xC000) << 16));
    if ( v10 < g_FinalResultHeight )
      v10 = g_FinalResultHeight;
    if ( v2->pos.Y < v10 - 1100 )
    {
      v30 |= 0x100u;
      if ( (a2 & 4) != 0 )
        goto LABEL_34;
    }
  }
  v2->pos.X = v24;
  v2->pos.Z = v25;
LABEL_55:
  if ( (a2 & 8) != 0 )
  {
    *a1 = v5;
    a1[2] = v6;
  }
  return v30;
}
// 801779AC: using guessed type int dword_801779AC;
// 801DD584: using guessed type int g_FinalResultHeight;
// 801DD5A4: using guessed type int dword_801DD5A4;
// 801DD5AC: using guessed type int dword_801DD5AC;

//----- (8003DDB0) --------------------------------------------------------
int __fastcall sub_8003DDB0(__int16 *a1)
{
  Entity *v1; // $s0
  int v3; // $s2
  bool v4; // dc
  int result; // $v0
  int v6; // [sp+18h] [-10h]
  int v7; // [sp+1Ch] [-Ch]
  int v8; // [sp+20h] [-8h]

  v1 = g_CurrentEntityPtr;
  v6 = *a1 + g_CurrentEntityPtr->pos.X;
  v7 = a1[1] + g_CurrentEntityPtr->pos.Y;
  v8 = a1[2] + g_CurrentEntityPtr->pos.Z;
  v3 = sub_8002E4F4(
         v6,
         v7,
         v8,
         g_CurrentEntityPtr->coll_radius,
         g_CurrentEntityPtr->height | ((g_CurrentEntityPtr->bit_flags & 0xC000) << 16),
         dword_801779AC);
  if ( v3 )
  {
    if ( sub_8002E4F4(
           v6,
           v1->pos.Y,
           v1->pos.Z,
           v1->coll_radius,
           v1->height | ((v1->bit_flags & 0xC000) << 16),
           dword_801779AC) )
    {
      *a1 = -*a1;
    }
    else if ( sub_8002E4F4(
                v1->pos.X,
                v7,
                v1->pos.Z,
                v1->coll_radius,
                v1->height | ((v1->bit_flags & 0xC000) << 16),
                dword_801779AC) )
    {
      a1[1] = -a1[1];
    }
    else
    {
      v4 = sub_8002E4F4(
             v1->pos.X,
             v1->pos.Y,
             v8,
             v1->coll_radius,
             v1->height | ((v1->bit_flags & 0xC000) << 16),
             dword_801779AC) == 0;
      result = v3;
      if ( v4 )
        return result;
      a1[2] = -a1[2];
    }
  }
  else
  {
    v1->pos.X = v6;
    v1->pos.Y = v7;
    v1->pos.Z = v8;
  }
  return v3;
}
// 801779AC: using guessed type int dword_801779AC;

//----- (8003DF98) --------------------------------------------------------
int __fastcall sub_8003DF98(int a1, int a2, int a3, int a4, int a5, int a6)
{
  Entity *v6; // $s0
  bool v7; // dc
  int result; // $v0
  int Y; // $a0
  __int16 v10[4]; // [sp+30h] [-8h] BYREF

  v6 = g_CurrentEntityPtr;
  v7 = sub_8001605C(
         a1,
         g_CurrentEntityPtr->pos.X,
         g_CurrentEntityPtr->pos.Y,
         g_CurrentEntityPtr->pos.Z,
         a2,
         a3,
         a4,
         a5,
         a6,
         v10,
         &g_CurrentEntityPtr->ai_scratchpad[36],
         &g_CurrentEntityPtr->ai_scratchpad[38]) != 0;
  result = -1;
  if ( !v7 )
  {
    HIBYTE(v6->anim_frame) = 48;
    result = v10[0];
    Y = v6->pos.Y;
    *&v6->ai_scratchpad[14] = 1;
    *&v6->ai_scratchpad[40] = a5;
    *&v6->rot_x = Y;
  }
  return result;
}
// 8003DF98: using guessed type __int16 var_8[4];

//----- (8003E038) --------------------------------------------------------
int sub_8003E038()
{
  int result; // $v0

  result = 96;
  HIBYTE(g_CurrentEntityPtr->anim_frame) = 96;
  return result;
}

//----- (8003E04C) --------------------------------------------------------
int UpdateObjectVerticalMovement()
{
  Entity *v0; // $s0
  EntityDefinition *v1; // $s2
  char v2; // $v1
  int v3; // $v0
  int anim_frame_high; // $v1
  int result; // $v0
  int v6; // $v1
  int v7; // $s3
  int v8; // $s1
  int v9; // $v0
  int v10; // $a0
  int v11; // $s1
  int v12; // $v1
  __int16 v13; // $v0
  char v14; // $v1

  v0 = g_CurrentEntityPtr;
  v1 = g_CurrentEntityDef;
  MAP_CollisionWithTile(
    g_CurrentEntityPtr->pos.X,
    g_CurrentEntityPtr->pos.Y,
    g_CurrentEntityPtr->pos.Z,
    g_CurrentEntityPtr->coll_radius,
    g_CurrentEntityPtr->height | ((g_CurrentEntityPtr->bit_flags & 0xC000) << 16));
  v2 = 2;
  if ( !g_TileLayerOffset )
    v2 = 1;
  v3 = v0->bit_flags & 0x400;
  v0->unk_03 = v2;
  if ( v3 )
    g_FinalResultHeight = g_CurrentFloorBaseHeight;
  anim_frame_high = HIBYTE(v0->anim_frame);
  if ( anim_frame_high == 32 )
  {
    v10 = *&v0->ai_scratchpad[14] + 5;
    v0->pos.Y += *&v0->ai_scratchpad[14];
    *&v0->ai_scratchpad[14] = v10;
    result = v10 << 16;
    if ( g_FinalResultHeight >= v0->pos.Y || (v10 & 0x8000) == 0 )
    {
      v0->pos.Y = g_FinalResultHeight;
      goto LABEL_32;
    }
  }
  else if ( HIBYTE(v0->anim_frame) >= 0x21u )
  {
    result = 48;
    if ( anim_frame_high == 48 )
    {
      v11 = *&v0->rot_x
          - *&v0->ai_scratchpad[38] * *&v0->ai_scratchpad[14]
          + ((*&v0->ai_scratchpad[40] * *&v0->ai_scratchpad[14] * *&v0->ai_scratchpad[14]) >> 1);
      v12 = sub_8002E4F4(
              v0->pos.X,
              v11,
              v0->pos.Z,
              v0->coll_radius,
              v0->height | ((v0->bit_flags & 0xC000) << 16),
              dword_801779AC);
      if ( v12 )
      {
        result = 16;
        if ( v12 == 128 )
        {
          ApplyStatusEffect(0, v1->flags[6], 0, 0, 0, 0, 0, 0, 0, 0x1000u, 0xAu, &v0->pos.X);
          result = 16;
        }
        goto LABEL_39;
      }
      v13 = *&v0->ai_scratchpad[14];
      v0->pos.Y = v11;
      *&v0->ai_scratchpad[14] = v13 + 1;
      result = g_TileLayerOffset;
      v14 = 2;
      if ( !g_TileLayerOffset )
        v14 = 1;
      v0->unk_03 = v14;
    }
  }
  else
  {
    result = 16;
    if ( HIBYTE(v0->anim_frame) )
    {
      if ( anim_frame_high != 16 )
        return result;
      v7 = *&v0->ai_scratchpad[14] + v0->pos.Y;
      v8 = sub_8002E4F4(
             v0->pos.X,
             v7,
             v0->pos.Z,
             v0->coll_radius,
             v0->height | ((v0->bit_flags & 0xC000) << 16),
             dword_801779AC);
      if ( !v8 )
      {
LABEL_17:
        v0->pos.Y = v7;
        result = v1->flags[5] + *&v0->ai_scratchpad[14];
        *&v0->ai_scratchpad[14] = result;
        return result;
      }
      v9 = v8 & 4;
      if ( v8 == 128 )
      {
        v9 = 0;
        if ( *&v0->ai_scratchpad[14] >= 41 )
        {
          ApplyStatusEffect(0, v1->flags[6], 0, 0, 0, 0, 0, 0, 0, 0x1000u, 0xAu, &v0->pos.X);
          v9 = 0;
        }
      }
      if ( !v9 )
      {
        result = v0->bit_flags & 0x400;
        if ( !result )
        {
          HIBYTE(v0->anim_frame) = 0;
          return result;
        }
        goto LABEL_17;
      }
      if ( (v0->bit_flags & 0x400) != 0 )
      {
        result = v0->pos.Y < g_CurrentFloorBaseHeight;
        if ( v0->pos.Y < g_CurrentFloorBaseHeight )
          goto LABEL_17;
        v0->pos.Y = g_CurrentFloorBaseHeight;
      }
      else
      {
        result = g_FinalResultHeight;
        v0->pos.Y = g_FinalResultHeight;
      }
      *&v0->ai_scratchpad[14] = 0;
LABEL_32:
      HIBYTE(v0->anim_frame) = 0;
      return result;
    }
    v6 = g_FinalResultHeight - v0->pos.Y;
    if ( v6 < 0 )
    {
      HIBYTE(v0->anim_frame) = 32;
      result = -100;
      *&v0->ai_scratchpad[14] = -100;
      return result;
    }
    result = 16;
    if ( v6 > 0 )
    {
LABEL_39:
      HIBYTE(v0->anim_frame) = 16;
      *&v0->ai_scratchpad[14] = 0;
    }
  }
  return result;
}
// 801779AC: using guessed type int dword_801779AC;
// 801DD57E: using guessed type __int16 g_TileLayerOffset;
// 801DD580: using guessed type int g_CurrentFloorBaseHeight;
// 801DD584: using guessed type int g_FinalResultHeight;

//----- (8003E414) --------------------------------------------------------
int __fastcall sub_8003E414(int a1, char a2)
{
  Entity *v2; // $s0
  signed int v5; // $s1
  int result; // $v0
  int v7; // $a0
  int v8; // $a2
  __int16 v9; // $v0
  int v10; // $a0
  int v11; // $a2

  v2 = g_CurrentEntityPtr;
  if ( !HIBYTE(g_CurrentEntityPtr->anim_frame) )
  {
    v5 = SquareRoot0(
           *&g_CurrentEntityPtr->ai_scratchpad[12] * *&g_CurrentEntityPtr->ai_scratchpad[12]
         + *&g_CurrentEntityPtr->ai_scratchpad[16] * *&g_CurrentEntityPtr->ai_scratchpad[16]);
    result = 0;
    if ( !v5 )
      return result;
    v7 = *&v2->ai_scratchpad[12];
    v8 = 2 * v7 * a1;
    if ( v5 == -1 && v8 == 0x80000000 )
      _break(6u, 0);
    v9 = sub_80014D48(v7, 0, v8 / v5);
    v10 = *&v2->ai_scratchpad[16];
    v11 = 2 * v10 * a1;
    if ( v5 == -1 && v11 == 0x80000000 )
      _break(6u, 0);
    *&v2->ai_scratchpad[12] = v9;
    *&v2->ai_scratchpad[16] = sub_80014D48(v10, 0, v11 / v5);
  }
  return sub_8003D8E4(&v2->ai_scratchpad[12], a2);
}
// 8003E4DC: conditional instruction was optimized away because $s1.4!=0
// 8003E494: conditional instruction was optimized away because $s1.4!=0

//----- (8003E540) --------------------------------------------------------
int __fastcall sub_8003E540(__int16 a1, __int16 a2, __int16 a3, char a4)
{
  Entity *v7; // $s2
  __int16 v8; // $v0
  int v9; // $a0
  int v11; // [sp+10h] [-10h] BYREF
  int v12; // [sp+14h] [-Ch]
  int v13; // [sp+18h] [-8h] BYREF
  int v14; // [sp+1Ch] [-4h]

  v7 = g_CurrentEntityPtr;
  sub_80014FAC(a1, &v11);
  v13 = v11;
  v14 = v12;
  sub_8001565C(a2, &v11);
  sub_8001565C(a3, &v13);
  v8 = sub_80014D48(*&v7->ai_scratchpad[12], v11, v13);
  v9 = *&v7->ai_scratchpad[16];
  *&v7->ai_scratchpad[12] = v8;
  *&v7->ai_scratchpad[16] = sub_80014D48(v9, v12, v14);
  return sub_8003D8E4(&v7->ai_scratchpad[12], a4);
}

//----- (8003E608) --------------------------------------------------------
int __fastcall sub_8003E608(int a1, __int16 a2, int a3, __int16 a4)
{
  int result; // $v0
  BOOL v10; // $v0
  int v11; // $a2
  __int16 v12; // $v0
  __int16 v13; // $v0
  __int16 v14; // $a1
  int v15; // $v1
  __int16 v16; // $s2
  __int16 v17; // $a0
  __int16 v18; // $a1

  result = sub_800157E4(a2, *(a1 + 66));
  if ( result )
  {
    v10 = sub_800157D4(a2, *(a1 + 66));
    v11 = -a3;
    if ( v10 )
    {
      v12 = *(a1 + 88) + a4;
      *(a1 + 88) = v12;
      if ( a3 < v12 )
        *(a1 + 88) = a3;
    }
    else
    {
      v13 = *(a1 + 88) - a4;
      *(a1 + 88) = v13;
      if ( v13 < v11 )
        *(a1 + 88) = v11;
    }
    v14 = *(a1 + 66);
    v15 = *(a1 + 88);
    *(a1 + 66) = *(a1 + 88) + v14;
    if ( v15 <= 0 )
    {
      v16 = a2;
      result = sub_800157D4(v14, a2);
      v18 = a2;
      if ( !result )
        return result;
      v17 = *(a1 + 66);
    }
    else
    {
      v16 = a2;
      result = sub_800157D4(a2, v14);
      v17 = a2;
      if ( !result )
        return result;
      v18 = *(a1 + 66);
    }
    result = sub_800157D4(v17, v18);
    if ( !result )
      *(a1 + 66) = v16;
  }
  else
  {
    *(a1 + 88) = 0;
  }
  return result;
}

//----- (8003E75C) --------------------------------------------------------
int __fastcall sub_8003E75C(__int16 a1, __int16 a2, int a3, __int16 a4, __int16 a5, char a6)
{
  Entity *v8; // $s0

  v8 = g_CurrentEntityPtr;
  sub_8003E608(g_CurrentEntityPtr, a1, a3, a5);
  return sub_8003E540(v8->unk_42, a2, a4, a6);
}

//----- (8003E7D0) --------------------------------------------------------
int __fastcall sub_8003E7D0(int a1, int a2, __int16 a3, int a4, __int16 a5, __int16 a6, __int16 a7, char a8)
{
  int v10; // $s2
  int v11; // $s0
  int v12; // $s3
  int v13; // $s2
  int IsAngleInRange; // $v0
  int v15; // $a0

  v10 = a1 - g_CurrentEntityPtr->pos.X;
  v11 = a2 - g_CurrentEntityPtr->pos.Z;
  v12 = Math_Atan2_Fixed(v10, v11);
  if ( v10 < 0 )
    v10 = -v10;
  if ( v11 < 0 )
    v11 = -v11;
  v13 = v10 + v11;
  if ( a5 == -1 || v13 >= 601 )
  {
    v15 = v12 << 16;
  }
  else
  {
    IsAngleInRange = Math_IsAngleInRange(v12, a5, 800);
    v15 = v12 << 16;
    if ( !IsAngleInRange )
      return -1;
  }
  sub_8003E75C(SHIWORD(v15), a3, a4, a6, a7, a8);
  return v12 & 0xFFF;
}

//----- (8003E8E8) --------------------------------------------------------
int __fastcall sub_8003E8E8(_WORD *a1, __int16 a2, __int16 a3, char a4)
{
  Entity *v7; // $s3
  __int16 v8; // $v0
  int v9; // $a0
  __int16 v10; // $v0
  int v11; // $a0
  BOOL v12; // $s0
  int v13; // $s1
  int v15; // [sp+18h] [-10h] BYREF
  int v16; // [sp+1Ch] [-Ch]
  int v17; // [sp+20h] [-8h] BYREF
  int v18; // [sp+24h] [-4h]

  v7 = g_CurrentEntityPtr;
  sub_80015538(a1, &v15);
  v17 = v15;
  v18 = v16;
  sub_80015694(a2, &v15);
  sub_80015694(a3, &v17);
  v8 = sub_80014D48(*&v7->ai_scratchpad[12], v15, v17);
  v9 = *&v7->ai_scratchpad[14];
  *&v7->ai_scratchpad[12] = v8;
  v10 = sub_80014D48(v9, SHIWORD(v15), SHIWORD(v17));
  v11 = *&v7->ai_scratchpad[16];
  *&v7->ai_scratchpad[14] = v10;
  *&v7->ai_scratchpad[16] = sub_80014D48(v11, v16, v18);
  v12 = sub_8003D8E4(&v7->ai_scratchpad[12], a4) != 0;
  v13 = *&v7->ai_scratchpad[14] + v7->pos.Y;
  if ( sub_8002E4F4(
         v7->pos.X,
         v13,
         v7->pos.Z,
         v7->coll_radius,
         v7->height | ((v7->bit_flags & 0xC000) << 16),
         dword_801779AC) )
  {
    return v12 | 2;
  }
  v7->pos.Y = v13;
  return v12;
}
// 801779AC: using guessed type int dword_801779AC;

//----- (8003EA30) --------------------------------------------------------
int __fastcall sub_8003EA30(__int16 *a1, __int16 a2, int a3, __int16 a4, __int16 a5, char a6)
{
  Entity *v9; // $s0

  v9 = g_CurrentEntityPtr;
  sub_8003E608(g_CurrentEntityPtr, a1[1], a3, a5);
  v9->rot_z = sub_80014C84(v9->rot_z, *a1, 8);
  return sub_8003E8E8(&v9->rot_z, a2, a4, a6);
}

//----- (8003EAC0) --------------------------------------------------------
int __fastcall sub_8003EAC0(int a1, int a2, int a3)
{
  int v5; // $v0
  __int16 v7[4]; // [sp+18h] [-10h] BYREF
  __int16 v8; // [sp+20h] [-8h] BYREF
  __int16 v9; // [sp+22h] [-6h]
  __int16 v10; // [sp+24h] [-4h]

  if ( sub_80036DD8(*(a1 + 1) + 128, *(a1 + 12), *(a1 + 24), a2, &v8) )
  {
    v8 = 0;
    v9 = -*(a1 + 30) >> 1;
    v5 = -*(a1 + 28);
  }
  else
  {
    v8 = (v8 * *(a1 + 72)) >> 12;
    v9 = (v9 * *(a1 + 74)) >> 12;
    v5 = (v10 * *(a1 + 76)) >> 12;
  }
  v10 = v5;
  v7[0] = *(a1 + 64);
  v7[1] = *(a1 + 66) + 2048;
  v7[2] = *(a1 + 68);
  sub_80015614(v7, &v8, a3);
  return 1;
}

//----- (8003EBC0) --------------------------------------------------------
int __fastcall sub_8003EBC0(int a1, _DWORD *a2)
{
  int v3; // $v1
  int result; // $v0
  __int16 *v6; // $a0
  __int16 *v7; // $a2
  int v8; // $v1

  v3 = *(a1 + 40) & 3;
  if ( v3 == 1 )
  {
    v7 = &g_ObjectTypeTable[30 * *(a1 + 2)];
    *a2 = v7[6] + *(a1 + 44);
    a2[1] = v7[7] + *(a1 + 48);
    result = a2;
    a2[2] = v7[8] + *(a1 + 52);
  }
  else
  {
    result = 2;
    if ( v3 )
    {
      v6 = (a1 + 64);
      if ( v3 == 2 )
      {
        sub_80015614(v6, &unk_801746F4 + 120 * *(a1 + 2), a2);
        *a2 += *(a1 + 44);
        v8 = a2[2];
        a2[1] += *(a1 + 48);
        result = a2;
        a2[2] = v8 + *(a1 + 52);
      }
    }
    else
    {
      return a1 + 44;
    }
  }
  return result;
}

//----- (8003ECE8) --------------------------------------------------------
int __fastcall sub_8003ECE8(int a1, int a2, int a3, int a4, int a5, int a6)
{
  int v6; // $s1
  Entity *v7; // $s0
  int v8; // $v0
  int v9; // $t0
  int v10; // $v1
  int result; // $v0
  int anim_frame_low; // $v1
  Entity *v13; // $a0
  int v14; // $a1

  v6 = a1;
  v7 = g_CurrentEntityPtr;
  v8 = *&g_CurrentEntityPtr->ai_scratchpad[20];
  v9 = 0;
  if ( v8 <= 0 )
  {
    if ( v8 < 0 )
    {
      v6 = a2;
      v9 = -v8;
    }
  }
  else
  {
    v6 = a3;
    v9 = *&g_CurrentEntityPtr->ai_scratchpad[20];
  }
  v10 = *&g_CurrentEntityPtr->ai_scratchpad[14];
  if ( v10 < 11 )
  {
    result = -v10;
    if ( v10 < 10 )
    {
      result = v9 < result;
      if ( result )
        v6 = a5;
    }
  }
  else
  {
    result = v9 < v10;
    if ( v9 < v10 )
      v6 = a4;
  }
  anim_frame_low = LOBYTE(g_CurrentEntityPtr->anim_frame);
  if ( anim_frame_low == a1 )
  {
    sub_8003D824(g_CurrentEntityPtr, a6);
    result = sub_8003D8B4(v7, 0);
    if ( result )
      return sub_8003C27C(v6);
    return result;
  }
  if ( anim_frame_low != a2 )
  {
    if ( anim_frame_low == a3 )
    {
      result = g_CurrentEntityPtr->anim_timer < 0x800u;
      v13 = g_CurrentEntityPtr;
      if ( g_CurrentEntityPtr->anim_timer >= 0x800u )
      {
        v14 = a6 << 16;
        if ( v6 == anim_frame_low )
          return result;
        goto LABEL_30;
      }
    }
    else if ( anim_frame_low == a4 )
    {
      result = g_CurrentEntityPtr->anim_timer < 0x800u;
      v13 = g_CurrentEntityPtr;
      if ( g_CurrentEntityPtr->anim_timer >= 0x800u )
      {
        v14 = a6 << 16;
        if ( v6 == anim_frame_low )
          return result;
        goto LABEL_30;
      }
    }
    else
    {
      if ( anim_frame_low != a5 )
        return result;
      result = g_CurrentEntityPtr->anim_timer < 0x800u;
      v13 = g_CurrentEntityPtr;
      if ( g_CurrentEntityPtr->anim_timer >= 0x800u )
      {
        v14 = a6 << 16;
        if ( v6 == a5 )
          return result;
        goto LABEL_30;
      }
    }
    return sub_8003D858(v13, a6);
  }
  result = g_CurrentEntityPtr->anim_timer < 0x800u;
  v13 = g_CurrentEntityPtr;
  if ( g_CurrentEntityPtr->anim_timer < 0x800u )
    return sub_8003D858(v13, a6);
  v14 = a6 << 16;
  if ( v6 == anim_frame_low )
    return result;
LABEL_30:
  sub_8003D858(v13, SHIWORD(v14));
  result = v7->anim_timer < 0xFFFu;
  if ( v7->anim_timer >= 0xFFFu )
    return sub_8003C250(v6);
  return result;
}

//----- (8003EEB0) --------------------------------------------------------
int __fastcall sub_8003EEB0(int a1, int *a2, int a3, _DWORD *a4, __int16 *a5, __int16 a6, __int16 a7, int a8)
{
  int v13; // $v1
  int v14; // $a0
  int v15; // $a1
  int v16; // $a2
  __int16 v17; // $a1
  unsigned int v18; // $a2
  int v19; // $lo
  int v20; // $a2
  __int16 v21; // $a1
  unsigned int v22; // $a2
  signed int v23; // $v0
  int v25; // [sp+10h] [-20h] BYREF
  int v26; // [sp+14h] [-1Ch]
  int v27; // [sp+18h] [-18h]
  int v28; // [sp+1Ch] [-14h]
  __int16 v29; // [sp+20h] [-10h] BYREF
  __int16 v30; // [sp+22h] [-Eh]
  __int16 v31; // [sp+28h] [-8h]

  v31 = a7;
  v13 = *a2;
  v14 = a2[1];
  v15 = a2[2];
  v16 = a2[3];
  v25 = v13;
  v26 = v14;
  v27 = v15;
  v28 = v16;
  while ( 1 )
  {
    sub_800159DC(v25 - *a4, v26 - (a4[1] + 1600), v27 - a4[2], &v29);
    v17 = *(a1 + 66);
    v18 = (v30 - v17) & 0xFFF;
    if ( v18 >= 0x800 )
      v18 = 4096 - v18;
    v19 = (v18 << 12) / v31;
    if ( !v31 )
      _break(7u, 0);
    if ( v31 == -1 && v18 << 12 == 0x80000000 )
      _break(6u, 0);
    v20 = (v18 << 12) / v31;
    if ( v19 >= 4097 )
      v20 = 4096;
    v30 = sub_80015D30(v30, v17, v20);
    if ( a6 == -1 )
    {
      v21 = *(a1 + 64);
      v22 = (v29 - v21) & 0xFFF;
      if ( v22 >= 0x800 )
        v22 = 4096 - v22;
      v29 = sub_80015D30(v29, v21, v22);
    }
    else
    {
      v29 = a6;
    }
    sub_80015538(&v29, a5);
    sub_80015694(a3, a5);
    if ( !--a8 )
      break;
    v23 = sub_80015990(*a4 - v25, a4[1] - v26, a4[2] - v27);
    if ( !a3 )
      _break(7u, 0);
    if ( a3 == -1 && v23 == 0x80000000 )
      _break(6u, 0);
    sub_80016168(a2, g_LanguageID[0].menus[0].header.pad1, v23 / a3, &v25);
  }
  return v30;
}

//----- (8003F0F4) --------------------------------------------------------
int sub_8003F0F4(int a1, char a2, ...)
{
  va_list v4; // $s3
  int *v5; // $s2
  Entity *v6; // $s1
  int v7; // $a0
  int v8; // $s0
  int result; // $v0
  Entity *v10; // $a0
  int v11; // $v1
  int v12; // $a0
  int *v13; // $a1
  int v14; // $a2
  Entity *v15; // $a0
  int v16; // $a0
  int v17; // $s3
  #15 *v18; // $s0
  char current_layer; // $v1
  EntityDefinition **v20; // $v0
  int v21; // $v1
  int v22; // $v1
  int v23; // $s3
  int v24; // $s0
  char v25; // $v1
  EntityDefinition **v26; // $v0
  int v27; // $v1
  int v28; // $v1
  int v29; // $v1
  int v30; // $a0
  int v31; // $a1
  int v32; // $s0
  int v33; // $v0
  Entity *v34; // $a0
  __int16 v35; // $v1
  int v36; // [sp+14h] [-8Ch]
  int v37; // [sp+14h] [-8Ch]
  int v38; // [sp+14h] [-8Ch]
  int v39; // [sp+14h] [-8Ch]
  __int16 v40; // [sp+18h] [-88h]
  __int16 v41; // [sp+18h] [-88h]
  __int16 v42; // [sp+18h] [-88h]
  __int16 v43; // [sp+18h] [-88h]
  __int16 v44; // [sp+18h] [-88h]
  __int16 v45; // [sp+18h] [-88h]
  __int16 v46; // [sp+18h] [-88h]
  __int16 v47; // [sp+1Ch] [-84h]
  __int16 v48; // [sp+1Ch] [-84h]
  __int16 v49; // [sp+1Ch] [-84h]
  __int16 v50; // [sp+1Ch] [-84h]
  __int16 v51; // [sp+1Ch] [-84h]
  __int16 v52; // [sp+1Ch] [-84h]
  __int16 v53; // [sp+1Ch] [-84h]
  __int16 v54; // [sp+20h] [-80h]
  __int16 v55; // [sp+20h] [-80h]
  __int16 v56; // [sp+24h] [-7Ch]
  __int16 v57; // [sp+24h] [-7Ch]
  __int16 v58; // [sp+28h] [-78h]
  __int16 v59; // [sp+28h] [-78h]
  int v60; // [sp+30h] [-70h] BYREF
  int v61; // [sp+34h] [-6Ch]
  Entity *v62; // [sp+38h] [-68h]
  int v63; // [sp+40h] [-60h] BYREF
  int v64; // [sp+44h] [-5Ch]
  int v65; // [sp+48h] [-58h]
  int v66[4]; // [sp+50h] [-50h] BYREF
  int v67; // [sp+60h] [-40h] BYREF
  int v68; // [sp+64h] [-3Ch]
  int v69; // [sp+68h] [-38h]
  int v70; // [sp+70h] [-30h] BYREF
  int v71; // [sp+74h] [-2Ch]
  __int16 v72[4]; // [sp+78h] [-28h] BYREF
  __int16 v73[4]; // [sp+80h] [-20h] BYREF
  int v74; // [sp+88h] [-18h] BYREF
  int v75; // [sp+8Ch] [-14h]
  int v76; // [sp+90h] [-10h]
  int v77; // [sp+94h] [-Ch]
  signed int v78; // [sp+98h] [-8h] BYREF
  int v79; // [sp+9Ch] [-4h] BYREF
  int v80; // [sp+C8h] [+28h] BYREF
  va_list va; // [sp+C8h] [+28h]
  int v82; // [sp+CCh] [+2Ch]
  int v83; // [sp+D0h] [+30h]
  int v84; // [sp+D4h] [+34h] BYREF
  va_list va1; // [sp+D4h] [+34h]
  va_list va2; // [sp+D8h] [+38h] BYREF

  va_start(va2, a2);
  va_start(va1, a2);
  va_start(va, a2);
  v80 = va_arg(va1, _DWORD);
  v82 = va_arg(va1, _DWORD);
  v83 = va_arg(va1, _DWORD);
  va_copy(va2, va1);
  v84 = va_arg(va2, _DWORD);
  va_copy(v4, va);
  v5 = &g_LanguageID[0].header[2];
  v6 = g_CurrentEntityPtr;
  if ( v80 == -1 )
  {
    va_copy(v4, va1);
    v73[0] = v82;
    v73[1] = v83;
    v73[2] = v84;
    sub_80015614(&g_CurrentEntityPtr->rot_z, v73, &v63);
  }
  else if ( v80 == -2 )
  {
    sub_8003EAC0(g_CurrentEntityPtr, v82, v66);
    sub_8003EAC0(v6, v83, &v63);
    va_copy(v4, va1);
    v5 = &v67;
    v8 = v84;
    v67 = FixedPointLerp(*&g_LanguageID[0].header[2], ((v63 - v66[0]) << 8) + v6->pos.X, v84);
    v68 = FixedPointLerp(*&g_LanguageID[0].header[6], ((v64 - v66[1]) << 8) + v6->pos.Y, v8);
    v69 = FixedPointLerp(*&g_LanguageID[0].menus[0].header.posY, ((v65 - v66[2]) << 8) + v6->pos.Z, v8);
  }
  else
  {
    sub_8003EAC0(g_CurrentEntityPtr, v80, &v63);
  }
  v60 = v6->pos.X + v63;
  v61 = v6->pos.Y + v64;
  result = v6->pos.Z + v65;
  v62 = result;
  switch ( a1 )
  {
    case 1:
    case 28:
      v12 = v6;
      v13 = v5;
      v14 = 500;
      goto LABEL_25;
    case 2:
      return SpawnParticleEntity(a2, 0x23u, a1, &v60, &v70, 4096, 256, 4096, v54, v56, v58);
    case 4:
      v12 = v6;
      v13 = v5;
      v14 = 800;
      goto LABEL_25;
    case 7:
    case 32:
      goto LABEL_8;
    case 9:
    case 33:
      sub_8003EEB0(v6, v5, 400, &v60, &v70, -1, 1024, 1);
      return SpawnParticleEntity(a2, 0x23u, a1, &v60, &v70, 254, v43, v50, v54, v56, v58);
    case 12:
      sub_800159DC(v67 - v60, v68 - v61, v69 - v62, v72);
      sub_80015538(v72, &v70);
      sub_80015694(20, &v70);
      return SpawnParticleEntity(a2, 0x23u, a1, &v60, &v70, v72, 500, 60, 128, 80, 140);
    case 22:
      v12 = v6;
      v13 = v5;
      v14 = 400;
      goto LABEL_25;
    case 23:
      return SpawnParticleEntity(a2, 0x23u, a1, &v60, 0, dword_801779C0, v80, *(v4[1] + 2), v54, v56, v58);
    case 24:
      v12 = v6;
      v13 = v5;
      v14 = 250;
      goto LABEL_25;
    case 26:
    case 27:
      v12 = v6;
      v13 = v5;
      v14 = 300;
LABEL_25:
      sub_8003EEB0(v12, v13, v14, &v60, &v70, -1, 1024, 1);
      result = SpawnParticleEntity(a2, 0x23u, a1, &v60, &v70, v38, v44, v51, v54, v56, v58);
      break;
    case 29:
    case 31:
      v29 = *(&g_LanguageID[3483439].menus[3].items[0].refY + v5);
      v30 = *(&g_LanguageID[3483439].menus[3].items[0].ColorAlt + v5);
      v31 = *(&g_LanguageID[3483439].menus[3].items[0].height + v5);
      v74 = *v5;
      v75 = v29;
      v76 = v30;
      v77 = v31;
      v32 = 6;
      while ( 1 )
      {
        v33 = CalculateDistance(v74 - v60, v76 - v62);
        --v32;
        if ( sub_80015DD0(0, v33, v61 + 1400 - v75, 10, 800, &v78, &v79) )
          v79 = 256;
        if ( !v32 )
          break;
        sub_80016168(v5, g_LanguageID[0].menus[0].header.pad1, v78 >> 6, &v74);
      }
      v72[1] = sub_8003EEB0(v6, &v74, 800, &v60, &v70, v79, 3072, 1);
      v72[2] = 0;
      v72[0] = v79;
      v34 = SpawnParticleEntity(a2, 0x23u, a1, &v60, &v70, v72, v46, v53, v54, v56, v58);
      result = 50;
      if ( v34 )
      {
        v35 = v61;
        *&v34->ai_timer_1 = 50;
        v34->grind_z = 0;
        v34->rot_z = v35;
      }
      break;
    case 40:
      sub_800159DC(
        *v5 - v60,
        *(&g_LanguageID[3483439].menus[3].items[0].refY + v5) - (v61 + 1600),
        *(&g_LanguageID[3483439].menus[3].items[0].ColorAlt + v5) - v62,
        v72);
      sub_80015538(v72, &v70);
      sub_80015694(1000, &v70);
      v60 += v70;
      v61 += SHIWORD(v70);
      v62 = (v62 + v71);
      result = SpawnParticleEntity(a2, 0x23u, a1, &v60, &v70, v72, v40, v47, v54, v56, v58);
      break;
    case 108:
      sub_80015538(&v6->rot_z, &v70);
      sub_80015694(550, &v70);
      v15 = SpawnParticleEntity(a2, 0x23u, 7u, &v60, &v70, v36, v40, v47, v54, v56, v58);
      result = 5;
      if ( v15 )
        v15->unk_0B = 5;
      break;
    case 110:
      v17 = *(v4[1] + 2);
      result = sub_8003B748();
      v18 = result;
      if ( result )
      {
        sub_8003EEB0(v6, v5, 400, &v60, &v70, -1, 1024, 1);
        *v18 = 5;
        *(v18 + 2) = v17;
        *(v18 + 4) = 0;
        *(v18 + 5) = 0;
        current_layer = v6->current_layer;
        *(v18 + 9) = 1;
        *(v18 + 3) = current_layer;
        v20 = &g_ObjectTypeTable[30 * v17];
        *(v18 + 10) = v20[13];
        *(v18 + 21) = *(v20 + 9);
        *(v18 + 11) = v60;
        *(v18 + 12) = v61 + 4096;
        *(v18 + 13) = v62;
        Entity_EnterCombatState(v18);
        v21 = v71;
        *(v18 + 20) = v70;
        *(v18 + 21) = v21;
        v22 = *v6->ai_scratchpad;
        *(v18 + 16) = *&v6->rot_z;
        *(v18 + 17) = v22;
        result = sub_8003C1CC(v18, 0x1Du);
      }
      break;
    case 112:
      v23 = *(v4[1] + 2);
      result = sub_8003B748();
      v24 = result;
      if ( result )
      {
        sub_8003EEB0(v6, v5, 250, &v60, &v70, -1, 1024, 1);
        *v24 = 5;
        *(v24 + 2) = v23;
        *(v24 + 4) = 0;
        *(v24 + 5) = 0;
        v25 = v6->current_layer;
        *(v24 + 9) = 1;
        *(v24 + 3) = v25;
        v26 = &g_ObjectTypeTable[30 * v23];
        *(v24 + 40) = v26[13];
        *(v24 + 21) = *(v26 + 9);
        *(v24 + 44) = v60;
        *(v24 + 48) = (*(v26 + 10) >> 1) + v61;
        *(v24 + 52) = v62;
        Entity_EnterCombatState(v24);
        v27 = v71;
        *(v24 + 80) = v70;
        *(v24 + 84) = v27;
        v28 = *v6->ai_scratchpad;
        *(v24 + 64) = *&v6->rot_z;
        *(v24 + 68) = v28;
        result = sub_8003C1CC(v24, 0x1Eu);
      }
      break;
    case 120:
      v60 = (rand(v7) >> 2) + *&g_LanguageID[0].header[2] - 4096;
      v62 = ((rand(v16) >> 2) + *&g_LanguageID[0].menus[0].header.posY - 4096);
      v61 = *&g_LanguageID[0].header[6] - 5000;
      SpawnParticleEntity(a2, 0x23u, a1, &v60, 0, v36, v40, v47, v54, v56, v58);
      result = SpawnParticleEntity(a2, 0x23u, a1, &v60, 0, v39, v45, v52, v55, v57, v59);
      break;
    case 121:
      sub_8003EEB0(v6, v5, 600, &v60, &v70, -1, 1024, 1);
      v11 = (sub_80015990(
               v60 - *v5,
               v61 - *(&g_LanguageID[3483439].menus[3].items[0].refY + v5),
               v62 - *(&g_LanguageID[3483439].menus[3].items[0].ColorAlt + v5))
           - 2000)
          / 600;
      if ( v11 < 0 )
        v11 = 0;
      result = SpawnParticleEntity(a2, 0x23u, a1, &v60, &v70, v11, v42, v49, v54, v56, v58);
      break;
    case 123:
      LOBYTE(a1) = 32;
      if ( !v4[2] )
LABEL_8:
        sub_800143E0(35, &v60, 110, 0);
      sub_8003EEB0(v6, v5, 500, &v60, &v70, -1, 1024, 1);
      v10 = SpawnParticleEntity(a2, 0x23u, a1, &v60, &v70, v37, v41, v48, v54, v56, v58);
      result = 3;
      if ( v10 )
        v10->unk_0B = 3;
      break;
    default:
      return result;
  }
  return result;
}
// 8003F30C: variable 'v37' is possibly undefined
// 8003F30C: variable 'v41' is possibly undefined
// 8003F30C: variable 'v48' is possibly undefined
// 8003F30C: variable 'v54' is possibly undefined
// 8003F30C: variable 'v56' is possibly undefined
// 8003F30C: variable 'v58' is possibly undefined
// 8003F3C0: variable 'v42' is possibly undefined
// 8003F3C0: variable 'v49' is possibly undefined
// 8003F474: variable 'v40' is possibly undefined
// 8003F474: variable 'v47' is possibly undefined
// 8003F4D0: variable 'v43' is possibly undefined
// 8003F4D0: variable 'v50' is possibly undefined
// 8003F5A4: variable 'v36' is possibly undefined
// 8003F614: variable 'v38' is possibly undefined
// 8003F614: variable 'v44' is possibly undefined
// 8003F614: variable 'v51' is possibly undefined
// 8003F6BC: variable 'v7' is possibly undefined
// 8003F6D8: variable 'v16' is possibly undefined
// 8003F734: variable 'v39' is possibly undefined
// 8003F734: variable 'v45' is possibly undefined
// 8003F734: variable 'v52' is possibly undefined
// 8003F734: variable 'v55' is possibly undefined
// 8003F734: variable 'v57' is possibly undefined
// 8003F734: variable 'v59' is possibly undefined
// 8003FA9C: variable 'v46' is possibly undefined
// 8003FA9C: variable 'v53' is possibly undefined
// 80062BF0: using guessed type int __fastcall rand(_DWORD);
// 801779C0: using guessed type int dword_801779C0;

//----- (8003FAE8) --------------------------------------------------------
int __fastcall sub_8003FAE8(int a1)
{
  int v1; // $s0

  v1 = 16 - (*(a1 + 74) << 16 >> 24);
  if ( v1 < 13 )
  {
    if ( v1 < -12 )
      v1 = -12;
  }
  else
  {
    v1 = 12;
  }
  return v1 - 2 + ((5 * rand(a1)) >> 15);
}
// 80062BF0: using guessed type int __fastcall rand(_DWORD);

//----- (8003FB58) --------------------------------------------------------
int __fastcall sub_8003FB58(int a1)
{
  int v2; // $s1
  int v3; // $v0
  int v5; // $v0

  v2 = *(a1 + 96);
  if ( (*(v2 + 4) & 0x80) != 0 )
  {
    v3 = sub_8003FAE8(a1);
    return PlayPositionalSound3D_Wrap((*(v2 + 4) & 0x7F) + 96, (a1 + 44), 127, 24576, 30720, v3);
  }
  else
  {
    v5 = sub_8003FAE8(a1);
    return sub_800143E0(*(v2 + 4) + 96, (a1 + 44), 110, v5);
  }
}

//----- (8003FBF8) --------------------------------------------------------
int UpdateEnemyAI()
{
  Entity *v0; // $s3
  EntityDefinition *v1; // $s5
  int v2; // $s4
  int v3; // $v0
  int v4; // $a0
  int v5; // $s0
  int v6; // $v1
  int v7; // $s0
  int bit_flags; // $v0
  __int16 v9; // $v0
  int v10; // $a0
  int active; // $v1
  int v12; // $v0
  char v13; // $a0
  unsigned int height; // $a3
  int unk_0B; // $a1
  Vector3 *p_pos; // $a2
  __int16 v17; // $v0
  int speed; // $v1
  int v19; // $v1
  int v20; // $a0
  __int16 v21; // $a1
  char current_layer; // $a0
  int grid_x; // $a1
  int coll_radius; // $a3
  int v25; // $a1
  int v26; // $a2
  int v27; // $v0
  char v28; // $s0
  int Y; // $a0
  int v30; // $v0
  int v31; // $a0
  int v32; // $a0
  int v33; // $a1
  int v34; // $v1
  __int16 v35; // $v0
  bool v36; // dc
  int v37; // $v0
  int target_id; // $v1
  signed int v39; // $a0
  __int16 v40; // $v0
  char v41; // $t0
  int v42; // $v1
  int v43; // $a0
  int v44; // $s0
  int v45; // $s2
  int v46; // $s1
  int v47; // $s0
  unsigned int v48; // $v0
  int v49; // $a2
  int v50; // $s0
  int v51; // $v1
  __int16 v52; // $v0
  char v53; // $v0
  __int16 *v54; // $a0
  __int16 v55; // $v0
  int v56; // $v1
  int v57; // $v0
  int v58; // $a0
  BOOL v59; // $v0
  signed __int16 v60; // $v0
  __int16 v61; // $v0
  int v62; // $v0
  int v63; // $a0
  BOOL v64; // $v0
  signed __int16 v65; // $v0
  __int16 v66; // $v0
  int v67; // $v0
  BOOL v68; // $v0
  signed __int16 v69; // $v0
  __int16 v70; // $v0
  __int16 v71; // $v0
  int v72; // $a2
  int v73; // $a0
  int v74; // $a0
  signed __int16 v75; // $v0
  unsigned int anim_timer; // $v1
  __int16 v77; // $s1
  __int16 v78; // $s0
  __int16 v79; // $v0
  int v80; // $v1
  int v81; // $v1
  __int16 v82; // $v0
  int v83; // $a0
  __int16 v84; // $v0
  int v85; // $a0
  int v86; // $v0
  int v87; // $v0
  unsigned int v88; // $v0
  int v89; // $s2
  int v90; // $s1
  int v91; // $s0
  int v92; // $a0
  int v93; // $v1
  int v94; // $v0
  unsigned __int8 v95; // $a0
  int v96; // $v1
  int v97; // $v0
  int v98; // $v1
  __int16 v99; // $v0
  __int16 coll_height; // $v1
  int v101; // $s1
  int v102; // $s1
  __int16 v103; // $v0
  Entity **v104; // $a0
  int v105; // $v0
  BOOL v106; // $v0
  __int16 v107; // $v1
  __int16 v108; // $v0
  int v109; // $v0
  int v110; // $v1
  __int16 v111; // $v0
  signed __int16 v112; // $v0
  int v113; // $s1
  unsigned __int16 *v114; // $s0
  int v115; // $a2
  __int16 v116; // $a0
  signed __int16 v117; // $a3
  __int16 *v118; // $s0
  __int16 v119; // $t0
  __int16 v120; // $v1
  int v121; // $a3
  unsigned __int16 *v122; // $s0
  int v123; // $t0
  int v124; // $v1
  int v125; // $a0
  __int16 v126; // $a1
  int v127; // $v1
  __int16 v128; // $v0
  __int16 v129; // $v0
  unsigned __int8 *v130; // $v0
  __int16 unk_42; // $v1
  int v132; // $v1
  __int16 *v133; // $a0
  __int16 v134; // $v1
  int v135; // $v0
  int v136; // $v0
  int v137; // $a0
  int v138; // $v0
  int v139; // $v0
  int v140; // $v1
  int v141; // $s0
  int v142; // $a3
  int v143; // $v1
  char v144; // $a0
  int v145; // $v0
  int v146; // $v1
  int result; // $v0
  int v148; // [sp+10h] [-78h]
  int v149; // [sp+14h] [-74h]
  __int16 v150[4]; // [sp+30h] [-58h] BYREF
  int v151; // [sp+38h] [-50h] BYREF
  int v152; // [sp+3Ch] [-4Ch]
  int v153; // [sp+40h] [-48h] BYREF
  int v154; // [sp+44h] [-44h]
  int v155; // [sp+48h] [-40h] BYREF
  int v156; // [sp+4Ch] [-3Ch]
  int v157; // [sp+50h] [-38h]
  int v158[4]; // [sp+58h] [-30h] BYREF
  int v159[8]; // [sp+68h] [-20h] BYREF

  v0 = g_CurrentEntityPtr;
  v1 = g_CurrentEntityDef;
  v2 = *&g_CurrentEntityPtr->ai_scratchpad[28];
  v3 = 3;
  if ( (g_CurrentEntityPtr->bit_flags & 4) == 0 )
    v3 = 147;
  dword_801779AC = v3;
  Map_MarkOccupiedTiles(g_CurrentEntityPtr->pos.X, g_CurrentEntityPtr->pos.Z, g_CurrentEntityPtr->coll_radius, -1);
  if ( *(v2 + 4) == 255 )
    goto LABEL_20;
  v5 = *(v2 + 10) & 0x3FFF;
  v6 = *(v2 + 10) & 0xC000;
  if ( v6 == 0x4000 )
  {
    if ( (*(v2 + 10) & 0x3FFF) == 0 )
      _break(7u, 0);
    v4 = v5 * dword_801779C0 / 3 % v5;
    if ( (*(v2 + 10) & 0x3FFF) == 0 )
      _break(7u, 0);
    if ( g_FrameCounter % v5 != v4 )
      goto LABEL_20;
  }
  else if ( (*(v2 + 10) & 0xC000u) >= 0x4001 )
  {
    if ( v6 != 0x8000 || rand(v4) >> 3 >= v5 )
      goto LABEL_20;
  }
  else
  {
    v4 = v0;
    if ( (*(v2 + 10) & 0xC000) != 0 || !sub_8003D8B4(v0, *(v2 + 10) & 0x3FFF) )
      goto LABEL_20;
  }
  sub_8003FB58(v0);
LABEL_20:
  switch ( v0->ai_timer_1 )
  {
    case 0:
      if ( !v0->ai_timer_2 )
      {
        v0->ai_timer_2 = -16;
        sub_8003C27C(*(v2 + 1));
      }
      sub_8003D824(v0, *(v2 + 8));
      if ( Math_IsAngleInRange(v0->anim_timer, 0, *(v2 + 8) - 1) )
        v0->ai_timer_2 = -15;
      goto LABEL_334;
    case 1:
      if ( !v0->ai_timer_2 )
      {
        v0->ai_timer_2 = -15;
        sub_8003C27C(*(v2 + 1));
LABEL_72:
        *&v0->ai_scratchpad[32] = rand(v20) >> 3;
        goto LABEL_73;
      }
      if ( sub_8003E75C(*&v0->ai_scratchpad[32], *(v2 + 12), *(v2 + 14), v1->flags[3], v1->flags[4], 5)
        || rand(v20) >> 5 < *(v2 + 16) )
      {
        goto LABEL_72;
      }
LABEL_73:
      v21 = *(v2 + 8);
      goto LABEL_348;
    case 2:
      if ( !v0->ai_timer_2 )
      {
        v0->ai_timer_2 = -16;
        sub_8003C250(*(v2 + 1));
      }
      if ( v0->anim_timer < 0x800u || (v0->bit_flags & 0x800) == 0 )
        sub_8003D858(v0, *(v2 + 8));
      if ( v0->anim_timer >= 0xFFFu )
        sub_8003C220();
      goto LABEL_152;
    case 3:
      v7 = *&v0->ai_scratchpad[44];
      if ( !v0->ai_timer_2 )
      {
        v0->ai_timer_2 = -16;
        sub_8003C250(*(v2 + 1));
        bit_flags = v0->bit_flags;
        *&v0->ai_scratchpad[44] = 0;
        v0->bit_flags = bit_flags & 0xFFFEFFFF;
      }
      if ( !*&v0->ai_scratchpad[44] )
      {
        if ( v0->anim_timer >= 0x400u && (v0->bit_flags & 0x800) != 0 )
          goto LABEL_377;
        sub_8003D858(v0, *(v2 + 8));
        if ( !sub_8003D8B4(v0, 0x800u) )
          goto LABEL_45;
        v9 = sub_80015CC8(*&v1->unk_param[26]);
        v10 = (*&v1->unk_param[26] + v9);
        if ( *&v1->unk_param[26] + v9 )
          sub_80039068(v10, &v0->pos.X, -(v0->height >> 1));
        active = v0->active;
        if ( v0->active && active != 4 )
        {
          if ( active != 1 )
            goto LABEL_45;
          unk_0B = v0->unk_0B;
          v13 = 0;
          if ( unk_0B == 255 )
            goto LABEL_45;
          height = v0->height;
          p_pos = &v0->pos;
        }
        else
        {
          if ( *(v2 + 12) == 255 )
            goto LABEL_45;
          v12 = rand(v10);
          v13 = 1;
          if ( v12 >> 7 >= *(v2 + 13) )
            goto LABEL_45;
          height = v0->height;
          LOBYTE(unk_0B) = *(v2 + 12);
          p_pos = &v0->pos;
        }
        SpawnProjectile(v13, unk_0B, p_pos, -(height >> 1));// <-----------------from sub_80038EF4
LABEL_45:
        v17 = 15;
        if ( v0->anim_timer >= 0xFFFu )
          goto LABEL_151;
        if ( !*(v2 + 8) )
          *&v0->ai_scratchpad[44] = 15;
        goto LABEL_152;
      }
      if ( *&v0->ai_scratchpad[44] == 99 )
        goto LABEL_377;
      ++*&v0->ai_scratchpad[44];
      if ( v7 >= 20 )
      {
        if ( v7 == 20 )
        {
          v0->action_id = 66;
          v0->speed = 1024;
          HIBYTE(v0->angle_speed) = 1;
          goto LABEL_152;
        }
        if ( v7 >= 38 )
        {
          (*&g_CurrentStateVTable[2].gap0[20])(v0);
          v19 = v0->active;
          switch ( v19 )
          {
            case 1:
              sub_8003B984(v0);
              goto LABEL_152;
            case 2:
              v0->current_state = 0;
              break;
            case 5:
              v0->active = -1;
              v0->current_state = 0;
              goto LABEL_152;
            default:
              v0->current_state = 2;
              break;
          }
          Entity_UpdatePhysics(v0);
        }
        else
        {
          speed = v0->speed;
          if ( speed >= 4096 )
            v0->speed = 4096;
          else
            v0->speed = speed + 192;
        }
      }
LABEL_152:
      sub_8003E414(2 * v1->flags[3], 10);
      goto LABEL_377;
    case 4:
      if ( !v0->ai_timer_2 )
      {
        v0->ai_timer_2 = -16;
        sub_8003C250(*(v2 + 1));
      }
      sub_8003D858(v0, *(v2 + 8));
      if ( sub_8003D8B4(v0, *(v2 + 24)) )
        sub_8003D090(0, *(v2 + 14), *(v2 + 15), *(v2 + 16), *(v2 + 18), *(v2 + 20), *(v2 + 22), *(v2 + 17));
      if ( v0->anim_timer >= 0xFFFu )
        sub_8003C220();
      v74 = *(v2 + 13);
      goto LABEL_335;
    case 5:
      if ( v0->ai_timer_2 )
        goto LABEL_102;
      v0->ai_timer_2 = -15;
      sub_8003C27C(*(v2 + 1));
      target_id = v0->target_id;
      if ( target_id == 18 )
        goto LABEL_99;
      if ( v0->target_id < 0x13u )
      {
        if ( target_id != 4 )
        {
          v0->ai_scratchpad[44] = 0;
          goto LABEL_101;
        }
        goto LABEL_99;
      }
      if ( v0->target_id < 0x19u && v0->target_id >= 0x17u )
      {
LABEL_99:
        v0->ai_scratchpad[44] = 1;
        goto LABEL_101;
      }
      v0->ai_scratchpad[44] = 0;
LABEL_101:
      v0->ai_scratchpad[45] = 0;
LABEL_102:
      if ( rand(v4) < 6000 )
      {
        v39 = CalculateDistance(
                *&g_LanguageID[0].header[2] - v0->pos.X,
                *&g_LanguageID[0].menus[0].header.posY - v0->pos.Z);
        if ( v39 < *(v2 + 22) )
        {
          if ( *(v2 + 20) >= v39 )
            v0->ai_scratchpad[44] = 1;
        }
        else
        {
          v0->ai_scratchpad[44] = 0;
        }
      }
      v40 = Math_Atan2_Fixed(
              *&g_LanguageID[0].header[2] - v0->pos.X,
              *&g_LanguageID[0].menus[0].header.posY - v0->pos.Z);
      v41 = 33;
      v42 = v0->ai_scratchpad[45];
      *&v0->ai_scratchpad[32] = v40;
      if ( !v42 )
        v41 = 5;
      if ( v0->ai_scratchpad[44] )
        v44 = sub_8003E540(v40 + 2048, *(v2 + 12), v1->flags[3], v41);
      else
        v44 = sub_8003E75C(v40, *(v2 + 12), *(v2 + 14), v1->flags[3], v1->flags[4], v41);
      if ( (v44 & 0x100) != 0 )
      {
        if ( v0->ai_scratchpad[45] )
          goto LABEL_119;
        if ( rand(v43) < *(v2 + 24) )
        {
          v0->ai_scratchpad[45] = 1;
          goto LABEL_119;
        }
      }
      else
      {
        v0->ai_scratchpad[45] = 0;
      }
      if ( v44 )
        v0->ai_scratchpad[44] = v0->ai_scratchpad[44] == 0;
LABEL_119:
      v21 = *(v2 + 8);
LABEL_348:
      sub_8003D824(v0, v21);
      goto LABEL_377;
    case 9:
      if ( !v0->ai_timer_2 )
      {
        v0->ai_timer_2 = -16;
        *&v0->ai_scratchpad[44] = 0;
        sub_8003C250(*(v2 + 20));
      }
      v56 = *&v0->ai_scratchpad[44];
      if ( v56 == 1 )
      {
        sub_8003D858(v0, *(v2 + 22));
        if ( v0->anim_timer < 0xFFFu )
          goto LABEL_152;
        v36 = sub_8003DF98(
                1,
                *&g_LanguageID[0].header[2],
                *&g_LanguageID[0].header[6] - 500,
                *&g_LanguageID[0].menus[0].header.posY,
                *(v2 + 23),
                *(v2 + 16)) << 16 <= 0;
        v17 = 2;
        if ( !v36 )
        {
LABEL_151:
          *&v0->ai_scratchpad[44] = v17;
          goto LABEL_152;
        }
      }
      else
      {
        if ( v56 < 2 )
        {
          if ( !*&v0->ai_scratchpad[44] )
          {
            if ( sub_8003E540(v0->unk_42 + 2048, *(v2 + 18), v1->flags[3], 5)
              || (sub_8003D824(v0, *(v2 + 8)),
                  CalculateDistance(
                    *&g_LanguageID[0].header[2] - v0->pos.X,
                    *&g_LanguageID[0].menus[0].header.posY - v0->pos.Z) >= *(v2 + 14)) )
            {
              *&v0->ai_scratchpad[44] = 1;
              sub_8003C250(*(v2 + 1));
            }
          }
          goto LABEL_377;
        }
        if ( v56 != 2 )
        {
          if ( v56 == 3 )
          {
            sub_8003D858(v0, *(v2 + 22));
            if ( v0->anim_timer >= 0xFFFu )
              sub_8003C220();
            sub_8003E414(*&v0->ai_scratchpad[36] << 16 >> 20, 10);
          }
          goto LABEL_377;
        }
        if ( HIBYTE(v0->anim_frame) )
        {
          sub_8003E75C(v0->unk_42, *&v0->ai_scratchpad[36], 0, *&v0->ai_scratchpad[36], v1->flags[4], 10);
          goto LABEL_377;
        }
      }
      *&v0->ai_scratchpad[44] = 3;
      sub_8003C250(*(v2 + 21));
      goto LABEL_377;
    case 0xA:
      if ( !v0->ai_timer_2 )
      {
        v0->ai_timer_2 = -15;
        sub_8003C27C(*(v2 + 1));
        sub_8003E038();
      }
      v57 = rand(v4);
      v36 = v57 >= 2048;
      v59 = v57 < 4096;
      if ( v36 )
      {
        if ( v59 )
        {
          v61 = *&v0->ai_scratchpad[12] - *(v2 + 16);
          *&v0->ai_scratchpad[12] = v61;
          if ( v61 < -*(v2 + 12) )
            *&v0->ai_scratchpad[12] = -*(v2 + 12);
        }
      }
      else
      {
        v60 = *&v0->ai_scratchpad[12] + *(v2 + 16);
        *&v0->ai_scratchpad[12] = v60;
        if ( *(v2 + 12) < v60 )
          *&v0->ai_scratchpad[12] = *(v2 + 12);
      }
      v62 = rand(v58);
      v36 = v62 >= 2048;
      v64 = v62 < 4096;
      if ( v36 )
      {
        if ( v64 )
        {
          v66 = *&v0->ai_scratchpad[16] - *(v2 + 16);
          *&v0->ai_scratchpad[16] = v66;
          if ( v66 < -*(v2 + 12) )
            *&v0->ai_scratchpad[16] = -*(v2 + 12);
        }
      }
      else
      {
        v65 = *&v0->ai_scratchpad[16] + *(v2 + 16);
        *&v0->ai_scratchpad[16] = v65;
        if ( *(v2 + 12) < v65 )
          *&v0->ai_scratchpad[16] = *(v2 + 12);
      }
      v67 = rand(v63);
      v36 = v67 >= 2048;
      v68 = v67 < 4096;
      if ( v36 )
      {
        if ( v68 )
        {
          v70 = *&v0->ai_scratchpad[14] - *(v2 + 16);
          *&v0->ai_scratchpad[14] = v70;
          if ( v70 < -*(v2 + 12) )
            *&v0->ai_scratchpad[14] = -*(v2 + 12);
        }
      }
      else
      {
        v69 = *&v0->ai_scratchpad[14] + *(v2 + 16);
        *&v0->ai_scratchpad[14] = v69;
        if ( *(v2 + 12) < v69 )
          *&v0->ai_scratchpad[14] = *(v2 + 12);
      }
      sub_8003DDB0(&v0->ai_scratchpad[12]);
      sub_8003D824(v0, *(v2 + 8));
      v71 = Math_Atan2_Fixed(*&v0->ai_scratchpad[12], *&v0->ai_scratchpad[16]);
      v72 = *(v2 + 14);
      v73 = v0;
      goto LABEL_230;
    case 0xB:
      if ( !v0->ai_timer_2 )
      {
        v0->ai_timer_2 = -16;
        sub_8003C27C(*(v2 + 1));
        *&v0->ai_scratchpad[44] = 0;
        sub_8003E038();
      }
      v80 = *&v0->ai_scratchpad[44];
      if ( v80 == 1 )
      {
        v81 = *&v0->ai_scratchpad[50];
        v153 = *&v0->ai_scratchpad[46];
        v154 = v81;
        v151 = v153;
        v152 = v81;
        sub_80015694(*(v2 + 20), &v151);
        sub_80015694(*(v2 + 24), &v153);
        v82 = sub_80014D48(*&v0->ai_scratchpad[12], v151, v153);
        v83 = *&v0->ai_scratchpad[14];
        *&v0->ai_scratchpad[12] = v82;
        v84 = sub_80014D48(v83, SHIWORD(v151), SHIWORD(v153));
        v85 = *&v0->ai_scratchpad[16];
        *&v0->ai_scratchpad[14] = v84;
        *&v0->ai_scratchpad[16] = sub_80014D48(v85, v152, v154);
        v86 = sub_8003DDB0(&v0->ai_scratchpad[12]);
        v36 = v86 == 0;
        v87 = v86 & 0x80;
        if ( !v36 )
        {
          if ( v87 )
            ApplyStatusEffect(*(v2 + 14), *(v2 + 16), *(v2 + 18), *(v2 + 13), 0, 0, 0, 0, 0, 0x1000u, 0xAu, &v0->pos.X);
          *&v0->ai_scratchpad[44] = 2;
        }
        v0->rot_z = (v0->rot_z + 256) & 0xFFF;
      }
      else
      {
        if ( v80 >= 2 )
        {
          if ( v80 == 2 )
          {
            v88 = (v0->rot_z + 256) & 0xFFF;
            v0->rot_z = v88;
            if ( v88 < 0x100 )
            {
              v0->rot_z = 0;
              *&v0->ai_scratchpad[44] = 3;
            }
          }
          else
          {
            if ( v80 != 3 )
              goto LABEL_229;
            sub_8003D858(v0, -*(v2 + 8));
            if ( !v0->anim_timer )
              sub_8003C220();
          }
        }
        else
        {
          if ( *&v0->ai_scratchpad[44] )
            goto LABEL_229;
          sub_8003D858(v0, *(v2 + 8));
          if ( v0->anim_timer >= 0xFFFu )
          {
            sub_800159DC(
              *&g_LanguageID[0].header[2] - v0->pos.X,
              *&g_LanguageID[0].header[6] - v0->pos.Y,
              *&g_LanguageID[0].menus[0].header.posY - v0->pos.Z,
              v150);
            sub_80015538(v150, &v0->ai_scratchpad[46]);
            *&v0->ai_scratchpad[44] = 1;
          }
        }
        sub_8003DDB0(&v0->ai_scratchpad[12]);
      }
LABEL_229:
      v71 = Math_Atan2_Fixed(*&v0->ai_scratchpad[12], *&v0->ai_scratchpad[16]);
      v73 = v0;
      v72 = *(v2 + 22);
LABEL_230:
      sub_8003E608(v73, v71, v72, v1->flags[4]);
      goto LABEL_377;
    case 0xC:
    case 0x10:
      if ( !v0->ai_timer_2 )
      {
        current_layer = v0->current_layer;
        grid_x = v0->grid_x;
        v0->ai_timer_2 = -15;
        coll_radius = v0->coll_radius;
        v25 = (grid_x << 11) + v0->fine_x;
        v26 = (v0->grind_z << 11) + v0->fine_z;
        v27 = v0->height;
        *&v0->ai_scratchpad[50] = 0;
        *&v0->ai_scratchpad[48] = 0;
        *&v0->ai_scratchpad[46] = 0;
        *&v0->ai_scratchpad[52] = v0->vertical_velocity + Map_GetCellData(current_layer, v25, v26, coll_radius, v27);
        v28 = 3;
        sub_8003C27C(*(v2 + 1));
        sub_8003E038();
        v30 = 1;
        goto LABEL_85;
      }
      v28 = sub_8003EA30(&v0->ai_scratchpad[46], *(v2 + 12), *(v2 + 14), v1->flags[3], v1->flags[4], 17);
      if ( rand(v31) >> 5 < *(v2 + 19) )
        v28 |= 1u;
      if ( rand(v32) >> 5 < *(v2 + 19) )
        v28 |= 2u;
      v33 = *&v0->ai_scratchpad[52];
      v34 = *(v2 + 16);
      Y = v0->pos.Y;
      if ( v33 + v34 >= Y )
      {
        v30 = v28 & 1;
        if ( Y >= v33 - v34 )
          goto LABEL_85;
        v35 = *(v2 + 18) + *&v0->ai_scratchpad[14];
      }
      else
      {
        v35 = *&v0->ai_scratchpad[14] - *(v2 + 18);
      }
      *&v0->ai_scratchpad[14] = v35;
      v30 = v28 & 1;
LABEL_85:
      v36 = v30 == 0;
      v37 = v28 & 2;
      if ( !v36 )
      {
        *&v0->ai_scratchpad[48] = rand(Y) >> 3;
        v37 = v28 & 2;
      }
      if ( v37 )
        *&v0->ai_scratchpad[46] = (rand(Y) >> 5) - 512;
      if ( v0->ai_timer_1 == 16 )
      {
        sub_8003ECE8(*(v2 + 1), *(v2 + 20), *(v2 + 21), *(v2 + 22), *(v2 + 23), *(v2 + 8));
        goto LABEL_377;
      }
      v21 = *(v2 + 8);
      goto LABEL_348;
    case 0xD:
    case 0x11:
      if ( !v0->ai_timer_2 )
      {
        v0->ai_timer_2 = -16;
        sub_8003C27C(*(v2 + 1));
        *&v0->ai_scratchpad[44] = 0;
      }
      v45 = *&g_LanguageID[0].header[2] - v0->pos.X;
      v46 = *&g_LanguageID[0].header[6] - v0->pos.Y - 1600;
      v47 = *&g_LanguageID[0].menus[0].header.posY - v0->pos.Z;
      v48 = sub_80015990(v45, v46, v47);
      v49 = v47;
      v50 = v48;
      sub_800159DC(v45, v46, v49, &v0->ai_scratchpad[46]);
      v51 = *&v0->ai_scratchpad[46];
      if ( v51 < 3585 )
      {
        v52 = 512;
        if ( v51 < 513 )
          goto LABEL_126;
      }
      else
      {
        v52 = 3584;
      }
      *&v0->ai_scratchpad[46] = v52;
LABEL_126:
      v53 = -15;
      if ( v50 < *(v2 + 22) )
      {
        if ( *(v2 + 20) < v50 )
          goto LABEL_131;
        *&v0->ai_scratchpad[44] = 1;
        v53 = -16;
      }
      else
      {
        *&v0->ai_scratchpad[44] = 0;
      }
      v0->ai_timer_2 = v53;
LABEL_131:
      if ( *&v0->ai_scratchpad[44] )
      {
        v150[0] = -512;
        v55 = *&v0->ai_scratchpad[48];
        v54 = v150;
        v150[2] = 0;
        v150[1] = v55 + 2048;
      }
      else
      {
        v54 = &v0->ai_scratchpad[46];
      }
      sub_8003EA30(v54, *(v2 + 12), *(v2 + 14), v1->flags[3], v1->flags[4], 17);
      if ( v0->ai_timer_1 == 17 )
      {
        sub_8003ECE8(*(v2 + 1), *(v2 + 24), *(v2 + 25), *(v2 + 26), *(v2 + 27), *(v2 + 8));
        goto LABEL_377;
      }
      v21 = *(v2 + 8);
      goto LABEL_348;
    case 0xE:
      v92 = dword_801779BC;
      if ( !v0->ai_timer_2 )
      {
        v0->ai_timer_2 = -15;
        *&v0->ai_scratchpad[44] = 0;
      }
      v93 = *&v0->ai_scratchpad[44];
      if ( v93 == 1 )
      {
        if ( v0->anim_timer < 0x800u )
          goto LABEL_252;
        if ( *(v92 + 88) > 0 )
          goto LABEL_377;
        goto LABEL_254;
      }
      if ( v93 >= 2 )
      {
        if ( v93 != 2 )
        {
          if ( v93 == 3 )
          {
            v0->anim_timer -= 128;
            if ( !v0->anim_timer )
              *&v0->ai_scratchpad[44] = 0;
          }
          goto LABEL_377;
        }
        if ( v0->anim_timer < 0x800u )
        {
LABEL_252:
          v0->anim_timer += 128;
          goto LABEL_377;
        }
        if ( *(v92 + 88) < 0 )
          goto LABEL_377;
LABEL_254:
        *&v0->ai_scratchpad[44] = 3;
        goto LABEL_377;
      }
      if ( *&v0->ai_scratchpad[44] )
        goto LABEL_377;
      v94 = *(v92 + 88);
      if ( v94 > 0 )
      {
        sub_8003C250(*(v2 + 13));
        goto LABEL_293;
      }
      if ( v94 < 0 )
      {
        v95 = *(v2 + 12);
        goto LABEL_351;
      }
LABEL_377:
      v140 = v0->bit_flags;
      if ( (v140 & 0x10) != 0 )
      {
        v141 = dword_801779BC;
        if ( v0->active == 3 )
        {
          v0->unk_03 = 0;
          if ( *(v141 + 9) != 1 )
          {
            v0->current_state = 0;
            goto LABEL_394;
          }
          if ( *(v141 + 14) == 3 )
          {
            v0->ai_timer_1 = 3;
            v0->ai_timer_2 = -16;
            *&v0->ai_scratchpad[44] = 99;
            goto LABEL_394;
          }
          goto LABEL_391;
        }
        v0->unk_03 = *(dword_801779BC + 3);
        if ( *(v141 + 9) == 1 )
        {
LABEL_391:
          v146 = *(v141 + 68);
          *&v0->rot_z = *(v141 + 64);
          *v0->ai_scratchpad = v146;
          v155 = *&v0->rot_z;
          LOWORD(v156) = *v0->ai_scratchpad;
          sub_80015614(&v155, v1->gapC, v158);
          sub_8003EAC0(v141, v0->fine_x, v159);
          v0->pos.X = *(v141 + 44) + v159[0] - v158[0];
          v0->pos.Y = *(v141 + 48) + v159[1] - v158[1];
          v0->pos.Z = *(v141 + 52) + v159[2] - v158[2];
          goto LABEL_394;
        }
        v142 = v0->coll_radius;
        v143 = v0->height;
        v0->bit_flags = v0->bit_flags & 0xFFFFFEEF | 0x100;
        v144 = sub_8002E4F4(v0->pos.X, v0->pos.Y, v0->pos.Z, v142, v143, 129);
        v145 = v144 & 0xF;
        if ( (v144 & 0x80) != 0 )
        {
          v0->pos.X += 800 + v0->coll_radius;
          v145 = v144 & 0xF;
        }
        if ( v145 )
          v0->bit_flags |= 0x400u;
        if ( (v0->bit_flags & 0x200) != 0 )
          sub_8003C1CC(v0, 3u);
        *&v0->ai_scratchpad[12] = *(v141 + 80);
        *&v0->ai_scratchpad[14] = *(v141 + 82);
        *&v0->ai_scratchpad[16] = *(v141 + 84);
      }
      else if ( (v140 & 0x10000) == 0 )
      {
        UpdateObjectVerticalMovement();
      }
LABEL_394:
      result = 1;
      if ( v0->current_state == 1 )
        return Map_MarkOccupiedTiles(v0->pos.X, v0->pos.Z, v0->coll_radius, 1);
      return result;
    case 0xF:
      if ( !v0->ai_timer_2 )
      {
        v0->ai_timer_2 = -16;
        sub_8003C27C(*(v2 + 1));
      }
      sub_8003E75C(*&v0->ai_scratchpad[32], *(v2 + 12), *(v2 + 14), v1->flags[3], v1->flags[4], 5);
      sub_8003D858(v0, *(v2 + 8));
      goto LABEL_260;
    case 0x12:
      if ( !v0->ai_timer_2 )
      {
        v0->ai_timer_2 = -16;
        sub_8003C27C(*(v2 + 1));
      }
      v89 = *&g_LanguageID[0].header[2] - v0->pos.X;
      v90 = *&g_LanguageID[0].header[6] - v0->pos.Y - 1600;
      v91 = *&g_LanguageID[0].menus[0].header.posY - v0->pos.Z;
      sub_80015990(v89, v90, v91);
      sub_800159DC(v89, v90, v91, &v0->ai_scratchpad[46]);
      sub_8003EA30(&v0->ai_scratchpad[46], *(v2 + 28), *(v2 + 30), *(v2 + 13), v1->flags[4], 6);
      sub_8003D858(v0, *(v2 + 8));
      if ( sub_8003D8B4(v0, *(v2 + 24)) )
        goto LABEL_207;
      goto LABEL_260;
    case 0x13:
      if ( !v0->ai_timer_2 )
      {
        v0->ai_timer_2 = -16;
        *&v0->ai_scratchpad[44] = 0;
        sub_8003C27C(*(v2 + 1));
      }
      v96 = *&v0->ai_scratchpad[44];
      if ( v96 == 16 )
      {
        if ( g_ActiveWeaponSpell.field_14 == -1 )
          *&v0->ai_scratchpad[44] = 32;
      }
      else if ( v96 >= 17 )
      {
        if ( v96 == 32 )
        {
LABEL_274:
          sub_8003D858(v0, *(v2 + 8));
LABEL_332:
          if ( v0->anim_timer >= 0xFFFu )
            sub_8003C220();
        }
      }
      else if ( !*&v0->ai_scratchpad[44] )
      {
        sub_8003D858(v0, *(v2 + 8));
        if ( v0->anim_timer >= *(v2 + 16) )
          *&v0->ai_scratchpad[44] = 16;
      }
LABEL_334:
      v74 = v1->flags[3];
LABEL_335:
      sub_8003E414(v74, 10);
      goto LABEL_377;
    case 0x14:
      if ( !v0->ai_timer_2 )
      {
        v0->ai_timer_2 = -16;
        *&v0->ai_scratchpad[44] = *(v2 + 18);
        sub_8003C27C(*(v2 + 1));
      }
      if ( sub_8003E540(v0->unk_42 + 2048, *(v2 + 16), 1000, 5) )
        *&v0->ai_scratchpad[44] = 1;
      sub_8003D824(v0, *(v2 + 8));
      if ( v0->anim_timer < 4095 - *(v2 + 8) )
        goto LABEL_377;
      v97 = *&v0->ai_scratchpad[44] - 1;
      *&v0->ai_scratchpad[44] = v97;
      if ( v97 << 16 )
        goto LABEL_377;
      v0->anim_timer = 4095;
      goto LABEL_261;
    case 0x15:
      if ( !v0->ai_timer_2 )
      {
        v0->ai_timer_2 = -16;
        *&v0->ai_scratchpad[44] = 0;
        sub_8003C250(*(v2 + 1));
        v0->coll_radius = *(v2 + 20);
        v0->height = *(v2 + 22);
      }
      v98 = *&v0->ai_scratchpad[44];
      if ( v98 == 1 )
      {
        sub_8003D858(v0, *(v2 + 8));
        v0->coll_radius = FixedPointLerp(*(v2 + 20), v1->coll_radius, v0->anim_timer);
        v99 = FixedPointLerp(*(v2 + 22), v1->coll_height, v0->anim_timer);
        v36 = v0->anim_timer < 0xFFFu;
        v0->height = v99;
        if ( !v36 )
        {
          v0->coll_radius = v1->coll_radius;
          coll_height = v1->coll_height;
          *&v0->ai_scratchpad[44] = 2;
          v0->height = coll_height;
          *&v0->ai_scratchpad[46] = *(v2 + 16);
          sub_8003C250(*(v2 + 24));
        }
        if ( v0->anim_timer >= *(v2 + 18) )
        {
          v101 = dword_801779AC;
          dword_801779AC &= ~0x20u;
          sub_8003E75C(*&v0->ai_scratchpad[32], *(v2 + 14), 0, 255, 0, 5);
          dword_801779AC = v101;
        }
        goto LABEL_377;
      }
      if ( v98 < 2 )
      {
        if ( !*&v0->ai_scratchpad[44]
          && CalculateDistance(
               *&g_LanguageID[0].header[2] - v0->pos.X,
               *&g_LanguageID[0].menus[0].header.posY - v0->pos.Z) < *(v2 + 12) )
        {
LABEL_293:
          *&v0->ai_scratchpad[44] = 1;
        }
        goto LABEL_377;
      }
      if ( v98 != 2 )
        goto LABEL_377;
      v102 = dword_801779AC;
      dword_801779AC &= ~0x20u;
      sub_8003E75C(*&v0->ai_scratchpad[32], *(v2 + 14), 0, 255, 0, 5);
      v103 = *&v0->ai_scratchpad[46] - 1;
      *&v0->ai_scratchpad[46] = v103;
      if ( v103 == -1 )
        sub_8003C220();
      dword_801779AC = v102;
      v21 = *(v2 + 25);
      goto LABEL_348;
    case 0x16:
      if ( !v0->ai_timer_2 )
      {
        v0->ai_timer_2 = -16;
        sub_8003C250(*(v2 + 1));
      }
      goto LABEL_274;
    case 0x17:
      if ( !v0->ai_timer_2 )
      {
        v0->ai_timer_2 = -16;
        *&v0->ai_scratchpad[44] = *(v2 + 24);
        sub_8003C250(*(v2 + 1));
      }
      sub_8003D858(v0, *(v2 + 8));
      if ( sub_8003D8B4(v0, *&v0->ai_scratchpad[44]) )
      {
        v75 = *&v0->ai_scratchpad[44] + *(v2 + 40);
        *&v0->ai_scratchpad[44] = v75;
        if ( *(v2 + 38) < v75 )
          *&v0->ai_scratchpad[44] = 0;
        sub_8003D090(0, *(v2 + 14), *(v2 + 15), *(v2 + 16), *(v2 + 18), *(v2 + 20), *(v2 + 22), *(v2 + 17) | 0x80);
      }
      if ( *(v2 + 42) && sub_8003D8B4(v0, *(v2 + 42)) )
        sub_8003D090(0, *(v2 + 28), *(v2 + 29), *(v2 + 30), *(v2 + 32), *(v2 + 34), *(v2 + 36), *(v2 + 31));
      if ( v0->anim_timer >= 0xFFFu )
        sub_8003C220();
      v74 = *(v2 + 13);
      goto LABEL_335;
    case 0x18:
      if ( !v0->ai_timer_2 )
      {
        v0->ai_timer_2 = -16;
        sub_8003C250(*(v2 + 1));
      }
      sub_8003D858(v0, *(v2 + 8));
      anim_timer = v0->anim_timer;
      v77 = 0;
      if ( anim_timer < *(v2 + 34) )
      {
        v77 = *(v2 + 28);
        if ( anim_timer < *(v2 + 32) )
          v78 = *(v2 + 13);
        else
          v78 = *(v2 + 36);
      }
      else
      {
        v78 = *(v2 + 38);
      }
      v79 = Math_Atan2_Fixed(
              *&g_LanguageID[0].header[2] - v0->pos.X,
              *&g_LanguageID[0].menus[0].header.posY - v0->pos.Z);
      *&v0->ai_scratchpad[32] = v79;
      sub_8003E75C(v79, v77, *(v2 + 30), v78, v1->flags[4], 4);
      if ( sub_8003D8B4(v0, *(v2 + 24)) )
LABEL_207:
        sub_8003D090(0, *(v2 + 14), *(v2 + 15), *(v2 + 16), *(v2 + 18), *(v2 + 20), *(v2 + 22), *(v2 + 17));
LABEL_260:
      if ( v0->anim_timer >= 0xFFFu )
        goto LABEL_261;
      goto LABEL_377;
    case 0x19:
      if ( !v0->ai_timer_2 )
      {
        v0->ai_timer_2 = -16;
        sub_8003C250(*(v2 + 1));
        v111 = *(v2 + 14);
        *&v0->ai_scratchpad[46] = 0;
        *&v0->ai_scratchpad[48] = 0;
        *&v0->ai_scratchpad[44] = v111;
        if ( *(v2 + 7) == 1 )
          HIBYTE(v0->anim_frame) = 16;
      }
      sub_8003D858(v0, *(v2 + 8));
      if ( sub_8003D8B4(v0, *&v0->ai_scratchpad[44]) )
      {
        v112 = *&v0->ai_scratchpad[44] + *(v2 + 18);
        *&v0->ai_scratchpad[44] = v112;
        v113 = 1;
        if ( *(v2 + 16) < v112 )
          *&v0->ai_scratchpad[44] = 0;
        v114 = (v2 + 2 * *&v0->ai_scratchpad[46] + 26);
        do
        {
          while ( 1 )
          {
            while ( 1 )
            {
              while ( 1 )
              {
                v115 = *v114;
                v116 = *&v0->ai_scratchpad[46];
                *&v0->ai_scratchpad[46] = v116 + 1;
                ++v114;
                if ( v115 != 0x8000 )
                  break;
                v114 = (v2 + 26);
                *&v0->ai_scratchpad[46] = 0;
              }
              if ( v115 != 32769 )
                break;
              v113 = *v114++;
              *&v0->ai_scratchpad[46] = v116 + 2;
            }
            if ( v115 != 32771 )
              break;
            v114 += *v114 + 1;
          }
          if ( v115 == 32770 )
          {
            v117 = *v114;
            v118 = (v114 + 1);
            *&v0->ai_scratchpad[46] = v116 + 2;
            v119 = *v118++;
            *&v0->ai_scratchpad[46] = v116 + 3;
            v120 = *v118;
            v114 = (v118 + 1);
            *&v0->ai_scratchpad[46] = v116 + 4;
            sub_8003F0F4(*(v2 + 12), *(v2 + 24), -1, v117, v119, v120, v114);
            --v113;
          }
          else
          {
            if ( v115 == 32772 )
            {
              v121 = *v114;
              v122 = v114 + 1;
              v123 = *v122++;
              v124 = *v122;
              v114 = v122 + 1;
              *&v0->ai_scratchpad[46] = v116 + 4;
              v125 = *(v2 + 12);
              v126 = *(v2 + 24);
              v115 = -2;
              v148 = v123;
              v149 = v124;
            }
            else
            {
              v125 = *(v2 + 12);
              v126 = *(v2 + 24);
              v121 = &v114[v113 - 1];
              v148 = *&v0->ai_scratchpad[48];
            }
            --v113;
            sub_8003F0F4(v125, v126, v115, v121, v148, v149);
          }
        }
        while ( v113 );
        ++*&v0->ai_scratchpad[48];
      }
      goto LABEL_332;
    case 0x1A:
      if ( !v0->ai_timer_2 )
      {
        v0->ai_timer_2 = -16;
        *&v0->ai_scratchpad[44] = 0;
        sub_8003C250(*(v2 + 1));
        *&v0->ai_scratchpad[8] = 0;
        *&v0->ai_scratchpad[6] = 0;
        *&v0->ai_scratchpad[4] = 0;
      }
      if ( *&v0->ai_scratchpad[44] )
      {
        if ( *&v0->ai_scratchpad[44] != 1 )
          goto LABEL_377;
      }
      else
      {
        v104 = &ObjectInstances[17 * v0->unk_20];
        if ( *(v104 + 4) < 2u )
          goto LABEL_377;
        v105 = *(v104 + 18);
        v36 = v105 == 0;
        v106 = v105 < 3072;
        if ( v36 || !v106 )
          goto LABEL_377;
        *&v0->ai_scratchpad[44] = 1;
        *&v0->ai_scratchpad[46] = 8;
        v0->coll_radius = v1->coll_radius;
        v107 = v1->coll_height;
        v0->pos.Y += 2048;
        v0->height = v107;
        v108 = *&v1->unk_param[28];
        *&v0->ai_scratchpad[8] = v108;
        *&v0->ai_scratchpad[6] = v108;
        *&v0->ai_scratchpad[4] = v108;
        v0->unk_42 = *(v104 + 19);
      }
      v109 = v0->pos.Y;
      v110 = *&v0->ai_scratchpad[46];
      HIBYTE(v0->anim_frame) = 0;
LABEL_358:
      v132 = v110 - 1;
      *&v0->ai_scratchpad[46] = v132;
      v0->pos.Y = v109 - 256;
      if ( !(v132 << 16) )
        goto LABEL_261;
      goto LABEL_377;
    case 0x1B:
      if ( !v0->ai_timer_2 )
      {
        v0->ai_timer_2 = -15;
        *&v0->ai_scratchpad[44] = 0;
        *&v0->ai_scratchpad[46] = -1;
        sub_8003C250(*(v2 + 22));
      }
      v127 = *&v0->ai_scratchpad[44];
      if ( v127 == 1 )
      {
        sub_8003E608(v0, v0->unk_20, *(v2 + 16), v1->flags[4]);
        if ( v0->unk_42 == v0->unk_20 )
        {
          v95 = *(v2 + 1);
LABEL_351:
          sub_8003C250(v95);
          *&v0->ai_scratchpad[44] = 2;
        }
        goto LABEL_377;
      }
      if ( v127 >= 2 )
      {
        if ( v127 == 2 )
        {
          sub_8003D858(v0, *(v2 + 8));
          v0->coll_radius = FixedPointLerp(v1->coll_radius, *(v2 + 18), v0->anim_timer);
          v129 = FixedPointLerp(v1->coll_height, *(v2 + 20), v0->anim_timer);
          v36 = v0->anim_timer < 0xFFFu;
          v0->height = v129;
          if ( !v36 )
          {
            v0->coll_radius = *(v2 + 18);
            v0->height = *(v2 + 20);
            v130 = sub_8003C184(v1, 0x15u);
            if ( v130 )
              sub_8003BB60(v0, v130);
            else
LABEL_261:
              sub_8003C220();
          }
        }
        goto LABEL_377;
      }
      if ( *&v0->ai_scratchpad[44] )
        goto LABEL_377;
      if ( !*(v2 + 14)
        || (v128 = sub_8003E7D0(
                     (v0->grid_x << 11) + v0->fine_x,
                     (v0->grind_z << 11) + v0->fine_z,
                     *(v2 + 14),
                     *(v2 + 16),
                     *&v0->ai_scratchpad[46],
                     v1->flags[3],
                     v1->flags[4],
                     5),
            *&v0->ai_scratchpad[46] = v128,
            v128 == -1) )
      {
        *&v0->ai_scratchpad[44] = 1;
      }
      v21 = *(v2 + 23);
      goto LABEL_348;
    case 0x1C:
      v133 = &v0->ai_scratchpad[12];
      if ( !v0->ai_timer_2 )
      {
        v0->ai_timer_2 = -16;
        sub_8003C250(*(v2 + 1));
        sub_8003E038();
        sub_800143E0(27, &v0->pos.X, 120, 0);
        v133 = &v0->ai_scratchpad[12];
      }
      v134 = v0->unk_42 + 64;
      v0->rot_z += 128;
      v0->unk_42 = v134;
      v135 = sub_8003DDB0(v133);
      v36 = v135 == 0;
      v136 = v135 & 0x80;
      if ( !v36 )
      {
        v137 = v0;
        if ( v136 )
        {
          ApplyStatusEffect(
            *(v2 + 14),
            *(v2 + 16),
            *(v2 + 18),
            *(v2 + 12),
            *(v2 + 20),
            *(v2 + 22),
            *(v2 + 24),
            *(v2 + 26),
            *(v2 + 28),
            0x1000u,
            0xAu,
            &v0->pos.X);
          v137 = v0;
        }
        sub_8003C1CC(v137, 3u);
        *&v0->ai_scratchpad[16] = 0;
        *&v0->ai_scratchpad[14] = 0;
        *&v0->ai_scratchpad[12] = 0;
        HIBYTE(v0->anim_frame) = 16;
      }
      goto LABEL_377;
    case 0x1D:
      if ( !v0->ai_timer_2 )
      {
        v0->ai_timer_2 = -16;
        sub_8003C250(*(v2 + 1));
        sub_8003E038();
        *&v0->ai_scratchpad[46] = 16;
      }
      unk_42 = v0->unk_42;
      v0->rot_z += 128;
      v109 = v0->pos.Y;
      v0->unk_42 = unk_42 + 64;
      v110 = *&v0->ai_scratchpad[46];
      goto LABEL_358;
    case 0x1E:
      if ( !v0->ai_timer_2 )
      {
        v0->ai_timer_2 = -16;
        sub_8003C250(*(v2 + 1));
        sub_8003E038();
      }
      v155 = *&v0->ai_scratchpad[12] + v0->pos.X;
      v156 = *&v0->ai_scratchpad[14] + v0->pos.Y;
      v157 = *&v0->ai_scratchpad[16] + v0->pos.Z;
      v138 = sub_8002E4F4(
               v155,
               v156,
               v157,
               v0->coll_radius,
               v0->height | ((v0->bit_flags & 0xC000) << 16),
               dword_801779AC);
      v36 = v138 != 0;
      v139 = v138 & 0x80;
      if ( !v36 )
        goto LABEL_369;
      if ( v139 )
      {
        ApplyStatusEffect(
          *(v2 + 14),
          *(v2 + 16),
          *(v2 + 18),
          *(v2 + 12),
          *(v2 + 20),
          *(v2 + 22),
          *(v2 + 24),
          *(v2 + 26),
          *(v2 + 28),
          0x1000u,
          0xAu,
          &v0->pos.X);
LABEL_369:
        v0->pos.X = v155;
        v0->pos.Y = v156;
        v0->pos.Z = v157;
      }
      else
      {
        *&v0->ai_scratchpad[16] = 0;
        *&v0->ai_scratchpad[14] = 0;
        *&v0->ai_scratchpad[12] = 0;
      }
      sub_8003D858(v0, *(v2 + 8));
      if ( v0->anim_timer >= 0xFFFu )
      {
        sub_8003C1CC(v0, 3u);
        HIBYTE(v0->anim_frame) = 16;
      }
      goto LABEL_377;
    case 0xF0:
      sub_8003E038();
      goto LABEL_377;
    default:
      (*&g_CurrentStateVTable[2].gap0[12])();
      goto LABEL_377;
  }
}
// 8003FD2C: conditional instruction was optimized away because $s0.4<10000u
// 8003FD64: conditional instruction was optimized away because $s0.4 is in (1..FFFF)
// 8003FCCC: variable 'v4' is possibly undefined
// 8003FF28: variable 'v10' is possibly undefined
// 80040148: variable 'v20' is possibly undefined
// 80040224: variable 'v31' is possibly undefined
// 80040244: variable 'v32' is possibly undefined
// 800402C0: variable 'Y' is possibly undefined
// 800404B8: variable 'v43' is possibly undefined
// 80040938: variable 'v58' is possibly undefined
// 800409D0: variable 'v63' is possibly undefined
// 80041914: variable 'v149' is possibly undefined
// 80062BF0: using guessed type int __fastcall rand(_DWORD);
// 801779AC: using guessed type int dword_801779AC;
// 801779BC: using guessed type int dword_801779BC;
// 801779C0: using guessed type int dword_801779C0;
// 801779CC: using guessed type int g_FrameCounter;

//----- (80042064) --------------------------------------------------------
EntityDefinition **Entities_UpdateAll()
{
  Entity **e; // $s1
  _WORD *v1; // $s0
  Entity **v2; // $v1
  Entity *v3; // $v1
  int v4; // $v0

  e = g_ObjectArray;                            //   ?
  v1 = &unk_8016E64A;
  dword_801779C8 = 0;
  dword_801779C0 = 0;
  do
  {
    if ( *e != 255 )
    {
      Entity_SetContext(e);
      if ( (g_FrameCounter & 3) == (dword_801779C0 & 3) || g_PhysicsReady || byte_8019B591 == 1 )
        Entity_UpdateDetection();
      if ( *(v1 - 57) == 1 )
      {
        if ( (g_FrameCounter & 3) == (dword_801779C8 & 3) )
          Entity_UpdateAIByDistance();
        UpdateEnemyAI();
        ++dword_801779C8;
      }
      if ( (*&g_CurrentEntityDef->unk_param[30] & 0x10000) != 0 )
      {
        v2 = &ObjectInstances[17 * *(v1 - 16)];
        *(v1 - 11) = v2[5];
        *(v1 - 9) = v2[6] - 500;
        v3 = v2[7];
        v4 = *(v1 - 57);
        *(v1 - 7) = v3;
        if ( v4 == 1 )
          *v1 = Math_Atan2_Fixed(*&g_LanguageID[0].header[2] - *(v1 - 11), *&g_LanguageID[0].menus[0].header.posY - v3);
      }
    }
    v1 += 62;
    ++dword_801779C0;
    e += 31;
  }
  while ( dword_801779C0 < 200 );
  ++g_FrameCounter;
  return Entity_SetContext(0);
}
// 801779C0: using guessed type int dword_801779C0;
// 801779C8: using guessed type int dword_801779C8;
// 801779CC: using guessed type int g_FrameCounter;
// 8019B4CE: using guessed type char g_PhysicsReady;
// 8019B591: using guessed type char byte_8019B591;

//----- (80042244) --------------------------------------------------------
int sub_80042244()
{
  EntityDefinition **v0; // $a1
  int v1; // $a2
  int result; // $v0
  _DWORD *v3; // $v1
  int i; // $a0

  v0 = g_ObjectTypeTable;
  v1 = 0;
  do
  {
    result = *v0;
    if ( result == 255 )
      break;
    v3 = v0 + 14;
    for ( i = 0; i < 16; ++i )
    {
      if ( *v3 == -1 )
        *v3 = 0;
      else
        *v3 += &unk_801759A8;
      ++v3;
    }
    result = ++v1 < 40;
    v0 += 30;
  }
  while ( v1 < 40 );
  return result;
}

//----- (800422B8) --------------------------------------------------------
int __fastcall sub_800422B8(int a1)
{
  _BYTE *v1; // $s4
  Entity *e; // $s3
  int v3; // $s5
  char *v4; // $s0
  _WORD *v5; // $s1
  char v6; // $v0
  int v7; // $v1
  __int16 v8; // $v0
  EntityDefinition **v9; // $s2
  int v10; // $v0
  int result; // $v0

  v1 = a1;
  e = g_ObjectArray;
  v3 = 199;
  v4 = &unk_8016E611;
  v5 = (a1 + 14);
  do
  {
    e->active = *v1;
    if ( e->active == 255 )
    {
      *v4 = 0;
    }
    else
    {
      v6 = *(v5 - 13);
      *(v4 - 5) = 0;
      *(v4 - 7) = v6;
      v7 = *(v4 - 7);
      *(v4 - 4) = *(v5 - 12);
      *(v4 - 3) = *(v5 - 7);
      *(v4 - 2) = *(v5 - 11);
      *(v4 - 1) = *(v5 - 10);
      v4[1] = *(v5 - 9);
      v4[2] = *(v5 - 8);
      *(v4 + 23) = *(v5 - 3);
      *(v4 + 25) = *(v5 - 2);
      *(v4 + 27) = *(v5 - 1);
      v8 = *v5;
      *v4 = 0;
      v4[5] = 0;
      v4[6] = -1;
      *(v4 + 87) = 0;
      *(v4 + 29) = v8;
      v9 = &g_ObjectTypeTable[30 * v7];
      Entity_LoadStats(e);
      Entity_UpdatePhysics(e);
      v10 = *(v4 + 31) & 0x10;
      v4[12] = *(v9 + 9);
      if ( v10 )
      {
        if ( e->active == 3 )
        {
          if ( *(v4 + 27) == -1 )
            *(v4 + 27) = *(v9 + 13);
          if ( *(v4 + 29) == -1 )
            *(v4 + 29) = *(v9 + 14);
        }
        else
        {
          e->active = 4;
          *(v4 + 29) = 0;
        }
      }
    }
    v5 += 8;
    v1 += 16;
    v4 += 124;
    e = (e + 124);
    result = v3;
  }
  while ( v3-- != 0 );
  return result;
}

//----- (8004248C) --------------------------------------------------------
int __fastcall PlayEntitySound(Entity *e, __int16 sound_id)
{
  return PlayPositionalSound3D_Wrap(sound_id, &e->action_id, 110, 28000, 29000, 0);
}

//----- (800424C8) --------------------------------------------------------
int __fastcall sub_800424C8(int *a1, int a2, __int16 a3)
{
  int v5; // $a1
  int v6; // $a0
  int result; // $v0
  char v8; // $v0

  if ( *(dword_801A1184 + 11) )
  {
    result = 0;
    --*(dword_801A1184 + 11);
    return result;
  }
  v5 = ((a3 & 0xFFF) >> 1) + a1[1];
  v6 = *dword_801A1184 & 7;
  if ( v6 == 2 )
  {
    v8 = 49;
    return sub_8002E4F4(*a1, v5, a1[2], a2, a3, v8);
  }
  result = 1;
  if ( (*dword_801A1184 & 7u) < 3 )
  {
    if ( v6 != 1 )
      return result;
    v8 = -95;
    return sub_8002E4F4(*a1, v5, a1[2], a2, a3, v8);
  }
  result = 4;
  if ( v6 == 3 )
  {
    v8 = -79;
    return sub_8002E4F4(*a1, v5, a1[2], a2, a3, v8);
  }
  if ( v6 == 4 )
  {
    v8 = 1;
    return sub_8002E4F4(*a1, v5, a1[2], a2, a3, v8);
  }
  return result;
}
// 801A1184: using guessed type int dword_801A1184;

//----- (800425A0) --------------------------------------------------------
int __fastcall sub_800425A0(
        int a1,
        char a2,
        unsigned __int16 a3,
        unsigned __int16 a4,
        unsigned __int8 a5,
        unsigned __int16 a6,
        unsigned __int16 a7,
        unsigned __int16 a8,
        char a9,
        unsigned __int16 a10,
        unsigned __int16 a11,
        unsigned __int16 a12,
        unsigned __int16 a13,
        unsigned __int16 a14,
        _DWORD *a15)
{
  unsigned int v16; // $a0
  int result; // $v0
  Entity **v18; // $s1
  EntityDefinition **v19; // $s2
  __int16 v20; // $v0
  char v21; // $s0
  char v22; // $s0
  int v25; // [sp+60h] [-8h]

  v25 = a1 & 0xF0000;
  v16 = a1 & 0xFFF0FFFF;
  if ( v16 == 128 )
    return ApplyStatusEffect(a6, a7, a8, a9, a10, a11, a12, a13, a14, a3, a5, a15);
  result = 16;
  if ( v16 == 16 )
  {
    v18 = &g_ObjectArray[31 * dword_801DD598];
    v19 = &g_ObjectTypeTable[30 * *(v18 + 2)];
    if ( !a15
      || (v20 = Math_Atan2_Fixed(v18[11] - *a15, v18[13] - a15[2]),
          (result = Math_IsAngleInRange(*(v18 + 33), v20 + 2048, *(v19 + 12))) != 0) )
    {
      v21 = a2 & 0x30;
      if ( (v25 & 0x20000) != 0 )
        v22 = v21 | 1;
      else
        v22 = v21 | 2;
      ApplyDamage(dword_801DD598, a4, a6, a7, a8, a10, a11, a12, a13, a14, a3, v22, a15);
      result = v25 & 0x10000;
      if ( (v25 & 0x10000) != 0 )
      {
        result = v18[10] | 0x800;
        v18[10] = result;
      }
    }
  }
  return result;
}
// 801DD598: using guessed type int dword_801DD598;

//----- (800427C8) --------------------------------------------------------
int __fastcall sub_800427C8(_BYTE *a1)
{
  int result; // $v0

  result = 5;
  if ( (*a1 & 0x10) != 0 )
    return g_unk_8019B4EE;
  return result;
}
// 8019B4EE: using guessed type __int16 g_unk_8019B4EE;

//----- (800427EC) --------------------------------------------------------
int __fastcall sub_800427EC(int a1, unsigned __int16 a2, _DWORD *a3)
{
  int v3; // $s0
  int v4; // $s1
  unsigned __int16 v8; // $v0

  v3 = dword_801A1184;
  v4 = dword_801A1180;
  v8 = sub_800427C8(dword_801A1184);
  return sub_800425A0(
           a1,
           *v3,
           a2,
           v8,
           *(v3 + 6),
           *(v4 + 6),
           *(v4 + 8),
           *(v4 + 10),
           *(v4 + 4),
           *(v4 + 12),
           *(v4 + 14),
           *(v4 + 16),
           *(v4 + 18),
           *(v4 + 20),
           a3);
}
// 801A1180: using guessed type int dword_801A1180;
// 801A1184: using guessed type int dword_801A1184;

//----- (800428D0) --------------------------------------------------------
int __fastcall sub_800428D0(int a1)
{
  int v2[4]; // [sp+10h] [-10h] BYREF

  v2[0] = *(dword_801A1184 + 20) - 8 * *(dword_801A1184 + 52);
  v2[1] = *(dword_801A1184 + 24) - 8 * *(dword_801A1184 + 54);
  v2[2] = *(dword_801A1184 + 28) - 8 * *(dword_801A1184 + 56);
  return sub_800427EC(a1, 0x1388u, v2);
}
// 801A1184: using guessed type int dword_801A1184;

//----- (80042938) --------------------------------------------------------
int __fastcall sub_80042938(int *a1, int a2, signed int a3, int a4, unsigned __int16 a5, __int16 a6)
{
  _BYTE *v6; // $s1
  unsigned __int16 *v10; // $s0
  int result; // $v0
  unsigned __int16 v13; // $v0

  v6 = dword_801A1184;
  v10 = dword_801A1180;
  if ( (*dword_801A1184 & 1) != 0 )
    sub_80027700(
      a1,
      a2,
      a3,
      a4,
      a5,
      *(dword_801A1180 + 6),
      *(dword_801A1180 + 8),
      *(dword_801A1180 + 10),
      *(dword_801A1180 + 4),
      *(dword_801A1180 + 12),
      *(dword_801A1180 + 14),
      *(dword_801A1180 + 16),
      *(dword_801A1180 + 18),
      *(dword_801A1180 + 20),
      a6,
      *(dword_801A1184 + 6));
  result = *v6 & 2;
  if ( (*v6 & 2) != 0 )
  {
    v13 = sub_800427C8(v6);
    return sub_8003CD9C(
             a1,
             a2,
             a3,
             a4,
             a5,
             v13,
             v10[3],
             v10[4],
             v10[5],
             v10[6],
             v10[7],
             v10[8],
             v10[9],
             v10[10],
             a6,
             *v6 & 0x30 | 2);
  }
  return result;
}
// 801A1180: using guessed type int dword_801A1180;
// 801A1184: using guessed type int dword_801A1184;

//----- (80042AEC) --------------------------------------------------------
int __fastcall sub_80042AEC(int a1, int a2, int a3, __int16 *a4)
{
  __int16 v8[4]; // [sp+18h] [-10h] BYREF
  __int16 v9; // [sp+20h] [-8h] BYREF
  __int16 v10; // [sp+22h] [-6h]
  __int16 v11; // [sp+24h] [-4h]

  sub_80036DD8(*(a1 + 3) + 40, *(a1 + 4), *(a1 + 18), a2, &v9);
  v9 = (v9 * *a4) >> 12;
  v10 = (v10 * a4[1]) >> 12;
  v11 = (v11 * a4[2]) >> 12;
  v8[0] = *(a1 + 36);
  v8[1] = *(a1 + 38) + 2048;
  v8[2] = *(a1 + 40);
  return sub_80015614(v8, &v9, a3);
}

//----- (80042BD4) --------------------------------------------------------
int __fastcall sub_80042BD4(_DWORD *a1, int a2, _DWORD *a3, __int16 *a4)
{
  int result; // $v0

  sub_80042AEC(a1, a2, a3, a4);
  *a3 += a1[5];
  a3[1] += a1[6];
  result = a3[2] + a1[7];
  a3[2] = result;
  return result;
}

//----- (80042C44) --------------------------------------------------------
unsigned __int8 *AllocateParticleSlot()
{
  unsigned __int8 *Slot; // $v1
  __int16 count; // $a0

  Slot = &g_ParticleArray;
  count = 128;                                  //  128 
  while ( 1 )
  {
    --count;
    if ( *Slot == 255 )
      break;
    // 72   
    Slot += 72;
    if ( !count )
      return 0;
  }
  return Slot;
}

//----- (80042C88) --------------------------------------------------------
int __fastcall SetupEntityAnimation(Entity *e, char a2, __int16 pos)
{
  int result; // $v0

  e->grid_x = 5;
  e->model_id = Transparent;
  e->current_state = 1;
  LOBYTE(e->anim_frame) = 67;
  result = 4096;
  e->type_id = a2;
  e->unk_03 = a2;
  *&e->target_id = 4096;
  LOWORD(e->pos.Y) = pos;
  HIWORD(e->pos.X) = pos;
  LOWORD(e->pos.X) = pos;
  return result;
}

//----- (80042CC8) --------------------------------------------------------
int __fastcall sub_80042CC8(int a1, char a2)
{
  int result; // $v0

  *(a1 + 8) = 14;
  *(a1 + 4) = 0x80;
  *(a1 + 9) = 1;
  *(a1 + 12) = 68;
  *(a1 + 16) = 4096;
  *(a1 + 46) = 256;
  *(a1 + 48) = 256;
  *(a1 + 44) = 256;
  *(a1 + 20) = 160;
  result = 120;
  *(a1 + 2) = a2;
  *(a1 + 3) = a2;
  *(a1 + 24) = 120;
  *(a1 + 40) = 0;
  *(a1 + 38) = 0;
  *(a1 + 36) = 0;
  *(a1 + 28) = 0;
  return result;
}

//----- (80042D2C) --------------------------------------------------------
Entity *__fastcall SpawnParticleEntity(
        char a1,
        unsigned __int8 a2,
        unsigned __int8 a3,
        _DWORD *a4,
        _DWORD *a5,
        int a6,
        __int16 a7,
        __int16 a8,
        __int16 a9,
        __int16 a10,
        __int16 a11)
{
  Entity *ParticleSlot; // $v0
  int v16; // $gp
  Entity *v17; // $s0
  int v18; // $v1
  int v19; // $a0
  int v20; // $a1
  int v21; // $v1
  char active; // $v0
  char v23; // $v0
  int v24; // $v1
  int v25; // $a1
  int v26; // $lo
  int v27; // $v1
  BOOL v28; // $a0
  Entity *result; // $v0
  Entity *v30; // $a0
  __int16 v31; // $a1
  __int16 v32; // $v0
  int v33; // $a0
  int v34; // $a0
  int v35; // $a0
  int v36; // $a0
  int v37; // $a0
  __int16 v38; // $v1
  __int16 v39; // $v0
  int v40; // $a0
  int v41; // $a0
  int v42; // $a0
  Entity *v43; // $a0
  __int16 v44; // $a2
  int v45; // $a0
  int v46; // $a0
  int v47; // $a0
  int v48; // $v0
  __int16 unk_38; // $v1
  int v50; // $a2
  int v51; // $a3
  int v52; // $a0
  int v53; // $v1
  _DWORD *v54; // $a2
  int v55; // $v1
  int v56; // $a0
  int v57; // $a1
  int bit_flags; // $v1
  int v59; // $a0
  Entity *v60; // $a0
  char v61; // $a1
  Entity *v62; // $a0
  char v63; // $a1
  char v64; // $v0
  Entity *v65; // $a0
  _DWORD *v66; // $v0
  __int16 v67; // $a1
  Entity *v68; // $a0
  __int16 v69; // $v0
  __int16 v70; // $a1
  int v71; // $a0
  int v72; // $a0
  int v73; // $a0
  int v74; // $v0
  __int16 v75; // $v1
  int v76; // $a2
  __int16 v77; // $v0
  Entity *v78; // $a0
  int v79; // $a2
  __int16 v80; // $a1
  int v81; // $a2
  int v82; // $a0
  int v83; // $a0
  int v84; // $v0
  __int16 fine_x; // $a2
  char v86; // $v0
  int v87; // $a2
  int rot_z; // $a0
  __int64 v89; // kr00_8
  int v90; // $v1
  int v91; // $a2
  int v92; // $v1
  __int16 v93; // $a0
  int v94; // $v1
  __int16 v95; // $v0
  int v96; // $a0
  int v97; // $a0
  int v98; // $a0
  int v99; // $v0
  __int16 v100; // $v1
  int v101; // $v1
  int v102; // $a0
  int v103; // $v0
  char v104; // $v0
  char type_id; // $v1
  int v106; // $a0
  int v107; // $a0
  int v108; // $a0
  int v109; // $a0
  int v110; // $a0
  int v111; // [sp+18h] [-10h]
  int v112; // [sp+20h] [-8h]

  ParticleSlot = AllocateParticleSlot();
  v17 = ParticleSlot;
  if ( !ParticleSlot )
    return v17;
  ParticleSlot->active = a2;
  ParticleSlot->flags = a3;
  if ( a4 )
  {
    v18 = a4[1];
    v19 = a4[2];
    v20 = a4[3];
    *&ParticleSlot->action_id = *a4;
    *&ParticleSlot->anim_timer = v18;
    *&ParticleSlot->coll_radius = v19;
    *&ParticleSlot->unk_20 = v20;
  }
  ParticleSlot->aggression = 3;
  if ( a5 )
  {
    v21 = a5[1];
    ParticleSlot->pos.Z = *a5;
    ParticleSlot->unk_38 = v21;
  }
  else
  {
    LOWORD(ParticleSlot->unk_38) = 0;
    ParticleSlot->pos.Z = 0;
  }
  LOWORD(ParticleSlot->pos.Y) = 4096;
  HIWORD(ParticleSlot->pos.X) = 4096;
  LOWORD(ParticleSlot->pos.X) = 4096;
  active = ParticleSlot->active;
  v17->grind_z = 0;
  v17->current_layer = a1;
  LOWORD(v17->bit_flags) = 0;
  v17->vertical_velocity = 0;
  v17->fine_x = 0;
  v17->angle_speed = 0;
  v17->init_flags = 0;
  v17->grid_x = 1;
  if ( (active & 0x10) != 0 )
  {
    v23 = 1;
    if ( byte_8019B591 == 1 )
      v23 = 8;
  }
  else
  {
    v23 = 1;
  }
  v17->unk_0B = v23;
  v24 = SLOWORD(v17->pos.Z) * SLOWORD(v17->pos.Z);
  v25 = SHIWORD(v17->pos.Z) * SHIWORD(v17->pos.Z);
  v26 = SLOWORD(v17->unk_38) * SLOWORD(v17->unk_38);
  *&v17->target_id = 0;
  LOBYTE(v17->anim_frame) = -1;
  v17->current_state = -1;
  *&v17->ai_timer_1 = -1;
  v27 = v24 + v25 + v26;
  v28 = v27 > 810000;
  HIBYTE(v17->anim_frame) = v27 > 810000;
  switch ( v17->flags )
  {
    case 0:
      SetupEntityAnimation(v17, 14, 512);
      *&v17->ai_timer_1 = 50;
      LOBYTE(v17->rot_z) = 0;
      return v17;
    case 1:
      goto LABEL_19;
    case 2:
      v17->grid_x = 1;
      v17->model_id = 0x80;
      v17->type_id = 9;
      v17->unk_03 = 9;
      LOBYTE(v17->anim_frame) = 68;
      *&v17->target_id = 4096;
      LOWORD(v17->pos.Y) = 0;
      LOWORD(v17->pos.X) = 0;
      v17->rot_z = a6;
      v68 = v17;
      v17->unk_42 = a7;
      v69 = a8;
      v70 = 30;
      goto LABEL_98;
    case 3:
      v17->model_id = 0x80;
      v17->type_id = 11;
      v17->unk_03 = 11;
      LOBYTE(v17->anim_frame) = 68;
      v17->grid_x = 1;
      v17->current_state = 1;
      *&v17->target_id = 4096;
      LOWORD(v17->pos.Y) = 0;
      HIWORD(v17->pos.X) = 0;
      LOWORD(v17->pos.X) = 0;
      PlayEntitySound(v17, 31);
      return v17;
    case 4:
      v17->model_id = 0x80;
      v17->type_id = 31;
      v17->unk_03 = 31;
      LOBYTE(v17->anim_frame) = 68;
      *&v17->target_id = 4096;
      *&v17->ai_timer_1 = 45;
      v17->grid_x = 1;
      v17->current_state = 1;
      LOBYTE(v17->rot_z) = 0;
      LOWORD(v17->pos.Y) = 13000;
      HIWORD(v17->pos.X) = 13000;
      LOWORD(v17->pos.X) = 13000;
      HIBYTE(v17->anim_frame) = 1;
      PlayEntitySound(v17, 32);
      return v17;
    case 5:
      v17->grid_x = 0;
      *&v17->ai_timer_1 = 70;
      HIBYTE(v17->rot_z) = a6;
      PlayEntitySound(v17, 33);
      return v17;
    case 6:
      v17->model_id = 0x80;
      v17->current_state = 1;
      v51 = 23;
      v17->grid_x = 0;
      v17->type_id = 0;
      v17->unk_03 = 0;
      LOWORD(v17->pos.Y) = 4096;
      HIWORD(v17->pos.X) = 4096;
      LOWORD(v17->pos.X) = 4096;
      LOBYTE(v17->anim_frame) = 68;
      *&v17->target_id = 4096;
      v52 = *(a6 + 4);
      *&v17->fine_x = *a6;
      v17->bit_flags = v52;
      v53 = *(v16 + 224);
      v54 = (&unk_801DE654 + 576 * v53);
      *&v17->rot_z = v54;
      *(v16 + 224) = (v53 + 1) & 3;
      do
      {
        v55 = *&v17->anim_timer;
        v56 = *&v17->coll_radius;
        v57 = *&v17->unk_20;
        *v54 = *&v17->action_id;
        v54[1] = v55;
        v54[2] = v56;
        v54[3] = v57;
        bit_flags = v17->bit_flags;
        v54[4] = *&v17->fine_x;
        v54[5] = bit_flags;
        --v51;
        v54 += 6;
      }
      while ( v51 != -1 );
      v30 = v17;
      v31 = 34;
      v32 = 150;
      v17->ai_scratchpad[0] = 0;
      v17->ai_scratchpad[1] = 0;
      goto LABEL_39;
    case 7:
    case 0x31:
      SetupEntityAnimation(v17, 45, 6144);
      *&v17->ai_timer_1 = 50;
      HIBYTE(v17->anim_frame) = 1;
      PlayEntitySound(v17, 35);
      return v17;
    case 8:
      SetupEntityAnimation(v17, 8, 4096);
      LOBYTE(v17->rot_z) = a6;
      v38 = a7;
      v39 = 50;
      goto LABEL_34;
    case 9:
      SetupEntityAnimation(v17, 8, 4096);
      LOWORD(v17->pos.Z) = LOWORD(v17->pos.Z) - 64 + (rand(v40) >> 8);
      HIWORD(v17->pos.Z) = HIWORD(v17->pos.Z) - 64 + (rand(v41) >> 8);
      LOWORD(v17->unk_38) = LOWORD(v17->unk_38) - 64 + (rand(v42) >> 8);
      *&v17->ai_timer_1 = 100;
      v17->unk_0B = 3;
      LOBYTE(v17->rot_z) = a6;
      PlayEntitySound(v17, 38);
      return v17;
    case 0xA:
      v30 = v17;
      v17->grid_x = 1;
      v17->current_state = 1;
      v17->type_id = 21;
      v17->unk_03 = 21;
      LOBYTE(v17->anim_frame) = 68;
      *&v17->target_id = 4096;
      v17->model_id = 0;
      LOWORD(v17->pos.Y) = 3000;
      HIWORD(v17->pos.X) = 3000;
      LOWORD(v17->pos.X) = 3000;
      v31 = 39;
      v50 = *(a6 + 4);
      *&v17->fine_x = *a6;
      v17->bit_flags = v50;
      v32 = 150;
      HIBYTE(v17->rot_z) = 0;
      goto LABEL_39;
    case 0xB:
      v64 = 17;
      goto LABEL_49;
    case 0xC:
      v17->grid_x = 1;
      v17->current_state = 1;
      v17->model_id = 0x80;
      v17->type_id = 34;
      v17->unk_03 = 34;
      LOBYTE(v17->anim_frame) = 73;
      *&v17->target_id = 4096;
      v71 = *(a6 + 4);
      *&v17->fine_x = *a6;
      v17->bit_flags = v71;
      LOWORD(v17->pos.Y) = 30000;
      HIWORD(v17->pos.X) = 30000;
      LOWORD(v17->pos.X) = 30000;
      v17->rot_z = a7;
      v17->unk_42 = a8;
      *v17->ai_scratchpad = a9;
      *&v17->ai_scratchpad[2] = a10;
      *&v17->ai_timer_1 = a11;
      return v17;
    case 0xD:
      SetupEntityAnimation(v17, 33, 4096);
      *&v17->ai_timer_1 = 50;
      PlayEntitySound(v17, 42);
      return v17;
    case 0xE:
    case 0x13:
      v95 = 16;
      goto LABEL_86;
    case 0xF:
      sub_80042CC8(v17, 25);
      return v17;
    case 0x10:
      v95 = 8;
LABEL_86:
      v17->grid_x = 0;
      *&v17->ai_timer_1 = v95;
      PlaySoundEffect(43, 120);
      return v17;
    case 0x11:
      sub_80042CC8(v17, 26);
      return v17;
    case 0x14:
      v17->model_id = 0x80;
      v17->type_id = 11;
      v17->unk_03 = 11;
      LOBYTE(v17->anim_frame) = 68;
      v17->grid_x = 1;
      v17->current_state = 1;
      *&v17->target_id = 4096;
      goto LABEL_54;
    case 0x16:
      SetupEntityAnimation(v17, 30, 4096);
      v17->unk_0B = 3;
      *&v17->ai_timer_1 = 30;
      LOWORD(v17->pos.Z) = LOWORD(v17->pos.Z) - 32 + (rand(v96) >> 9);
      HIWORD(v17->pos.Z) = HIWORD(v17->pos.Z) - 32 + (rand(v97) >> 9);
      v99 = rand(v98) >> 9;
      v100 = LOWORD(v17->unk_38) - 32;
      goto LABEL_102;
    case 0x17:
      SetupEntityAnimation(v17, 8, 1024);
      LOWORD(v17->unk_38) = 0;
      v17->pos.Z = 0;
      v17->grind_z = 9;
      v17->rot_z = a6;
      v68 = v17;
      v17->unk_42 = a7;
      v69 = a8;
      v70 = 38;
LABEL_98:
      *v17->ai_scratchpad = v69;
      PlayEntitySound(v68, v70);
      return v17;
    case 0x18:
      v77 = 70;
      goto LABEL_100;
    case 0x19:
      v17->model_id = 0x80;
      v17->type_id = 13;
      v17->unk_03 = 13;
      LOBYTE(v17->anim_frame) = 68;
      *&v17->target_id = 4096;
      v17->grid_x = 1;
      v17->current_state = 1;
      *&v17->ai_timer_1 = 45;
      v33 = *(a6 + 4);
      *&v17->fine_x = *a6;
      v17->bit_flags = v33;
      LOWORD(v17->bit_flags) = rand(v33) >> 3;
      LOBYTE(v17->rot_z) = 0;
      return v17;
    case 0x1A:
      v17->grid_x = 1;
      v17->model_id = 0x80;
      v17->type_id = 36;
      v17->unk_03 = 36;
      *&v17->ai_timer_1 = 70;
      LOBYTE(v17->rot_z) = 0;
      LOWORD(v17->pos.Y) = 600;
      HIWORD(v17->pos.X) = 600;
      LOWORD(v17->pos.X) = 600;
      LOBYTE(v17->rot_z) = 0;
      return v17;
    case 0x1B:
      v17->grid_x = 1;
      v17->model_id = 0x80;
      v17->type_id = 37;
      v17->unk_03 = 37;
      LOBYTE(v17->rot_z) = 0;
      *&v17->ai_timer_1 = 70;
      goto LABEL_54;
    case 0x1C:
      LOWORD(v17->pos.Y) = 2048;
      HIWORD(v17->pos.X) = 2048;
      LOWORD(v17->pos.X) = 2048;
LABEL_19:
      v30 = v17;
      v31 = 27;
      v17->grid_x = 1;
      v17->model_id = 0x80;
      v17->type_id = 32;
      v17->unk_03 = 32;
      v32 = 70;
      LOBYTE(v17->rot_z) = 0;
LABEL_39:
      *&v17->ai_timer_1 = v32;
      PlayEntitySound(v30, v31);
      return v17;
    case 0x1D:
    case 0x1F:
      v104 = 28;
      goto LABEL_96;
    case 0x1E:
      v104 = 29;
      goto LABEL_96;
    case 0x20:
      SetupEntityAnimation(v17, 33, 6144);
      *&v17->ai_timer_1 = 50;
      return v17;
    case 0x21:
      v43 = v17;
      v44 = 4096;
      goto LABEL_31;
    case 0x22:
      v86 = 40;
      goto LABEL_68;
    case 0x23:
      v86 = 41;
LABEL_68:
      v17->type_id = v86;
      v17->unk_03 = v86;
      v78 = v17;
      v17->model_id = 0x80;
      LOBYTE(v17->anim_frame) = 68;
      *&v17->target_id = 4096;
      v17->grid_x = 1;
      v17->current_state = 1;
      *&v17->ai_timer_1 = 45;
      v87 = *(a6 + 4);
      *&v17->fine_x = *a6;
      v17->bit_flags = v87;
      v80 = 32;
      goto LABEL_70;
    case 0x26:
    case 0x27:
      v17->grid_x = 1;
      v17->model_id = 0x80;
      v17->type_id = 44;
      v17->unk_03 = 44;
      *&v17->ai_timer_1 = 50;
      v82 = *(a6 + 4);
      *&v17->fine_x = *a6;
      v17->bit_flags = v82;
      v17->vertical_velocity = v17->vertical_velocity - 256 + (rand(v82) >> 6);
      v84 = rand(v83);
      fine_x = v17->fine_x;
      LOWORD(v17->bit_flags) = 0;
      LOBYTE(v17->rot_z) = 0;
      LOWORD(v17->pos.Y) = 0x2000;
      HIWORD(v17->pos.X) = 0x2000;
      LOWORD(v17->pos.X) = 0x2000;
      v17->fine_x = fine_x - 256 + (v84 >> 6);
      PlayEntitySound(v17, 32);
      return v17;
    case 0x28:
      v65 = v17;
      v17->type_id = 10;
      v17->unk_03 = 10;
      v17->model_id = 0x80;
      LOBYTE(v17->anim_frame) = 68;
      *&v17->target_id = 4096;
      v17->grid_x = 1;
      v17->current_state = 1;
      *&v17->ai_timer_1 = 50;
      v66 = a6;
      v67 = 50;
      goto LABEL_64;
    case 0x2A:
      v17->model_id = 0x80;
      v17->type_id = 17;
      v17->unk_03 = 17;
      LOBYTE(v17->anim_frame) = 68;
      v17->grid_x = 1;
      v17->current_state = 1;
      *&v17->target_id = 4096;
      LOWORD(v17->pos.Y) = 0;
      HIWORD(v17->pos.X) = 0;
      LOWORD(v17->pos.X) = 0;
      LOBYTE(v17->rot_z) = a6;
      return v17;
    case 0x2D:
      v17->model_id = 0x80;
      v17->type_id = 48;
      v17->unk_03 = 48;
      LOBYTE(v17->anim_frame) = 68;
      v17->grid_x = 1;
      v17->current_state = 1;
      *&v17->target_id = 4096;
      LOWORD(v17->pos.Y) = 0;
      HIWORD(v17->pos.X) = 0;
      LOWORD(v17->pos.X) = 0;
      PlayEntitySound(v17, 23);
      v17->rot_z = a6;
      return v17;
    case 0x2E:
      SetupEntityAnimation(v17, 16, 4096);
      HIWORD(v17->pos.X) = 0;
      LOBYTE(v17->rot_z) = 0;
      HIWORD(v17->pos.Z) = 0;
      HIBYTE(v17->rot_z) = a6;
      return v17;
    case 0x2F:
      v104 = 43;
      goto LABEL_96;
    case 0x30:
      v104 = 42;
LABEL_96:
      v17->type_id = v104;
      type_id = v17->type_id;
      v17->grid_x = 1;
      v17->model_id = 0x80;
      LOBYTE(v17->anim_frame) = -1;
      v17->unk_03 = type_id;
      v106 = *(a6 + 4);
      *&v17->fine_x = *a6;
      v17->bit_flags = v106;
      LOWORD(v17->bit_flags) = 0;
      v17->unk_42 = 0;
      return v17;
    case 0x32:
      v78 = v17;
      v80 = 24;
      v17->model_id = 0x80;
      LOBYTE(v17->anim_frame) = 68;
      *&v17->target_id = 4096;
      v17->grid_x = 1;
      v17->current_state = 1;
      v17->type_id = 11;
      v17->unk_03 = 11;
      LOWORD(v17->pos.Y) = 0;
      HIWORD(v17->pos.X) = 0;
      LOWORD(v17->pos.X) = 0;
      goto LABEL_70;
    case 0x33:
    case 0x34:
      v17->grid_x = 1;
      v17->model_id = 0x80;
      v17->type_id = 37;
      v17->unk_03 = 37;
      LOBYTE(v17->rot_z) = 0;
LABEL_54:
      LOWORD(v17->pos.Y) = 0;
      HIWORD(v17->pos.X) = 0;
      LOWORD(v17->pos.X) = 0;
      return v17;
    case 0x35:
      v43 = v17;
      v44 = 0x2000;
LABEL_31:
      SetupEntityAnimation(v43, 33, v44);
      LOWORD(v17->pos.Z) = LOWORD(v17->pos.Z) - 64 + (rand(v45) >> 8);
      HIWORD(v17->pos.Z) = HIWORD(v17->pos.Z) - 64 + (rand(v46) >> 8);
      v48 = rand(v47);
      *&v17->ai_timer_1 = 100;
      unk_38 = v17->unk_38;
      v17->unk_0B = 3;
      LOWORD(v17->unk_38) = unk_38 - 64 + (v48 >> 8);
      PlayEntitySound(v17, 33);
      return v17;
    case 0x36:
      v64 = 48;
LABEL_49:
      v17->type_id = v64;
      v17->unk_03 = v64;
      v17->model_id = 0x80;
      LOBYTE(v17->anim_frame) = 68;
      v17->grid_x = 1;
      v17->current_state = 1;
      *&v17->target_id = 4096;
      LOWORD(v17->pos.Y) = 0;
      HIWORD(v17->pos.X) = 0;
      LOWORD(v17->pos.X) = 0;
      v17->rot_z = a6 / 4;
      return v17;
    case 0x64:
      v17->grid_x = 1;
      v17->model_id = 0x80;
      v17->type_id = 34;
      v17->unk_03 = 34;
      LOBYTE(v17->anim_frame) = 68;
      *&v17->target_id = 4096;
      v72 = *(a6 + 4);
      *&v17->fine_x = *a6;
      v17->bit_flags = v72;
      v17->vertical_velocity = v17->vertical_velocity - 128 + (rand(v72) >> 7);
      v74 = rand(v73);
      v75 = v17->fine_x;
      LOWORD(v17->bit_flags) = 0;
      v17->fine_x = v75 - 128 + (v74 >> 7);
      PlayEntitySound(v17, 41);
      return v17;
    case 0x65:
      SetupEntityAnimation(v17, a9, a6);
      v17->rot_z = a7;
      *&v17->ai_timer_1 = a8;
      v17->unk_42 = a10;
      return v17;
    case 0x66:
      v17->grid_x = 1;
      v17->model_id = 0x80;
      v17->type_id = 12;
      v17->unk_03 = 12;
      HIWORD(v17->pos.X) = 0;
      LOWORD(v17->pos.Y) = a6;
      LOWORD(v17->pos.X) = a6;
      v17->rot_z = a7;
      result = v17;
      if ( *(v16 + 388) - dword_801BA5B0 >= 0 )
        return result;
      rot_z = v17->rot_z;
      v89 = -1240768329LL * v17->rot_z;
      v90 = v17->rot_z << 16 >> 31;
      *(v16 + 388) = dword_801BA5B0 + 30;
      v91 = (((HIDWORD(v89) + rot_z) >> 6) - v90);
      if ( v91 >= 128 )
        LOWORD(v91) = 127;
      if ( word_8019B3C4 == -1 || (v92 = *(&pSfxSlot + 4 * word_8019B3C4), v92 == -1) || (v93 = 236, v92 == 254) )
      {
        if ( word_8019B3E2 == -1 )
          return v17;
        v94 = *(&pSfxSlot + 4 * word_8019B3E2);
        if ( v94 == -1 )
          return v17;
        v93 = 239;
        if ( v94 == 254 )
          return v17;
      }
      PlayPositionalSound3D_Wrap(v93, &v17->action_id, v91, 28000, 29000, 0);
      result = v17;
      break;
    case 0x67:
      v60 = v17;
      v61 = 15;
      goto LABEL_43;
    case 0x68:
      v62 = v17;
      v63 = 16;
      goto LABEL_46;
    case 0x69:
      SetupEntityAnimation(v17, 14, 4096);
      LOWORD(v17->bit_flags) = rand(v34);
      LOWORD(v17->pos.Z) = LOWORD(v17->pos.Z) - 32 + (rand(v35) >> 9);
      HIWORD(v17->pos.Z) = HIWORD(v17->pos.Z) - 32 + (rand(v36) >> 9);
      LOWORD(v17->unk_38) = LOWORD(v17->unk_38) - 32 + (rand(v37) >> 9);
      LOBYTE(v17->rot_z) = a6;
      HIBYTE(v17->rot_z) = a7;
      v38 = a8;
      v39 = 70;
LABEL_34:
      *&v17->ai_timer_1 = v39;
      v17->unk_42 = v38;
      return v17;
    case 0x6A:
      SetupEntityAnimation(v17, 8, 0x2000);
      HIWORD(v17->pos.Z) -= 100;
      PlayEntitySound(v17, 36);
      *&v17->ai_timer_1 = 100;
      return v17;
    case 0x6B:
      v17->model_id = 0x80;
      v17->type_id = 35;
      v17->unk_03 = 35;
      LOBYTE(v17->anim_frame) = 68;
      v17->grid_x = 1;
      v17->current_state = 1;
      *&v17->target_id = 4096;
      LOWORD(v17->pos.Y) = 4096;
      HIWORD(v17->pos.X) = 4096;
      LOWORD(v17->pos.X) = 4096;
      v59 = *(a6 + 4);
      *&v17->fine_x = *a6;
      v17->bit_flags = v59;
      return v17;
    case 0x6D:
      SetupEntityAnimation(v17, 14, 1024);
      *&v17->ai_timer_1 = 20;
      LOBYTE(v17->rot_z) = a6;
      LOWORD(v17->pos.Z) = LOWORD(v17->pos.Z) - 64 + (rand(v107) >> 8);
      HIWORD(v17->pos.Z) = HIWORD(v17->pos.Z) - 64 + (rand(v108) >> 8);
      v99 = rand(v109) >> 8;
      v100 = LOWORD(v17->unk_38) - 64;
LABEL_102:
      LOWORD(v17->unk_38) = v100 + v99;
      return v17;
    case 0x6F:
      v17->grid_x = 0;
      *&v17->ai_timer_1 = 50;
      v17->rot_z = a6;
      PlayEntitySound(v17, 33);
      return v17;
    case 0x71:
    case 0x73:
      v17->model_id = 0x80;
      v17->type_id = 13;
      v17->unk_03 = 13;
      LOBYTE(v17->anim_frame) = 68;
      *&v17->target_id = 4096;
      v17->grid_x = 1;
      v17->current_state = 1;
      *&v17->ai_timer_1 = 45;
      v76 = *(a6 + 4);
      *&v17->fine_x = *a6;
      v17->bit_flags = v76;
      LOWORD(v17->pos.Y) = 5000;
      HIWORD(v17->pos.X) = 5000;
      LOWORD(v17->pos.X) = 5000;
      PlayEntitySound(v17, 41);
      return v17;
    case 0x72:
      v101 = *&v17->anim_timer;
      v17->grid_x = 1;
      v17->model_id = 0x80;
      v17->type_id = 38;
      v17->unk_03 = 38;
      *&v17->ai_timer_1 = 45;
      *v17->ai_scratchpad = v101;
      v111 = (rand(v28) >> 5) + *&v17->action_id - 512;
      v112 = (rand(v102) >> 5) + *&v17->coll_radius - 512;
      if ( CollisionWithTilemap(v111, *&v17->anim_timer, v112, 10, 10) )
      {
        v111 = *&v17->action_id;
        v112 = *&v17->coll_radius;
      }
      *&v17->action_id = v111 - 2730;
      v103 = *&v17->anim_timer;
      LOWORD(v17->pos.Z) = 100;
      LOWORD(v17->unk_38) = 100;
      *&v17->anim_timer = v103 - 0x4000;
      HIWORD(v17->pos.Z) = 600;
      LOWORD(v17->pos.Y) = 0x4000;
      HIWORD(v17->pos.X) = 0x4000;
      LOWORD(v17->pos.X) = 0x4000;
      *&v17->coll_radius = v112 - 2730;
      return v17;
    case 0x74:
      v77 = 20;
LABEL_100:
      v17->grid_x = 0;
      *&v17->ai_timer_1 = v77;
      return v17;
    case 0x75:
      v78 = v17;
      v17->type_id = 49;
      v17->unk_03 = 49;
      v17->model_id = 0x80;
      LOBYTE(v17->anim_frame) = 68;
      *&v17->target_id = 4096;
      v17->grid_x = 1;
      v17->current_state = 1;
      *&v17->ai_timer_1 = 50;
      v79 = *(a6 + 4);
      *&v17->fine_x = *a6;
      v17->bit_flags = v79;
      v80 = 32;
LABEL_70:
      LOBYTE(v17->rot_z) = 0;
      PlayEntitySound(v78, v80);
      return v17;
    case 0x76:
    case 0x77:
      v65 = v17;
      v17->grid_x = 1;
      v17->model_id = 0x80;
      v17->type_id = 19;
      v17->unk_03 = 19;
      *&v17->ai_timer_1 = 35;
      v66 = a6;
      v67 = 32;
LABEL_64:
      v81 = v66[1];
      *&v17->fine_x = *v66;
      v17->bit_flags = v81;
      PlayEntitySound(v65, v67);
      return v17;
    case 0x78:
      SetupEntityAnimation(v17, 50, 0);
      *&v17->ai_timer_1 = 100;
      if ( rand(v110) >= 4096 )
        return v17;
      PlayEntitySound(v17, 33);
      return v17;
    case 0x79:
      v60 = v17;
      v61 = 46;
LABEL_43:
      SetupEntityAnimation(v60, v61, 4096);
      *&v17->ai_timer_1 = 100;
      v17->rot_z = a6;
      PlayEntitySound(v17, 40);
      return v17;
    case 0x7A:
      v62 = v17;
      v63 = 47;
LABEL_46:
      SetupEntityAnimation(v62, v63, 4096);
      *&v17->ai_timer_1 = 15;
      HIWORD(v17->pos.X) = a6;
      return v17;
    default:
      v17->active = -1;
      return v17;
  }
  return result;
}
// 8004316C: variable 'v34' is possibly undefined
// 80043174: variable 'v35' is possibly undefined
// 8004318C: variable 'v36' is possibly undefined
// 800431A4: variable 'v37' is possibly undefined
// 800431F4: variable 'v40' is possibly undefined
// 8004320C: variable 'v41' is possibly undefined
// 80043224: variable 'v42' is possibly undefined
// 80043290: variable 'v45' is possibly undefined
// 800432A8: variable 'v46' is possibly undefined
// 800432C0: variable 'v47' is possibly undefined
// 8004343C: variable 'v16' is possibly undefined
// 8004381C: variable 'v73' is possibly undefined
// 80043AE0: variable 'v83' is possibly undefined
// 80043DCC: variable 'v96' is possibly undefined
// 80043DE4: variable 'v97' is possibly undefined
// 80043DFC: variable 'v98' is possibly undefined
// 80043EA4: variable 'v102' is possibly undefined
// 8004403C: variable 'v107' is possibly undefined
// 80044054: variable 'v108' is possibly undefined
// 8004406C: variable 'v109' is possibly undefined
// 800440A0: variable 'v110' is possibly undefined
// 80062BF0: using guessed type int __fastcall rand(_DWORD);
// 8019B3C4: using guessed type __int16 word_8019B3C4;
// 8019B3E2: using guessed type __int16 word_8019B3E2;
// 8019B591: using guessed type char byte_8019B591;
// 801BA5B0: using guessed type int dword_801BA5B0;

//----- (80044184) --------------------------------------------------------
int __fastcall sub_80044184(__int16 a1, signed int a2, int a3, int a4, __int16 *a5)
{
  int v8; // $s1
  int v9; // $a0
  int v10; // $a1
  __int16 v11; // $v0
  signed int v12; // $a1
  int v13; // $a0
  int v14; // $v1
  int v15; // $v0
  int v16; // $a0
  int v17; // $a1
  int v18; // $v1

  v8 = dword_801A1184;
  sub_80015694(a1, a5);
  *(v8 + 52) += *a5;
  v9 = *(v8 + 52);
  *(v8 + 54) += a5[1];
  v10 = *(v8 + 54);
  v11 = *(v8 + 56) + a5[2];
  *(v8 + 56) = v11;
  v12 = sub_80015990(v9, v10, v11);
  if ( a2 < v12 )
  {
    v13 = *(v8 + 52) * a2;
    if ( v12 == -1 && v13 == 0x80000000 )
      _break(6u, 0);
    v14 = *(v8 + 54) * a2;
    if ( v12 == -1 && v14 == 0x80000000 )
      _break(6u, 0);
    v15 = *(v8 + 56) * a2;
    if ( v12 == -1 && v15 == 0x80000000 )
      _break(6u, 0);
    *(v8 + 52) = v13 / v12;
    *(v8 + 54) = v14 / v12;
    *(v8 + 56) = v15 / v12;
  }
  v16 = *(v8 + 24);
  v17 = *(v8 + 28);
  *(v8 + 20) += *(v8 + 52);
  v18 = *(v8 + 56) + v17;
  *(v8 + 24) = *(v8 + 54) + v16;
  *(v8 + 28) = v18;
  if ( a4 == -1 )
    return 0;
  else
    return -(sub_800424C8((v8 + 20), a3, a4) != 0);
}
// 80044234: conditional instruction was optimized away because $a1.4!=0
// 80044270: conditional instruction was optimized away because $a1.4!=0
// 800442AC: conditional instruction was optimized away because $a1.4!=0
// 801A1184: using guessed type int dword_801A1184;

//----- (8004435C) --------------------------------------------------------
int __fastcall sub_8004435C(signed int a1, __int16 a2, __int16 a3, int a4, int a5, int a6, __int16 a7, int a8)
{
  int v8; // $s1
  Entity **v13; // $v0
  __int16 v14; // $v0
  __int16 v15; // $a0
  Entity *v17; // [sp+20h] [-28h]
  int v18; // [sp+24h] [-24h]
  Entity *v19; // [sp+28h] [-20h]
  __int16 v20[4]; // [sp+30h] [-18h] BYREF
  __int16 v21[4]; // [sp+38h] [-10h] BYREF
  int v22; // [sp+40h] [-8h] BYREF

  v8 = dword_801A1184;
  if ( (*dword_801A1184 & 0x10) == 0 )
  {
    v22 = sub_80027D54((dword_801A1184 + 20), *(dword_801A1184 + 38), 24000, 4096);
    if ( v22 == -1 )
      goto LABEL_7;
    v17 = *&g_LanguageID[0].header[2];
    v19 = *&g_LanguageID[0].menus[0].header.posY;
    v18 = *&g_LanguageID[0].header[6] - 1600;
    goto LABEL_4;
  }
  v13 = sub_8003D200((dword_801A1184 + 20), *(dword_801A1184 + 38), *(dword_801A1184 + 36), 24000, a8, a8, &v22, 0);
  if ( v13 )
  {
    v17 = v13[11];
    v18 = v13[12] - (*(v13 + 15) >> 1);
    v19 = v13[13];
LABEL_4:
    sub_800159DC(v17 - *(v8 + 20), v18 - *(v8 + 24), v19 - *(v8 + 28), v20);
    v14 = sub_80014C84(*(v8 + 36), v20[0], a3);
    v15 = *(v8 + 38);
    *(v8 + 36) = v14;
    *(v8 + 38) = sub_80014C84(v15, v20[1], a3);
  }
LABEL_7:
  sub_80015538((v8 + 36), v21);
  if ( v22 >= 0 && a6 >= v22 )
    a2 = a7;
  return sub_80044184(a2, a1, a4, a5, v21);
}
// 801A1184: using guessed type int dword_801A1184;
// 8004435C: using guessed type __int16 var_10[4];

//----- (80044520) --------------------------------------------------------
int __fastcall sub_80044520(_DWORD *a1, signed int a2, __int16 a3, signed int a4, signed int a5, int a6, int a7)
{
  __int16 *v7; // $s2
  signed int v11; // $s1
  __int16 v13; // $v0
  int v14; // $a1
  __int16 v15; // $v0
  int v16; // $a1
  int v17; // [sp+18h] [-18h]
  int v18; // [sp+1Ch] [-14h]
  int v19; // [sp+20h] [-10h]
  __int16 v20[4]; // [sp+28h] [-8h] BYREF

  v7 = dword_801A1184;
  v17 = *a1 - *(dword_801A1184 + 20);
  v18 = a1[1] - *(dword_801A1184 + 24);
  v19 = a1[2] - *(dword_801A1184 + 28);
  v11 = sub_80015990(v17, v18, v19);
  if ( a5 >= v11 )
    return -2;
  if ( a4 >= v11 )
  {
    v13 = FixedPointLerp(0, v7[26], 3072);
    v14 = v7[27];
    v7[26] = v13;
    v15 = FixedPointLerp(0, v14, 3072);
    v16 = v7[28];
    v7[27] = v15;
    v7[28] = FixedPointLerp(0, v16, 3072);
  }
  if ( v11 == -1 && v17 << 12 == 0x80000000 )
    _break(6u, 0);
  if ( v11 == -1 && v18 << 12 == 0x80000000 )
    _break(6u, 0);
  if ( v11 == -1 && v19 << 12 == 0x80000000 )
    _break(6u, 0);
  v20[0] = (v17 << 12) / v11;
  v20[1] = (v18 << 12) / v11;
  v20[2] = (v19 << 12) / v11;
  return sub_80044184(a3, a2, a6, a7, v20);
}
// 800445F8: conditional instruction was optimized away because $s1.4!=0
// 80044630: conditional instruction was optimized away because $s1.4!=0
// 80044668: conditional instruction was optimized away because $s1.4!=0
// 801A1184: using guessed type int dword_801A1184;

//----- (800446E0) --------------------------------------------------------
int __fastcall sub_800446E0(int a1, int a2, int a3, unsigned __int16 a4, int a5)
{
  int v5; // $s1
  __int16 v8; // $v1
  int v9; // $a2
  int result; // $v0

  v5 = dword_801A1184;
  v8 = *(dword_801A1184 + 44) + a3;
  *(dword_801A1184 + 44) = v8;
  v9 = a1 * *(v5 + 44);
  *(v5 + 48) = v8;
  *(v5 + 46) = v8;
  sub_80042938((v5 + 20), (v9 >> 12) - ((a1 * a3) >> 12), (v9 >> 12) - 1, a5, a4, 4096);
  result = 255;
  if ( *(v5 + 44) >= a2 )
    *v5 = -1;
  return result;
}
// 801A1184: using guessed type int dword_801A1184;

//----- (80044784) --------------------------------------------------------
int __fastcall sub_80044784(int a1, int a2)
{
  int v3; // $a0
  Entity *v4; // $v1
  int result; // $v0
  int v6; // [sp+18h] [-18h] BYREF
  __int16 v7; // [sp+1Ch] [-14h]
  __int16 v8; // [sp+20h] [-10h]
  __int16 v9; // [sp+24h] [-Ch]
  __int16 v10[4]; // [sp+28h] [-8h] BYREF

  sub_80042BD4(a1, a2, &v6, (a1 + 44));
  v10[0] = *(a1 + 36);
  v10[1] = *(a1 + 38) + (rand(v3) >> 7) - 128;
  v10[2] = *(a1 + 40);
  v4 = SpawnParticleEntity(10, *a1, 0x64u, &v6, dword_800763A4, v10, v6, v7, v8, v9, v10[0]);
  result = 2;
  if ( v4 )
    v4->grind_z = 2;
  return result;
}
// 800447A4: variable 'v3' is possibly undefined
// 80062BF0: using guessed type int __fastcall rand(_DWORD);
// 800763A4: using guessed type int dword_800763A4[2];

//----- (80044814) --------------------------------------------------------
int __fastcall sub_80044814(_DWORD *a1, int a2, __int16 a3, int a4)
{
  int v4; // $t0
  int result; // $v0
  __int16 v6; // [sp+1Ch] [-1Ch]
  int v7; // [sp+20h] [-18h] BYREF
  int v8; // [sp+30h] [-8h] BYREF

  v4 = a1[1];
  result = 0;
  if ( v4 >= g_CeilingHeight )
  {
    if ( a4 + g_CeilingHeight < v4 )
    {
      return 0;
    }
    else
    {
      SpawnParticleEntity(10, 0, 0x66u, &v7, &v8, a2, a3, v6, *a1, g_CeilingHeight, a1[2]);
      return 1;
    }
  }
  return result;
}
// 80044878: variable 'v6' is possibly undefined
// 801DD58C: using guessed type int g_CeilingHeight;

//----- (8004489C) --------------------------------------------------------
Entity *__fastcall sub_8004489C(
        int a1,
        int a2,
        int a3,
        int a4,
        __int16 a5,
        __int16 a6,
        __int16 a7,
        __int16 a8,
        int a9,
        int a10,
        __int16 *a11,
        __int16 a12,
        int a13,
        __int16 a14)
{
  _WORD *v17; // $a0
  int v18; // $a0
  int v19; // $a0
  int v21; // [sp+28h] [-28h] BYREF
  __int16 v22; // [sp+2Ch] [-24h]
  int v23; // [sp+30h] [-20h] BYREF
  int v24; // [sp+34h] [-1Ch]
  int v25; // [sp+38h] [-18h]
  __int16 v26[8]; // [sp+40h] [-10h] BYREF

  if ( a2 == -1 )
  {
    v25 = 0;
    v24 = 0;
    v23 = 0;
  }
  else
  {
    sub_80042AEC(a1, a2, &v23, (a1 + 44));
  }
  if ( a3 != -2 )
  {
    if ( a3 >= -1 )
    {
      v17 = (a1 + 36);
      if ( a3 != -1 )
      {
LABEL_12:
        sub_80015538(v17, &v21);
        sub_80015694(30, &v21);
        LOWORD(v21) = -v21;
        v22 = -v22;
        HIWORD(v21) = -HIWORD(v21);
        goto LABEL_13;
      }
      sub_80042AEC(a1, a10, v26, a11);
      LOWORD(v21) = v26[0];
      HIWORD(v21) = v26[2];
      v22 = v26[4];
      a3 = a9;
    }
    else
    {
      v17 = (a1 + 36);
      if ( a3 != -3 )
        goto LABEL_12;
      v22 = 0;
      v21 = 0;
      a3 = a9;
    }
LABEL_13:
    LOWORD(v21) = v21 + ((*(a1 + 52) * a3) >> 12);
    HIWORD(v21) += (*(a1 + 54) * a3) >> 12;
    v22 += (*(a1 + 56) * a3) >> 12;
    goto LABEL_14;
  }
  LOWORD(v21) = ((rand(a1) * a9) >> 15) + a10;
  HIWORD(v21) = ((rand(v18) * a11) >> 15) + a12;
  v22 = ((rand(v19) * a13) >> 15) + a14;
LABEL_14:
  v23 += *(a1 + 20);
  v24 += *(a1 + 24);
  v25 += *(a1 + 28);
  return SpawnParticleEntity(10, 0, 0x65u, &v23, &v21, a4, a5, a6, a7, a8, v21);
}
// 8004496C: variable 'a1' is possibly undefined
// 80044990: variable 'v18' is possibly undefined
// 800449B4: variable 'v19' is possibly undefined
// 80062BF0: using guessed type int __fastcall rand(_DWORD);

//----- (80044B20) --------------------------------------------------------
int __fastcall sub_80044B20(_DWORD *a1, int a2, int a3, int a4, int a5, int a6)
{
  int v10; // $s2
  int v11; // $a0
  int v12; // $a1
  int result; // $v0
  int v14; // $s0
  int v15; // $v0
  int v16; // $v0
  int v17; // $a0
  int v18; // $a0
  __int16 v19; // [sp+1Ch] [-1Ch]
  int v20; // [sp+20h] [-18h] BYREF
  int v21; // [sp+24h] [-14h]
  int v22; // [sp+28h] [-10h]
  int v23; // [sp+30h] [-8h] BYREF

  v10 = 0;
  v11 = a1[1];
  v12 = 0;
  if ( v11 < g_CeilingHeight )
    return 0;
  result = 0;
  if ( g_CeilingHeight + 500 >= v11 )
  {
    v14 = a2 - 1;
    for ( result = 1; v14 != -1; result = 1 )
    {
      v20 = v10 + *a1;
      v15 = a1[2];
      v21 = g_CeilingHeight;
      v22 = v12 + v15;
      v16 = sub_80015CC8(a6);
      SpawnParticleEntity(
        10,
        0,
        0x66u,
        &v20,
        &v23,
        (a4 * (v16 + 4096)) >> 12,
        (a5 * (v16 + 4096)) >> 12,
        v19,
        v20,
        v21,
        v22);
      --v14;
      v10 = ((rand(v17) * a3) >> 14) - a3;
      v12 = ((rand(v18) * a3) >> 14) - a3;
    }
  }
  return result;
}
// 80044BFC: variable 'v19' is possibly undefined
// 80044C04: variable 'v17' is possibly undefined
// 80044C18: variable 'v18' is possibly undefined
// 80062BF0: using guessed type int __fastcall rand(_DWORD);
// 801DD58C: using guessed type int g_CeilingHeight;

//----- (80044C74) --------------------------------------------------------
// write access to const memory has been detected, the output may be wrong!
int __fastcall sub_80044C74(int a1, __int16 a2, __int16 a3)
{
  int v7; // $s0
  int *v8; // $a0
  int v9; // $a3
  int v10; // $t0
  int v11; // $v1
  int v12; // $a1
  int v13; // $gp
  int v14; // $v1
  int v15; // $a2
  int v16; // $a3
  int v17; // $gp
  char v18; // $a0
  __int16 v19; // $v1
  int result; // $v0
  int v21[4]; // [sp+10h] [-10h] BYREF

  v7 = dword_801A1184;
  v8 = (dword_801A1184 + 20);
  v9 = *(dword_801A1184 + 24);
  v10 = *(dword_801A1184 + 28);
  *(dword_801A1184 + 20) += *(dword_801A1184 + 52);
  v11 = *(v7 + 56) + v10;
  *(v7 + 24) = *(v7 + 54) + v9;
  *(v7 + 28) = v11;
  v12 = sub_800424C8(v8, a1, a2);
  if ( *(v7 + 13) )
  {
    v14 = *(v7 + 52) << 16 >> 17;
    *(v13 + 424) = *(v7 + 52) >> 1;
    v15 = *(v7 + 54) << 16 >> 17;
    word_8007646A = *(v7 + 54) >> 1;
    v16 = *(v7 + 56) << 16 >> 17;
    word_8007646C = *(v7 + 56) >> 1;
    if ( !v12 )
    {
      v21[0] = *(v7 + 20) - v14;
      v21[1] = *(v7 + 24) - v15;
      v21[2] = *(v7 + 28) - v16;
      v12 = sub_800424C8(v21, a1, a2);
      if ( v12 )
      {
        *(v17 + 424) = *(v7 + 52);
        word_8007646A = *(v7 + 54);
        word_8007646C = *(v7 + 56);
      }
    }
  }
  v18 = 2;
  if ( !g_TileLayerOffset )
    v18 = 1;
  v19 = *(v7 + 40);
  result = v12;
  *(v7 + 10) = v18;
  *(v7 + 40) = (v19 - a3) & 0xFFF;
  return result;
}
// 80044D14: write access to const memory at 8007646A has been detected
// 80044D2C: write access to const memory at 8007646C has been detected
// 80044D90: write access to const memory at 8007646A has been detected
// 80044DA0: write access to const memory at 8007646C has been detected
// 80044D00: variable 'v13' is possibly undefined
// 80044D84: variable 'v17' is possibly undefined
// 8007646A: using guessed type __int16 word_8007646A;
// 8007646C: using guessed type __int16 word_8007646C;
// 801A1184: using guessed type int dword_801A1184;
// 801DD57E: using guessed type __int16 g_TileLayerOffset;

//----- (80044DF8) --------------------------------------------------------
int sub_80044DF8()
{
  int v0; // $gp
  int v1; // $a2
  int v2; // $a0
  int v3; // $a1
  int v4; // $v1
  int v5; // $a0
  int v6; // $a1
  int result; // $v0
  int v8; // $v1

  v1 = dword_801A1184;
  if ( *(dword_801A1184 + 13) )
  {
    *(dword_801A1184 + 20) -= *(v0 + 424);
    *(v1 + 24) = *(v1 + 24);
    *(v1 + 28) = *(v1 + 28);
  }
  else
  {
    v2 = *(dword_801A1184 + 54);
    v3 = *(dword_801A1184 + 56);
    *(dword_801A1184 + 20) -= *(dword_801A1184 + 52);
    v4 = *(v1 + 28) - v3;
    *(v1 + 24) -= v2;
    *(v1 + 28) = v4;
  }
  v5 = *(v1 + 54);
  v6 = *(v1 + 56);
  *(v1 + 20) -= *(v1 + 52);
  result = *(v1 + 24) - v5;
  v8 = *(v1 + 28) - v6;
  *(v1 + 24) = result;
  *(v1 + 28) = v8;
  return result;
}
// 80044E14: variable 'v0' is possibly undefined
// 8007646A: using guessed type __int16 word_8007646A;
// 8007646C: using guessed type __int16 word_8007646C;
// 801A1184: using guessed type int dword_801A1184;

//----- (80044EC0) --------------------------------------------------------
int __fastcall sub_80044EC0(int a1, int a2, __int16 a3, __int16 a4)
{
  int v4; // $s3
  int v9; // $s2
  int v10; // $v1
  int v11; // $v0
  int v12; // $s1
  int v13; // $v0
  int result; // $v0
  __int16 v15; // [sp+1Ch] [-1Ch]
  int v16; // [sp+20h] [-18h] BYREF
  int v17[4]; // [sp+28h] [-10h] BYREF

  v4 = dword_801A1184;
  v9 = rand(a1);
  v17[0] = *(v4 + 20) - *(v4 + 52);
  if ( !a1 )
    _break(7u, 0);
  v17[1] = *(v4 + 24) - *(v4 + 54);
  v10 = *(v4 + 56);
  v11 = *(v4 + 28);
  v12 = -2;
  HIWORD(v16) = a3;
  v17[2] = v11 - v10;
  do
  {
    LOWORD(v16) = (FixedCos(v9) * a2) >> 12;
    v13 = FixedSin(v9);
    v9 -= 4096;
    --v12;
    SpawnParticleEntity(10, *v4 | 3, 8u, v17, &v16, dword_801A1188, a4, v15, v16, (v13 * a2) >> 12, v17[0]);
    result = -1;
  }
  while ( v12 != -1 );
  return result;
}
// 80044FD8: variable 'v15' is possibly undefined
// 80062BF0: using guessed type int __fastcall rand(_DWORD);
// 801A1184: using guessed type int dword_801A1184;
// 801A1188: using guessed type int dword_801A1188;

//----- (80045018) --------------------------------------------------------
void __fastcall UpdateParticleEffect(int a1)
{
  int v1; // $s2
  unsigned __int16 *v2; // $s0
  int v3; // $s4
  int v4; // $s1
  int v5; // $s0
  __int16 v6; // $a1
  int v7; // $a2
  int v8; // $s1
  int v9; // $v1
  int v10; // $s0
  _DWORD *v11; // $a0
  char v12; // $v1
  int v13; // $a0
  int v14; // $a2
  int v15; // $a1
  int v16; // $s0
  char v17; // $v0
  _DWORD *v18; // $a0
  int v19; // $a1
  __int16 v20; // $a2
  __int16 v21; // $v0
  char v22; // $v1
  Entity **v23; // $s0
  _DWORD *v24; // $v0
  int v25; // $a0
  int v26; // $a1
  int v27; // $a2
  __int16 v28; // $v1
  int v29; // $a0
  __int16 v30; // $v0
  int v31; // $a3
  int v32; // $s0
  _DWORD *v33; // $a0
  __int16 v34; // $a2
  int v35; // $s0
  int v36; // $a0
  unsigned __int8 *v37; // $s0
  int v38; // $v0
  __int16 v39; // $v1
  __int16 v40; // $v0
  __int16 v41; // $v1
  int v42; // $a0
  int v43; // $a1
  int v44; // $v1
  int v45; // $v1
  int v46; // $a1
  int v47; // $v0
  int v48; // $a0
  int v49; // $v1
  int v50; // $v0
  int v51; // $v0
  int v52; // $v0
  int v53; // $s0
  int v54; // $a0
  int v55; // $v1
  SVECTOR *v56; // $a1
  __int16 v57; // $v0
  __int16 v58; // $v0
  int v59; // $a0
  int v60; // $v1
  __int16 v61; // $v0
  int v62; // $v0
  int *v63; // $a0
  signed int v64; // $a2
  int v65; // $v1
  int v66; // $v0
  int v67; // $v1
  int v68; // $v0
  int v69; // $s0
  Entity **v70; // $v0
  int v71; // $a0
  bool v72; // dc
  __int16 v73; // $v0
  int v74; // $v0
  int v75; // $s0
  _DWORD *v76; // $a0
  int v77; // $v0
  int v78; // $v0
  __int16 v79; // $v0
  int v80; // $v1
  int v81; // $v0
  int v82; // $v0
  int v83; // $s3
  int v84; // $a0
  int v85; // $a1
  __int16 v86; // $v0
  int v87; // $a1
  int v88; // $s0
  int v89; // $v1
  unsigned __int8 v90; // $a2
  int v91; // $v0
  int v92; // $a0
  int v93; // $a0
  char v94; // $v0
  int v95; // $v0
  int v96; // $v1
  unsigned __int8 v97; // $a2
  signed int v98; // $s0
  int v99; // $v0
  int v100; // $a0
  int v101; // $a0
  int v102; // $a0
  unsigned __int8 v103; // $s0
  __int16 v104; // $v0
  int v105; // $a0
  int v106; // $a1
  int v107; // $a2
  signed int v108; // $a0
  __int16 v109; // $a1
  __int16 v110; // $a2
  unsigned __int8 v111; // $v0
  int v112; // $v1
  int v113; // $s3
  int v114; // $s0
  int v115; // $s1
  int v116; // $v0
  __int16 v117; // $v0
  int v118; // $s0
  int v119; // $v1
  int v120; // $s3
  unsigned __int8 *v121; // $a1
  int v122; // $a2
  char *v123; // $a0
  int v124; // $v1
  Entity **v125; // $s1
  unsigned __int16 v126; // $v0
  int v127; // $v1
  Entity **v128; // $s0
  _DWORD *v129; // $v0
  __int16 v130; // $v0
  __int16 v131; // $v1
  int v132; // $v0
  int v133; // $v0
  int v134; // $s0
  char *v135; // $a0
  char *v136; // $a0
  int v137; // $v1
  int v138; // $a0
  int v139; // $a1
  int v140; // $v1
  signed int v141; // $a1
  __int16 v142; // $a2
  signed int v143; // $a3
  Entity **v144; // $a3
  int v145; // $v0
  int v146; // $v0
  int v147; // $a0
  int v148; // $s0
  int v149; // $a0
  int v150; // $v0
  int v151; // $s4
  int v152; // $s0
  int v153; // $s0
  int v154; // $a0
  int v155; // $t0
  int v156; // $t1
  int v157; // $v1
  int v158; // $v1
  int v159; // $v0
  int v160; // $v0
  int v161; // $v0
  char *v162; // $s3
  int v163; // $s1
  int v164; // $v0
  int v165; // $v1
  int v166; // $s0
  int v167; // $s1
  int v168; // $s0
  __int16 v169; // $v0
  int v170; // $a0
  char v171; // $v1
  __int16 v172; // $v0
  char *v173; // $s3
  int v174; // $v1
  int v175; // $a0
  int v176; // $a2
  __int16 v177; // $v0
  int v178; // $a0
  unsigned int v179; // $v1
  __int16 v180; // $v0
  int v181; // $v1
  int v182; // $a0
  int v183; // $v1
  int v184; // $a0
  unsigned __int8 v185; // $v0
  int v186; // $v1
  Entity **v187; // $a3
  int *v188; // $a0
  char v189; // $v0
  int v190; // $v0
  Entity **v191; // $v0
  int i; // $s0
  Entity *v193; // $v1
  char v194; // $v0
  Entity **v195; // $s0
  int v196; // $v1
  unsigned __int8 v197; // $v0
  int v198; // $s3
  int v199; // $s1
  int v200; // $v1
  Entity **v201; // $s0
  int v202; // $s4
  unsigned __int8 v203; // $v0
  _DWORD *v204; // $v0
  int v205; // $a0
  int v206; // $a1
  int v207; // $a2
  unsigned int v208; // $a2
  __int16 v209; // $v0
  int v210; // $s3
  int v211; // $v0
  int v212; // $v1
  int v213; // $s1
  int v214; // $v0
  int v215; // $a1
  unsigned __int8 v216; // $v0
  int v217; // $s0
  int v218; // $a0
  Entity **v219; // $s0
  char *v220; // $a1
  __int16 v221; // $v1
  int v222; // $a0
  int v223; // $v0
  _DWORD *v224; // $v0
  int v225; // $a0
  int v226; // $a1
  int v227; // $a2
  int v228; // $a0
  __int16 v229; // $v0
  int v230; // $v1
  int v231; // $a0
  __int16 v232; // $v0
  __int16 v233; // $a1
  int v234; // $v1
  int v235; // $a0
  __int16 v236; // $v0
  int v237; // $v0
  __int16 v238; // $v0
  unsigned __int8 v239; // $a0
  unsigned __int8 v240; // $a1
  unsigned __int8 v241; // $a2
  int v242; // $a3
  int v243; // $a0
  Entity *v244; // $v0
  int v245; // $s0
  int v246; // $a0
  Entity *v247; // $v0
  int v248; // $a0
  int v249; // $a1
  int v250; // $v1
  int v251; // $a0
  int v252; // $s0
  int v253; // $v0
  int v254; // $a0
  int v255; // $s0
  int v256; // $a0
  __int16 v257; // $v0
  int v258; // $v0
  int v259; // $a0
  int v260; // $v0
  int v261; // $v0
  int v262; // [sp+14h] [-16Ch]
  __int16 v263; // [sp+18h] [-168h]
  __int16 v264; // [sp+18h] [-168h]
  __int16 v265; // [sp+18h] [-168h]
  __int16 v266; // [sp+18h] [-168h]
  __int16 v267; // [sp+18h] [-168h]
  __int16 v268; // [sp+18h] [-168h]
  __int16 v269; // [sp+18h] [-168h]
  __int16 v270; // [sp+18h] [-168h]
  __int16 v271; // [sp+1Ch] [-164h]
  __int16 v272; // [sp+1Ch] [-164h]
  __int16 v273; // [sp+1Ch] [-164h]
  __int16 v274; // [sp+1Ch] [-164h]
  __int16 v275; // [sp+1Ch] [-164h]
  __int16 v276; // [sp+1Ch] [-164h]
  __int16 v277; // [sp+1Ch] [-164h]
  int v278; // [sp+20h] [-160h]
  __int16 v279; // [sp+20h] [-160h]
  __int16 v280; // [sp+20h] [-160h]
  __int16 v281; // [sp+20h] [-160h]
  __int16 v282; // [sp+20h] [-160h]
  __int16 v283; // [sp+20h] [-160h]
  __int16 v284; // [sp+20h] [-160h]
  int v285; // [sp+24h] [-15Ch]
  __int16 v286; // [sp+24h] [-15Ch]
  __int16 v287; // [sp+24h] [-15Ch]
  __int16 v288; // [sp+24h] [-15Ch]
  __int16 v289; // [sp+24h] [-15Ch]
  __int16 v290; // [sp+24h] [-15Ch]
  __int16 v291; // [sp+24h] [-15Ch]
  __int16 *v292; // [sp+28h] [-158h]
  __int16 v293; // [sp+28h] [-158h]
  __int16 v294; // [sp+28h] [-158h]
  __int16 v295; // [sp+28h] [-158h]
  __int16 v296; // [sp+28h] [-158h]
  __int16 v297; // [sp+28h] [-158h]
  __int16 v298; // [sp+28h] [-158h]
  __int16 v299; // [sp+2Ch] [-154h]
  int v300; // [sp+30h] [-150h]
  __int16 v301; // [sp+34h] [-14Ch]
  Entity *v302; // [sp+38h] [-148h] BYREF
  Entity *v303; // [sp+3Ch] [-144h]
  Entity *v304; // [sp+40h] [-140h]
  int v305[4]; // [sp+48h] [-138h] BYREF
  int v306; // [sp+58h] [-128h] BYREF
  int v307; // [sp+5Ch] [-124h]
  int v308; // [sp+60h] [-120h]
  Entity *v309; // [sp+68h] [-118h] BYREF
  int v310; // [sp+6Ch] [-114h]
  int v311; // [sp+70h] [-110h] BYREF
  int v312; // [sp+74h] [-10Ch]
  int v313; // [sp+78h] [-108h] BYREF
  int v314; // [sp+80h] [-100h] BYREF
  __int16 v315; // [sp+84h] [-FCh]
  int v316; // [sp+88h] [-F8h] BYREF
  int v317; // [sp+8Ch] [-F4h]
  int v318; // [sp+90h] [-F0h] BYREF
  int v319; // [sp+94h] [-ECh]
  char v320[8]; // [sp+98h] [-E8h] BYREF
  int v321; // [sp+A0h] [-E0h] BYREF
  int v322; // [sp+A4h] [-DCh]
  int v323; // [sp+A8h] [-D8h]
  int v324; // [sp+ACh] [-D4h]
  int v325; // [sp+B0h] [-D0h] BYREF
  int v326; // [sp+B4h] [-CCh]
  int v327; // [sp+B8h] [-C8h]
  char v328[16]; // [sp+C0h] [-C0h] BYREF
  Entity *v329; // [sp+D0h] [-B0h] BYREF
  int v330; // [sp+D4h] [-ACh]
  int v331; // [sp+D8h] [-A8h]
  int v332; // [sp+E0h] [-A0h] BYREF
  int v333; // [sp+E4h] [-9Ch]
  int v334; // [sp+E8h] [-98h]
  int v335[2]; // [sp+F0h] [-90h] BYREF
  int v336[2]; // [sp+F8h] [-88h] BYREF
  Entity *v337; // [sp+100h] [-80h] BYREF
  __int16 v338; // [sp+104h] [-7Ch]
  int v339[4]; // [sp+108h] [-78h] BYREF
  int v340[2]; // [sp+118h] [-68h] BYREF
  int v341[4]; // [sp+120h] [-60h] BYREF
  int v342[4]; // [sp+130h] [-50h] BYREF
  int v343; // [sp+140h] [-40h] BYREF
  __int16 v344; // [sp+144h] [-3Ch]
  int v345[14]; // [sp+148h] [-38h] BYREF

  v1 = dword_801A1184;
  v2 = dword_801A1180;
  v3 = *(dword_801A1184 + 1);
  v4 = *(dword_801A1184 + 7);
  switch ( *(dword_801A1184 + 1) )
  {
    case 0:
      v72 = *(dword_801A1184 + 44) >= 3072;
      *(dword_801A1184 + 54) += 20;
      if ( !v72 )
      {
        v73 = *(v1 + 48) + 256;
        *(v1 + 48) = v73;
        *(v1 + 46) = v73;
        *(v1 + 44) = v73;
      }
      v74 = sub_80044C74(180, 0, -300);
      v75 = v74;
      v76 = (v1 + 20);
      if ( v74 )
      {
        v77 = v74 & 0x10;
        if ( !*(v1 + 64) )
        {
          v72 = rand(v76) >= 3000;
          v77 = v75 & 0x10;
          if ( !v72 )
          {
            sub_800428D0(v75);
            v77 = v75 & 0x10;
          }
        }
        if ( v77 )
          *(v1 + 64) = 1;
        if ( (v75 & 5) != 0 )
        {
          if ( v4 == 1 )
          {
            *v1 = -1;
          }
          else
          {
            v78 = g_FinalResultHeight;
            *(v1 + 7) = 1;
            *(v1 + 54) = -200;
            *(v1 + 24) = v78;
          }
        }
        v76 = (v1 + 20);
      }
      sub_80044814(v76, 1024, 1024, 500);
      goto LABEL_421;
    case 1:
      v59 = 500;
      goto LABEL_114;
    case 2:
      v104 = *(dword_801A1184 + 44) + *(dword_801A1184 + 66);
      *(dword_801A1184 + 44) = v104;
      v72 = *(v1 + 44) < 768;
      *(v1 + 48) = v104;
      if ( !v72 )
      {
        v321 = *(v1 + 20);
        v322 = *(v1 + 24) + 1000;
        v323 = *(v1 + 28);
        sub_80042938(&v321, 4 * (*(v1 + 44) - *(v1 + 66)), 4 * *(v1 + 44) - 1, 2000, 0x1000u, *(v1 + 68));
      }
      if ( *(v1 + 64) < *(v1 + 44) )
        goto LABEL_408;
      return;
    case 3:
      sub_800446E0(0x4000, 512, 64, 0xC00u, 0x8000);
      return;
    case 4:
      v32 = sub_80044C74(180, 0, 0);
      if ( v32 )
      {
        if ( (v32 & 0xF) != 0 )
          *v1 = -1;
        v33 = (v1 + 20);
        if ( !*(v1 + 64) )
        {
          *(v1 + 64) = 1;
          sub_800428D0(v32);
          v33 = (v1 + 20);
        }
      }
      else
      {
        *(v1 + 64) = 0;
        v33 = (v1 + 20);
      }
      *(v1 + 38) += 750;
      sub_80044814(v33, 0x2000, 0x2000, 500);
      return;
    case 5:
      if ( !*(dword_801A1184 + 7) )
      {
        v112 = *(dword_801A1184 + 65);
        v113 = 0;
        if ( v112 == 255
          || (v114 = sub_8003706C(BYTE1(g_ObjectArray[31 * v112]) + 128, LOBYTE(g_ObjectArray[31 * v112 + 3]))) == 0 )
        {
          v114 = 16;
          v115 = 0;
          *(v1 + 14) = 1;
        }
        else
        {
          v116 = v114 << 12;
          if ( v114 < 33 )
          {
            v115 = 4096;
          }
          else
          {
            v114 = 32;
            v115 = v116 / 32;
          }
        }
        v117 = v114;
        v118 = v114 - 1;
        *(v1 + 66) = v117;
        *(v1 + 64) = v117;
        while ( v118 != -1 )
        {
          v119 = v113 >> 12;
          v113 += v115;
          --v118;
          SpawnParticleEntity(10, *v1, 0x69u, (v1 + 20), (v1 + 52), dword_801A1188, *(v1 + 65), v119, v278, v285, v292);
        }
        *(v1 + 7) = 1;
        return;
      }
      if ( v4 != 1 )
        return;
      v120 = 0;
      if ( *(dword_801A1184 + 14) >= 2 )
      {
        if ( *(dword_801A1184 + 66) )
          return;
      }
      v121 = &g_ParticleArray;
      v122 = 127;
      v123 = &unk_8019ED87;
      do
      {
        if ( *v121 != 255 && *(v123 - 6) == 105 && v123[57] == dword_801A1188 )
        {
          if ( *v123 == 1 )
          {
            *(v123 + 7) = 1;
            ++v120;
          }
          else
          {
            *v123 = 2;
          }
        }
        v123 += 72;
        --v122;
        v121 += 72;
      }
      while ( v122 != -1 );
      v124 = *(v1 + 65);
      if ( v124 != 255 )
      {
        v125 = &g_ObjectArray[31 * v124];
        if ( *(v1 + 64) )
        {
          v126 = sub_800427C8(v1);
          if ( !*(v1 + 64) )
            _break(7u, 0);
          ApplyDamage(
            *(v1 + 65),
            v126,
            v2[3],
            v2[4],
            v2[5],
            v2[6],
            v2[7],
            v2[8],
            v2[9],
            v2[10],
            (v120 << 12) / *(v1 + 64),
            *v1 & 0x30 | 2,
            v125 + 11);
        }
      }
      goto LABEL_408;
    case 6:
      switch ( *(dword_801A1184 + 7) )
      {
        case 0:
          for ( i = 0; i < 8; ++i )
          {
            v193 = SpawnParticleEntity(10, 0, 0x6Bu, (v1 + 20), (v1 + 52), v1 + 36, i, v271, v278, v285, v292);
            if ( !i )
              v193->unk_03 = 23;
            v194 = dword_801A1188;
            HIBYTE(v193->rot_z) = i;
            LOBYTE(v193->rot_z) = v194;
          }
          v193->unk_03 = 24;
          *(v1 + 7) = 1;
          goto LABEL_341;
        case 1:
LABEL_341:
          if ( *(v1 + 14) < 3 )
            goto LABEL_342;
          if ( sub_8004435C(250, 25, 32, 200, 0, 1024, 100, 2048) == -1 )
          {
            *(v1 + 14) = -1;
            if ( dword_801DD594 != 16
              || (sub_800427EC(65552, 0x1388u, 0),
                  *(v1 + 70) = dword_801DD598,
                  v195 = &g_ObjectArray[31 * *(v1 + 70)],
                  *(v195 + 14) - 2 >= 2) )
            {
LABEL_342:
              *(v1 + 7) = 3;
              *(v1 + 14) = -1;
              *(v1 + 69) = 24;
              return;
            }
            v196 = *(v1 + 20);
            *(v1 + 8) = 1;
            *(v1 + 3) = 22;
            *(v1 + 7) = 2;
            *(v1 + 69) = 0;
            *(v1 + 40) = 0;
            *(v1 + 36) = 0;
            *(v1 + 42) = -Math_Atan2_Fixed(v196 - v195[11], *(v1 + 28) - v195[13]);
LABEL_350:
            v201 = &g_ObjectArray[31 * *(v1 + 70)];
            v201[10] = (v201[10] | 0x800);
            v202 = *(v201 + 14);
            v203 = *(v1 + 68) + 1;
            *(v1 + 68) = v203;
            if ( v203 >= 0x18u )
              *(v1 + 68) = 0;
            v204 = sub_8003EBC0(v201, v335);
            v205 = v204[1];
            v206 = v204[2];
            v207 = v204[3];
            *(v1 + 20) = *v204;
            *(v1 + 24) = v205;
            *(v1 + 28) = v206;
            *(v1 + 32) = v207;
            v208 = *(v1 + 69);
            *(v1 + 24) -= *(v201 + 15) >> 1;
            if ( v208 < 0x11 )
            {
              v209 = FixedPointLerp(0, v202, v208 << 9);
              *(v1 + 48) = v209;
              *(v1 + 44) = v209;
              *(v1 + 46) = FixedPointLerp(0, *(v201 + 15), 350 * *(v1 + 69));
            }
            else if ( v208 >= 0x3C )
            {
              *(v1 + 7) = 4;
              return;
            }
            v210 = *(v1 + 42);
            v211 = 24 * *(v1 + 68);
            v212 = *(v1 + 64);
            ++*(v1 + 69);
            v213 = v211 + v212;
            *(v1 + 42) = v210 + 100000 / v202;
            *v213 = ((-2 * FixedSin(v210)) >> 12) + *(v1 + 20);
            *(v213 + 8) = ((-2 * FixedCos(v210)) >> 12) + *(v1 + 28);
            v214 = FixedSin(2 * v210);
            v215 = *(v1 + 24);
            *(v213 + 18) = (-v210 - 1024);
            *(v213 + 4) = (v214 >> 4) + v215;
            *(v213 + 16) = FixedCos(2 * v210) >> 4;
          }
          else
          {
            v197 = *(v1 + 68) + 1;
            *(v1 + 68) = v197;
            if ( v197 >= 0x18u )
              *(v1 + 68) = 0;
            v198 = 16 * *(v1 + 69);
            v199 = 24 * *(v1 + 68) + *(v1 + 64);
            v200 = *(v1 + 20);
            *(v1 + 69) += 8;
            *v199 = v200;
            *(v199 + 8) = *(v1 + 28);
            *(v199 + 4) = (FixedSin(v198) >> 3) + *(v1 + 24);
            *(v199 + 18) = *(v1 + 38);
            *(v199 + 20) = *(v1 + 40);
            *(v199 + 16) = *(v1 + 36) + (FixedCos(v198) >> 4);
          }
          break;
        case 2:
          goto LABEL_350;
        case 3:
          v216 = *(dword_801A1184 + 68) + 1;
          *(dword_801A1184 + 68) = v216;
          if ( v216 >= 0x18u )
            *(v1 + 68) = 0;
          if ( !*(v1 + 69) )
            goto LABEL_363;
          --*(v1 + 69);
          return;
        case 4:
          v217 = 31;
          v218 = dword_801A1184;
          do
          {
            sub_8004489C(v218, -1, -2, 3072, -90, 16, 14, 5, 512, -256, 0x200, -320, 512, -256);
            --v217;
            v218 = v1;
          }
          while ( v217 != -1 );
LABEL_363:
          v219 = &g_ObjectArray[31 * *(v1 + 70)];
          v219[10] = (v219[10] & 0xFFFFF7FF);
          goto LABEL_408;
        default:
          return;
      }
      return;
    case 7:
    case 0x31:
      goto LABEL_14;
    case 8:
      if ( *(dword_801A1184 + 7) )
      {
        if ( v4 == 1 )
        {
          v173 = &g_ParticleArray + 72 * *(dword_801A1184 + 64);
          sub_80014FAC(*(dword_801A1184 + 52), v335);
          v174 = *(v1 + 56);
          *(v1 + 20) = ((v174 * v335[0]) >> 12) + *(v173 + 5);
          v175 = *(v1 + 54);
          v176 = *(v1 + 48);
          *(v1 + 28) = ((v174 * v335[1]) >> 12) + *(v173 + 7);
          v177 = FixedPointLerp(v175, 0, v176);
          v178 = *(v1 + 48);
          *(v1 + 56) = v177;
          v179 = 25 * FixedSin(v178 << 16 >> 17);
          v180 = *(v1 + 48);
          *(v1 + 46) = v179 >> 5;
          v181 = *(v1 + 50);
          v180 += 64;
          *(v1 + 48) = v180;
          v182 = v181;
          if ( v180 >= v181 )
          {
            v183 = *(v1 + 46);
            *(v1 + 50) = v182 + 2048;
            v182 = sub_8002E4F4(*(v1 + 20), *(v1 + 24), *(v1 + 28), 256, v183, 144);
            if ( v182 )
              sub_800427EC(v182, 0x1388u, 0);
          }
          if ( *(v1 + 48) < 4096 )
          {
            if ( rand(v182) < 2048 )
              sub_8004489C(v1, -1, -2, 6144, -96, 12, 39, -17, 128, -64, 0x40, -100, 128, -64);
          }
          else
          {
            *v1 = -1;
            if ( v173[64] )
              --v173[64];
          }
        }
        return;
      }
      v158 = *(dword_801A1184 + 52) + *(dword_801A1184 + 20);
      *(dword_801A1184 + 54) += *(dword_801A1184 + 66);
      v332 = v158;
      v333 = *(v1 + 54) + *(v1 + 24);
      v334 = *(v1 + 56) + *(v1 + 28);
      v159 = sub_800424C8(&v332, 140, 0);
      v72 = v159 == 0;
      v160 = v159 & 0xF;
      if ( v72 || !v160 )
        goto LABEL_301;
      v332 = *(v1 + 20);
      v334 = *(v1 + 28);
      if ( (sub_800424C8(&v332, 140, 0) & 0xF) == 0 )
      {
        *(v1 + 56) = 0;
        *(v1 + 52) = 0;
        goto LABEL_301;
      }
      if ( *(v1 + 54) < 0 )
      {
        v161 = *(v1 + 24);
        *(v1 + 54) = 0;
        v333 = v161;
LABEL_301:
        *(v1 + 20) = v332;
        *(v1 + 24) = v333;
        *(v1 + 28) = v334;
        v171 = 2;
        if ( !g_TileLayerOffset )
          v171 = 1;
        v172 = *(v1 + 40);
        *(v1 + 10) = v171;
        *(v1 + 40) = (v172 + 300) & 0xFFF;
        sub_8004489C(v1, -1, 1024, 4096, -500, 2, 8, 0, v278, v285, v292, v299, v300, v301);
        return;
      }
      v162 = &g_ParticleArray + 72 * *(v1 + 64);
      if ( !sub_80044814(&v332, 0x2000, 0x2000, 500) )
      {
        v163 = *(v1 + 20);
        *(v1 + 7) = 1;
        *(v1 + 8) = 9;
        *(v1 + 3) = 20;
        v164 = *(v162 + 5);
        v165 = *(v162 + 7);
        v166 = *(v1 + 28);
        *(v1 + 40) = 0;
        v167 = v163 - v164;
        v168 = v166 - v165;
        *(v1 + 52) = Math_Atan2_Fixed(v167, v168);
        v169 = CalculateDistance(v167, v168);
        *(v1 + 56) = v169;
        *(v1 + 54) = v169;
        *(v1 + 48) = 0;
        *(v1 + 44) = 1024;
        *(v1 + 50) = ((1500 * rand(v170)) >> 15) + 256;
        *(v1 + 14) = 100;
        return;
      }
      if ( v162[64] )
        --v162[64];
      goto LABEL_408;
    case 9:
      v140 = *(dword_801A1184 + 64);
      if ( v140 == 254 )
      {
        v141 = 400;
        v142 = 60;
        v329 = *&g_LanguageID[0].header[2];
        v143 = 3000;
        v331 = *&g_LanguageID[0].menus[0].header.posY;
        v330 = *&g_LanguageID[0].header[6] - 1600;
      }
      else
      {
        if ( v140 == 255 )
        {
          *(dword_801A1184 + 54) += 10;
          v150 = sub_80044C74(10, 0, 0);
          v147 = v1;
          if ( v150 )
          {
LABEL_268:
            v148 = 11;
            sub_800428D0(dword_801DD594);
            v149 = v1;
            do
            {
              sub_8004489C(v149, -1, -2, 3072, -90, 16, 8, 5, 512, -256, 0x200, -256, 512, -256);
              --v148;
              v149 = v1;
            }
            while ( v148 != -1 );
            sub_80044B20((v1 + 20), 5, 1024, 0x2000, 0x4000, 4096);
LABEL_408:
            *v1 = -1;
            return;
          }
LABEL_272:
          sub_8004489C(v147, -1, -3, 3800, -80, 6, 8, 0, 1024, v285, v292, v299, v300, v301);
          return;
        }
        v141 = 600;
        v144 = &g_ObjectArray[31 * v140];
        v142 = 50;
        v329 = v144[11];
        v330 = v144[12] - (*(v144 + 15) >> 1);
        v145 = v144[13];
        v143 = 0;
        v331 = v145;
      }
      v146 = sub_80044520(&v329, v141, v142, v143, 0, 10, 0x80000000);
      v147 = v1;
      if ( v146 == -1 )
        goto LABEL_268;
      goto LABEL_272;
    case 0xA:
      if ( v4 == 1 )
        goto LABEL_331;
      if ( *(dword_801A1184 + 7) >= 2u )
      {
        if ( v4 != 5 )
          goto LABEL_334;
LABEL_321:
        *(v1 + 7) = 1;
        *(v1 + 3) = 11;
        *(v1 + 12) = 68;
        v185 = *v1;
        *(v1 + 48) = 0;
        *(v1 + 46) = 0;
        *(v1 + 44) = 0;
        *(v1 + 14) = -1;
        *v1 = v185 | 3;
LABEL_331:
        v105 = 0x4000;
        v106 = 2048;
        v107 = 75;
LABEL_332:
        sub_800446E0(v105, v106, v107, 0x400u, 0x8000);
LABEL_333:
        *(v1 + 38) += 64;
        return;
      }
      if ( *(dword_801A1184 + 7) )
        goto LABEL_334;
      if ( sub_80044C74(250, 0, 0) || *(v1 + 14) < 2 )
      {
        sub_80044B20((v1 + 20), 8, 400, 0x2000, 0x8000, 1024);
        SpawnParticleEntity(10, *v1 | 3, 0xAu, (v1 + 20), 0, v1 + 36, v263, v271, v278, v285, v292)->grind_z = 2;
        PlayEntitySound(v1, 23);
        goto LABEL_321;
      }
      v186 = *(v1 + 65);
      *(v1 + 18) = (*(v1 + 18) + 128) & 0xFFF;
      if ( v186 )
      {
        sub_80042BD4(v1, 0, v339, (v1 + 44));
        v187 = &g_ObjectArray[31 * *(v1 + 64)];
        v336[0] = v187[11];
        v336[1] = v187[12] - (*(v187 + 15) >> 1);
        v337 = v187[13];
        sub_80014DB0(v339, v336, 800, v335);
        SpawnParticleEntity(10, *v1, 7u, v339, v335, v262, v263, v271, v278, v285, v292);
        v189 = *(v1 + 65) - 1;
      }
      else
      {
        v190 = rand(v184);
        v188 = (v1 + 20);
        if ( v190 >= 2048 || (v191 = sub_8003D200(v188, *(v1 + 38), *(v1 + 36), 25000, 800, 800, v340, 512)) == 0 )
        {
LABEL_328:
          if ( rand(v188) < 1024 && sub_8003D200((v1 + 20), *(v1 + 38), *(v1 + 36), 30000, 800, 800, v340, 512) )
          {
            sub_80044784(v1, 47);
            sub_80044784(v1, 50);
          }
          return;
        }
        v188 = (v191 - g_ObjectArray);
        *(v1 + 64) = (-1108378657 * (v191 - g_ObjectArray)) >> 2;
        v189 = 5;
      }
      *(v1 + 65) = v189;
      goto LABEL_328;
    case 0xB:
    case 0x36:
      sub_800446E0(14336, *(dword_801A1184 + 64), 128, 0x400u, 0x8000);
      LOWORD(v318) = (rand(v100) >> 6) - 256;
      LOWORD(v319) = (rand(v101) >> 6) - 256;
      HIWORD(v318) = -(rand(v102) >> 7) - 128;
      SpawnParticleEntity(10, 0, 0x65u, (v1 + 20), &v318, 3072, -128, 15, 18, 10, v292);
      goto LABEL_333;
    case 0xC:
      if ( v4 == 101 )
        goto LABEL_334;
      if ( *(dword_801A1184 + 7) >= 0x66u )
      {
        if ( v4 == 102 )
        {
LABEL_207:
          *(v1 + 3) = 17;
          v111 = *v1;
          *(v1 + 48) = 0;
          *(v1 + 46) = 0;
          *(v1 + 44) = 0;
          *(v1 + 7) = 110;
          *v1 = v111 | 3;
          goto LABEL_201;
        }
        if ( v4 == 110 )
        {
LABEL_201:
          v105 = 14336;
          v106 = 799;
          v107 = 70;
          goto LABEL_332;
        }
      }
      else if ( v4 == 100 )
      {
LABEL_206:
        SpawnParticleEntity(10, *v1 | 3, 0xCu, (v1 + 20), 0, v1 + 36, v263, v271, v278, v285, v292)->grind_z = 101;
        goto LABEL_207;
      }
      if ( !*(dword_801A1184 + 7) )
        PlayEntitySound(dword_801A1184, 41);
      v108 = *(v1 + 64);
      v109 = *(v1 + 66);
      v110 = *(v1 + 68);
      ++*(v1 + 7);
      if ( sub_8004435C(v108, v109, v110, 160, 0, 6000, *(v1 + 70), 2048) != -1 )
      {
        sub_80044814((v1 + 20), 0x2000, 0x2000, 500);
        *(v1 + 40) += 128;
        sub_8004489C(v1, 2, 1024, 3072, -300, 5, 33, 0, v278, v285, v292, v299, v300, v301);
        return;
      }
      PlayEntitySound(v1, 24);
      goto LABEL_206;
    case 0xD:
    case 0x20:
      if ( !*(dword_801A1184 + 7) )
      {
        v16 = sub_80044C74(180, 0, -300);
        v18 = (v1 + 20);
        if ( v16 )
          goto LABEL_21;
        v19 = 0x2000;
        v20 = 0x2000;
        goto LABEL_124;
      }
      if ( *(dword_801A1184 + 7) >= 3u )
        goto LABEL_408;
      goto LABEL_24;
    case 0xE:
      if ( *(dword_801A1184 + 14) == 12 )
        g_PoisenStatus = 0;
      v341[0] = (rand(a1) >> 5) - 512;
      v341[1] = (rand(v243) >> 8) + 200;
      v341[2] = 1024;
      v338 = 0;
      v337 = 0;
      v244 = SpawnParticleEntity(10, 0, 0x65u, v341, &v337, 700, -30, 10, 14, -10, v292);
      v244->aggression = 3;
      v244->grid_x = 14;
      v238 = FixedSin(*(v1 + 14) << 7);
      v239 = -96;
      v240 = -76;
      v241 = -36;
      goto LABEL_394;
    case 0xF:
      if ( !word_8019B526 )
        *dword_801A1184 = -1;
      *(v1 + 38) += 128;
      return;
    case 0x10:
      if ( *(dword_801A1184 + 14) == 4 )
      {
        g_CurrentHP += 60;
        if ( g_MaxHP < g_CurrentHP )
          g_CurrentHP = g_MaxHP;
      }
      v238 = FixedSin(*(dword_801A1184 + 14) << 8);
      v239 = -26;
      v240 = -56;
      v241 = -96;
      v242 = 23000;
      goto LABEL_395;
    case 0x11:
      if ( !word_8019B528 )
        *dword_801A1184 = -1;
      *(v1 + 38) -= 128;
      return;
    case 0x13:
      v245 = 3;
      if ( *(dword_801A1184 + 14) == 12 )
      {
        g_CurrentHP += 150;
        if ( g_MaxHP < g_CurrentHP )
          g_CurrentHP = g_MaxHP;
        sub_80027280(7);
      }
      v344 = 0;
      v343 = 0;
      do
      {
        --v245;
        v342[0] = (rand(a1) >> 5) - 512;
        v342[1] = (rand(v246) >> 8) + 200;
        v342[2] = 1024;
        v247 = SpawnParticleEntity(10, 0, 0x65u, v342, &v343, 700, -30, 10, 18, -10, v292);
        v247->aggression = 3;
        v247->grid_x = 14;
      }
      while ( v245 );
      v238 = FixedSin(*(v1 + 14) << 7);
      v239 = -16;
      v240 = -16;
      v241 = -96;
LABEL_394:
      v242 = 18000;
LABEL_395:
      TriggerLightFlash(v239, v240, v241, v242, v238);
      return;
    case 0x14:
      v105 = 0x4000;
      v106 = 256;
      v107 = 32;
      goto LABEL_332;
    case 0x16:
      *(dword_801A1184 + 54) += 10;
      v50 = sub_80044C74(100, 0, -300);
      if ( v50 )
        goto LABEL_80;
      return;
    case 0x17:
      if ( v4 == 9 )
      {
        v23 = &g_ObjectArray[31 * *(dword_801A1184 + 64)];
        if ( *(v23 + 9) != 1 || *(v23 + 14) != 25 )
          goto LABEL_408;
        sub_8003EAC0(&g_ObjectArray[31 * *(dword_801A1184 + 64)], *(dword_801A1184 + 66), &v309);
        v24 = sub_8003EBC0(v23, &v313);
        v25 = *(v1 + 24);
        v26 = *(v1 + 28);
        v27 = *(v1 + 32);
        v316 = *(v1 + 20);
        v317 = v25;
        v318 = v26;
        v319 = v27;
        *(v1 + 20) = v309 + *v24;
        *(v1 + 24) = v310 + v24[1];
        v28 = *(v1 + 44) + 512;
        v29 = v311 + v24[2];
        *(v1 + 44) = v28;
        *(v1 + 28) = v29;
        if ( v28 >= 6145 )
          *(v1 + 44) = 6144;
        v30 = *(v1 + 44);
        *(v1 + 48) = v30;
        *(v1 + 46) = v30;
        *(v1 + 52) = *(v1 + 20) - v316;
        *(v1 + 54) = *(v1 + 24) - v317;
        v31 = *(v1 + 44);
        *(v1 + 56) = *(v1 + 28) - v318;
        sub_8004489C(v1, -1, -700, v31, -300, 3, 8, 0, v278, v285, v292, v299, v300, v301);
        if ( *(v23 + 12) >= *(v1 + 68) )
        {
          sub_8003EEB0(v23, &g_LanguageID[0].header[2], 650, (v1 + 20), (v1 + 52), -1, 1024, 5);
          *(v1 + 7) = 0;
          *(v1 + 14) = 50;
        }
      }
      else
      {
        sub_8004489C(dword_801A1184, -1, 256, *(dword_801A1184 + 44), -300, 2, 8, 0, v278, v285, v292, v299, v300, v301);
LABEL_14:
        if ( v4 )
        {
          v17 = v4 + 0x80;
          if ( v4 >= 3 )
            goto LABEL_408;
        }
        else
        {
          v16 = sub_80044C74(180, 0, -300);
          if ( !v16 )
            return;
          sub_80044B20((v1 + 20), 3, 400, 0x2000, 0x2000, 1024);
LABEL_21:
          sub_80044DF8();
          sub_800428D0(v16);
          *(v1 + 7) = 1;
LABEL_24:
          v17 = v4 + 0x80;
        }
        *(v1 + 4) = v17;
        v21 = *(v1 + 44) + 2048;
        v22 = *(v1 + 7) + 1;
        *(v1 + 44) = v21;
        *(v1 + 46) = v21;
        *(v1 + 48) = v21;
        *(v1 + 7) = v22;
      }
      return;
    case 0x18:
      v345[0] = *&g_LanguageID[0].header[2];
      v345[2] = *&g_LanguageID[0].menus[0].header.posY;
      v345[1] = *&g_LanguageID[0].header[6] - 1600;
      v255 = 11;
      if ( sub_80044520(v345, 300, 40, 2000, 0, 10, 0) == -1 )
      {
        sub_800428D0(dword_801DD594);
        v256 = v1;
        do
        {
          sub_8004489C(v256, -1, -2, 3072, -90, 16, 14, 5, 512, -256, 0x200, -256, 512, -256);
          --v255;
          v256 = v1;
        }
        while ( v255 != -1 );
        goto LABEL_408;
      }
      if ( rand(v254) < 0x4000 )
        SpawnParticleEntity(10, 0, 0x6Du, (v1 + 20), (v1 + 52), dword_801A1188, v269, v271, v278, v285, v292);
      return;
    case 0x19:
      v34 = -30;
      goto LABEL_43;
    case 0x1A:
    case 0x1B:
      v63 = (dword_801A1184 + 20);
      *dword_801A1184 = 33;
      v64 = *(v1 + 44);
      *(v1 + 38) += 100;
      sub_80042938(v63, 0, v64, 0x8000, 0x400u, 4096);
      v65 = *(v1 + 64);
      *v1 = 36;
      if ( !v65 )
      {
        if ( sub_80044C74(100, 200, 0) )
        {
          *(v1 + 56) = 0;
          *(v1 + 54) = 0;
          *(v1 + 52) = 0;
        }
        return;
      }
      if ( v65 != 1 )
        return;
      v66 = *(v1 + 48) - 512;
      *(v1 + 48) = v66;
      if ( v66 << 16 > 0 )
        return;
      goto LABEL_408;
    case 0x1C:
      v59 = 250;
LABEL_114:
      v60 = *(dword_801A1184 + 64);
      if ( v60 == 2 )
      {
        v61 = *(dword_801A1184 + 16) + 256;
        *(dword_801A1184 + 16) = v61;
        if ( v61 < 4096 )
          return;
        goto LABEL_408;
      }
      if ( v60 == 1 )
        *(dword_801A1184 + 54) += 13;
      *(v1 + 36) += 200;
      v62 = sub_80044C74(v59, 2 * v59, 250);
      v18 = (v1 + 20);
      if ( v62 )
      {
        sub_800428D0(v62);
        if ( *(v1 + 64) == 1 )
        {
          *(v1 + 64) = 2;
          *(v1 + 9) = 1;
          *(v1 + 12) = 66;
          *(v1 + 16) = 1024;
          return;
        }
        sub_80044DF8();
        *(v1 + 64) = 1;
        *(v1 + 56) = 0;
        *(v1 + 52) = 0;
        *(v1 + 54) = -100;
        v18 = (v1 + 20);
      }
      v19 = 0x4000;
      v20 = 0x4000;
      goto LABEL_124;
    case 0x1D:
    case 0x1F:
    case 0x30:
      v5 = 10;
      goto LABEL_4;
    case 0x1E:
    case 0x2F:
      v5 = 5;
LABEL_4:
      if ( *(dword_801A1184 + 7) )
        return;
      if ( !*(dword_801A1184 + 66) )
        PlayPositionalSound3D_Wrap(5, (dword_801A1184 + 20), 110, 28000, 29000, 0);
      v6 = *(v1 + 66) + 1;
      v7 = *(v1 + 54) * v6;
      v8 = *(v1 + 24);
      v9 = *(v1 + 64);
      *(v1 + 66) = v6;
      v303 = (v9 + v7 + ((v5 * v6 * v6) >> 1));
      v302 = (*(v1 + 52) + *(v1 + 20));
      v304 = (*(v1 + 56) + *(v1 + 28));
      v10 = sub_800424C8(&v302, 20, 20);
      v11 = (v1 + 20);
      if ( !v10 )
      {
        v306 = (v302 + *(v1 + 20)) >> 1;
        v307 = (v303 + *(v1 + 24)) >> 1;
        v308 = (v304 + *(v1 + 28)) >> 1;
        v10 = sub_800424C8(&v306, 20, 20);
        v11 = (v1 + 20);
      }
      *(v1 + 20) = v302;
      *(v1 + 24) = v303;
      *(v1 + 28) = v304;
      sub_80044814(v11, 0x2000, 0x2000, 500);
      if ( v10 )
      {
        sub_800428D0(v10 | 0x20000);
        goto LABEL_408;
      }
      v12 = 2;
      if ( !g_TileLayerOffset )
        v12 = 1;
      v13 = *(v1 + 52);
      v14 = *(v1 + 56);
      v15 = *(v1 + 24);
      *(v1 + 10) = v12;
      sub_800159DC(v13, v15 - v8, v14, (v1 + 36));
      return;
    case 0x21:
      v151 = 3800;
      goto LABEL_275;
    case 0x22:
    case 0x23:
      v34 = 0;
LABEL_43:
      v35 = sub_80044C74(250, 100, v34);
      if ( v35 )
      {
        if ( (v35 & 0xF) != 0 )
          *v1 = -1;
        v18 = (v1 + 20);
        if ( !*(v1 + 64) )
        {
          *(v1 + 64) = 1;
          sub_800428D0(v35);
          v18 = (v1 + 20);
        }
      }
      else
      {
        *(v1 + 64) = 0;
        v18 = (v1 + 20);
      }
      v19 = 0x2000;
      v20 = 0x2000;
      goto LABEL_124;
    case 0x26:
      goto LABEL_84;
    case 0x27:
      if ( *(dword_801A1184 + 14) < 45 )
      {
        v52 = sub_8004435C(600, 40, 36, 50, 100, 4096, 260, 2048);
        v18 = (v1 + 20);
        if ( v52 != -1 )
          goto LABEL_98;
LABEL_87:
        if ( (dword_801DD594 & 0x10) != 0 )
        {
          if ( !*(v1 + 64) )
          {
            v53 = 11;
            sub_800428D0(dword_801DD594);
            goto LABEL_93;
          }
          *(v1 + 64) = 1;
        }
        else
        {
          *(v1 + 64) = 0;
        }
        v53 = 11;
LABEL_93:
        v54 = v1;
        do
        {
          sub_8004489C(v54, -1, -2, 3072, -90, 16, 14, 5, 512, -256, 0x200, -256, 512, -256);
          --v53;
          v54 = v1;
        }
        while ( v53 != -1 );
        if ( (dword_801DD594 & 0xF) != 0 )
          *v1 = -1;
        v18 = (v1 + 20);
        goto LABEL_98;
      }
      *(dword_801A1184 + 54) += 10;
LABEL_84:
      v51 = sub_80044C74(100, 0, 0);
      v18 = (v1 + 20);
      if ( v51 )
        goto LABEL_87;
LABEL_98:
      v19 = 0x2000;
      v20 = 0x2000;
LABEL_124:
      sub_80044814(v18, v19, v20, 500);
      return;
    case 0x28:
      v50 = sub_80044C74(100, 200, 0);
      v18 = (v1 + 20);
      if ( v50 )
      {
LABEL_80:
        sub_800428D0(v50);
        goto LABEL_408;
      }
      v19 = 0x2000;
      v20 = 0x2000;
      goto LABEL_124;
    case 0x2A:
      if ( *(dword_801A1184 + 64) )
        --*(dword_801A1184 + 64);
      else
        sub_800446E0(14336, 504, 70, 0x800u, 0x8000);
      return;
    case 0x2D:
      sub_800446E0(0x4000, *(dword_801A1184 + 64), 70, 0x800u, 0x8000);
      return;
    case 0x2E:
      *(dword_801A1184 + 20) += *(dword_801A1184 + 52);
      v36 = *(v1 + 65);
      *(v1 + 28) += *(v1 + 56);
      v37 = &g_ParticleArray + 72 * v36;
      if ( !*(v1 + 64) )
      {
        v38 = sub_8002E4F4(*(v1 + 20), *(v1 + 24), *(v1 + 28), 10, *(v1 + 46), 48);
        sub_800428D0(v38);
        MAP_CollisionWithTile(*(v1 + 20), *(v37 + 6), *(v1 + 28), 0, 0);
        *(v1 + 24) = g_FinalResultHeight;
        if ( g_FinalResultHeight - g_CurrentWallTopY > 0x7FFF )
          *(v1 + 46) = 0x7FFF;
        else
          *(v1 + 46) = g_FinalResultHeight - g_CurrentWallTopY;
        if ( *v37 == 255 )
        {
          v39 = *(v1 + 46);
          *(v1 + 64) = 1;
          *(v1 + 66) = 0;
          *(v1 + 50) = v39;
        }
        return;
      }
      if ( *(v1 + 64) != 1 )
        return;
      v40 = FixedPointLerp(*(v1 + 50), 0, *(v1 + 66));
      v41 = *(v1 + 66);
      *(v1 + 46) = v40;
      v41 += 512;
      *(v1 + 66) = v41;
      if ( v41 < 4096 )
        return;
      goto LABEL_408;
    case 0x32:
      v55 = *(dword_801A1184 + 64);
      if ( v55 == 1 )
      {
        if ( sub_80044C74(512, &unk_80000200, 0) )
        {
          *(v1 + 64) = 2;
          sub_80042938((v1 + 20), 0, 1024, 0x8000, 0x1000u, 4096);
        }
      }
      else if ( v55 >= 2 )
      {
        if ( v55 == 2 )
        {
          if ( *(dword_801A1184 + 44) >= 512 )
            *dword_801A1184 = -1;
          v58 = *(v1 + 48) + 64;
          *(v1 + 48) = v58;
          *(v1 + 46) = v58;
          *(v1 + 44) = v58;
        }
      }
      else if ( !*(dword_801A1184 + 64) )
      {
        v56 = (dword_801A1184 + 20);
        v57 = *(dword_801A1184 + 48) + 64;
        *(dword_801A1184 + 48) = v57;
        *(v1 + 46) = v57;
        *(v1 + 44) = v57;
        Local2World(0, v56);
        if ( *(v1 + 44) >= 256 )
        {
          *(v1 + 64) = 1;
          CalculateTrajectory(1000, 0, (v1 + 52), v320);
        }
      }
      return;
    case 0x33:
      sub_800446E0(4096, 1024, 128, 0x800u, 0x8000);
      return;
    case 0x34:
      sub_800446E0(4096, 2048, 256, 0x800u, 0x8000);
      return;
    case 0x35:
      v151 = 7600;
LABEL_275:
      v305[0] = *&g_LanguageID[0].header[2];
      v305[2] = *&g_LanguageID[0].menus[0].header.posY;
      v305[1] = *&g_LanguageID[0].header[6] - 1600;
      v152 = sub_80044520(v305, 400, 60, 3000, 0, 10, 0);
      sub_80044814((v1 + 20), 0x2000, 0x2000, 500);
      if ( v152 == -1 )
      {
        v153 = 11;
        sub_800428D0(dword_801DD594);
        v154 = v1;
        do
        {
          sub_8004489C(v154, -1, -2, 3072, -90, 16, 33, 5, 512, -256, 0x200, -256, 512, -256);
          --v153;
          v154 = v1;
        }
        while ( v153 != -1 );
        *v1 = -1;
      }
      sub_8004489C(v1, -1, -3, v151, -v151 / 48, 6, 33, 0, 1024, v285, v292, v299, v300, v301);
      return;
    case 0x64:
      if ( *(dword_801A1184 + 7) >= 0x64u )
        goto LABEL_214;
      if ( (v4 - 4) < 0x43 )
      {
        if ( sub_8004435C(600, 30, 64, 100, 0, 4096, 360, 2048) != -1 )
        {
          sub_80044814((v1 + 20), 0x2000, 0x2000, 500);
          *(v1 + 40) += 128;
          sub_8004489C(v1, 5, 1024, 2048, -150, 10, 8, 0, v278, v285, v292, v299, v300, v301);
LABEL_334:
          ++*(v1 + 7);
          return;
        }
      }
      else
      {
        *(dword_801A1184 + 54) += 10;
        if ( !sub_80044C74(100, 0, 0) )
        {
          sub_80044814((v1 + 20), 0x2000, 0x2000, 500);
          goto LABEL_334;
        }
      }
LABEL_214:
      SpawnParticleEntity(10, *v1 | 3, 0x14u, (v1 + 20), &v321, v262, v263, v271, v278, v285, v292);
      PlayEntitySound(v1, 24);
      *v1 = -1;
      goto LABEL_334;
    case 0x65:
      v229 = *(dword_801A1184 + 54) + *(dword_801A1184 + 66);
      *(dword_801A1184 + 20) += *(dword_801A1184 + 52);
      v230 = *(v1 + 56);
      v231 = *(v1 + 28);
      *(v1 + 54) = v229;
      v232 = *(v1 + 44);
      v233 = *(v1 + 64);
      *(v1 + 28) = v230 + v231;
      v234 = *(v1 + 54);
      v235 = *(v1 + 24);
      v236 = v232 + v233;
      *(v1 + 44) = v236;
      *(v1 + 48) = v236;
      *(v1 + 46) = v236;
      *(v1 + 24) = v234 + v235;
      return;
    case 0x66:
      ++*(dword_801A1184 + 7);
      v237 = FixedSin(*(v1 + 7) << 8);
      v72 = *(v1 + 7) < 8u;
      *(v1 + 46) = (v237 * *(v1 + 64)) >> 12;
      if ( !v72 )
        goto LABEL_408;
      return;
    case 0x67:
    case 0x79:
      if ( *(dword_801A1184 + 7) == 2 )
      {
        v79 = *(dword_801A1184 + 44) - 128;
        *(dword_801A1184 + 44) = v79;
        v80 = *(v1 + 44);
        *(v1 + 46) = v79;
        if ( v80 > 0 )
          return;
        goto LABEL_408;
      }
      v81 = sub_80044C74(50, 0, -300);
      v72 = v81 == 0;
      v82 = v81 & 0xF;
      if ( v72 )
        goto LABEL_162;
      if ( !v82 )
        goto LABEL_161;
      if ( v4 )
      {
        sub_80044DF8();
        MAP_CollisionWithTile(*(v1 + 20), *(v1 + 24), *(v1 + 28), 50, 0);
        if ( g_FinalResultHeight >= g_CeilingHeight )
          v312 = g_CeilingHeight;
        else
          v312 = g_FinalResultHeight;
        v83 = v312 - *(v1 + 24);
      }
      else
      {
        sub_80044DF8();
        *(v1 + 56) = 0;
        *(v1 + 52) = 0;
LABEL_161:
        *(v1 + 7) = 1;
LABEL_162:
        v84 = 0;
        if ( v4 != 1 )
        {
          v88 = 3;
          if ( !v4 )
          {
            v91 = *(v1 + 64);
            *(v1 + 64) = v91 - 1;
            if ( v91 << 16 <= 0 )
            {
              *(v1 + 7) = 1;
              v88 = 3;
            }
          }
          goto LABEL_173;
        }
        v85 = *(v1 + 52);
        *(v1 + 54) -= 70;
        v86 = FixedPointLerp(0, v85, 3000);
        v87 = *(v1 + 56);
        *(v1 + 52) = v86;
        *(v1 + 56) = FixedPointLerp(0, v87, 3000);
        v84 = g_FinalResultHeight;
        if ( g_FinalResultHeight >= g_CeilingHeight )
          v312 = g_CeilingHeight;
        else
          v312 = g_FinalResultHeight;
        v83 = v312 - *(v1 + 24);
        v88 = 3;
        if ( v83 < 7000 )
        {
          do
          {
LABEL_173:
            --v88;
            LOWORD(v314) = (rand(v84) >> 7) - 128;
            HIWORD(v314) = (rand(v92) >> 7) - 128;
            v315 = (rand(v93) >> 7) - 128;
            SpawnParticleEntity(10, 0, 0x65u, (v1 + 20), &v314, 2048, -128, 5, 18, 0, v292);
          }
          while ( v88 != -1 );
          return;
        }
      }
      v89 = *(v1 + 20);
      *(v1 + 7) = 2;
      v311 = v89;
      v313 = *(v1 + 28);
      v90 = 122;
      if ( v3 == 103 )
        v90 = 104;
      SpawnParticleEntity(10, *v1 | 3, v90, &v311, &v314, v83, v263, v271, v278, v285, v292);
      SpawnParticleEntity(10, *v1, 2u, &v311, &v314, v83 >> 1, v83 >> 4, 2048, v283, v290, v297);
      PlayEntitySound(v1, 23);
      v88 = 3;
      goto LABEL_173;
    case 0x68:
    case 0x7A:
      v94 = v4 & 1;
      if ( *(dword_801A1184 + 7) < 3u )
      {
        v95 = sub_8005DC50(*(dword_801A1184 + 46) * ((*(dword_801A1184 + 46) * *(dword_801A1184 + 46)) >> 12));
        v96 = sub_8005DC50(v95) >> 3;
        v97 = 54;
        if ( v3 == 104 )
          v97 = 11;
        SpawnParticleEntity(10, *v1 | 3, v97, (v1 + 20), &v316, v96, v263, v271, v278, v285, v292);
        v94 = v4 & 1;
      }
      v72 = *(v1 + 7) >= 9u;
      *(v1 + 4) = v94 + 0x80;
      if ( !v72 )
      {
        v98 = sub_80015990(
                *&g_LanguageID[0].header[2] - *(v1 + 20),
                *&g_LanguageID[0].header[6] - *(v1 + 24),
                *&g_LanguageID[0].menus[0].header.posY - *(v1 + 28));
        if ( v98 < 32001 )
        {
          v99 = FixedSin(*(v1 + 7) << 8);
          TriggerLightFlash(0xC8u, 0xB4u, 0xA0u, 32000, ((v99 >> 1) + 1024) * (32000 - v98) / 32000);
        }
      }
      goto LABEL_334;
    case 0x69:
      *(dword_801A1184 + 40) += 800;
      if ( v4 == 2 )
      {
        v130 = *(v1 + 44) - 128;
        v131 = *(v1 + 54) + 5;
        *(v1 + 44) = v130;
        *(v1 + 46) = v130;
        *(v1 + 54) = v131;
      }
      else
      {
        v127 = *(v1 + 65);
        if ( v127 != 255 )
        {
          v128 = &g_ObjectArray[31 * v127];
          sub_8003EAC0(v128, *(v1 + 66), &v325);
          v129 = sub_8003EBC0(v128, v328);
          v321 = v325 + *v129;
          v322 = v326 + v129[1];
          v323 = v327 + v129[2];
          if ( v4 )
          {
            if ( v4 != 1 )
              return;
          }
          else
          {
            v134 = sub_80044520(&v321, 300, 50, 500, 150, 10, 0);
            if ( v134 != -2 )
            {
              if ( v134 != -1 || (dword_801DD594 & 0xF) == 0 )
                return;
              v136 = &g_ParticleArray + 72 * *(v1 + 64);
              if ( *(v136 + 33) )
                --*(v136 + 33);
              goto LABEL_408;
            }
            v135 = &g_ParticleArray + 72 * *(v1 + 64);
            if ( *(v135 + 33) )
              --*(v135 + 33);
            *(v1 + 7) = 1;
          }
          v137 = v322;
          v138 = v323;
          v139 = v324;
          *(v1 + 20) = v321;
          *(v1 + 24) = v137;
          *(v1 + 28) = v138;
          *(v1 + 32) = v139;
          if ( *(v1 + 14) < 2 )
          {
            *(v1 + 7) = 2;
            *(v1 + 14) = (rand(v138) >> 12) + 16;
            *(v1 + 52) = v325 >> 1;
            *(v1 + 54) = v326 >> 1;
            *(v1 + 56) = v327 >> 1;
          }
          return;
        }
      }
      v132 = sub_80044C74(100, 0, 0);
      v72 = v132 == 0;
      v133 = v132 & 0xF;
      if ( v72 || !v133 )
        return;
      goto LABEL_408;
    case 0x6A:
      if ( !*(dword_801A1184 + 7) )
      {
        *(dword_801A1184 + 54) += 20;
        if ( sub_80044C74(140, 0, -300) )
        {
          v155 = *(v1 + 54);
          v156 = *(v1 + 56);
          *(v1 + 20) -= *(v1 + 52);
          v157 = *(v1 + 28) - v156;
          *(v1 + 24) -= v155;
          *(v1 + 28) = v157;
          sub_80044EC0(1, 0, -400, 60);
          sub_80044EC0(6, 60, -330, 56);
          sub_80044EC0(8, 140, -170, 40);
          PlayEntitySound(v1, 37);
          *(v1 + 64) = 15;
          *(v1 + 7) = 1;
        }
        else
        {
          sub_8004489C(v1, -1, -3, 6000, -800, 6, 8, 0, -1024, v285, v292, v299, v300, v301);
        }
        return;
      }
      if ( v4 != 1 || *(dword_801A1184 + 64) )
        return;
      goto LABEL_408;
    case 0x6B:
      v220 = &g_ParticleArray + 72 * *(dword_801A1184 + 64);
      if ( !*(dword_801A1184 + 7) && v220[7] >= 3u )
      {
        v221 = *(dword_801A1184 + 65);
        *(dword_801A1184 + 7) = 1;
        *(v1 + 14) = 3 * v221;
      }
      if ( v220[7] == 4 )
        goto LABEL_408;
      v222 = v220[68] - 3 * *(v1 + 65);
      v223 = 2 * v222;
      if ( v222 < 0 )
      {
        v222 += 24;
        v223 = 2 * v222;
      }
      v224 = (8 * (v223 + v222) + *(v220 + 16));
      v225 = v224[1];
      v226 = v224[2];
      v227 = v224[3];
      *(v1 + 20) = *v224;
      *(v1 + 24) = v225;
      *(v1 + 28) = v226;
      *(v1 + 32) = v227;
      v228 = v224[5];
      *(v1 + 36) = v224[4];
      *(v1 + 40) = v228;
      return;
    case 0x6D:
      sub_80044520(&unk_8019ED94 + 18 * *(dword_801A1184 + 64), 500, 15, -1, 0, 0, -1);
      return;
    case 0x6F:
      v67 = *(dword_801A1184 + 64);
      if ( v67 == 255 )
      {
        v302 = *(dword_801A1184 + 20);
        v303 = *(dword_801A1184 + 24);
        v68 = *(dword_801A1184 + 28);
        v69 = 1000;
        LOWORD(v310) = 0;
        v309 = 0;
        v304 = v68;
      }
      else
      {
        v70 = &g_ObjectArray[31 * v67];
        v69 = *(v70 + 14);
        v302 = v70[11];
        v304 = v70[13];
        v303 = v70[12];
        a1 = v70[21];
        v309 = v70[20];
        v310 = a1;
      }
      v302 = (v302 + ((rand(a1) * v69) >> 14) - v69);
      v303 = (v303 - 2000);
      v304 = (v304 + ((rand(v71) * v69) >> 14) - v69);
      SpawnParticleEntity(10, *v1 | 3, 0, &v302, &v309, v262, v263, v271, v278, v285, v292);
      return;
    case 0x71:
      if ( sub_80044C74(180, 360, 0) || (v19 = 0x2000, *(v1 + 14) < 2) )
      {
        SpawnParticleEntity(10, *v1 | 3, 0x2Au, (v1 + 20), 0, 0, v263, v271, v278, v285, v292);
        SpawnParticleEntity(10, *v1 | 3, 0x2Au, (v1 + 20), 0, 1, v267, v275, v281, v288, v295);
        SpawnParticleEntity(10, *v1 | 3, 0x2Au, (v1 + 20), 0, 2, v268, v276, v282, v289, v296);
        PlayEntitySound(v1, 23);
        goto LABEL_408;
      }
      v18 = (v1 + 20);
      v20 = 0x2000;
      goto LABEL_124;
    case 0x72:
      v248 = *(dword_801A1184 + 24);
      v249 = *(dword_801A1184 + 28);
      *(dword_801A1184 + 20) += *(dword_801A1184 + 52);
      v250 = *(v1 + 56) + v249;
      *(v1 + 24) = *(v1 + 54) + v248;
      *(v1 + 28) = v250;
      if ( sub_8002E4F4(*(v1 + 20), *(v1 + 24), *(v1 + 28), 10, 10, 176) )
        goto LABEL_402;
      MAP_CollisionWithTile(*(v1 + 20), *(v1 + 68), *(v1 + 28), 0, 0);
      v252 = 1;
      if ( *(v1 + 24) < g_FinalResultHeight )
      {
        do
        {
          --v252;
          v253 = rand(v251);
          sub_8004489C(v1, (20 * v253) >> 15, -3, 6000, -200, 5, 39, 0, 256, v285, v292, v299, v300, v301);
        }
        while ( v252 != -1 );
        return;
      }
      *(v1 + 24) = g_FinalResultHeight;
LABEL_402:
      SpawnParticleEntity(10, *v1 | 3, 3u, (v1 + 20), 0, 0, v263, v271, v278, v285, v292);
      goto LABEL_408;
    case 0x73:
      if ( sub_8004435C(600, 40, 36, 180, 360, 4096, 260, 2048) == -1 || (v18 = (v1 + 20), *(v1 + 14) < 2) )
      {
        sub_80044DF8();
        SpawnParticleEntity(10, *v1 | 3, 0x2Au, (v1 + 20), 0, 0, v264, v272, v278, v285, v292);
        SpawnParticleEntity(10, *v1 | 3, 0x2Au, (v1 + 20), 0, 1, v265, v273, v279, v286, v293);
        SpawnParticleEntity(10, *v1 | 3, 0x2Au, (v1 + 20), 0, 2, v266, v274, v280, v287, v294);
        PlayEntitySound(v1, 24);
        goto LABEL_408;
      }
      v19 = 0x2000;
      v20 = 0x2000;
      goto LABEL_124;
    case 0x74:
      v306 = (*(dword_801A1184 + 52) << 16 >> 17) + *(dword_801A1184 + 20);
      v307 = (*(dword_801A1184 + 54) << 16 >> 17) + *(dword_801A1184 + 24);
      v308 = (*(dword_801A1184 + 56) << 16 >> 17) + *(dword_801A1184 + 28);
      v42 = *(dword_801A1184 + 24);
      v43 = *(dword_801A1184 + 28);
      *(dword_801A1184 + 20) += *(dword_801A1184 + 52);
      v44 = *(v1 + 56) + v43;
      *(v1 + 24) = *(v1 + 54) + v42;
      *(v1 + 28) = v44;
      if ( CollisionWithTilemap(v306, v307, v308, 5, 10)
        || CollisionWithTilemap(*(v1 + 20), *(v1 + 24), *(v1 + 28), 5, 10) )
      {
        *v1 = -1;
      }
      SpawnParticleEntity(10, *v1, 0x2Du, (v1 + 20), 0, 420, v263, v271, v278, v285, v292);
      return;
    case 0x75:
      v45 = *(dword_801A1184 + 54);
      v46 = *(dword_801A1184 + 24);
      *(dword_801A1184 + 20) += *(dword_801A1184 + 52);
      v47 = *(v1 + 56);
      *(v1 + 24) = v45 + v46;
      v48 = *(v1 + 20);
      *(v1 + 28) += v47;
      v302 = v48;
      v303 = (*(v1 + 24) + 5000);
      v304 = *(v1 + 28);
      v49 = Entity_CheckWorldCollision(v48, v303, v304, 100, 10000);
      if ( v49 != -1 )
        SpawnParticleEntity(10, *v1, 0x2Du, &unk_8016E634 + 31 * v49, 0, 1260, v263, v271, v278, v285, v292);
      sub_80044814(&v302, 0x2000, 0x7FFF, 10000);
      return;
    case 0x76:
      v103 = 51;
      goto LABEL_188;
    case 0x77:
      v103 = 52;
LABEL_188:
      if ( !sub_80044C74(140, 0, -200) )
        return;
      SpawnParticleEntity(10, *v1 | 3, v103, (v1 + 20), 0, v262, v263, v271, v278, v285, v292);
      goto LABEL_408;
    case 0x78:
      v72 = *(dword_801A1184 + 44) >= 4096;
      *(dword_801A1184 + 54) += 20;
      if ( !v72 )
      {
        v257 = *(v1 + 48) + 512;
        *(v1 + 48) = v257;
        *(v1 + 46) = v257;
        *(v1 + 44) = v257;
      }
      v258 = rand(a1);
      v259 = 180;
      if ( v258 < 400 )
        goto LABEL_418;
      v260 = sub_80044C74(180, 0, -300);
      v72 = v260 == 0;
      v261 = v260 & 5;
      if ( !v72 && v261 )
      {
        *(v1 + 24) = g_FinalResultHeight;
LABEL_418:
        if ( rand(v259) < 0x2000 )
        {
          SpawnParticleEntity(10, *v1 | 3, 0x2Au, (v1 + 20), 0, 0, v263, v271, v278, v285, v292);
          SpawnParticleEntity(10, *v1 | 3, 0x2Au, (v1 + 20), 0, 1, v270, v277, v284, v291, v298);
          PlayEntitySound(v1, 24);
        }
        *v1 = -1;
      }
LABEL_421:
      *(v1 + 40) += 2700;
      return;
    default:
      return;
  }
}
// 80046B2C: conditional instruction was optimized away because $a1.4 is in (1..FF)
// 80047C38: conditional instruction was optimized away because $s4.4 is in (1..FFFF)
// 80045430: variable 'v278' is possibly undefined
// 80045430: variable 'v285' is possibly undefined
// 80045430: variable 'v292' is possibly undefined
// 80045430: variable 'v299' is possibly undefined
// 80045430: variable 'v300' is possibly undefined
// 80045430: variable 'v301' is possibly undefined
// 80045658: variable 'v264' is possibly undefined
// 80045658: variable 'v272' is possibly undefined
// 8004567C: variable 'v265' is possibly undefined
// 8004567C: variable 'v273' is possibly undefined
// 8004567C: variable 'v279' is possibly undefined
// 8004567C: variable 'v286' is possibly undefined
// 8004567C: variable 'v293' is possibly undefined
// 800456A0: variable 'v266' is possibly undefined
// 800456A0: variable 'v274' is possibly undefined
// 800456A0: variable 'v280' is possibly undefined
// 800456A0: variable 'v287' is possibly undefined
// 800456A0: variable 'v294' is possibly undefined
// 8004570C: variable 'v263' is possibly undefined
// 8004570C: variable 'v271' is possibly undefined
// 80045730: variable 'v267' is possibly undefined
// 80045730: variable 'v275' is possibly undefined
// 80045730: variable 'v281' is possibly undefined
// 80045730: variable 'v288' is possibly undefined
// 80045730: variable 'v295' is possibly undefined
// 80045754: variable 'v268' is possibly undefined
// 80045754: variable 'v276' is possibly undefined
// 80045754: variable 'v282' is possibly undefined
// 80045754: variable 'v289' is possibly undefined
// 80045754: variable 'v296' is possibly undefined
// 80045F8C: variable 'v71' is possibly undefined
// 80045FD4: variable 'v262' is possibly undefined
// 80046298: variable 'v283' is possibly undefined
// 80046298: variable 'v290' is possibly undefined
// 80046298: variable 'v297' is possibly undefined
// 800462E0: variable 'v84' is possibly undefined
// 800462F0: variable 'v92' is possibly undefined
// 80046300: variable 'v93' is possibly undefined
// 800464B8: variable 'v100' is possibly undefined
// 800464C8: variable 'v101' is possibly undefined
// 800464D8: variable 'v102' is possibly undefined
// 80047348: variable 'v170' is possibly undefined
// 80047584: variable 'v182' is possibly undefined
// 8004779C: variable 'v184' is possibly undefined
// 80047828: variable 'v188' is possibly undefined
// 80048078: variable 'v243' is possibly undefined
// 8004816C: variable 'a1' is possibly undefined
// 8004817C: variable 'v246' is possibly undefined
// 80048344: variable 'v251' is possibly undefined
// 80048470: variable 'v254' is possibly undefined
// 800484A0: variable 'v269' is possibly undefined
// 80048568: variable 'v259' is possibly undefined
// 800485B8: variable 'v270' is possibly undefined
// 800485B8: variable 'v277' is possibly undefined
// 800485B8: variable 'v284' is possibly undefined
// 800485B8: variable 'v291' is possibly undefined
// 800485B8: variable 'v298' is possibly undefined
// 8005DC50: using guessed type int __fastcall sub_8005DC50(_DWORD);
// 80062BF0: using guessed type int __fastcall rand(_DWORD);
// 8019B4D6: using guessed type __int16 g_MaxHP;
// 8019B4D8: using guessed type __int16 g_CurrentHP;
// 8019B518: using guessed type __int16 g_PoisenStatus;
// 8019B526: using guessed type __int16 word_8019B526;
// 8019B528: using guessed type __int16 word_8019B528;
// 801A1180: using guessed type int dword_801A1180;
// 801A1184: using guessed type int dword_801A1184;
// 801A1188: using guessed type int dword_801A1188;
// 801DD57E: using guessed type __int16 g_TileLayerOffset;
// 801DD584: using guessed type int g_FinalResultHeight;
// 801DD588: using guessed type int g_CurrentWallTopY;
// 801DD58C: using guessed type int g_CeilingHeight;
// 801DD594: using guessed type int dword_801DD594;
// 801DD598: using guessed type int dword_801DD598;
// 80045018: using guessed type char var_E8[8];
// 80045018: using guessed type char var_C0[16];
// 80045018: using guessed type _DWORD var_78[4];

//----- (8004860C) --------------------------------------------------------
BOOL InitParticleSystem()
{
  _BYTE *v0; // $a0
  int v1; // $v1
  BOOL result; // $v0

  v0 = &g_ParticleArray;
  v1 = 0;
  do
  {
    *v0 = -1;
    result = ++v1 < 0x80u;
    v0 += 72;
  }
  while ( v1 < 0x80u );
  return result;
}

//----- (80048668) --------------------------------------------------------
BOOL __fastcall UpdateParticleSystem(int a1)
{
  _BYTE *v1; // $s0
  __int16 *v2; // $s1
  __int16 v3; // $v1
  BOOL result; // $v0

  v1 = &g_ParticleArray;
  v2 = &unk_8019ED8E;
  dword_801A1188 = 0;
  do
  {
    if ( *v1 != 255 )
    {
      dword_801A1184 = v1;
      dword_801A1180 = g_SpellEntryTable + 26 * *(v2 - 13);
      v3 = *v2;
      if ( *v2 == -1 || (*v2 = v3 - 1, (v3 - 1) != -1) )
        UpdateParticleEffect(a1);
      else
        *v1 = -1;
    }
    v2 += 36;
    result = ++dword_801A1188 < 128;
    v1 += 72;
  }
  while ( dword_801A1188 < 128 );
  return result;
}
// 80048718: variable 'a1' is possibly undefined
// 801A1180: using guessed type int dword_801A1180;
// 801A1184: using guessed type int dword_801A1184;
// 801A1188: using guessed type int dword_801A1188;

//----- (80048768) --------------------------------------------------------
int sub_80048768()
{
  return PlaySoundEffect(64, 100);
}

//----- (8004878C) --------------------------------------------------------
int __fastcall sub_8004878C(int a1)
{
  return PlaySoundEffect(a1, 100);
}

//----- (800487AC) --------------------------------------------------------
BOOL __fastcall IsFacingFountainTile(VECTOR *pos, SVECTOR *rot)
{
  int sin_yaw; // $v0
  int vy; // $a0
  int cos_yaw; // $v0
  int x; // $s0

  sin_yaw = FixedSin(rot->vy);
  vy = rot->vy;
  x = pos->x - ((800 * sin_yaw) >> 12);
  cos_yaw = FixedCos(vy);
  MAP_CollisionWithTile(x, pos->y, ((800 * cos_yaw) >> 12) + *&pos->z, 800, 1700);
  return MapTileSlice->TileID == TILE_FOUNTAIN; // 0x20 = Fountain/Water tile
}

//----- (80048874) --------------------------------------------------------
int __fastcall sub_80048874(__int16 a1, __int16 a2, __int16 a3, __int16 a4, __int16 a5, int a6, __int16 a7, _DWORD *a8)
{
  int result; // $v0
  __int16 v9[4]; // [sp+10h] [-10h] BYREF
  __int16 v10[4]; // [sp+18h] [-8h] BYREF

  v9[0] = a1;
  v10[0] = -a4;
  v10[2] = 0;
  v9[1] = a2 + a6;
  v9[2] = a3 + a7;
  v10[1] = a5;
  sub_80015614(v10, v9, a8);
  *a8 += *&g_LanguageID[0].header[2];
  a8[1] = a8[1] - 1600 + a6 + *&g_LanguageID[0].header[6];
  result = a8[2] + *&g_LanguageID[0].menus[0].header.posY;
  a8[2] = result;
  return result;
}

//----- (8004892C) --------------------------------------------------------
void __fastcall sub_8004892C(int a1, int *a2, int *a3, __int16 *a4, __int16 *a5, int a6)
{
  if ( a2 )
  {
    *(a1 + 20) = FixedPointLerp(*a2, *a3, a6);
    *(a1 + 24) = FixedPointLerp(a2[1], a3[1], a6);
    *(a1 + 28) = FixedPointLerp(a2[2], a3[2], a6);
  }
  if ( a4 )
  {
    *(a1 + 36) = sub_80015D30(*a4, *a5, a6);
    *(a1 + 40) = sub_80015D30(a4[2], a5[2], a6);
  }
}

//----- (800489FC) --------------------------------------------------------
int __fastcall sub_800489FC(int a1, char a2, __int16 a3, int a4, unsigned __int16 a5)
{
  int result; // $v0
  int v7; // $v1
  __int16 v8; // $s4
  int v9; // $s3
  int v10; // $s2

  result = a5;
  if ( a5 )
  {
    v7 = (a5 & 0xFFFE) >> 1;
    v8 = a4 - v7;
    v9 = (a4 - v7) << 16;
    v10 = v7 << 16;
    *(a1 + 12) = a2;
    *(a1 + 24) = a3;
    while ( !Math_IsAngleInRange(*(a1 + 24), SHIWORD(v9), SHIWORD(v10)) )
    {
      *(a1 + 24) = ((a5 & 0xFFFE) + *(a1 + 24)) & 0xFFF;
      UpdatePlayerSystem(0, 0);
    }
    *(a1 + 24) = v8 & 0xFFF;
    return UpdatePlayerSystem(0, 0);
  }
  return result;
}

//----- (80048AB4) --------------------------------------------------------
int __fastcall sub_80048AB4(int a1, unsigned __int8 a2)
{
  unsigned __int8 *i; // $v1
  int v3; // $v0

  for ( i = (a1 + 20); ; ++i )
  {
    while ( 1 )
    {
      v3 = *i++;
      if ( v3 == 242 )
        break;
      if ( v3 == 255 )
        return *(a1 + 16);
    }
    if ( *i == a2 )
      break;
  }
  return (i - (a1 + 19));
}

//----- (80048B10) --------------------------------------------------------
unsigned __int8 *__fastcall sub_80048B10(int a1)
{
  int v2; // $s0
  unsigned __int8 *v3; // $a1
  unsigned __int8 *v4; // $a0
  int v5; // $v1
  int v6; // $v0
  unsigned __int8 *v7; // $a1
  unsigned __int8 v9; // $v0

  v2 = dword_80174720[30 * *(a1 + 2)];
  v3 = (v2 + 20);
  v4 = (v2 + 23);
  while ( 2 )
  {
    v5 = *v3;
    while ( v5 != 241 )
    {
      if ( v5 == 254 )
      {
        v6 = *(v2 + 16);
        v7 = v3 + 1;
        if ( !*(v2 + 16) )
        {
          *(v2 + 16) = v7 - 20 - v2;
          return v7;
        }
        return (v2 + v6 + 20);
      }
    }
    if ( byte_801B519C[*(v4 - 2)] != *(v4 - 1) )
    {
      v4 += 4;
      v3 += 4;
      continue;
    }
    break;
  }
  v9 = sub_80048AB4(v2, *v4);
  if ( *(v2 + 16) < v9 )
    *(v2 + 16) = v9;
  byte_801B51DB = *(a1 + 1);
  *(v2 + 19) = 0;
  v6 = *(v2 + 16);
  return (v2 + v6 + 20);
}
// 80174720: using guessed type _DWORD dword_80174720[1186];
// 801B51DB: using guessed type char byte_801B51DB;

//----- (80048C30) --------------------------------------------------------
int __fastcall sub_80048C30(int a1)
{
  char v1; // $s5
  int v3; // $s1
  int result; // $v0
  int v5; // $s4
  int v6; // $s3
  unsigned __int8 *v7; // $s0
  int v8; // $v1
  unsigned __int8 *v9; // $s0
  int v10; // $v0
  int v11; // $v1
  char v12; // $v0
  int v13; // $s3
  int v14; // $v1
  int v15; // $s0
  int v16; // $a1

  v3 = dword_80174720[30 * *(a1 + 2)];
  result = 112;
  if ( !v3 )
    return result;
  v5 = 0;
  if ( *v3 != 112 )
    return result;
  v6 = 0;
  if ( !*(v3 + 16) )
    byte_801B51DB = *(a1 + 1);
  v7 = sub_80048B10(a1);
  if ( byte_801B51DB != *(a1 + 1) && *(v3 + 19) == 1 )
  {
    v8 = *v7;
    v9 = v7 + 1;
    if ( v8 != 240 )
    {
      do
        v10 = *v9++;
      while ( v10 != 240 );
    }
    v7 = v9 + 1;
    *(v3 + 16) = v7 - 20 - v3;
    *(v3 + 19) = 0;
  }
  while ( 2 )
  {
    switch ( *v7 )
    {
      case 0xF0u:
        *(v3 + 19) = 1;
        goto LABEL_12;
      case 0xF2u:
        v7 += 2;
        *(v3 + 16) += 2;
        continue;
      case 0xF3u:
        goto LABEL_27;
      case 0xF4u:
        ++v7;
        ++*(v3 + 16);
        (*&g_CurrentStateVTable->gap0[16])(a1, *v7);
        goto LABEL_27;
      case 0xF5u:
        ++v7;
        ++*(v3 + 16);
        v6 = *v7;
        goto LABEL_27;
      case 0xF6u:
        byte_801B51DB = *(a1 + 1);
        v12 = *(v3 + 16);
        ++v7;
        *(v3 + 19) = 0;
        *(v3 + 16) = v12 + 1;
        continue;
      case 0xF7u:
        byte_801B519C[v7[1]] = v7[2];
        v7 += 2;
        *(v3 + 16) += 2;
        goto LABEL_27;
      case 0xF8u:
LABEL_12:
        v11 = v7[1];
        v7 -= v11;
        *(v3 + 16) -= v11;
        continue;
      case 0xF9u:
        if ( byte_801B519C[v7[1]] == v7[2] )
        {
          *(v3 + 16) = sub_80048AB4(v3, v7[3]);
          v7 = (v3 + *(v3 + 16) + 20);
        }
        else
        {
          v7 += 4;
          *(v3 + 16) += 4;
        }
        continue;
      case 0xFFu:
        goto LABEL_29;
      default:
        if ( !v5 && *(v3 + 1) != 255 )
        {
          v1 = *(a1 + 12);
          v5 = 1;
          if ( *(a1 + 24) )
            sub_800489FC(a1, *(a1 + 12), *(a1 + 24), 0, *(a1 + 102));
          sub_800489FC(a1, *(v3 + 1), 0, 4095, *(v3 + 8));
        }
        sub_800378A0(3u, *(v3 + 12) + *v7);
LABEL_27:
        ++v7;
        ++*(v3 + 16);
        if ( v6 )
        {
          --v6;
          continue;
        }
LABEL_29:
        v13 = byte_8009DEC3;
        v14 = *(v3 + 18) & 0xF0;
        if ( v14 == 16 )
        {
          sub_8002BA60();
          sub_8001FD28();
        }
        else if ( (*(v3 + 18) & 0xF0u) >= 0x11 )
        {
          if ( v14 == 32 )
          {
            sub_8002BA60();
            sub_8001F9B8();
          }
          else if ( v14 == 48 )
          {
            sub_8002BA60();
            v15 = sub_8001F77C();
            if ( v15 != -1 )
            {
              UpdatePlayerSystem(0, 0);
              sub_800378A0(6u, v15 + 360);
            }
          }
        }
        else if ( (*(v3 + 18) & 0xF0) == 0 )
        {
          sub_8002BA60();
          sub_8001EF38(*(v3 + 18) & 0xF);
        }
        if ( byte_8009DEC3 < v13 )
          byte_801B51B8 = 1;
        byte_801B51DB = *(a1 + 1);
        if ( v5 )
        {
          v16 = *(v3 + 17);
          if ( v16 != 255 )
          {
            sub_800489FC(a1, v16, 0, 4095, *(v3 + 14));
            *(a1 + 12) = v1;
          }
        }
        dword_801B5198 = 1;
        return Player_ResetMovement();
    }
  }
}
// 8004904C: variable 'v1' is possibly undefined
// 8009DEC3: using guessed type char byte_8009DEC3;
// 80174720: using guessed type _DWORD dword_80174720[1186];
// 801B5198: using guessed type int dword_801B5198;
// 801B51B8: using guessed type char byte_801B51B8;
// 801B51DB: using guessed type char byte_801B51DB;

//----- (8004908C) --------------------------------------------------------
Entity **__fastcall sub_8004908C(int a1, __int16 a2)
{
  Entity **result; // $v0

  result = FindFreeOrOldestProjectileSlot(380, 16, -1);
  *(a1 + 57) = ((-252645135 * (result - ObjectInstances)) >> 2) - 124;
  *(result + 3) = a2;
  *(result + 56) = 0;
  return result;
}

//----- (80049108) --------------------------------------------------------
int __fastcall UseItems_80049108(VECTOR *pos, SVECTOR *rot, int item_id)
{
  VECTOR *v3; // $s7
  int v6; // $s0
  int v7; // $s0
  int v8; // $v1
  __int16 v9; // $a1
  int v10; // $a0
  int v11; // $s1
  int v12; // $s0
  Entity **v13; // $s0
  int v14; // $v0
  __int16 v15; // $a1
  int v16; // $s1
  unsigned __int8 v17; // $s2
  unsigned __int8 v18; // $a0
  unsigned __int8 v19; // $a1
  Entity **v20; // $s0
  __int16 v21; // $v0
  int v22; // $s0
  int v23; // $v0
  int v24; // $s0
  Entity **v25; // $a0
  Entity **v26; // $s1
  int *v27; // $s2
  int v28; // $s4
  int v29; // $s3
  Entity **v30; // $s0
  int v31; // $v1
  int *v32; // $a0
  int v33; // $v1
  char *v34; // $v1
  int v35; // $s2
  int v36; // $s3
  char *FreeOrOldestProjectileSlot; // $s1
  int v38; // $a0
  int v39; // $a0
  __int16 v40; // $v0
  __int16 v41; // $a1
  __int16 v42; // $v1
  int v43; // $v0
  __int16 v44; // $v1
  bool v45; // dc
  __int16 v46; // $a1
  int InteractableInCone; // $s0
  __int16 v48; // $a1
  int v49; // $s3
  Entity **v50; // $v0
  unsigned __int16 v51; // $a1
  Entity **v52; // $s2
  int v53; // $s1
  unsigned __int8 *v54; // $s0
  __int16 v55; // $a1
  int v57[2]; // [sp+20h] [-30h] BYREF
  int v58[4]; // [sp+28h] [-28h] BYREF
  int v59[4]; // [sp+38h] [-18h] BYREF
  int v60; // [sp+48h] [-8h] BYREF

  v3 = pos;
  dword_801B5198 = 0;
  switch ( item_id )
  {
    case ItemCrystalFlask:
      //   ?
      if ( IsFacingFountainTile(pos, rot) )
        goto LABEL_104;
      //      ?     ,    
      // 0 - ?
      InteractableInCone = FindInteractableInCone(0, v3, 800, 1700, rot->vy, 512);
      if ( InteractableInCone == -1 )
        goto LABEL_98;
      pos = v3;
      if ( HIWORD(ObjectInstances[17 * InteractableInCone + 1]) == 0xC3 )
      {
        //   
LABEL_104:
        if ( !InventoryAddItem(ItemBluePotion, v46) )
        {
          MessageQueuePush(DrewSomeWater, v48);
          //  
          InventoryRemoveItem(ItemCrystalFlask);
        }
        goto LABEL_96;
      }
      goto LABEL_99;
    case ItemPhantomRod:
      word_8019B52E = 1200;
      InventoryRemoveItem(ItemPhantomRod);
      goto LABEL_96;
    case ItemTruthGlass:
      v49 = 2;
      if ( !word_8019B5EC )
        v49 = 1;
      v50 = sub_8003D200(&pos->x, rot->vy, rot->vx, 8000, 500, 500, &v60, -1);
      if ( v50 && *(v50 + 3) == v49 )
      {
        v51 = *(v50 + 1) + 240;
      }
      else
      {
        v52 = ObjectInstances;
        v53 = 395;
        v54 = &ObjectInstances[14] + 1;
        while ( 1 )
        {
          --v53;
          if ( LOBYTE(GameDB01ObjectClassDeclaration[6 * *(v54 - 51)]) == 226
            && v54[7] == v49
            && sub_8003955C(*(v54 - 37) >> 11, *(v54 - 29) >> 11, *(v54 - 1), *v54, 0x8000) )
          {
            break;
          }
          v54 += 68;
          v52 += 17;
          if ( v53 == -1 )
          {
            pos = v3;
            goto LABEL_99;
          }
        }
        v51 = *(v52 + 29) + 510;
      }
      sub_800378A0(6u, v51);
      goto LABEL_96;
    case ItemSeathsPlume:
      InventoryRemoveItem(ItemSeathsPlume);
      word_8019B530 = 900;
      goto LABEL_96;
    case ItemDemonsPick:
      InventoryRemoveItem(ItemDemonsPick);
      word_8019B532 = 900;
      dword_801B5198 = 1;
      CalculatePlayerStats();
      goto LABEL_98;
    case ItemHarvinesFlute:
      v24 = FindInteractableInCone(0, pos, 800, 1700, rot->vy, 512);
      if ( v24 != -1 )
      {
        v25 = &ObjectInstances[17 * v24];
        if ( *(v25 + 3) == 157 )
          sub_80039190(*(v25 + 56));
        dword_801B5198 = 1;
      }
      sub_8004878C(8);
      pos = v3;
      goto LABEL_99;
    case ItemGroundBell:
      v26 = ObjectInstances;
      v27 = 0;
      v28 = 999999;
      v29 = 395;
      v30 = ObjectInstances;
      do
      {
        if ( *(v30 + 3) >= 0x52u && (*(v30 + 3) < 0x54u || *(v30 + 3) < 0x61u && *(v30 + 3) >= 0x5Au) )
        {
          v31 = sub_80015B74(v26 + 5, 25000, &g_LanguageID[0].header[2], 0, 0);
          if ( v31 >= 0 && v31 < v28 )
          {
            v27 = v30;
            v28 = v31;
          }
        }
        v30 += 17;
        --v29;
        v26 += 17;
      }
      while ( v29 != -1 );
      if ( !v27 )
        goto LABEL_98;
      v58[0] = v27[5];
      v58[2] = v27[7];
      v58[1] = 4 * (v27[6] - dword_8019A63C) + v27[6];
      PlayPositionalSound3D_Wrap(32777, v27 + 5, 110, 25000, 29000, 0);
      goto LABEL_96;
    case ItemFireCrystal:
      v32 = dword_8006F3D0;
      goto LABEL_66;
    case ItemWaterCrystal:
      v32 = dword_8006F3D8;
      goto LABEL_66;
    case ItemEarthCrystal:
      v32 = dword_8006F3E0;
      goto LABEL_66;
    case ItemWindCrystal:
      v32 = dword_8006F3E8;
      goto LABEL_66;
    case ItemLightCrystal:
      v32 = dword_8006F3F0;
      break;
    case ItemElfsKey:
    case ItemPiratesKey:
    case ItemSkullKey:
    case ItemJailKey:
    case ItemHarvinesKey:
    case ItemMagiciansKey:
    case ItemSilverKey:
    case ItemGoldKey:
    case ItemShrineKey:
      v6 = 0;
      while ( 2 )
      {
        v7 = FindInteractableInCone(v6, v3, 800, 1700, rot->vy, 512);
        if ( v7 == -1 )
          goto LABEL_98;
        v8 = sub_80039348(&ObjectInstances[17 * v7], item_id);
        if ( v8 == 1 )
        {
          sub_80048768();
          dword_801B5198 = 1;
          pos = v3;
        }
        else
        {
          if ( v8 < 2 )
          {
            v6 = v7 + 1;
            continue;
          }
          if ( v8 == 3 )
          {
            v10 = BYTE2(ObjectInstances[17 * v7 + 15]);
          }
          else
          {
            v10 = 4;
            if ( v8 != 4 )
            {
              v6 = v7 + 1;
              continue;
            }
          }
          MessageQueuePush(v10, v9);
          dword_801B5198 = 1;
          pos = v3;
        }
        goto LABEL_99;
      }
    case ItemRhombusKey:
      v22 = FindInteractableInCone(0, pos, 800, 1700, rot->vy, 512);
      if ( v22 == -1 )
        goto LABEL_98;
      v13 = &ObjectInstances[17 * v22];
      if ( *(v13 + 3) == 184 )
      {
        pos = v3;
        if ( *(v13 + 56) == 255 )
        {
          *(v13 + 56) = item_id;
          *(v13 + 4) = 0;
          dword_801B5198 = 1;
          InventoryRemoveItem(item_id);
          sub_8004908C(v13, item_id);
          pos = v3;
        }
        goto LABEL_99;
      }
      v23 = sub_80039348(v13, item_id);
      pos = v3;
      if ( v23 != 3 )
        goto LABEL_99;
      goto LABEL_21;
    case ItemMoonGate:
      v16 = 40;
      goto LABEL_25;
    case ItemStarGate:
      v16 = 44;
      goto LABEL_25;
    case ItemSunGate:
      v16 = 48;
LABEL_25:
      if ( g_TitleColor == 7 )
        goto LABEL_98;
      if ( byte_801B519C[v16] != 255 && g_CurrentMP >= 0xAu )
      {
        g_CurrentMP -= 10;
        FadeScreenIn(1u, 0, 4096, 256);
        sub_8003B9A8();
        v17 = byte_801B519E[v16];
        do
        {
          PadStartCom();
          HandleUISequence();
        }
        while ( g_bStartKeyState );
        v18 = v17;
        if ( v17 == g_TitleColor )
        {
          v18 = -1;
          v19 = -1;
        }
        else
        {
          v19 = v17;
        }
        sub_800166F8(v18, v19, v17, 0xFFu, 0xFFu, 127, 127, 127);
        do
        {
          PadStartCom();
          HandleUISequence();
        }
        while ( g_bStartKeyState );
        WaitForCdIdle();
        v20 = &ObjectInstances[17 * *&byte_801B519C[v16]];
        sub_80014FAC(*(v20 + 19), v57);
        sub_8001565C(1024, v57);
        byte_8019B591 = 0;
        LOWORD(dword_8019B5D0) = 0;
        dword_8019B5CC = 0;
        *&g_LanguageID[0].menus[0].header.extra[2] = *&g_LanguageID[0].menus[0].header.extra[10];
        *&g_LanguageID[0].menus[0].header.extra[6] = *&g_LanguageID[0].menus[0].items[0].refY;
        *&g_LanguageID[0].header[2] = v20[5] + v57[0];
        *&g_LanguageID[0].menus[0].header.posY = v20[7] + v57[1];
        *&g_LanguageID[0].header[6] = v20[6];
        v21 = *(v20 + 19);
        dword_801B5198 = 1;
        g_LanguageID[0].menus[0].items[0].refX = v21 + 2048;
        *&g_LanguageID[0].menus[0].header.extra[4] = v21 + 2048;
        FadeScreenIn(1u, 4096, 4096, 0);
        if ( !dword_80190858 )
          sub_80034C68(0, 0x101u, 385);
        FadeScreenIn(1u, 4096, 0, -256);
        SetFadeColor(255, 0, 0, 0);
        sub_800166F8(0xFFu, 0xFFu, 0xFFu, v17, v17, 127, 127, 127);
        pos = v3;
      }
      goto LABEL_99;
    case ItemMoonKey:
      v11 = 40;
      goto LABEL_16;
    case ItemStarKey:
      v11 = 44;
      goto LABEL_16;
    case ItemSunKey:
      v11 = 48;
LABEL_16:
      v12 = FindInteractableInCone(0, pos, 800, 1700, rot->vy, 512);
      if ( v12 == -1 )
        goto LABEL_98;
      v13 = &ObjectInstances[17 * v12];
      if ( *(v13 + 3) == 189 )
      {
        if ( *(v13 + 56) != 255 )
          goto LABEL_98;
        *(v13 + 56) = item_id;
        *(v13 + 4) = 0;
        *&byte_801B519C[v11] = (-252645135 * (v13 - ObjectInstances)) >> 2;
        byte_801B519E[v11] = g_TitleColor;
        dword_801B5198 = 1;
        InventoryRemoveItem(item_id);
        *(v13 + 64) = 0;
        sub_8004908C(v13, item_id);
        pos = v3;
        goto LABEL_99;
      }
      v14 = sub_80039348(v13, item_id);
      pos = v3;
      if ( v14 != 3 )
        goto LABEL_99;
LABEL_21:
      MessageQueuePush(*(v13 + 62), v15);
      goto LABEL_96;
    default:
      goto LABEL_98;
  }
  do
  {
LABEL_66:
    v33 = *v32;
    v32 = (v32 + 1);
    if ( v33 == 255 )
    {
LABEL_98:
      pos = v3;
      goto LABEL_99;
    }
    v34 = &g_SpellEntryTable[0].PlayerHas + 26 * v33;
    v35 = 0;
  }
  while ( *v34 );
  *v34 = 1;
  v36 = 0;
  FreeOrOldestProjectileSlot = FindFreeOrOldestProjectileSlot(350, 10, word_8018012E);
  InitProjectileInstance(FreeOrOldestProjectileSlot);
  InventoryRemoveItem(item_id);
  FreeOrOldestProjectileSlot[2] = 1;
  *FreeOrOldestProjectileSlot = 3;
  FreeOrOldestProjectileSlot[4] = -1;
  FreeOrOldestProjectileSlot[5] = 66;
  *(FreeOrOldestProjectileSlot + 3) = item_id;
  *(FreeOrOldestProjectileSlot + 20) = 0;
  *(FreeOrOldestProjectileSlot + 19) = 0;
  *(FreeOrOldestProjectileSlot + 18) = 0;
  sub_80048874(
    0,
    200,
    1500,
    *&g_LanguageID[0].menus[0].header.extra[2],
    *&g_LanguageID[0].menus[0].header.extra[4],
    0,
    0,
    v59);
  sub_80048874(
    0,
    200,
    1000,
    *&g_LanguageID[0].menus[0].header.extra[2],
    *&g_LanguageID[0].menus[0].header.extra[4],
    0,
    0,
    v58);
  v38 = FreeOrOldestProjectileSlot;
  do
  {
    sub_8004892C(v38, v58, v59, 0, 0, v36);
    v39 = v36 << 6;
    v36 += 64;
    v40 = *(FreeOrOldestProjectileSlot + 19) + v35;
    v35 += 4;
    *(FreeOrOldestProjectileSlot + 19) = v40;
    *(FreeOrOldestProjectileSlot + 8) = (FixedSin(v39) >> 2) + 1024;
    ProcessCDAudioLoad();
    ProcessAssetLoadQueue();
    UpdatePlayerSystem(0, 0);
    v38 = FreeOrOldestProjectileSlot;
  }
  while ( v36 < 4096 );
  while ( 1 )
  {
    v42 = *(FreeOrOldestProjectileSlot + 19) + v35;
    *(FreeOrOldestProjectileSlot + 8) -= 64;
    v43 = *(FreeOrOldestProjectileSlot + 8);
    v35 += 8;
    *(FreeOrOldestProjectileSlot + 19) = v42;
    if ( v43 <= 0 )
      break;
    ProcessCDAudioLoad();
    ProcessAssetLoadQueue();
    UpdatePlayerSystem(0, 0);
  }
  *(FreeOrOldestProjectileSlot + 8) = 0;
  while ( 1 )
  {
    v44 = *(FreeOrOldestProjectileSlot + 19) + v35;
    *(FreeOrOldestProjectileSlot + 8) += 128;
    v35 += 8;
    v45 = *(FreeOrOldestProjectileSlot + 8) < 0x1000u;
    *(FreeOrOldestProjectileSlot + 19) = v44;
    if ( !v45 )
      break;
    ProcessCDAudioLoad();
    ProcessAssetLoadQueue();
    UpdatePlayerSystem(0, 0);
  }
  *(FreeOrOldestProjectileSlot + 3) = 255;
  MessageQueuePush(1, v41);
LABEL_96:
  dword_801B5198 = 1;
  pos = v3;
LABEL_99:
  (*&g_CurrentStateVTable->gap0[8])(pos, rot, item_id);
  if ( !dword_801B5198 )
    MessageQueuePush(20, v55);
  return Player_ResetMovement();
}
// 80049214: variable 'v9' is possibly undefined
// 8004934C: variable 'v15' is possibly undefined
// 80049AA8: variable 'v41' is possibly undefined
// 80049B20: variable 'v46' is possibly undefined
// 80049B30: variable 'v48' is possibly undefined
// 80049CEC: variable 'v55' is possibly undefined
// 8006F3D0: using guessed type int dword_8006F3D0[2];
// 8006F3D8: using guessed type int dword_8006F3D8[2];
// 8006F3E0: using guessed type int dword_8006F3E0[2];
// 8006F3E8: using guessed type int dword_8006F3E8[2];
// 8006F3F0: using guessed type int dword_8006F3F0[2];
// 801779D4: using guessed type __int16 g_bStartKeyState;
// 801779D8: using guessed type int g_TitleColor;
// 801779F0: using guessed type _DWORD GameDB01ObjectClassDeclaration[];
// 8018012E: using guessed type __int16 word_8018012E;
// 80190858: using guessed type int dword_80190858;
// 8019A63C: using guessed type int dword_8019A63C;
// 8019B4DC: using guessed type __int16 g_CurrentMP;
// 8019B52E: using guessed type __int16 word_8019B52E;
// 8019B530: using guessed type __int16 word_8019B530;
// 8019B532: using guessed type __int16 word_8019B532;
// 8019B591: using guessed type char byte_8019B591;
// 8019B5CC: using guessed type int dword_8019B5CC;
// 8019B5D0: using guessed type int dword_8019B5D0;
// 8019B5EC: using guessed type __int16 word_8019B5EC;
// 801B5198: using guessed type int dword_801B5198;
// 801B519E: using guessed type _BYTE byte_801B519E[26];
// 80049108: using guessed type int var_18[4];

//----- (80049D2C) --------------------------------------------------------
int __fastcall InventoryRemoveItem(int a1)
{
  int v1; // $v0
  bool v2; // dc
  char v3; // $v0

  v1 = g_InventoryCounts[a1];
  v2 = v1 != 0;
  v3 = v1 - 1;
  if ( !v2 )
    return 1;
  g_InventoryCounts[a1] = v3;
  return 0;
}

//----- (80049D6C) --------------------------------------------------------
int __fastcall InventoryAddItem(int a1, __int16 a2)
{
  unsigned int v2; // $v1

  v2 = g_InventoryCounts[a1];
  if ( v2 < 0x63 )
  {
    g_InventoryCounts[a1] = v2 + 1;
    g_CurrentStateVTable->pfunc18();
    return 0;
  }
  else
  {
    MessageQueuePush(18, a2);
    return 1;
  }
}

//----- (80049DE4) --------------------------------------------------------
int __fastcall sub_80049DE4(int a1, int a2, int a3, int a4, int a5, int a6, int a7)
{
  int i; // $s2
  int v11; // $s1
  int v12; // $v0
  int v13; // $s0

  for ( i = 0; i < 4096; i += a1 )
  {
    PrepareRenderPrimitives();
    v11 = FixedPointLerp(a2, a5, i);
    v13 = FixedPointLerp(a3, a6, i);
    v12 = FixedPointLerp(a4, a7, i);
    sub_80034100(v11, v13, v12, 2048);
    UpdatePlayerSystem(0, 0);
  }
  PrepareRenderPrimitives();
  sub_80034100(a5, a6, a7, 2048);
  return UpdatePlayerSystem(0, 0);
}

//----- (80049EFC) --------------------------------------------------------
int __fastcall sub_80049EFC(char *a1, int a2)
{
  int v2; // $s2
  int v3; // $s7
  int v4; // $s1
  _DWORD *v5; // $s4
  int result; // $v0
  Entity **v7; // $a0
  __int16 v8; // $s6
  __int16 v9; // $s3
  int v10; // $v0
  int v11; // $v1
  int v12; // $s5
  int v13; // $v0
  int v14; // $fp
  int v15; // $s0
  int v16; // $t0
  int v17; // $t2
  int v18; // $t3
  int v19; // $t4
  unsigned __int16 v20; // $v0
  int v21; // $a2
  int v22; // $v0
  __int16 v23; // $a1
  int v24; // $a0
  int v25; // $s2
  int v26; // $a0
  int v27; // $v1
  int v28; // $a1
  char v29; // $v0
  char v30; // $v0
  int v31; // $a0
  int v32; // $s0
  int v33; // $a0
  __int16 v34; // $s3
  int v35; // $a0
  int v36; // $a1
  int v37; // $a2
  unsigned __int16 v38; // $v0
  int v39; // [sp+20h] [-38h] BYREF
  int v40; // [sp+24h] [-34h]
  int v41; // [sp+28h] [-30h] BYREF
  int v42; // [sp+2Ch] [-2Ch]
  int v43[4]; // [sp+30h] [-28h] BYREF
  int v44[4]; // [sp+40h] [-18h] BYREF
  unsigned __int16 v45; // [sp+50h] [-8h]
  unsigned __int16 *FreeOrOldestProjectileSlot; // [sp+80h] [+28h]
  unsigned __int16 v47; // [sp+84h] [+2Ch]

  v47 = a2;
  v3 = -1;
  v4 = 0;
  FreeOrOldestProjectileSlot = a1;
  if ( !a1 )
  {
    v3 = a2;
    FreeOrOldestProjectileSlot = FindFreeOrOldestProjectileSlot(350, 10, word_8018012E);
    InitProjectileInstance(FreeOrOldestProjectileSlot);
    FreeOrOldestProjectileSlot[3] = v47;
    *FreeOrOldestProjectileSlot = 3;
    *(FreeOrOldestProjectileSlot + 4) = -1;
    FreeOrOldestProjectileSlot[20] = 0;
    FreeOrOldestProjectileSlot[19] = 0;
    FreeOrOldestProjectileSlot[18] = 0;
    *(FreeOrOldestProjectileSlot + 56) = -1;
  }
  v5 = &GameDB01ObjectClassDeclaration[6 * FreeOrOldestProjectileSlot[3]];
  v45 = FreeOrOldestProjectileSlot[7];
  result = 32;
  if ( *(FreeOrOldestProjectileSlot + 56) == 255 )
  {
    if ( *(v5 + 1) == 32 )
    {
      MessageQueuePush(21, FreeOrOldestProjectileSlot[29]);
      FreeOrOldestProjectileSlot[3] = 255;
      result = FreeOrOldestProjectileSlot[29] + g_PlayerGold;
      g_PlayerGold = result;
      return result;
    }
    if ( (*(FreeOrOldestProjectileSlot + 1) & 0xFFFF00FF) != 6750320
      || (v7 = &ObjectInstances[17 * HIBYTE(ObjectInstances[17 * FreeOrOldestProjectileSlot[32] + 14])], *(v7 + 4) != 3)
      || (result = *(v7 + 4), !*(v7 + 4)) )
    {
      if ( FreeOrOldestProjectileSlot[3] == 18 )
        FreeOrOldestProjectileSlot[3] = 13;
      v8 = *&g_LanguageID[0].menus[0].header.extra[2] & 0xFFF;
      v9 = *&g_LanguageID[0].menus[0].header.extra[2] & 0xFFF;
      if ( (*&g_LanguageID[0].menus[0].header.extra[2] & 0xFFFu) >= 0x800 )
      {
        if ( (*&g_LanguageID[0].menus[0].header.extra[2] & 0xFFFu) < 0xF00 )
          v9 = 3840;
      }
      else if ( (*&g_LanguageID[0].menus[0].header.extra[2] & 0xFFFu) >= 0x101 )
      {
        v9 = 256;
      }
      v10 = PadRead();
      v11 = *(v5 + 7);
      v12 = v10;
      v13 = -v11;
      if ( v11 > 0 )
        v13 = 3 - v11;
      v14 = (v13 >> 2) - 200;
      if ( v3 == -1 )
      {
        v15 = 0;
        WaitForCdIdle();
        v12 = v2;
        v16 = *(FreeOrOldestProjectileSlot + 10);
        v41 = *(FreeOrOldestProjectileSlot + 9);
        v42 = v16;
        v17 = *(FreeOrOldestProjectileSlot + 6);
        v18 = *(FreeOrOldestProjectileSlot + 7);
        v19 = *(FreeOrOldestProjectileSlot + 8);
        v44[0] = *(FreeOrOldestProjectileSlot + 5);
        v44[1] = v17;
        v44[2] = v18;
        v44[3] = v19;
        sub_80048874(0, 500, 1500, v9, *&g_LanguageID[0].menus[0].header.extra[4], *(v5 + 6), *(v5 + 7), v43);
        LOWORD(v40) = 0;
        LOWORD(v39) = 0;
        do
        {
          sub_8004892C(FreeOrOldestProjectileSlot, v44, v43, &v41, &v39, v15);
          v20 = sub_80014D48(v45, v14, v15);
          v21 = v15;
          v15 += 512;
          FreeOrOldestProjectileSlot[7] = v20;
          *&g_LanguageID[0].menus[0].header.extra[2] = sub_80015D30(v8, v9, v21);
          ProcessCDAudioLoad();
          ProcessAssetLoadQueue();
          UpdatePlayerSystem(0, &g_LanguageID[0].menus[0].header.extra[2]);
        }
        while ( v15 < 4097 );
      }
      else
      {
        sub_80048874(
          0,
          500,
          1500,
          v9,
          *&g_LanguageID[0].menus[0].header.extra[4],
          *(v5 + 6),
          *(v5 + 7),
          FreeOrOldestProjectileSlot + 5);
      }
      FreeOrOldestProjectileSlot[7] = v14;
      while ( 1 )
      {
        v22 = PadRead();
        if ( !v12 && v22 && v4 == 256 )
          break;
        v12 = v22;
        FreeOrOldestProjectileSlot[19] += 64;
        v24 = v4;
        if ( v4 < 256 )
          v24 = v4 + 64;
        v4 = v24;
        ProcessCDAudioLoad();
        ProcessAssetLoadQueue();
        UpdatePlayerSystem(0, &g_LanguageID[0].menus[0].header.extra[2]);
      }
      if ( (v22 & 0x20) != 0 || (v25 = 0, v3 != -1) )
      {
        if ( !InventoryAddItem(FreeOrOldestProjectileSlot[3], v23) )
        {
          v27 = FreeOrOldestProjectileSlot[3];
          if ( v27 == 117 )
          {
            v28 = ((6 * rand(v26)) >> 15) + 4;
            v29 = 99;
            if ( byte_8009DEE5 < 99 - v28 )
              v29 = byte_8009DEE5 + v28;
            byte_8009DEE5 = v29;
          }
          else if ( v27 == 118 )
          {
            if ( byte_8009DEE6 >= 0x5Fu )
              v30 = 99;
            else
              v30 = byte_8009DEE6 + 4;
            byte_8009DEE6 = v30;
          }
          sub_80048874(-500, 500, 0, v9, *&g_LanguageID[0].menus[0].header.extra[4], 0, 0, v44);
          v45 = 0;
          v31 = *(FreeOrOldestProjectileSlot + 10);
          v41 = *(FreeOrOldestProjectileSlot + 9);
          v42 = v31;
          v25 = 1;
LABEL_48:
          v32 = 0;
          v33 = *(FreeOrOldestProjectileSlot + 10);
          v39 = *(FreeOrOldestProjectileSlot + 9);
          v40 = v33;
          v34 = *&g_LanguageID[0].menus[0].header.extra[2];
          v35 = *(FreeOrOldestProjectileSlot + 6);
          v36 = *(FreeOrOldestProjectileSlot + 7);
          v37 = *(FreeOrOldestProjectileSlot + 8);
          v43[0] = *(FreeOrOldestProjectileSlot + 5);
          v43[1] = v35;
          v43[2] = v36;
          v43[3] = v37;
          do
          {
            sub_8004892C(FreeOrOldestProjectileSlot, v43, v44, &v39, &v41, v32);
            *&g_LanguageID[0].menus[0].header.extra[2] = sub_80015D30(v34, v8, v32);
            v38 = sub_80014D48(v14, v45, v32);
            v32 += 512;
            FreeOrOldestProjectileSlot[7] = v38;
            UpdatePlayerSystem(0, &g_LanguageID[0].menus[0].header.extra[2]);
          }
          while ( v32 < 4097 );
          if ( !v25 )
          {
            if ( FreeOrOldestProjectileSlot[3] == 13 )
              FreeOrOldestProjectileSlot[3] = 18;
            return Player_ResetMovement();
          }
LABEL_51:
          FreeOrOldestProjectileSlot[3] = 255;
          return Player_ResetMovement();
        }
        v25 = 0;
        if ( v3 != -1 )
          goto LABEL_51;
      }
      while ( !Math_IsAngleInRange(FreeOrOldestProjectileSlot[19], SHIWORD(v41), 128) )
      {
        FreeOrOldestProjectileSlot[19] = (FreeOrOldestProjectileSlot[19] + 256) & 0xFFF;
        UpdatePlayerSystem(0, &g_LanguageID[0].menus[0].header.extra[2]);
      }
      FreeOrOldestProjectileSlot[19] = HIWORD(v41);
      goto LABEL_48;
    }
  }
  return result;
}
// 8004A17C: variable 'v2' is possibly undefined
// 8004A324: variable 'v23' is possibly undefined
// 8004A35C: variable 'v26' is possibly undefined
// 80062BF0: using guessed type int __fastcall rand(_DWORD);
// 8009DEE5: using guessed type char byte_8009DEE5;
// 8009DEE6: using guessed type char byte_8009DEE6;
// 801779F0: using guessed type _DWORD GameDB01ObjectClassDeclaration[];
// 8018012E: using guessed type __int16 word_8018012E;
// 8019B4F0: using guessed type int g_PlayerGold;

//----- (8004A5E4) --------------------------------------------------------
int __fastcall Interact_8004A5E4(int *a1, int a2)
{
  int v3; // $v0
  int v4; // $s2
  Entity **v5; // $s0
  __int16 v6; // $v0
  int v7; // $s2
  int v8; // $a0
  int v9; // $a1
  int InteractableInCone; // $s2
  Entity **v11; // $s1
  int v12; // $v1
  int v13; // $v1
  int v14; // $a0
  int v15; // $v1
  Entity **v16; // $s0
  char v17; // $v0
  int v18; // $v0
  int v19; // $v1
  int v20; // $a0
  Entity *v21; // $a0
  int v23; // [sp+20h] [-10h] BYREF
  int v24; // [sp+24h] [-Ch]
  int v25; // [sp+28h] [-8h]

  v23 = *a1;
  v24 = a1[1] + 500;
  v3 = a1[2];
  dword_801B5198 = 0;
  v25 = v3;
  if ( IsFacingFountainTile(&v23, a2) )
  {
    sub_80049DE4(1024, 0, 0, 0, 128, 160, 255);
    g_CurrentHP = g_MaxHP;
    sub_80049DE4(1024, 128, 160, 255, 0, 0, 0);
  }
  v4 = Entity_CheckWorldCollision(v23, v24, v25, 1400, 3200);
  if ( v4 == -1 )
    goto LABEL_6;
  v5 = &g_ObjectArray[31 * v4];
  v6 = Math_Atan2_Fixed(v5[11] - v23, v5[13] - v25);
  v7 = 0;
  if ( Math_IsAngleInRange(*(a2 + 2), v6, 300) )
  {
    sub_80048C30(v5);
LABEL_6:
    v7 = 0;
  }
LABEL_7:
  v8 = v7;
  while ( 1 )
  {
    InteractableInCone = FindInteractableInCone(v8, &v23, 800, 2500, *(a2 + 2), 512);
    if ( InteractableInCone == -1 )
      return (*g_CurrentStateVTable->gap0)(&v23, a2);
    v11 = &ObjectInstances[17 * InteractableInCone];
    v12 = *(v11 + 3);
    dword_801B5198 = 1;
    v13 = LOBYTE(GameDB01ObjectClassDeclaration[6 * v12]);
    if ( v13 == 18 )
    {
      sub_80049DE4(512, 0, 0, 0, 128, 200, 255);
      g_CurrentHP = g_MaxHP;
      sub_80049DE4(512, 128, 200, 255, 0, 0, 0);
      v7 = InteractableInCone + 1;
      goto LABEL_7;
    }
    if ( v13 >= 0x13 )
    {
      if ( v13 == 0x40 )
      {
        sub_80049EFC(v11, v9);
        v7 = InteractableInCone + 1;
        if ( *(v11 + 3) == 255 )
          return (*g_CurrentStateVTable->gap0)(&v23, a2);
        goto LABEL_7;
      }
      if ( v13 >= 65 )
      {
        if ( v13 == 83 )
        {
          if ( *(v11 + 4) )
            goto LABEL_84;
          goto LABEL_50;
        }
        if ( v13 < 84 )
        {
          if ( v13 != 81 )
          {
            v7 = InteractableInCone + 1;
            goto LABEL_7;
          }
          if ( !*(v11 + 4) && *(v11 + 56) == 255 )
            *(v11 + 4) = 1;
          goto LABEL_84;
        }
        if ( v13 != 165 && v13 != 255 )
          goto LABEL_84;
        v14 = *(v11 + 63);
        if ( v14 == 255 )
          goto LABEL_84;
        MessageQueuePush(v14, v9);
        v8 = InteractableInCone + 1;
      }
      else
      {
        if ( v13 != 21 )
        {
          if ( v13 < 22 )
          {
            if ( v13 != 20 )
            {
              v7 = InteractableInCone + 1;
              goto LABEL_7;
            }
LABEL_81:
            sub_800378A0(6u, *(v11 + 28) + 120);
            v7 = InteractableInCone + 1;
            goto LABEL_7;
          }
          if ( v13 != 22 )
          {
            if ( v13 != 32 )
            {
              v7 = InteractableInCone + 1;
              goto LABEL_7;
            }
            if ( !byte_8019B591 )
            {
              sub_8002BED0(InteractableInCone);
              v21 = v11[16];
              if ( v21->flags == 1 )
                v21->flags = 5;
            }
            goto LABEL_84;
          }
LABEL_66:
          if ( !Math_IsAngleInRange(*(a2 + 2), *(v11 + 19) + 2048, 341) )
            goto LABEL_84;
LABEL_67:
          v19 = *(v11 + 56);
          if ( v19 == 254 )
          {
            v20 = *(v11 + 29);
            if ( v20 == 0xFFFF || HIWORD(ObjectInstances[17 * v20 + 1]) == 255 )
            {
              MessageQueuePush(6, v9);
              v7 = InteractableInCone + 1;
            }
            else
            {
              v7 = InteractableInCone + 1;
            }
            goto LABEL_7;
          }
          if ( v19 == 255 )
          {
            *(v11 + 56) = -2;
            goto LABEL_84;
          }
          goto LABEL_75;
        }
LABEL_45:
        v15 = *(v11 + 29);
        if ( v15 != 0xFFFF )
        {
          v16 = &ObjectInstances[17 * v15];
          if ( *(v16 + 3) != 255 )
          {
            v17 = *(v11 + 64);
            *(v16 + 56) = -1;
            *v16 = v17;
            sub_80049EFC(&ObjectInstances[17 * v15], v9);
            v18 = *(v16 + 3);
            *v16 = 0;
            *(v16 + 56) = 0;
            if ( v18 == 255 )
              *(v11 + 29) = -1;
            goto LABEL_84;
          }
        }
LABEL_75:
        MessageQueuePush(*(v11 + 63), v9);
        v8 = InteractableInCone + 1;
      }
    }
    else
    {
      if ( v13 == 8 )
        goto LABEL_66;
      if ( v13 >= 9 )
      {
        if ( v13 == 13 )
          goto LABEL_81;
        if ( v13 >= 14 )
        {
          if ( v13 == 14 )
          {
            sub_8004AEC4(g_TitleColor);
            sub_8002BA60();
            sub_8001D770();
          }
          else
          {
            if ( v13 != 15 )
            {
              v7 = InteractableInCone + 1;
              goto LABEL_7;
            }
            if ( *(v11 + 56) == 255 )
            {
              MessageQueuePush(16, v9);
              v7 = InteractableInCone + 1;
              goto LABEL_7;
            }
          }
          goto LABEL_84;
        }
        if ( v13 != 9 )
        {
          v7 = InteractableInCone + 1;
          goto LABEL_7;
        }
        goto LABEL_45;
      }
      if ( v13 >= 5 )
      {
        if ( v13 != 5 )
        {
          v7 = InteractableInCone + 1;
          goto LABEL_7;
        }
        goto LABEL_67;
      }
      if ( v13 >= 3 )
      {
        if ( *(v11 + 4) )
          goto LABEL_84;
        if ( *(v11 + 56) >= 0xFCu
          && ((v11[14] & 1) != 0 && Math_IsAngleInRange(*(a2 + 2), *(v11 + 19), 900)
           || (v11[14] & 2) != 0 && Math_IsAngleInRange(*(a2 + 2), *(v11 + 19) + 2048, 900)) )
        {
          goto LABEL_50;
        }
        if ( *(v11 + 56) == 15 && byte_8009DE7F )
        {
          *(v11 + 4) = 1;
          goto LABEL_84;
        }
        goto LABEL_75;
      }
      if ( v13 != 2 )
      {
        v7 = InteractableInCone + 1;
        goto LABEL_7;
      }
      if ( !*(v11 + 4) )
      {
        if ( *(v11 + 56) != 255 )
          goto LABEL_75;
LABEL_50:
        *(v11 + 4) = 1;
      }
LABEL_84:
      v8 = InteractableInCone + 1;
    }
  }
}
// 8004A8C8: variable 'v9' is possibly undefined
// 8009DE7F: using guessed type char byte_8009DE7F;
// 801779D8: using guessed type int g_TitleColor;
// 801779F0: using guessed type _DWORD GameDB01ObjectClassDeclaration[];
// 8019B4D6: using guessed type __int16 g_MaxHP;
// 8019B4D8: using guessed type __int16 g_CurrentHP;
// 8019B591: using guessed type char byte_8019B591;
// 801B5198: using guessed type int dword_801B5198;

//----- (8004AC5C) --------------------------------------------------------
int InitPlayerInventory()
{
  int *v0; // $s1
  int i; // $v0
  int result; // $v0

  memset_0(byte_801B519C, 0, 0x40);
  memset_0(byte_801B529C, 0, 0xE00);
  word_801B51CC = -1;
  word_801B51C8 = -1;
  word_801B51C4 = -1;
  Heap_Init(byte_801B529C, 0x3800);
  v0 = &dword_801B8A9C;
  for ( i = 9; i != -1; --i )
  {
    *v0 = -1;
    v0 = (v0 + 2);
  }
  memset_0(g_InventoryCounts, 0, 0x1E);
  result = 1;
  //      0.
  //   1.   " = 1".
  g_InventoryCounts[0] = 1;                     // add 1 dagger 
  return result;
}
// 801B51C4: using guessed type __int16 word_801B51C4;
// 801B51C8: using guessed type __int16 word_801B51C8;
// 801B51CC: using guessed type __int16 word_801B51CC;
// 801B8A9C: using guessed type int dword_801B8A9C;

//----- (8004AD18) --------------------------------------------------------
int ProcessCurrentMode()
{
  return (*&g_CurrentStateVTable->gap0[4])(0);
}

//----- (8004AD48) --------------------------------------------------------
int __fastcall sub_8004AD48(_DWORD *a1)
{
  int *v1; // $v1
  int i; // $a1
  int result; // $v0

  v1 = &dword_801B8A9C;
  for ( i = 9; i != -1; --i )
  {
    result = *v1;
    v1 = (v1 + 2);
    if ( result == 0xFFFF )
    {
      *a1 = 0;
    }
    else
    {
      result += byte_801B529C;
      *a1 = result;
    }
    ++a1;
  }
  return result;
}
// 801B8A9C: using guessed type int dword_801B8A9C;

//----- (8004AD98) --------------------------------------------------------
int __fastcall sub_8004AD98(int a1)
{
  char *v1; // $a1
  int result; // $v0

  v1 = byte_801B529C;
  result = 255;
  if ( byte_801B529C[0] != 255 )
  {
    do
    {
      if ( *v1 < 4u )
      {
        if ( *v1 )
          *(v1 + 2) += a1;
      }
      v1 += *(v1 + 1) + 12;
      result = *v1;
    }
    while ( result != 255 );
  }
  return result;
}

//----- (8004AE08) --------------------------------------------------------
int __fastcall sub_8004AE08(int *a1)
{
  int *v1; // $v1
  int i; // $a1
  int result; // $v0

  v1 = &dword_801B8A9C;
  for ( i = 9; i != -1; --i )
  {
    result = *a1;
    if ( *a1++ != 0 )
    {
      result -= byte_801B529C;
      *v1 = result;
    }
    else
    {
      *v1 = -1;
    }
    v1 = (v1 + 2);
  }
  return result;
}
// 801B8A9C: using guessed type int dword_801B8A9C;

//----- (8004AE54) --------------------------------------------------------
int __fastcall sub_8004AE54(int a1)
{
  char *v1; // $a1
  int result; // $v0

  v1 = byte_801B529C;
  result = 255;
  if ( byte_801B529C[0] != 255 )
  {
    do
    {
      if ( *v1 < 4u )
      {
        if ( *v1 )
          *(v1 + 2) -= a1;
      }
      v1 += *(v1 + 1) + 12;
      result = *v1;
    }
    while ( result != 255 );
  }
  return result;
}

//----- (8004AEC4) --------------------------------------------------------
unsigned __int8 *__fastcall sub_8004AEC4(int a1)
{
  int *v2; // $s0
  Entity **v3; // $v1
  int i; // $a1
  int v5; // $v0
  _BYTE *v6; // $s0
  _BYTE *v7; // $s0
  EntityDefinition **v8; // $a0
  int j; // $a1
  EntityDefinition *v10; // $v1
  _BYTE *v11; // $s0
  _BYTE *v12; // $s0
  int v13; // $a1
  char *v14; // $a0
  int v15; // $v1
  int v16; // $v1
  _BYTE *v17; // $s0
  int v18; // $v0
  _BYTE *v19; // $s0
  _BYTE *v20; // $s0
  _BYTE *v21; // $s0
  _BYTE *v22; // $s0
  int *v23; // $s3
  int v24; // $s0
  unsigned __int8 *result; // $v0
  int v26[10]; // [sp+10h] [-C28h] BYREF
  int v27[768]; // [sp+38h] [-C00h] BYREF

  v2 = v27;
  v3 = g_ObjectArray;
  for ( i = 0; i < 200; ++i )
  {
    v5 = *v3;
    if ( v5 != 255 && v5 == 1 )
    {
      *v2 = i;
      v6 = v2 + 1;
      if ( *(v3 + 9) == 3 )
        *v6 = 3;
      else
        *v6 = 0;
      v2 = (v6 + 1);
    }
    v3 += 31;
  }
  *v2 = -1;
  v7 = v2 + 1;
  v8 = g_ObjectTypeTable;
  for ( j = 0; j < 40; ++j )
  {
    if ( *v8 == 255 )
      break;
    v10 = v8[14];
    v8 += 30;
    if ( v10 && v10->flags[0] == 112 )
    {
      *v7 = j;
      v11 = v7 + 1;
      *v11++ = v10->gapC[4];
      *v11 = HIBYTE(v10->coll_radius);
      v7 = v11 + 1;
    }
  }
  *v7 = -1;
  v12 = v7 + 1;
  v13 = 0;
  v14 = &ObjectInstances[14] + 1;
  do
  {
    v15 = *(v14 - 51);
    if ( v15 == 255 )
    {
      *v12 = -1;
    }
    else
    {
      switch ( LOBYTE(GameDB01ObjectClassDeclaration[6 * v15]) )
      {
        case 0:
        case 2:
        case 3:
        case 4:
        case 5:
        case 8:
        case 0x16:
        case 0x50:
        case 0x51:
        case 0x54:
        case 0x58:
        case 0x5F:
        case 0xA0:
        case 0xA1:
        case 0xA3:
        case 0xA4:
          goto LABEL_32;
        case 0xF:
        case 0x11:
          *v12 = -12;
          v22 = v12 + 1;
          *v22 = *(v14 - 1);
          LOBYTE(v18) = *v14;
          v12 = v22 + 1;
          goto LABEL_35;
        case 0x40:
          v16 = *(v14 - 53);
          if ( v16 == 98 )
          {
            *v12 = -14;
            v20 = v12 + 1;
            *v20++ = *(v14 - 51);
            *v20++ = *(v14 - 37) >> 2;
            *v20++ = *(v14 - 37) >> 10;
            *v20++ = *(v14 - 29) >> 2;
            *v20++ = *(v14 - 29) >> 10;
            *v20++ = *(v14 - 33);
            *v20 = BYTE1(*(v14 - 33));
            v12 = v20 + 1;
            v18 = *(v14 + 1) >> 2;
            goto LABEL_35;
          }
          if ( *(v14 - 53) >= 0x63u )
          {
            if ( v16 == 112 )
            {
              *v12 = -13;
              v21 = v12 + 1;
              *v21 = *(v14 - 51);
              LOBYTE(v18) = *(v14 - 1);
              v12 = v21 + 1;
              goto LABEL_35;
            }
            *v12 = -3;
          }
          else
          {
            if ( v16 == 96 )
            {
              *v12 = -16;
              v17 = v12 + 1;
              *v17++ = *(v14 - 51);
              *v17++ = *(v14 - 37) >> 2;
              *v17++ = *(v14 - 37) >> 10;
              *v17++ = *(v14 - 29) >> 2;
              *v17++ = *(v14 - 29) >> 10;
              *v17++ = *(v14 - 33);
              *v17 = BYTE1(*(v14 - 33));
              v12 = v17 + 1;
              v18 = *(v14 - 19) >> 4;
              goto LABEL_35;
            }
            if ( v16 == 97 )
            {
              *v12 = -15;
              v19 = v12 + 1;
              *v19++ = *(v14 - 51);
              *v19++ = *(v14 - 37) >> 2;
              *v19++ = *(v14 - 37) >> 10;
              *v19++ = *(v14 - 29) >> 2;
              *v19++ = *(v14 - 29) >> 10;
              *v19 = *(v14 - 33);
              v12 = v19 + 1;
              v18 = *(v14 - 33) >> 8;
              goto LABEL_35;
            }
            *v12 = -3;
          }
          LOBYTE(v18) = *(v14 - 1);
          ++v12;
LABEL_35:
          *v12 = v18;
          break;
        case 0x53:
          if ( *(v14 - 1) < 2u )
            goto LABEL_37;
LABEL_32:
          *v12 = -3;
          LOBYTE(v18) = *(v14 - 1);
          ++v12;
          goto LABEL_35;
        default:
          LOBYTE(v18) = -2;
          goto LABEL_35;
      }
    }
    ++v12;
LABEL_37:
    ++v13;
    v14 += 68;
  }
  while ( v13 < 396 );
  sub_8004AD48(v26);
  sub_8004AD98(v26);
  v23 = &v26[a1];
  if ( *v23 )
    sub_80017B7C(*v23);
  v24 = (v12 - v27 + 3) & 0xFFFFFFFC;
  result = FMOAllocateBuffer(byte_801B529C, v24, v23);
  if ( result )
  {
    MemcpyDword(result, v27, v24 >> 2);
    sub_8004AE08(v26);
    return sub_8004AE54(v26);
  }
  return result;
}
// 801779F0: using guessed type _DWORD GameDB01ObjectClassDeclaration[];
// 8004AEC4: using guessed type int var_C00[768];
// 8004AEC4: using guessed type int var_C28[10];

//----- (8004B31C) --------------------------------------------------------
_DWORD *__fastcall sub_8004B31C(int a1)
{
  _DWORD *result; // $v0
  unsigned __int8 *v3; // $s0
  int v4; // $a0
  unsigned __int8 *v5; // $s0
  char v6; // $v1
  int v7; // $v1
  char *v8; // $s0
  EntityDefinition *def; // $v1
  char v10; // $v0
  _BYTE *v11; // $s0
  char v12; // $v0
  Entity **v13; // $s5
  int v14; // $s6
  Entity **v15; // $s1
  int v16; // $v0
  char v17; // $v0
  char *v18; // $s0
  char v19; // $v0
  __int16 v20; // $v0
  unsigned __int8 *v21; // $s0
  int v22; // $s4
  int v23; // $a2
  int v24; // $s3
  int v25; // $a1
  __int16 v26; // $s2
  __int16 v27; // $v1
  __int16 v28; // $a0
  int v29; // $s4
  int v30; // $s3
  __int16 v31; // $s2
  int v32; // $a0
  int v33; // $a1
  int v34; // $a2
  char v35; // $v1
  char v36; // $v0
  __int16 v37; // $v0
  unsigned __int8 *v38; // $s0
  int v39; // $s4
  int v40; // $a0
  int v41; // $s3
  int v42; // $v1
  __int16 v43; // $s2
  __int16 v44; // $v0
  __int16 v45; // $v0
  unsigned __int8 *v46; // $s0
  int v47; // $s4
  int v48; // $a0
  int v49; // $s3
  int v50; // $v1
  __int16 v51; // $s2
  __int16 v52; // $v0
  __int16 v53; // $v0
  _DWORD v54[4]; // [sp+0h] [-38h] BYREF
  int v55[10]; // [sp+10h] [-28h] BYREF

  sub_8004AD48(v55);
  result = &v54[a1];
  v3 = result[4];
  if ( v3 )
  {
    while ( 1 )
    {
      v4 = *v3;
      v5 = v3 + 1;
      if ( v4 == 255 )
        break;
      v6 = *v5;
      v3 = v5 + 1;
      BYTE1(g_ObjectArray[31 * v4 + 2]) = v6;
    }
    while ( 1 )
    {
      v7 = *v5;
      v8 = (v5 + 1);
      if ( v7 == 255 )
        break;
      def = g_ObjectTypeTable[30 * v7 + 14];
      v10 = *v8;
      v11 = v8 + 1;
      def->gapC[4] = v10;
      v12 = *v11;
      v5 = v11 + 1;
      HIBYTE(def->coll_radius) = v12;
    }
    v13 = ObjectInstances;
    v14 = 0;
    v15 = &ObjectInstances[14];
    do
    {
      v16 = *v8++;
      switch ( v16 )
      {
        case 240:
          InitProjectileInstance(v13);
          *(v15 - 52) = 96;
          v20 = *v8;
          v21 = (v8 + 1);
          *(v15 - 25) = v20;
          v22 = *v21++;
          v23 = *v21++;
          v24 = *v21++;
          v25 = *v21++;
          v26 = *v21++;
          v27 = *v21++;
          v28 = *v21;
          v8 = (v21 + 1);
          *(v15 - 8) = 1024;
          v29 = v22 | (v23 << 8);
          v30 = v24 | (v25 << 8);
          v31 = v26 | (v27 << 8);
          *(v15 - 9) = 16 * v28;
          goto LABEL_11;
        case 241:
          InitProjectileInstance(v13);
          *(v15 - 52) = 97;
          v37 = *v8;
          v38 = (v8 + 1);
          *(v15 - 25) = v37;
          v39 = *v38++;
          v40 = *v38++;
          v41 = *v38++;
          v42 = *v38++;
          v43 = *v38++;
          v44 = *v38;
          v8 = (v38 + 1);
          v29 = v39 | (v40 << 8);
          v30 = v41 | (v42 << 8);
          v31 = v43 | (v44 << 8);
          goto LABEL_11;
        case 242:
          InitProjectileInstance(v13);
          *(v15 - 52) = 98;
          v45 = *v8;
          v46 = (v8 + 1);
          *(v15 - 25) = v45;
          v47 = *v46++;
          v48 = *v46++;
          v49 = *v46++;
          v50 = *v46++;
          v51 = *v46++;
          v52 = *v46++;
          v48 <<= 8;
          v29 = v47 | v48;
          v30 = v49 | (v50 << 8);
          v31 = v51 | (v52 << 8);
          *(v15 + 1) = 4 * *v46 + (rand(v48) >> 13);
          v8 = (v46 + 1);
          if ( *(v15 - 25) == 103 )
            *(v15 - 10) = 1024;
LABEL_11:
          *(v15 - 9) = (4 * v29);
          *(v15 - 7) = (4 * v30);
          v32 = *(v15 - 9);
          *(v15 - 8) = v31;
          v33 = *(v15 - 8);
          v34 = *(v15 - 7);
          *(v15 - 24) = 99;
          ResolveCurrentMetaTile(v32, v33, v34);
          v35 = 2;
          if ( !g_TileLayerOffset )
            v35 = 1;
          v36 = -1;
          *v13 = v35;
          goto LABEL_19;
        case 243:
          InitProjectileInstance(v13);
          *(v15 - 52) = 112;
          v53 = *v8++;
          *(v15 - 25) = v53;
          goto LABEL_18;
        case 244:
          v17 = *v8;
          v18 = v8 + 1;
          *v15 = v17;
          v19 = *v18;
          v8 = v18 + 1;
          *(v15 + 1) = v19;
          break;
        case 253:
LABEL_18:
          v36 = *v8++;
LABEL_19:
          *v15 = v36;
          break;
        case 255:
          *(v15 - 25) = 255;
          break;
        default:
          break;
      }
      v15 += 17;
      result = (++v14 < 396);
      v13 += 17;
    }
    while ( v14 < 396 );
  }
  return result;
}
// 80062BF0: using guessed type int __fastcall rand(_DWORD);
// 801DD57E: using guessed type __int16 g_TileLayerOffset;
// 8004B31C: using guessed type int var_28[10];

//----- (8004B694) --------------------------------------------------------
__int64 __fastcall sub_8004B694(int a1)
{
  char v2; // $v1
  int v3; // $v1
  int v4; // $a0
  int v5; // $v1
  char *v6; // $a1
  SpellDataEntry *v7; // $a0
  int v8; // $v1
  char PlayerHas; // $v0
  _DWORD *v10; // $t0
  char *v11; // $a2
  int v12; // $v1
  int v13; // $a0
  int v14; // $a1
  int v15; // $v1
  int v16; // $a0
  int v17; // $a1
  int v18; // $v1
  _DWORD *v19; // $t0
  char *v20; // $a2
  int v21; // $v1
  int v22; // $a0
  int v23; // $a1
  int *v24; // $t0
  int v25; // $v1
  int v26; // $a0
  int v27; // $a1
  int *v28; // $a2
  int v29; // $v1
  int v30; // $a0
  int v31; // $a1
  int v32; // $v1
  int v33; // $a0
  int v34; // $a1
  int v35; // $v1
  int v36; // $a0
  __int64 result; // $v0

  v2 = g_TitleBrightness;
  *a1 = g_TitleColor;
  *(a1 + 4) = v2;
  v3 = *&g_LanguageID[0].header[6];
  v4 = *&g_LanguageID[0].menus[0].header.posY;
  *(a1 + 14804) = *&g_LanguageID[0].header[2];
  *(a1 + 14808) = v3;
  *(a1 + 14812) = v4;
  *(a1 + 14816) = *&g_LanguageID[0].menus[0].header.height;
  v5 = *&g_LanguageID[0].menus[0].items[0].refY;
  *(a1 + 14820) = *&g_LanguageID[0].menus[0].header.extra[10];
  *(a1 + 14824) = v5;
  *(a1 + 14828) = dword_8019B4C4;
  *(a1 + 14832) = dword_8019B4C8;
  *(a1 + 14836) = g_PlayerGold;
  *(a1 + 14840) = word_8019B5EC;
  *(a1 + 14842) = g_MaxHP;
  *(a1 + 14844) = g_CurrentHP;
  *(a1 + 14846) = g_MaxMP;
  *(a1 + 14848) = g_CurrentMP;
  *(a1 + 14850) = g_Strength;
  *(a1 + 14852) = g_MagicPower;
  *(a1 + 14854) = word_8019B4E4;
  *(a1 + 14856) = word_8019B4E6;
  *(a1 + 14858) = g_PoisenStatus;
  *(a1 + 14860) = word_8019B51A;
  *(a1 + 14862) = word_8019B51C;
  *(a1 + 14864) = word_8019B51E;
  *(a1 + 14866) = word_8019B520;
  *(a1 + 14868) = word_8019B522;
  *(a1 + 14870) = g_AttackCooldown;
  *(a1 + 14872) = word_8019B526;
  *(a1 + 14874) = word_8019B528;
  *(a1 + 14876) = word_8019B52A;
  *(a1 + 14878) = word_8019B52C;
  *(a1 + 14880) = word_8019B52E;
  *(a1 + 14882) = word_8019B530;
  *(a1 + 14884) = word_8019B532;
  *(a1 + 14894) = byte_8019B4CC;
  *(a1 + 14895) = byte_8019B4CD;
  *(a1 + 14896) = g_EquippedHead;
  *(a1 + 14897) = g_EquippedBody;
  *(a1 + 14898) = g_EquippedShield;
  *(a1 + 14899) = g_EquippedArms;
  *(a1 + 14900) = g_EquippedLegs;
  *(a1 + 14901) = g_EquipAccessory1;
  *(a1 + 14902) = g_EquipAccessory2;
  *(a1 + 14903) = g_EquippedMagic;
  *(a1 + 14904) = g_QuickSlotItem;
  *(a1 + 14906) = g_EquippedWeapon;
  *(a1 + 14907) = g_Option_Sound;
  *(a1 + 14908) = g_Option_Music;
  *(a1 + 14909) = g_Option_ShowHPMP;
  v6 = (a1 + 14738);
  *(a1 + 14910) = g_Option_ShowCompass;
  v7 = g_SpellEntryTable;
  *(a1 + 14911) = g_Option_ShowPreviewItem3D;
  v8 = 63;
  *(a1 + 14912) = g_Option_WalkEffect;
  *(a1 + 14914) = *g_LanguageID[0].header;
  do
  {
    PlayerHas = v7->PlayerHas;
    v7 = (v7 + 26);
    --v8;
    *v6++ = PlayerHas;
  }
  while ( v8 != -1 );
  v10 = (a1 + 14618);
  v11 = g_InventoryCounts;
  if ( (((a1 + 26) | g_InventoryCounts) & 3) != 0 )
  {
    do
    {
      v12 = *(v11 + 1);
      v13 = *(v11 + 2);
      v14 = *(v11 + 3);
      *v10 = *v11;
      v10[1] = v12;
      v10[2] = v13;
      v10[3] = v14;
      v11 += 16;
      v10 += 4;
    }
    while ( v11 != &unk_8009DEE0 );
  }
  else
  {
    do
    {
      v15 = *(v11 + 1);
      v16 = *(v11 + 2);
      v17 = *(v11 + 3);
      *v10 = *v11;
      v10[1] = v15;
      v10[2] = v16;
      v10[3] = v17;
      v11 += 16;
      v10 += 4;
    }
    while ( v11 != &unk_8009DEE0 );
  }
  v18 = *(v11 + 1);
  *v10 = *v11;
  v10[1] = v18;
  v19 = (a1 + 5);
  v20 = byte_801B519C;
  if ( (((a1 + 5) | byte_801B519C) & 3) != 0 )
  {
    do
    {
      v21 = *(v20 + 1);
      v22 = *(v20 + 2);
      v23 = *(v20 + 3);
      *v19 = *v20;
      v19[1] = v21;
      v19[2] = v22;
      v19[3] = v23;
      v20 += 16;
      v19 += 4;
    }
    while ( v20 != byte_801B529C );
    v24 = (a1 + 261);
  }
  else
  {
    do
    {
      v25 = *(v20 + 1);
      v26 = *(v20 + 2);
      v27 = *(v20 + 3);
      *v19 = *v20;
      v19[1] = v25;
      v19[2] = v26;
      v19[3] = v27;
      v20 += 16;
      v19 += 4;
    }
    while ( v20 != byte_801B529C );
    v24 = (a1 + 261);
  }
  v28 = byte_801B529C;
  if ( ((v24 | byte_801B529C) & 3) != 0 )
  {
    do
    {
      v29 = v28[1];
      v30 = v28[2];
      v31 = v28[3];
      *v24 = *v28;
      v24[1] = v29;
      v24[2] = v30;
      v24[3] = v31;
      v28 += 4;
      v24 += 4;
    }
    while ( v28 != &dword_801B8A9C );
  }
  else
  {
    do
    {
      v32 = v28[1];
      v33 = v28[2];
      v34 = v28[3];
      *v24 = *v28;
      v24[1] = v32;
      v24[2] = v33;
      v24[3] = v34;
      v28 += 4;
      v24 += 4;
    }
    while ( v28 != &dword_801B8A9C );
  }
  v35 = dword_801B8AA0;
  v36 = dword_801B8AA4;
  *(a1 + 14598) = dword_801B8A9C;
  *(a1 + 14602) = v35;
  *(a1 + 14606) = v36;
  result = qword_801B8AA8;
  *(a1 + 14610) = qword_801B8AA8;
  return result;
}
// 801779D8: using guessed type int g_TitleColor;
// 801779DC: using guessed type char g_TitleBrightness;
// 8019B4C4: using guessed type int dword_8019B4C4;
// 8019B4C8: using guessed type int dword_8019B4C8;
// 8019B4CC: using guessed type char byte_8019B4CC;
// 8019B4CD: using guessed type char byte_8019B4CD;
// 8019B4D6: using guessed type __int16 g_MaxHP;
// 8019B4D8: using guessed type __int16 g_CurrentHP;
// 8019B4DA: using guessed type __int16 g_MaxMP;
// 8019B4DC: using guessed type __int16 g_CurrentMP;
// 8019B4E4: using guessed type __int16 word_8019B4E4;
// 8019B4E6: using guessed type __int16 word_8019B4E6;
// 8019B4E8: using guessed type __int16 g_Strength;
// 8019B4EA: using guessed type __int16 g_MagicPower;
// 8019B4F0: using guessed type int g_PlayerGold;
// 8019B518: using guessed type __int16 g_PoisenStatus;
// 8019B51A: using guessed type __int16 word_8019B51A;
// 8019B51C: using guessed type __int16 word_8019B51C;
// 8019B51E: using guessed type __int16 word_8019B51E;
// 8019B520: using guessed type __int16 word_8019B520;
// 8019B522: using guessed type __int16 word_8019B522;
// 8019B524: using guessed type __int16 g_AttackCooldown;
// 8019B526: using guessed type __int16 word_8019B526;
// 8019B528: using guessed type __int16 word_8019B528;
// 8019B52A: using guessed type __int16 word_8019B52A;
// 8019B52C: using guessed type __int16 word_8019B52C;
// 8019B52E: using guessed type __int16 word_8019B52E;
// 8019B530: using guessed type __int16 word_8019B530;
// 8019B532: using guessed type __int16 word_8019B532;
// 8019B55B: using guessed type char g_EquippedMagic;
// 8019B55C: using guessed type __int16 g_QuickSlotItem;
// 8019B55F: using guessed type char g_EquippedWeapon;
// 8019B584: using guessed type char g_EquippedHead;
// 8019B585: using guessed type char g_EquippedBody;
// 8019B586: using guessed type char g_EquippedShield;
// 8019B587: using guessed type char g_EquippedArms;
// 8019B588: using guessed type char g_EquippedLegs;
// 8019B589: using guessed type char g_EquipAccessory1;
// 8019B58A: using guessed type char g_EquipAccessory2;
// 8019B58B: using guessed type char g_Option_Sound;
// 8019B58C: using guessed type char g_Option_Music;
// 8019B58D: using guessed type char g_Option_ShowHPMP;
// 8019B58E: using guessed type char g_Option_ShowCompass;
// 8019B58F: using guessed type char g_Option_ShowPreviewItem3D;
// 8019B590: using guessed type char g_Option_WalkEffect;
// 8019B5EC: using guessed type __int16 word_8019B5EC;
// 801B8A9C: using guessed type int dword_801B8A9C;
// 801B8AA0: using guessed type int dword_801B8AA0;
// 801B8AA4: using guessed type int dword_801B8AA4;
// 801B8AA8: using guessed type __int64 qword_801B8AA8;

//----- (8004BC5C) --------------------------------------------------------
__int64 __fastcall sub_8004BC5C(int a1)
{
  int v2; // $v1
  int v3; // $v1
  int v4; // $a0
  int v5; // $v1
  char *v6; // $a1
  SpellDataEntry *v7; // $a0
  int v8; // $v1
  char v9; // $v0
  char *v10; // $t0
  _DWORD *v11; // $a2
  int v12; // $t1
  int v13; // $v1
  int v14; // $a0
  int v15; // $a1
  int v16; // $v1
  int v17; // $a0
  int v18; // $a1
  int v19; // $v1
  char *v20; // $t0
  _DWORD *v21; // $a2
  int v22; // $t1
  int v23; // $v1
  int v24; // $a0
  int v25; // $a1
  int v26; // $v1
  int v27; // $a0
  int v28; // $a1
  char *v29; // $t0
  _DWORD *v30; // $a2
  int v31; // $t1
  int v32; // $v1
  int v33; // $a0
  int v34; // $a1
  int v35; // $v1
  int v36; // $a0
  int v37; // $a1
  int v38; // $v1
  int v39; // $a0
  __int64 result; // $v0

  v2 = *a1;
  g_TitleColor = v2;
  BYTE1(g_TitleColor) = v2;
  BYTE2(g_TitleColor) = v2;
  HIBYTE(g_TitleColor) = v2;
  g_TitleBrightness = v2;
  v3 = *(a1 + 14808);
  v4 = *(a1 + 14812);
  *&g_LanguageID[0].header[2] = *(a1 + 14804);
  *&g_LanguageID[0].header[6] = v3;
  *&g_LanguageID[0].menus[0].header.posY = v4;
  *&g_LanguageID[0].menus[0].header.height = *(a1 + 14816);
  v5 = *(a1 + 14824);
  *&g_LanguageID[0].menus[0].header.extra[10] = *(a1 + 14820);
  *&g_LanguageID[0].menus[0].items[0].refY = v5;
  dword_8019B4C4 = *(a1 + 14828);
  dword_8019B4C8 = *(a1 + 14832);
  g_PlayerGold = *(a1 + 14836);
  word_8019B5EC = *(a1 + 14840);
  g_MaxHP = *(a1 + 14842);
  g_CurrentHP = *(a1 + 14844);
  g_MaxMP = *(a1 + 14846);
  g_CurrentMP = *(a1 + 14848);
  g_Strength = *(a1 + 14850);
  g_MagicPower = *(a1 + 14852);
  word_8019B4E4 = *(a1 + 14854);
  word_8019B4E6 = *(a1 + 14856);
  g_PoisenStatus = *(a1 + 14858);
  word_8019B51A = *(a1 + 14860);
  word_8019B51C = *(a1 + 14862);
  word_8019B51E = *(a1 + 14864);
  word_8019B520 = *(a1 + 14866);
  word_8019B522 = *(a1 + 14868);
  g_AttackCooldown = *(a1 + 14870);
  word_8019B526 = *(a1 + 14872);
  word_8019B528 = *(a1 + 14874);
  word_8019B52A = *(a1 + 14876);
  word_8019B52C = *(a1 + 14878);
  word_8019B52E = *(a1 + 14880);
  word_8019B530 = *(a1 + 14882);
  word_8019B532 = *(a1 + 14884);
  byte_8019B4CC = *(a1 + 14894);
  byte_8019B4CD = *(a1 + 14895);
  g_EquippedHead = *(a1 + 14896);
  g_EquippedBody = *(a1 + 14897);
  g_EquippedShield = *(a1 + 14898);
  g_EquippedArms = *(a1 + 14899);
  g_EquippedLegs = *(a1 + 14900);
  g_EquipAccessory1 = *(a1 + 14901);
  g_EquipAccessory2 = *(a1 + 14902);
  g_EquippedMagic = *(a1 + 14903);
  g_QuickSlotItem = *(a1 + 14904);
  g_EquippedWeapon = *(a1 + 14906);
  g_Option_Sound = *(a1 + 14907);
  g_Option_Music = *(a1 + 14908);
  g_Option_ShowHPMP = *(a1 + 14909);
  g_Option_ShowCompass = *(a1 + 14910);
  v6 = (a1 + 14738);
  g_Option_ShowPreviewItem3D = *(a1 + 14911);
  v7 = g_SpellEntryTable;
  g_Option_WalkEffect = *(a1 + 14912);
  v8 = 63;
  *g_LanguageID[0].header = *(a1 + 14914);
  do
  {
    v9 = *v6++;
    --v8;
    v7->PlayerHas = v9;
    v7 = (v7 + 26);
  }
  while ( v8 != -1 );
  v10 = g_InventoryCounts;
  v11 = (a1 + 14618);
  v12 = a1 + 14730;
  if ( (((a1 + 26) | g_InventoryCounts) & 3) != 0 )
  {
    do
    {
      v13 = v11[1];
      v14 = v11[2];
      v15 = v11[3];
      *v10 = *v11;
      *(v10 + 1) = v13;
      *(v10 + 2) = v14;
      *(v10 + 3) = v15;
      v11 += 4;
      v10 += 16;
    }
    while ( v11 != v12 );
  }
  else
  {
    do
    {
      v16 = v11[1];
      v17 = v11[2];
      v18 = v11[3];
      *v10 = *v11;
      *(v10 + 1) = v16;
      *(v10 + 2) = v17;
      *(v10 + 3) = v18;
      v11 += 4;
      v10 += 16;
    }
    while ( v11 != v12 );
  }
  v19 = v11[1];
  *v10 = *v11;
  *(v10 + 1) = v19;
  v20 = byte_801B519C;
  v21 = (a1 + 5);
  v22 = a1 + 261;
  if ( (((a1 + 5) | byte_801B519C) & 3) != 0 )
  {
    do
    {
      v23 = v21[1];
      v24 = v21[2];
      v25 = v21[3];
      *v20 = *v21;
      *(v20 + 1) = v23;
      *(v20 + 2) = v24;
      *(v20 + 3) = v25;
      v21 += 4;
      v20 += 16;
    }
    while ( v21 != v22 );
  }
  else
  {
    do
    {
      v26 = v21[1];
      v27 = v21[2];
      v28 = v21[3];
      *v20 = *v21;
      *(v20 + 1) = v26;
      *(v20 + 2) = v27;
      *(v20 + 3) = v28;
      v21 += 4;
      v20 += 16;
    }
    while ( v21 != v22 );
  }
  v29 = byte_801B529C;
  v30 = (a1 + 261);
  v31 = a1 + 14597;
  if ( (((a1 + 5) | byte_801B529C) & 3) != 0 )
  {
    do
    {
      v32 = v30[1];
      v33 = v30[2];
      v34 = v30[3];
      *v29 = *v30;
      *(v29 + 1) = v32;
      *(v29 + 2) = v33;
      *(v29 + 3) = v34;
      v30 += 4;
      v29 += 16;
    }
    while ( v30 != v31 );
  }
  else
  {
    do
    {
      v35 = v30[1];
      v36 = v30[2];
      v37 = v30[3];
      *v29 = *v30;
      *(v29 + 1) = v35;
      *(v29 + 2) = v36;
      *(v29 + 3) = v37;
      v30 += 4;
      v29 += 16;
    }
    while ( v30 != v31 );
  }
  v38 = *(a1 + 14602);
  v39 = *(a1 + 14606);
  dword_801B8A9C = *(a1 + 14598);
  dword_801B8AA0 = v38;
  dword_801B8AA4 = v39;
  result = *(a1 + 14610);
  LODWORD(qword_801B8AA8) = *(a1 + 14610);
  HIDWORD(qword_801B8AA8) = HIDWORD(result);
  return result;
}
// 801779D8: using guessed type int g_TitleColor;
// 801779DC: using guessed type char g_TitleBrightness;
// 8019B4C4: using guessed type int dword_8019B4C4;
// 8019B4C8: using guessed type int dword_8019B4C8;
// 8019B4CC: using guessed type char byte_8019B4CC;
// 8019B4CD: using guessed type char byte_8019B4CD;
// 8019B4D6: using guessed type __int16 g_MaxHP;
// 8019B4D8: using guessed type __int16 g_CurrentHP;
// 8019B4DA: using guessed type __int16 g_MaxMP;
// 8019B4DC: using guessed type __int16 g_CurrentMP;
// 8019B4E4: using guessed type __int16 word_8019B4E4;
// 8019B4E6: using guessed type __int16 word_8019B4E6;
// 8019B4E8: using guessed type __int16 g_Strength;
// 8019B4EA: using guessed type __int16 g_MagicPower;
// 8019B4F0: using guessed type int g_PlayerGold;
// 8019B518: using guessed type __int16 g_PoisenStatus;
// 8019B51A: using guessed type __int16 word_8019B51A;
// 8019B51C: using guessed type __int16 word_8019B51C;
// 8019B51E: using guessed type __int16 word_8019B51E;
// 8019B520: using guessed type __int16 word_8019B520;
// 8019B522: using guessed type __int16 word_8019B522;
// 8019B524: using guessed type __int16 g_AttackCooldown;
// 8019B526: using guessed type __int16 word_8019B526;
// 8019B528: using guessed type __int16 word_8019B528;
// 8019B52A: using guessed type __int16 word_8019B52A;
// 8019B52C: using guessed type __int16 word_8019B52C;
// 8019B52E: using guessed type __int16 word_8019B52E;
// 8019B530: using guessed type __int16 word_8019B530;
// 8019B532: using guessed type __int16 word_8019B532;
// 8019B55B: using guessed type char g_EquippedMagic;
// 8019B55C: using guessed type __int16 g_QuickSlotItem;
// 8019B55F: using guessed type char g_EquippedWeapon;
// 8019B584: using guessed type char g_EquippedHead;
// 8019B585: using guessed type char g_EquippedBody;
// 8019B586: using guessed type char g_EquippedShield;
// 8019B587: using guessed type char g_EquippedArms;
// 8019B588: using guessed type char g_EquippedLegs;
// 8019B589: using guessed type char g_EquipAccessory1;
// 8019B58A: using guessed type char g_EquipAccessory2;
// 8019B58B: using guessed type char g_Option_Sound;
// 8019B58C: using guessed type char g_Option_Music;
// 8019B58D: using guessed type char g_Option_ShowHPMP;
// 8019B58E: using guessed type char g_Option_ShowCompass;
// 8019B58F: using guessed type char g_Option_ShowPreviewItem3D;
// 8019B590: using guessed type char g_Option_WalkEffect;
// 8019B5EC: using guessed type __int16 word_8019B5EC;
// 801B8A9C: using guessed type int dword_801B8A9C;
// 801B8AA0: using guessed type int dword_801B8AA0;
// 801B8AA4: using guessed type int dword_801B8AA4;
// 801B8AA8: using guessed type __int64 qword_801B8AA8;

//----- (8004C24C) --------------------------------------------------------
void nullsub_3()
{
  ;
}

//----- (8004C254) --------------------------------------------------------
int start()
{
  return sub_80013A5C();
}

//----- (8004C264) --------------------------------------------------------
// write access to const memory has been detected, the output may be wrong!
int __fastcall sub_8004C264(int a1)
{
  int v2; // $a1

  if ( !a1 || a1 > -8 )
    return -1;
  v2 = a1 + 4;
  *(4 * (a1 / 4)) = -2;
  MEMORY[0xFFFFFFFC] = a1 | 1;
  if ( a1 + 4 < 0 )
    v2 = a1 + 7;
  dword_80076404 = 4 * (v2 >> 2);
  return 0;
}
// 8004C344: write access to const memory at 80076404 has been detected
// 8004C27C: conditional instruction was optimized away because $a0.4!=0
// 8004C2CC: conditional instruction was optimized away because $a0.4==0
// 80076404: using guessed type int dword_80076404;
// 8007640C: using guessed type int dword_8007640C;
// 80076414: using guessed type int dword_80076414;

//----- (8004C358) --------------------------------------------------------
// write access to const memory has been detected, the output may be wrong!
int __fastcall sub_8004C358(int a1, int a2)
{
  unsigned int v2; // $a1
  int v3; // $v0
  unsigned int *v4; // $t1
  int result; // $v0
  int v6; // $a3
  unsigned int v7; // $t0
  int v8; // $a2
  int v9; // $v0

  v2 = (a2 + 3) & 0xFFFFFFFC;
  v3 = *(a1 - 4);
  v4 = (a1 - 4);
  if ( v3 == -2 )
    return 0;
  if ( (v3 & 0xFFFFFFFE) < v2 )
  {
    v6 = a1 - 4;
    v7 = v3 & 0xFFFFFFFE;
    do
    {
      v8 = v6 + 4 * (*v6 >> 2);
      v9 = *(v8 + 4);
      v6 = v8 + 4;
      if ( v9 == -2 )
      {
        if ( (-v6 >> 2) - 4 < v2 - v7 )
          break;
        *(v8 + 4) = (v2 - v7) | 1;
        *(v6 + 4 * ((v2 - v7) >> 2)) = -2;
        dword_80076404 = 4;
      }
      else if ( (v9 & 1) == 0 )
      {
        break;
      }
      *v4 += *v6 & 0xFFFFFFFE;
      v7 += *v6 & 0xFFFFFFFE;
    }
    while ( v7 < v2 );
  }
  if ( v2 >= (*v4 & 0xFFFFFFFC) )
  {
    result = a1;
    if ( (*v4 & 0xFFFFFFFE) >= v2 )
      return result;
    return 0;
  }
  else
  {
    *(4 * (v2 / 4) + a1) = (*(a1 - 4) & 0xFFFFFFFE) - v2 - 4;
    *(4 * (v2 / 4) + a1) |= 1u;
    *v4 = v2 | *v4 & 1;
  }
  return a1;
}
// 8004C404: write access to const memory at 80076404 has been detected
// 8004C420: write access to const memory at 80076404 has been detected
// 80076404: using guessed type int dword_80076404;
// 80076414: using guessed type int dword_80076414;

//----- (8004C500) --------------------------------------------------------
// write access to const memory has been detected, the output may be wrong!
unsigned int __fastcall sub_8004C500(_DWORD *a1, unsigned int a2)
{
  unsigned int result; // $v0

  dword_80076404 = a1;
  *a1 = 0;
  result = a2 >> 2;
  dword_80076414 = &a1[result + 1];
  dword_8007640C = a2 - 4;
  dword_8007641C = 0;
  return result * 4;
}
// 8004C500: write access to const memory at 80076404 has been detected
// 8004C51C: write access to const memory at 80076414 has been detected
// 8004C528: write access to const memory at 8007640C has been detected
// 8004C530: write access to const memory at 8007641C has been detected
// 80076404: using guessed type int dword_80076404;
// 8007640C: using guessed type int dword_8007640C;
// 80076414: using guessed type int dword_80076414;
// 8007641C: using guessed type int dword_8007641C;

//----- (8004C540) --------------------------------------------------------
// write access to const memory has been detected, the output may be wrong!
int AllocateMemor_01()
{
  return 0;
}
// 8004C5A8: write access to const memory at 80076404 has been detected
// 8004C5CC: write access to const memory at 8007641C has been detected
// 8004C67C: write access to const memory at 80076404 has been detected
// 80076404: using guessed type int dword_80076404;
// 80076414: using guessed type int dword_80076414;
// 8007641C: using guessed type int dword_8007641C;
// 8009DE68: using guessed type int dword_8009DE68;
// 8009E114: using guessed type int dword_8009E114;

//----- (8004C774) --------------------------------------------------------
int __fastcall Mem_FreeBlock(int dataPtr)
{
  int result; // $v0

  result = *(dataPtr - 4) | 1;
  *(dataPtr - 4) = result;
  return result;
}

//----- (8004CF24) --------------------------------------------------------
int __fastcall CdCheckStatus(int a1, _BYTE *a2)
{
  return CdWaitForCompletion(a1, a2);
}

//----- (8004CF44) --------------------------------------------------------
int __fastcall CdReadWithRetry(int a1, int a2, int a3)
{
  int v6; // $s0
  int v7; // $a0

  v6 = 3;                                       // //  3 !
  v7 = a2;
  do
  {
    --v6;
    if ( !SetupDmaTransfer(v7, a1, a3) )        //    DMA 
      return 1;                                 //  !
    v7 = a2;
  }
  while ( v6 != -1 );
  return 0;                                     //  3  
}

//----- (8004CFC4) --------------------------------------------------------
_BYTE *__fastcall SectorToMSF(int a1, _BYTE *a2)
{
  int v2; // $a0
  _BYTE *result; // $v0

  v2 = a1 + 150;
  result = a2;
  a2[1] = 16 * (v2 / 75 % 60 / 10) + v2 / 75 % 60 % 10;
  a2[2] = 16 * (v2 % 75 / 10) + v2 % 75 % 10;
  *a2 = 16 * (v2 / 75 / 60 / 10) + v2 / 75 / 60 % 10;
  return result;
}

//----- (8004D148) --------------------------------------------------------
// write access to const memory has been detected, the output may be wrong!
int sub_8004D148()
{
  char *v1; // $v1
  int v2; // $a0
  BOOL v3; // $v0
  char *v4; // $v1
  int v5; // $s0
  int *v6; // $v1
  char *v7; // $a1
  int k; // $a0
  char v9; // $v0
  int *v10; // $v1
  char *v11; // $a1
  int m; // $a0
  char v13; // $v0
  char v14; // $v0
  int *v15; // $v1
  char *v16; // $a1
  int j; // $a0
  char v18; // $v0
  char v19; // $v0
  int *v20; // $v1
  char *v21; // $a1
  int i; // $a0
  char v23; // $v0
  int *v24; // $a0
  char *v25; // $a1
  int v26; // $v1
  char v27; // $v0
  int *v28; // $v1
  char *v29; // $a1
  int n; // $a0
  char v31; // $v0
  int *v32; // $a0
  char *v33; // $a1
  int v34; // $v1
  char v35; // $v0
  int *v36; // $v1
  char *v37; // $a1
  int ii; // $a0
  char v39; // $v0
  unsigned __int8 v40; // [sp+10h] [-10h]
  char v41[8]; // [sp+18h] [-8h] BYREF

  MEMORY[0x1F801800] = 1;
  v40 = MEMORY[0x1F801803] & 7;
  if ( (MEMORY[0x1F801803] & 7) == 0 )
    return 0;
  while ( 1 )
  {
    v1 = v41;
    if ( v40 == (MEMORY[0x1F801803] & 7) )
      break;
    v40 = MEMORY[0x1F801803] & 7;
  }
  v2 = 0;
  while ( 1 )
  {
    v3 = v2 < 8;
    if ( (MEMORY[0x1F801800] & 0x20) == 0 )
      break;
    ++v2;
    *v1++ = MEMORY[0x1F801801];
    if ( v2 >= 8 )
    {
      v3 = v2 < 8;
      break;
    }
  }
  if ( v3 )
  {
    v4 = &v41[v2];
    do
    {
      *v4 = 0;
      ++v2;
      ++v4;
    }
    while ( v2 < 8 );
  }
  MEMORY[0x1F801800] = 1;
  MEMORY[0x1F801803] = 7;
  MEMORY[0x1F801802] = 7;
  if ( (v41[0] & 0x10) != 0 )
    dword_8006F490 = 1;
  v5 = v41[0] & 0x1D;
  dword_8006F488 = v41[0];
  dword_8006F48C = v41[1];
  if ( v40 == 5 )
    sub_80062C20();
  switch ( v40 )
  {
    case 1u:
      v19 = 1;
      if ( v5 )
        v19 = 5;
      byte_8006F755 = v19;
      v20 = g_CdStatusRegisters;
      v21 = v41;
      if ( !g_CdStatusRegisters )
        return 4;
      for ( i = 7; i != -1; --i )
      {
        v23 = *v21++;
        *v20 = v23;
        v20 = (v20 + 1);
      }
      return 4;
    case 2u:
      v14 = 2;
      if ( v5 )
        v14 = 5;
      byte_8006F754 = v14;
      v15 = dword_80076490;
      v16 = v41;
      if ( dword_80076490 )
      {
        for ( j = 7; j != -1; --j )
        {
          v18 = *v16++;
          *v15 = v18;
          v15 = (v15 + 1);
        }
      }
      return 2;
    case 3u:
      if ( v5 )
      {
        byte_8006F754 = 5;
        v6 = dword_80076490;
        v7 = v41;
        if ( dword_80076490 )
        {
          for ( k = 7; k != -1; --k )
          {
            v9 = *v7++;
            *v6 = v9;
            v6 = (v6 + 1);
          }
          return 2;
        }
        return 2;
      }
      byte_8006F754 = 2;
      v10 = dword_80076490;
      v11 = v41;
      if ( !dword_80076490 )
        return 2;
      for ( m = 7; m != -1; --m )
      {
        v13 = *v11++;
        *v10 = v13;
        v10 = (v10 + 1);
      }
      return 2;
    case 4u:
      v24 = dword_800764A0;
      v25 = v41;
      byte_8006F756 = 4;
      byte_8006F755 = 0;
      v26 = 7;
      if ( dword_800764A0 )
      {
        do
        {
          v27 = *v25++;
          --v26;
          *v24 = v27;
          v24 = (v24 + 1);
        }
        while ( v26 != -1 );
      }
      v28 = g_CdStatusRegisters;
      v29 = v41;
      if ( g_CdStatusRegisters )
      {
        for ( n = 7; n != -1; --n )
        {
          v31 = *v29++;
          *v28 = v31;
          v28 = (v28 + 1);
        }
      }
      return 4;
    case 5u:
      v32 = dword_80076490;
      v33 = v41;
      byte_8006F755 = 5;
      byte_8006F754 = 0;
      v34 = 7;
      if ( dword_80076490 )
      {
        do
        {
          v35 = *v33++;
          --v34;
          *v32 = v35;
          v32 = (v32 + 1);
        }
        while ( v34 != -1 );
      }
      v36 = g_CdStatusRegisters;
      v37 = v41;
      if ( g_CdStatusRegisters )
      {
        for ( ii = 7; ii != -1; --ii )
        {
          v39 = *v37++;
          *v36 = v39;
          v36 = (v36 + 1);
        }
      }
      return 6;
    default:
      sub_80062C20();
      printf("(%d)\n", v40);
      return -1;
  }
}
// 8004D2D4: write access to const memory at 8006F490 has been detected
// 8004D2EC: write access to const memory at 8006F488 has been detected
// 8004D2F4: write access to const memory at 8006F48C has been detected
// 8004D4B4: write access to const memory at 8006F754 has been detected
// 8004D500: write access to const memory at 8006F755 has been detected
// 8004D550: write access to const memory at 8006F756 has been detected
// 8004D5D8: write access to const memory at 8006F755 has been detected
// 8004D3B4: write access to const memory at 8006F754 has been detected
// 8004D424: write access to const memory at 8006F754 has been detected
// 8004D46C: write access to const memory at 8006F754 has been detected
// 8004D568: write access to const memory at 8006F755 has been detected
// 8004D5F0: write access to const memory at 8006F754 has been detected
// 80062BA0: using guessed type int printf(const char *, ...);
// 8006F488: using guessed type int dword_8006F488;
// 8006F48C: using guessed type int dword_8006F48C;
// 8006F490: using guessed type int dword_8006F490;
// 8006F499: using guessed type char byte_8006F499;
// 8006F754: using guessed type char byte_8006F754;
// 8006F755: using guessed type char byte_8006F755;
// 8006F756: using guessed type char byte_8006F756;
// 80076490: using guessed type int dword_80076490[2];
// 80076498: using guessed type int g_CdStatusRegisters[2];
// 800764A0: using guessed type int dword_800764A0[2];

//----- (8004D68C) --------------------------------------------------------
// write access to const memory has been detected, the output may be wrong!
int __fastcall InitDmaChannel(int a1)
{
  int v2; // $v0
  bool v3; // dc
  int result; // $v0
  char v5; // $s1

  dword_800764A8 = VSync(-1) + 480;
  dword_800764AC = 0;
  dword_800764B0 = "CD_sync";
  do
  {
    if ( VSync(-1) > 0 )
    {
      sub_80062C20();
      printf("%s:(%s) Sync=%s, Ready=%s\n", 0, "CdlSync", "NoIntr", "NoIntr");
      sub_8004E1E0();
      v2 = -1;
    }
    else
    {
      dword_800764AC = 1;
      v2 = 0;
    }
    v3 = v2 != 0;
    result = -1;
    if ( v3 )
      break;
    if ( CheckCallback() )
    {
      v5 = MEMORY[0x1F801800] & 3;
      while ( sub_8004D148() )
        ;
      MEMORY[0x1F801800] = v5;
    }
    result = 0;
  }
  while ( !a1 );
  return result;
}
// 8004D6D8: write access to const memory at 800764A8 has been detected
// 8004D6E8: write access to const memory at 800764AC has been detected
// 8004D6F0: write access to const memory at 800764B0 has been detected
// 8004D728: write access to const memory at 800764AC has been detected
// 8004D8A0: write access to const memory at 8006F754 has been detected
// 8004D894: conditional instruction was optimized away because $a2.4==0
// 80000000: using guessed type int (__fastcall *unk_80000000)(_DWORD, _DWORD);
// 80062BA0: using guessed type int printf(const char *, ...);
// 8006F478: using guessed type int dword_8006F478;
// 8006F47C: using guessed type int dword_8006F47C;
// 8006F499: using guessed type char byte_8006F499;
// 8006F754: using guessed type char byte_8006F754;
// 8006F755: using guessed type char byte_8006F755;
// 800764A8: using guessed type int dword_800764A8;
// 800764AC: using guessed type int dword_800764AC;
// 800764B0: using guessed type int dword_800764B0;

//----- (8004D910) --------------------------------------------------------
// write access to const memory has been detected, the output may be wrong!
int __fastcall sub_8004D910(int a1)
{
  int v2; // $v0
  bool v3; // dc
  int result; // $v0
  char v5; // $s1

  dword_800764A8 = VSync(-1) + 480;
  dword_800764AC = 0;
  dword_800764B0 = "CD_ready";
  do
  {
    if ( VSync(-1) > 0 )
    {
      sub_80062C20();
      printf("%s:(%s) Sync=%s, Ready=%s\n", 0, "CdlSync", "NoIntr", "NoIntr");
      sub_8004E1E0();
      v2 = -1;
    }
    else
    {
      dword_800764AC = 1;
      v2 = 0;
    }
    v3 = v2 != 0;
    result = -1;
    if ( v3 )
      break;
    if ( CheckCallback() )
    {
      v5 = MEMORY[0x1F801800] & 3;
      while ( sub_8004D148() )
        ;
      MEMORY[0x1F801800] = v5;
    }
    result = 0;
  }
  while ( !a1 );
  return result;
}
// 8004D964: write access to const memory at 800764A8 has been detected
// 8004D974: write access to const memory at 800764AC has been detected
// 8004D97C: write access to const memory at 800764B0 has been detected
// 8004D9B4: write access to const memory at 800764AC has been detected
// 8004DB1C: write access to const memory at 8006F756 has been detected
// 8004DB6C: write access to const memory at 8006F755 has been detected
// 80000000: using guessed type int (__fastcall *unk_80000000)(_DWORD, _DWORD);
// 80062BA0: using guessed type int printf(const char *, ...);
// 8006F478: using guessed type int dword_8006F478;
// 8006F47C: using guessed type int dword_8006F47C;
// 8006F499: using guessed type char byte_8006F499;
// 8006F754: using guessed type char byte_8006F754;
// 8006F755: using guessed type char byte_8006F755;
// 8006F756: using guessed type char byte_8006F756;
// 800764A8: using guessed type int dword_800764A8;
// 800764AC: using guessed type int dword_800764AC;
// 800764B0: using guessed type int dword_800764B0;

//----- (8004DBE0) --------------------------------------------------------
// write access to const memory has been detected, the output may be wrong!
int __fastcall sub_8004DBE0(unsigned __int8 a1, char *a2, int a3, int a4)
{
  int result; // $v0
  int v8; // $a0
  char *v9; // $v1
  int v10; // $a0
  int *v11; // $v1
  int v12; // $a0
  char *v13; // $a1
  char v14; // $v0
  int v15; // $v0
  bool v16; // dc
  char v17; // $s1

  if ( dword_8006F6BC[a1] && !a2 )
    return -2;
  InitDmaChannel(0);
  v8 = 0;
  if ( a1 == 2 )
  {
    v9 = a2;
    do
      byte_8006F494[v8++] = *v9++;
    while ( v8 < 4 );
  }
  byte_8006F754 = 0;
  v10 = a1;
  if ( dword_8006F5BC[v10] )
    byte_8006F755 = 0;
  MEMORY[0x1F801800] = 0;
  v11 = &dword_8006F6BC[v10];
  v12 = 0;
  if ( *v11 > 0 )
  {
    v13 = a2;
    do
    {
      v14 = *v13++;
      MEMORY[0x1F801802] = v14;
      ++v12;
    }
    while ( v12 < *v11 );
  }
  byte_8006F499 = a1;
  MEMORY[0x1F801801] = a1;
  result = 0;
  if ( !a4 )
  {
    dword_800764A8 = VSync(-1) + 480;
    dword_800764AC = 0;
    dword_800764B0 = "CD_cw";
    while ( 1 )
    {
      if ( VSync(-1) > 0 )
      {
        sub_80062C20();
        printf("%s:(%s) Sync=%s, Ready=%s\n", 0, "CdlSync", "NoIntr", "NoIntr");
        sub_8004E1E0();
        v15 = -1;
      }
      else
      {
        dword_800764AC = 1;
        v15 = 0;
      }
      v16 = v15 != 0;
      result = -1;
      if ( v16 )
        break;
      if ( CheckCallback() )
      {
        v17 = MEMORY[0x1F801800] & 3;
        while ( sub_8004D148() )
          ;
        MEMORY[0x1F801800] = v17;
      }
    }
  }
  return result;
}
// 8004DD30: write access to const memory at 8006F755 has been detected
// 8004DD98: write access to const memory at 8006F499 has been detected
// 8004DDC0: write access to const memory at 800764A8 has been detected
// 8004DDC8: write access to const memory at 800764AC has been detected
// 8004DDDC: write access to const memory at 800764B0 has been detected
// 8004DE2C: write access to const memory at 800764AC has been detected
// 8004DFC4: write access to const memory at 8006F498 has been detected
// 8004DD04: write access to const memory at 8006F754 has been detected
// 80000000: using guessed type int (__fastcall *unk_80000000)(_DWORD, _DWORD);
// 80062BA0: using guessed type int printf(const char *, ...);
// 8006F478: using guessed type int dword_8006F478;
// 8006F47C: using guessed type int dword_8006F47C;
// 8006F498: using guessed type char byte_8006F498;
// 8006F499: using guessed type char byte_8006F499;
// 8006F5BC: using guessed type int dword_8006F5BC[3];
// 8006F6BC: using guessed type int dword_8006F6BC[2];
// 8006F754: using guessed type char byte_8006F754;
// 8006F755: using guessed type char byte_8006F755;
// 800764A8: using guessed type int dword_800764A8;
// 800764AC: using guessed type int dword_800764AC;
// 800764B0: using guessed type int dword_800764B0;

//----- (8004E048) --------------------------------------------------------
int __fastcall sub_8004E048(_BYTE *a1)
{
  MEMORY[0x1F801800] = 2;
  MEMORY[0x1F801802] = *a1;
  MEMORY[0x1F801803] = a1[1];
  MEMORY[0x1F801800] = 3;
  MEMORY[0x1F801801] = a1[2];
  MEMORY[0x1F801802] = a1[3];
  MEMORY[0x1F801803] = 32;
  return 0;
}

//----- (8004E0D0) --------------------------------------------------------
// write access to const memory has been detected, the output may be wrong!
int sub_8004E0D0()
{
  return 0;
}
// 8004E10C: write access to const memory at 8006F478 has been detected
// 8004E1B8: write access to const memory at 8006F478 has been detected
// 8004E1C0: write access to const memory at 8006F780 has been detected
// 8006F478: using guessed type int dword_8006F478;
// 8006F488: using guessed type int dword_8006F488;
// 8006F490: using guessed type int dword_8006F490;
// 8006F780: using guessed type int dword_8006F780;

//----- (8004E1E0) --------------------------------------------------------
// write access to const memory has been detected, the output may be wrong!
int sub_8004E1E0()
{
  int result; // $v0

  MEMORY[0x1F801800] = 1;
  if ( (MEMORY[0x1F801803] & 7) != 0 )
  {
    while ( 1 )
    {
      MEMORY[0x1F801800] = 1;
      MEMORY[0x1F801803] = 7;
      MEMORY[0x1F801802] = 7;
    }
  }
  byte_8006F756 = 0;
  byte_8006F498 = 0;
  byte_8006F755 = 0;
  byte_8006F754 = 2;
  MEMORY[0x1F801800] = 0;
  MEMORY[0x1F801803] = 0;
  result = 4901;
  MEMORY[0x1F801020] = 4901;
  return result;
}
// 8004E264: write access to const memory at 8006F756 has been detected
// 8004E27C: write access to const memory at 8006F498 has been detected
// 8004E294: write access to const memory at 8006F754 has been detected
// 8004E284: write access to const memory at 8006F755 has been detected
// 8006F498: using guessed type char byte_8006F498;
// 8006F754: using guessed type char byte_8006F754;
// 8006F755: using guessed type char byte_8006F755;
// 8006F756: using guessed type char byte_8006F756;

//----- (8004E2C8) --------------------------------------------------------
int sub_8004E2C8()
{
  if ( !MEMORY[0x1F801DB8] && !MEMORY[0x1F801DBA] )
  {
    MEMORY[0x1F801D80] = 0x3FFF;
    MEMORY[0x1F801D82] = 0x3FFF;
  }
  MEMORY[0x1F801DB0] = 0x3FFF;
  MEMORY[0x1F801DB2] = 0x3FFF;
  MEMORY[0x1F801DAA] = -16383;
  MEMORY[0x1F801800] = 3;
  MEMORY[0x1F801801] = 0x80;
  MEMORY[0x1F801802] = 0;
  MEMORY[0x1F801803] = 32;
  return 0;
}

//----- (8004E3BC) --------------------------------------------------------
// write access to const memory has been detected, the output may be wrong!
int sub_8004E3BC()
{
  int *v0; // $v1
  int v1; // $v0

  v0 = &g_DmaChannel;
  v1 = 9;
  dword_8006F47C = 0;
  dword_8006F478 = 0;
  dword_8006F48C = 0;
  dword_8006F488 = 0;
  do
  {
    *v0 = 0;
    --v1;
    ++v0;
  }
  while ( v1 != -1 );
  ResetCallback();
  return InterruptCallback(2, sub_8004F0C4);
}
// 8004E3D4: write access to const memory at 8006F47C has been detected
// 8004E3DC: write access to const memory at 8006F478 has been detected
// 8004E3E4: write access to const memory at 8006F48C has been detected
// 8004E3EC: write access to const memory at 8006F488 has been detected
// 8004F0C4: using guessed type int sub_8004F0C4();
// 80061B84: using guessed type int __fastcall InterruptCallback(_DWORD, _DWORD);
// 8006F478: using guessed type int dword_8006F478;
// 8006F47C: using guessed type int dword_8006F47C;
// 8006F488: using guessed type int dword_8006F488;
// 8006F48C: using guessed type int dword_8006F48C;
// 8006F758: using guessed type int g_DmaChannel;

//----- (8004E42C) --------------------------------------------------------
// write access to const memory has been detected, the output may be wrong!
int sub_8004E42C()
{
  int *v0; // $v1
  int v1; // $v0
  bool v2; // dc
  int result; // $v0

  sub_80062C20();
  printf("addr=%08x\n", &off_8006F788);
  v0 = &g_DmaChannel;
  v1 = 9;
  byte_8006F499 = 0;
  byte_8006F498 = 0;
  dword_8006F47C = 0;
  dword_8006F478 = 0;
  dword_8006F48C = 0;
  dword_8006F488 = 0;
  do
  {
    *v0 = 0;
    --v1;
    ++v0;
  }
  while ( v1 != -1 );
  ResetCallback();
  InterruptCallback(2, sub_8004F0C4);
  MEMORY[0x1F801800] = 1;
  if ( (MEMORY[0x1F801803] & 7) != 0 )
  {
    while ( 1 )
    {
      MEMORY[0x1F801800] = 1;
      MEMORY[0x1F801803] = 7;
      MEMORY[0x1F801802] = 7;
    }
  }
  byte_8006F756 = 0;
  byte_8006F498 = 0;
  byte_8006F755 = 0;
  byte_8006F754 = 2;
  MEMORY[0x1F801800] = 0;
  MEMORY[0x1F801803] = 0;
  MEMORY[0x1F801020] = 4901;
  sub_8004DBE0(1u, 0, 0, 0);
  v2 = sub_8004DBE0(0xAu, 0, 0, 0) != 0;
  result = -1;
  if ( !v2 )
  {
    v2 = sub_8004DBE0(0xCu, 0, 0, 0) != 0;
    result = -1;
    if ( !v2 )
      return -(InitDmaChannel(0) != 2);
  }
  return result;
}
// 8004E470: write access to const memory at 8006F499 has been detected
// 8004E478: write access to const memory at 8006F498 has been detected
// 8004E480: write access to const memory at 8006F47C has been detected
// 8004E488: write access to const memory at 8006F478 has been detected
// 8004E490: write access to const memory at 8006F48C has been detected
// 8004E498: write access to const memory at 8006F488 has been detected
// 8004E558: write access to const memory at 8006F756 has been detected
// 8004E570: write access to const memory at 8006F498 has been detected
// 8004E588: write access to const memory at 8006F754 has been detected
// 8004E618: write access to const memory at 8006F478 has been detected
// 8004E6C4: write access to const memory at 8006F478 has been detected
// 8004E6CC: write access to const memory at 8006F780 has been detected
// 8004E578: write access to const memory at 8006F755 has been detected
// 8004F0C4: using guessed type int sub_8004F0C4();
// 80061B84: using guessed type int __fastcall InterruptCallback(_DWORD, _DWORD);
// 80062BA0: using guessed type int printf(const char *, ...);
// 8006F478: using guessed type int dword_8006F478;
// 8006F47C: using guessed type int dword_8006F47C;
// 8006F488: using guessed type int dword_8006F488;
// 8006F48C: using guessed type int dword_8006F48C;
// 8006F490: using guessed type int dword_8006F490;
// 8006F498: using guessed type char byte_8006F498;
// 8006F499: using guessed type char byte_8006F499;
// 8006F754: using guessed type char byte_8006F754;
// 8006F755: using guessed type char byte_8006F755;
// 8006F756: using guessed type char byte_8006F756;
// 8006F758: using guessed type int g_DmaChannel;
// 8006F780: using guessed type int dword_8006F780;

//----- (8004E73C) --------------------------------------------------------
// write access to const memory has been detected, the output may be wrong!
int sub_8004E73C()
{
  dword_8006F47C = 0;
  dword_8006F478 = 0;
  g_DmaChannel = -1;
  dword_8006F770 = -1;
  return 0;
}
// 8004E768: write access to const memory at 8006F47C has been detected
// 8004E770: write access to const memory at 8006F478 has been detected
// 8004E818: write access to const memory at 8006F478 has been detected
// 8004E8C4: write access to const memory at 8006F478 has been detected
// 8004E8CC: write access to const memory at 8006F780 has been detected
// 8004E974: write access to const memory at 8006F756 has been detected
// 8004E98C: write access to const memory at 8006F498 has been detected
// 8004E9A4: write access to const memory at 8006F754 has been detected
// 8004EA20: write access to const memory at 8006F47C has been detected
// 8004E77C: write access to const memory at 8006F758 has been detected
// 8004E994: write access to const memory at 8006F755 has been detected
// 8004EA70: write access to const memory at 8006F758 has been detected
// 8004EA88: write access to const memory at 8006F770 has been detected
// 80062BA0: using guessed type int printf(const char *, ...);
// 8006F478: using guessed type int dword_8006F478;
// 8006F47C: using guessed type int dword_8006F47C;
// 8006F488: using guessed type int dword_8006F488;
// 8006F490: using guessed type int dword_8006F490;
// 8006F498: using guessed type char byte_8006F498;
// 8006F754: using guessed type char byte_8006F754;
// 8006F755: using guessed type char byte_8006F755;
// 8006F756: using guessed type char byte_8006F756;
// 8006F758: using guessed type int g_DmaChannel;
// 8006F770: using guessed type int dword_8006F770;
// 8006F780: using guessed type int dword_8006F780;

//----- (8004EAB8) --------------------------------------------------------
// write access to const memory has been detected, the output may be wrong!
int __fastcall SetupDmaTransfer(int a1, int a2, int a3)
{
  g_DmaBlockCount = a3;                         //    (128 )
  g_DmaBlockSize = 512;                         //    (512  Mode 1)
  g_DmaDest = a1;                               //     RAM
  g_DmaSource = a2;                             //    (CD )
  g_DmaChannel = 8;                             //  DMA  (8 = CDROM DMA)
  g_DmaReadCount = 0;                           //    ?
  g_DmaErrorFlags = 0;                          //   
  InitDmaChannel(0);
  return -(sub_8004E73C() < 1);                 //   
}
// 8004EAF4: write access to const memory at 8006F76C has been detected
// 8004EB04: write access to const memory at 8006F76C has been detected
// 8004EB34: write access to const memory at 8006F75C has been detected
// 8004EB50: write access to const memory at 8006F758 has been detected
// 8004EB5C: write access to const memory at 8006F778 has been detected
// 8004EB64: write access to const memory at 8006F77C has been detected
// 8004EAC8: write access to const memory at 8006F768 has been detected
// 8004EB1C: write access to const memory at 8006F76C has been detected
// 8004EB28: write access to const memory at 8006F760 has been detected
// 8006F478: using guessed type int dword_8006F478;
// 8006F47C: using guessed type int dword_8006F47C;
// 8006F488: using guessed type int dword_8006F488;
// 8006F758: using guessed type int g_DmaChannel;
// 8006F75C: using guessed type int g_DmaSource;
// 8006F760: using guessed type int g_DmaDest;
// 8006F768: using guessed type int g_DmaBlockCount;
// 8006F76C: using guessed type int g_DmaBlockSize;
// 8006F778: using guessed type int g_DmaReadCount;
// 8006F77C: using guessed type int g_DmaErrorFlags;

//----- (8004EBB0) --------------------------------------------------------
// write access to const memory has been detected, the output may be wrong!
int __fastcall CdWaitForCompletion(int a1, _BYTE *a2)
{
  int result; // $v0
  int v4; // $v0
  _BYTE *v5; // $a0
  char v6; // $s1
  int *v7; // $a1
  int v8; // $v1
  char v9; // $v0

  dword_800764A8 = VSync(-1) + 480;
  dword_800764AC = 0;
  dword_800764B0 = "CD_read";
  if ( VSync(-1) > 0 )
  {
    sub_80062C20();
    printf("%s:(%s) Sync=%s, Ready=%s\n", 0, "CdlSync", "NoIntr", "NoIntr");
    sub_8004E1E0();
    result = -1;
  }
  else
  {
    dword_800764AC = 1;
    result = 0;
  }
  if ( !result )
  {
    v4 = CheckCallback();
    v5 = a2;
    if ( v4 )
    {
      v6 = MEMORY[0x1F801800] & 3;
      while ( sub_8004D148() )
        ;
      MEMORY[0x1F801800] = v6;
      v5 = a2;
    }
    v7 = g_CdStatusRegisters;
    v8 = 7;
    if ( v5 )
    {
      do
      {
        v9 = *v7;
        v7 = (v7 + 1);
        --v8;
        *v5++ = v9;
      }
      while ( v8 != -1 );
    }
    if ( VSync(-1) > 0x3C )
      sub_8004E73C();
    sub_8004EE68(0);
    return 0;
  }
  return result;
}
// 8004EC08: write access to const memory at 800764A8 has been detected
// 8004EC18: write access to const memory at 800764AC has been detected
// 8004EC20: write access to const memory at 800764B0 has been detected
// 8004EC58: write access to const memory at 800764AC has been detected
// 80000000: using guessed type int (__fastcall *unk_80000000)(_DWORD, _DWORD);
// 80062BA0: using guessed type int printf(const char *, ...);
// 8006F478: using guessed type int dword_8006F478;
// 8006F47C: using guessed type int dword_8006F47C;
// 8006F499: using guessed type char byte_8006F499;
// 8006F754: using guessed type char byte_8006F754;
// 8006F755: using guessed type char byte_8006F755;
// 8006F770: using guessed type int dword_8006F770;
// 8006F774: using guessed type int dword_8006F774;
// 80076498: using guessed type int g_CdStatusRegisters[2];
// 800764A8: using guessed type int dword_800764A8;
// 800764AC: using guessed type int dword_800764AC;
// 800764B0: using guessed type int dword_800764B0;

//----- (8004EE68) --------------------------------------------------------
// write access to const memory has been detected, the output may be wrong!
int __fastcall sub_8004EE68(int a1)
{
  int v2; // $v0
  bool v3; // dc
  int result; // $v0

  dword_800764A8 = VSync(-1) + 480;
  dword_800764AC = 0;
  dword_800764B0 = "CD_datasync";
  do
  {
    if ( VSync(-1) > 0 )
    {
      sub_80062C20();
      printf("%s:(%s) Sync=%s, Ready=%s\n", 0, "CdlSync", "NoIntr", "NoIntr");
      sub_8004E1E0();
      v2 = -1;
    }
    else
    {
      dword_800764AC = 1;
      v2 = 0;
    }
    v3 = v2 != 0;
    result = -1;
    if ( v3 )
      break;
    result = 0;
    if ( (MEMORY[0x1F8010B8] & 0x1000000) == 0 )
      break;
    result = 1;
  }
  while ( !a1 );
  return result;
}
// 8004EEA8: write access to const memory at 800764A8 has been detected
// 8004EEB8: write access to const memory at 800764AC has been detected
// 8004EEC0: write access to const memory at 800764B0 has been detected
// 8004EEF8: write access to const memory at 800764AC has been detected
// 80062BA0: using guessed type int printf(const char *, ...);
// 8006F499: using guessed type char byte_8006F499;
// 8006F754: using guessed type char byte_8006F754;
// 8006F755: using guessed type char byte_8006F755;
// 800764A8: using guessed type int dword_800764A8;
// 800764AC: using guessed type int dword_800764AC;
// 800764B0: using guessed type int dword_800764B0;

//----- (8004EFD4) --------------------------------------------------------
int __fastcall sub_8004EFD4(int a1, int a2)
{
  MEMORY[0x1F801800] = 0;
  MEMORY[0x1F801803] = 0x80;
  MEMORY[0x1F801018] = 133443;
  MEMORY[0x1F801020] = 4899;
  MEMORY[0x1F8010F0] |= 0x8000u;
  MEMORY[0x1F8010B0] = a1;
  MEMORY[0x1F8010B4] = a2 | 0x10000;
  MEMORY[0x1F8010B8] = 285212672;
  while ( (MEMORY[0x1F8010B8] & 0x1000000) != 0 )
    ;
  MEMORY[0x1F801020] = 4901;
  return 0;
}

//----- (8004F0C4) --------------------------------------------------------
int sub_8004F0C4()
{
  char v0; // $s1
  int result; // $v0

  v0 = MEMORY[0x1F801800] & 3;
  while ( sub_8004D148() )
    ;
  result = 528488448;
  MEMORY[0x1F801800] = v0;
  return result;
}
// 80000000: using guessed type int (__fastcall *unk_80000000)(_DWORD, _DWORD);
// 8004F0C4: using guessed type int sub_8004F0C4();
// 8006F478: using guessed type int dword_8006F478;
// 8006F47C: using guessed type int dword_8006F47C;
// 8006F754: using guessed type char byte_8006F754;

//----- (8004F1A4) --------------------------------------------------------
// write access to const memory has been detected, the output may be wrong!
int __fastcall sub_8004F1A4(int a1)
{
  if ( a1 != 1 )
    dword_8006F770 = -1;
  dword_8006F774 = VSync(-1);
  dword_8006F478 = 0;
  dword_8006F47C = 0;
  return sub_8004DBE0(9u, 0, 0, 0);
}
// 8004F208: write access to const memory at 8006F764 has been detected
// 8004F2B0: write access to const memory at 8006F478 has been detected
// 8004F2B8: write access to const memory at 8006F47C has been detected
// 8004F238: write access to const memory at 8006F770 has been detected
// 8004F24C: write access to const memory at 8006F774 has been detected
// 80000000: using guessed type int (__fastcall *unk_80000000)(_DWORD, _DWORD);
// 8006F478: using guessed type int dword_8006F478;
// 8006F47C: using guessed type int dword_8006F47C;
// 8006F758: using guessed type int g_DmaChannel;
// 8006F764: using guessed type int dword_8006F764;
// 8006F76C: using guessed type int g_DmaBlockSize;
// 8006F770: using guessed type int dword_8006F770;
// 8006F774: using guessed type int dword_8006F774;
// 8006F778: using guessed type int g_DmaReadCount;
// 8006F77C: using guessed type int g_DmaErrorFlags;

//----- (8004F310) --------------------------------------------------------
int sub_8004F310()
{
  int i; // $s0

  for ( i = 4; i != -1; --i )
  {
    if ( CdLastCom(1) == 1 )
    {
      PadStopCom_0(sub_8004F3A0);
      CdSyncCallback(sub_8004F3C8);
      CdReadyCallback(sub_8004F3F0);
      return 1;
    }
  }
  printf("CdInit: Init failed\n");
  return 0;
}
// 8004C924: using guessed type int __fastcall CdLastCom(_DWORD);
// 8004CAA8: using guessed type int __fastcall CdReadyCallback(_DWORD);
// 80062BA0: using guessed type int printf(const char *, ...);

//----- (8004F3A0) --------------------------------------------------------
void sub_8004F3A0()
{
  DeliverEvent();
}

//----- (8004F3C8) --------------------------------------------------------
void sub_8004F3C8()
{
  DeliverEvent();
}

//----- (8004F3F0) --------------------------------------------------------
void sub_8004F3F0()
{
  DeliverEvent();
}

//----- (8004F418) --------------------------------------------------------
int __fastcall sub_8004F418(__int16 a1)
{
  char v3[8]; // [sp+10h] [-8h] BYREF

  v3[0] = a1;
  CdControl(0xEu, v3, 0);
  if ( (a1 & 0x100) != 0 )
  {
    dword_8009DE64 = (a1 & 0x20) == 0;
    sub_8004CEE0(sub_80050A2C);
    CdSyncCallback(sub_8004FEB4);
  }
  return CdControl(0x1Bu, 0, 0);
}
// 8009DE64: using guessed type int dword_8009DE64;
// 8004F418: using guessed type char var_8[8];

//----- (8004F4AC) --------------------------------------------------------
// write access to const memory has been detected, the output may be wrong!
char *__fastcall CdSearchFile(_DWORD *a1, char *a2)
{
  bool v4; // dc
  char *result; // $v0
  int v6; // $a0
  char *v7; // $s0
  int v8; // $s2
  int v9; // $v0
  char *v10; // $s1
  int v11; // $v0
  BOOL v12; // $v0
  char v13; // $v0
  int v14; // $s2
  char *v15; // $s0
  int *v16; // $s3
  int i; // $s1
  int v18; // $v1
  int v19; // $a0
  int v20; // $a1
  int v21; // $v1
  char v22[32]; // [sp+10h] [-20h] BYREF

  v4 = CdCheckISO9660() == 0;                   // if ( strncmp(&unk_800780B5, "CD001", 5) )    return 0;
  result = 0;
  if ( !v4 )
  {
    dword_8006F7B8 = 0;
    v6 = 1;
    if ( *a2 != 92 )
      return 0;
    v22[0] = 0;
    v7 = a2;
    v8 = 0;
    while ( 1 )
    {
      v9 = *v7;
      v10 = v22;
      if ( v9 != 92 )
        break;
LABEL_11:
      v4 = v9 == 0;
      v12 = v8 < 8;
      if ( v4 )
        goto LABEL_15;
      ++v7;
      *v10 = 0;
      v6 = sub_8004FAAC(v6, v22);               // do while |v8 = strcmp(a2, v5);  v5 += 44;  if ( !v8 )    return v4 + 1; else return -1;
      if ( v6 == -1 )
      {
        v22[0] = 0;
LABEL_14:
        v12 = v8 < 8;
        goto LABEL_15;
      }
      if ( ++v8 >= 8 )
        goto LABEL_14;
    }
    v11 = *v7;
    while ( 1 )
    {
      v4 = v11 == 0;
      v12 = v8 < 8;
      if ( v4 )
        break;
      v13 = *v7++;
      *v10 = v13;
      v11 = *v7;
      ++v10;
      if ( v11 == 92 )
      {
        v9 = *v7;
        goto LABEL_11;
      }
    }
LABEL_15:
    if ( v12 && v22[0] )
    {
      *v10 = 0;
      if ( !sub_8004FB58(v6) )
        return 0;
      v14 = 0;
      v15 = &byte_800764B4;
      v16 = dword_800764BC;
      for ( i = 0; LOBYTE(dword_800764BC[i]); i += 6 )
      {
        if ( sub_8004F794(v16, v22) )           // return strncmp(a1, a2, 12) == 0;
        {
          v18 = *(v15 + 1);
          v19 = *(v15 + 2);
          v20 = *(v15 + 3);
          *a1 = *v15;
          a1[1] = v18;
          a1[2] = v19;
          a1[3] = v20;
          v21 = *(v15 + 5);
          a1[4] = *(v15 + 4);
          a1[5] = v21;
          return v15;
        }
        v15 += 24;
        v16 += 6;
        if ( ++v14 >= 64 )
          return 0;
      }
    }
    return 0;
  }
  return result;
}
// 8004F504: write access to const memory at 8006F7B8 has been detected
// 80062BA0: using guessed type int printf(const char *, ...);
// 8006F490: using guessed type int dword_8006F490;
// 8006F7B8: using guessed type int dword_8006F7B8;
// 800764B4: using guessed type char byte_800764B4;
// 800764BC: using guessed type int dword_800764BC[209];

//----- (8004F794) --------------------------------------------------------
BOOL __fastcall sub_8004F794(int a1, int a2)
{
  return strncmp(a1, a2, 12) == 0;
}
// 80062BE0: using guessed type int __fastcall strncmp(_DWORD, _DWORD, _DWORD);

//----- (8004F7B8) --------------------------------------------------------
// write access to const memory has been detected, the output may be wrong!
int CdCheckISO9660()
{
  unsigned __int8 *v1; // $s1
  int v2; // $a3
  int v3; // $s0
  int v4; // $v0
  int v5; // $s3

  if ( !CdReadSector(1, 16, &unk_800780B4) )
    return 0;
  if ( strncmp(&unk_800780B5, "CD001", 5) )
    return 0;
  if ( !CdReadSector(1, dword_80078140, &unk_800780B4) )
    return 0;
  v1 = &unk_800780B4;
  v2 = 0;
  do
  {
    if ( !*v1 )
      break;
    v3 = 44 * v2;
    *(&unk_80076ABC + v3) = *(v1 + 2);
    v4 = v1[6];
    v5 = v2 + 1;
    *(&unk_80076AB4 + v3) = v2 + 1;
    *(&unk_80076AB8 + v3) = v4;
    sub_8004FE80(&byte_80076AC0[44 * v2], v1 + 8, *v1);
    byte_80076AC0[v3 + *v1] = 0;
    v1 += *v1 + (*v1 & 1) + 8;
    v2 = v5;
    if ( v5 >= 128 )
      goto LABEL_13;
  }
  while ( v1 < &dword_800788B4 );
  if ( v2 < 128 )
    *(&unk_80076AB8 + 11 * v2) = 0;
LABEL_13:
  dword_8006F7B4 = 0;
  return 1;
}
// 8004FA5C: write access to const memory at 8006F7B4 has been detected
// 80062BA0: using guessed type int printf(const char *, ...);
// 80062BE0: using guessed type int __fastcall strncmp(_DWORD, _DWORD, _DWORD);
// 8006F7B4: using guessed type int dword_8006F7B4;
// 80076AC0: using guessed type _BYTE byte_80076AC0[5620];
// 80078140: using guessed type int dword_80078140;
// 800788B4: using guessed type int dword_800788B4;

//----- (8004FAAC) --------------------------------------------------------
int __fastcall sub_8004FAAC(int a1, int a2)
{
  int v4; // $s0
  _BYTE *v5; // $s2
  int v6; // $s1
  int v7; // $v0
  int v8; // $v0

  v4 = 0;
  v5 = byte_80076AC0;
  v6 = 0;
  do
  {
    v7 = *(&unk_80076AB8 + v6);
    if ( !v7 )
      break;
    if ( v7 == a1 )
    {
      v8 = strcmp(a2, v5);
      v5 += 44;
      if ( !v8 )
        return v4 + 1;
    }
    else
    {
      v5 += 44;
    }
    ++v4;
    v6 += 44;
  }
  while ( v4 < 128 );
  return -1;
}
// 80062BC0: using guessed type int __fastcall strcmp(_DWORD, _DWORD);
// 80076AC0: using guessed type _BYTE byte_80076AC0[5620];

//----- (8004FB58) --------------------------------------------------------
// write access to const memory has been detected, the output may be wrong!
int __fastcall sub_8004FB58(int a1)
{
  unsigned __int8 *v2; // $s0
  int v4; // $s2
  int *v5; // $s3
  int v6; // $s1
  char *v7; // $s4

  if ( !a1 )
    return 1;
  v2 = &unk_800780B4;
  if ( !CdReadSector(1, *(&unk_80076A90 + 11 * a1), &unk_800780B4) )
    return -1;
  v4 = 0;
  v5 = dword_800764BC;
  v6 = 0;
  v7 = &byte_800764B4;
  do
  {
    if ( !*v2 )
      break;
    SectorToMSF(*(v2 + 2), v7);
    dword_800764B8[v6] = *(v2 + 10);
    if ( v4 )
    {
      if ( v4 == 1 )
      {
        strcpy(&dword_800764BC[6], "..");
      }
      else
      {
        sub_8004FE80(v5, v2 + 33, v2[32]);
        *(v5 + v2[32]) = 0;
      }
    }
    else
    {
      LOWORD(dword_800764BC[0]) = 46;
    }
    v7 += 24;
    v5 += 6;
    ++v4;
    v2 += *v2;
    v6 += 6;
    if ( v4 >= 64 )
      break;
  }
  while ( v2 < &dword_800788B4 );
  dword_8006F7B4 = a1;
  if ( v4 < 64 )
    LOBYTE(dword_800764BC[6 * v4]) = 0;
  return 1;
}
// 8004FD90: write access to const memory at 8006F7B4 has been detected
// 8004FCC8: write access to const memory at 800764D4 has been detected
// 8004FCCC: write access to const memory at 800764D6 has been detected
// 8004FCB4: write access to const memory at 800764BC has been detected
// 80062BA0: using guessed type int printf(const char *, ...);
// 8006F7B4: using guessed type int dword_8006F7B4;
// 800764B4: using guessed type char byte_800764B4;
// 800764B8: using guessed type int dword_800764B8[];
// 800764BC: using guessed type int dword_800764BC[209];
// 800788B4: using guessed type int dword_800788B4;

//----- (8004FE14) --------------------------------------------------------
BOOL __fastcall CdReadSector(int a1, int a2, int a3)
{
  char v6[8]; // [sp+10h] [-8h] BYREF

  SectorToMSF(a2, v6);
  CdControl(2u, v6, 0);
  CdReadWithRetry(a1, a3, 128);
  return CdCheckStatus(0, 0) == 0;
}

//----- (8004FE80) --------------------------------------------------------
int __fastcall sub_8004FE80(_BYTE *a1, unsigned __int8 *a2, int a3)
{
  int v3; // $v1
  int result; // $v0

  v3 = a3 - 1;
  if ( a3 )
  {
    do
    {
      result = *a2++;
      --v3;
      *a1++ = result;
    }
    while ( v3 != -1 );
  }
  return result;
}

//----- (8004FEB4) --------------------------------------------------------
// write access to const memory has been detected, the output may be wrong!
int sub_8004FEB4()
{
  int result; // $v0
  int *v1; // $v1
  unsigned int i; // $v1
  unsigned __int16 v3; // $v0
  BOOL v4; // $v0
  _DWORD *v5; // $a1
  int *v6; // $a0
  unsigned int v7; // $v1
  int v8; // $v0
  int v9; // $t0
  int v10; // [sp+28h] [-10h] BYREF
  int v11; // [sp+2Ch] [-Ch] BYREF
  char v12; // [sp+30h] [-8h] BYREF

  result = dword_80180134;
  if ( dword_80180134 == 1 )
    return result;
  if ( dword_8009DE60 && (MEMORY[0x1F801098] & 0x1000000) != 0 )
  {
    result = dword_801DE648;
    dword_8009E088 = 1;
    if ( dword_801DE648 )
      result = ++dword_801A118C;
    dword_8006F804 = 1;
    return result;
  }
  result = PadStartCom_0(1, &v12);
  if ( result == 5 )
    return result;
  result = 3;
  if ( (v12 & 4) != 0 )
  {
    dword_8006F804 = 3;
    return result;
  }
  dword_800788B4 = 32 * dword_801BA2D8 + dword_801DEF58;
  if ( *dword_800788B4 )
  {
    result = 4;
    if ( dword_801DE648 )
    {
      ++dword_801A118C;
      result = 4;
    }
    dword_8006F804 = 4;
    return result;
  }
  MEMORY[0x1F801800] = 0;
  MEMORY[0x1F801803] = 0x80;
  MEMORY[0x1F801018] = 133443;
  MEMORY[0x1F801020] = 4899;
  if ( !dword_8009DE64 )
  {
    v1 = &v10;
    do
    {
      *v1 = MEMORY[0x1F801802];
      v1 = (v1 + 1);
    }
    while ( v1 < &v11 );
    for ( i = 0; i < 8; ++i )
      ;
  }
  if ( dword_801DE648 )
    sub_8005082C(dword_800788B4, ((dword_801A118C << 11) + dword_801DE648), 8u);
  else
    sub_80050860(3, dword_800788B4, 0, 8, 285212672, 0);
  while ( (MEMORY[0x1F8010B8] & 0x1000000) != 0 )
    ;
  *(dword_800788B4 + 28) = v10;
  MEMORY[0x1F801018] = 133187;
  MEMORY[0x1F801020] = 4901;
  if ( dword_801DE650 == 1 && dword_80130A84 )
  {
    if ( dword_80130A84 != *(dword_800788B4 + 8) )
    {
      *dword_800788B4 = 0;
      result = dword_801DE648;
      if ( dword_801DE648 )
        return ++dword_801A118C;
      return result;
    }
    dword_801DE650 = 0;
  }
  if ( *dword_800788B4 != 352 || ((*(dword_800788B4 + 2) >> 10) & 0x1F) != dword_8016E600 )
  {
    if ( dword_801DE648 )
      dword_801A118C = 0;
    result = 5;
    dword_8006F804 = 5;
    *dword_800788B4 = 0;
    return result;
  }
  if ( word_8009DE5C != *(dword_800788B4 + 4) || dword_80079180 && dword_80079180 != *(dword_800788B4 + 8) )
  {
    dword_80079180 = 0;
    word_8009DE5C = 0;
    sub_800509EC(dword_801BA2DC, dword_801BA2D8 - dword_801BA2DC);
    dword_801BA2D8 = dword_801BA2DC;
    *dword_800788B4 = 0;
    result = 6;
    if ( dword_801DE648 )
    {
      ++dword_801A118C;
      result = 6;
    }
    dword_8006F804 = 6;
    return result;
  }
  if ( !*(dword_800788B4 + 4) )
  {
    v3 = *(dword_800788B4 + 8);
    word_8009DE5C = 0;
    dword_80079180 = v3;
    v4 = v3 < dword_801DE64C;
    if ( dword_801DE64C && !v4 )
    {
      dword_80079180 = 0;
      word_8009DE5C = 0;
      sub_800509EC(dword_801BA2DC, dword_801BA2D8 - dword_801BA2DC);
      dword_801BA2D8 = dword_801BA2DC;
      *dword_800788B4 = 0;
      dword_801DE650 = 1;
      if ( dword_8009DEEC )
        dword_8009DEEC();
      result = 7;
      if ( dword_801DE648 )
      {
        ++dword_801A118C;
        result = 7;
      }
      dword_8006F804 = 7;
      return result;
    }
    if ( dword_801DF024 - dword_801BA2D8 - 1 < *(dword_800788B4 + 6) )
    {
      if ( !dword_801DE64C )
      {
        *dword_800788B4 = 1;
        dword_801DE650 = 1;
        if ( dword_8009DEEC )
          dword_8009DEEC();
        result = 8;
        if ( dword_801DE648 )
        {
          ++dword_801A118C;
          result = 8;
        }
        dword_8006F804 = 8;
        return result;
      }
      if ( *dword_801DEF58 )
      {
        *dword_800788B4 = 0;
        result = 9;
        if ( dword_801DE648 )
        {
          ++dword_801A118C;
          result = 9;
        }
        dword_8006F804 = 9;
        return result;
      }
      *dword_800788B4 = 1;
      v5 = dword_801DEF58;
      v6 = dword_800788B4;
      v7 = 0;
      dword_801BA2D8 = 0;
      do
      {
        v8 = *v6++;
        ++v7;
        *v5++ = v8;
      }
      while ( v7 < 8 );
      dword_800788B4 = dword_801DEF58;
    }
    dword_801BA2DC = dword_801BA2D8;
  }
  dword_8006F804 = 10;
  ++word_8009DE5C;
  dword_801DEF54 = 32 * dword_801DF024 + dword_801DEF58 + 2016 * dword_801BA2D8;
  v9 = 285212672;
  if ( dword_8009DE60 )
  {
    MEMORY[0x1F801018] = 133443;
    MEMORY[0x1F801020] = 4899;
  }
  else
  {
    v9 = 289407232;
    MEMORY[0x1F801018] = 553781315;
  }
  if ( *(dword_800788B4 + 6) - 1 == *(dword_800788B4 + 4) )
  {
    dword_80180134 = 1;
    if ( dword_801DE648 )
    {
      sub_8005082C(dword_801DEF54, ((dword_801A118C << 11) + dword_801DE648 + 32), 0x1F8u);
      ++dword_801A118C;
    }
    else
    {
      sub_80050860(3, dword_801DEF54, 0, 504, v9, 1u);
    }
    word_8009DE5C = 0;
    dword_80079180 = 0;
    dword_8016E600 = dword_80130A80;
  }
  else if ( dword_801DE648 )
  {
    sub_8005082C(dword_801DEF54, ((dword_801A118C << 11) + dword_801DE648 + 32), 0x1F8u);
    ++dword_801A118C;
  }
  else
  {
    sub_80050860(3, dword_801DEF54, 0, 504, v9, 0);
  }
  MEMORY[0x1F801020] = 4901;
  *dword_800788B4 = 3;
  result = ++dword_801BA2D8;
  if ( dword_801DE648 )
  {
    result = dword_80180134;
    if ( dword_80180134 )
      return sub_80050A2C();
  }
  return result;
}
// 8004FF30: write access to const memory at 8006F804 has been detected
// 8004FF78: write access to const memory at 8006F804 has been detected
// 8004FFE8: write access to const memory at 8006F804 has been detected
// 80050290: write access to const memory at 8006F804 has been detected
// 80050354: write access to const memory at 8006F804 has been detected
// 80050448: write access to const memory at 8006F804 has been detected
// 800504F4: write access to const memory at 8006F804 has been detected
// 80050554: write access to const memory at 8006F804 has been detected
// 800505CC: write access to const memory at 8006F804 has been detected
// 8004CA58: using guessed type int __fastcall PadStartCom_0(_DWORD, _DWORD);
// 8006F804: using guessed type int dword_8006F804;
// 800788B4: using guessed type int dword_800788B4;
// 80079180: using guessed type int dword_80079180;
// 8009DE5C: using guessed type __int16 word_8009DE5C;
// 8009DE60: using guessed type int dword_8009DE60;
// 8009DE64: using guessed type int dword_8009DE64;
// 8009DEEC: using guessed type int (*dword_8009DEEC)(void);
// 8009E088: using guessed type int dword_8009E088;
// 80130A80: using guessed type int dword_80130A80;
// 80130A84: using guessed type int dword_80130A84;
// 8016E600: using guessed type int dword_8016E600;
// 80180134: using guessed type int dword_80180134;
// 801A118C: using guessed type int dword_801A118C;
// 801BA2D8: using guessed type int dword_801BA2D8;
// 801BA2DC: using guessed type int dword_801BA2DC;
// 801DE648: using guessed type int dword_801DE648;
// 801DE64C: using guessed type int dword_801DE64C;
// 801DE650: using guessed type int dword_801DE650;
// 801DEF54: using guessed type int dword_801DEF54;
// 801DEF58: using guessed type int dword_801DEF58;
// 801DF024: using guessed type int dword_801DF024;
// 8004FEB4: using guessed type int var_C;

//----- (8005082C) --------------------------------------------------------
BOOL __fastcall sub_8005082C(_DWORD *a1, int *a2, unsigned int a3)
{
  unsigned int i; // $v1
  int v4; // $v0
  BOOL result; // $v0

  for ( i = 0; i < a3; ++a1 )
  {
    v4 = *a2++;
    ++i;
    *a1 = v4;
    result = i < a3;
  }
  return result;
}

//----- (80050860) --------------------------------------------------------
int __fastcall sub_80050860(int a1, int a2, int a3, int a4, int a5, unsigned __int8 a6)
{
  int v10; // $a0
  int v11; // $v0
  bool v12; // dc
  int v13; // $v0
  char v14; // $a0

  v10 = 0;
  v11 = a6;
  if ( (*(16 * a1 + 0x1F801088) & 0x1000000) != 0 )
  {
    while ( v10 != 0x10000 )
    {
      ++v10;
      if ( (*(16 * a1 + 0x1F801088) & 0x1000000) == 0 )
      {
        v11 = a6;
        goto LABEL_5;
      }
    }
    printf("DMA STATUS ERROR %x\n", *(16 * a1 + 0x1F801088));
    v11 = a6;
  }
LABEL_5:
  v12 = v11 != 1;
  v13 = 1 << a1;
  if ( v12 )
    v14 = MEMORY[0x1F8010F6] & ~v13;
  else
    v14 = MEMORY[0x1F8010F6] | v13;
  MEMORY[0x1F8010F6] = v14;
  MEMORY[0x1F8010F0] |= 1 << (4 * a1 + 3);
  *(16 * a1 + 0x1F801080) = a2;
  *(16 * a1 + 0x1F801084) = (a3 << 16) | a4;
  *(16 * a1 + 0x1F801088) = a5;
  return *(16 * a1 + 0x1F801088);
}
// 80062BA0: using guessed type int printf(const char *, ...);

//----- (800509EC) --------------------------------------------------------
BOOL __fastcall sub_800509EC(int a1, unsigned int a2)
{
  unsigned int i; // $a2
  unsigned int v3; // $v0
  BOOL result; // $v0

  for ( i = 0; i < a2; result = i < a2 )
  {
    v3 = i + a1;
    ++i;
    *(32 * v3 + dword_801DEF58) = 0;
  }
  return result;
}
// 801DEF58: using guessed type int dword_801DEF58;

//----- (80050A2C) --------------------------------------------------------
int sub_80050A2C()
{
  int result; // $v0

  *(32 * dword_801BA2DC + dword_801DEF58) = 2;
  result = dword_801BA2D8;
  dword_801BA2DC = dword_801BA2D8;
  if ( dword_8009DEE8 )
    result = dword_8009DEE8();
  dword_80180134 = 0;
  return result;
}
// 8009DEE8: using guessed type int (*dword_8009DEE8)(void);
// 80180134: using guessed type int dword_80180134;
// 801BA2D8: using guessed type int dword_801BA2D8;
// 801BA2DC: using guessed type int dword_801BA2DC;
// 801DEF58: using guessed type int dword_801DEF58;

//----- (80050B64) --------------------------------------------------------
BOOL __fastcall sub_80050B64(_BYTE *a1)
{
  int v1; // $a2
  BOOL result; // $v0

  v1 = 0;
  do
  {
    if ( *(16 * v1 + 0x1F801C0C) )
      *a1 = 2;
    else
      *a1 = 0;
    result = ++v1 < 24;
    ++a1;
  }
  while ( v1 < 24 );
  return result;
}
// 8006F8E4: using guessed type int dword_8006F8E4;

//----- (80050C7C) --------------------------------------------------------
// write access to const memory has been detected, the output may be wrong!
int __fastcall sub_80050C7C(int a1)
{
  int result; // $v0
  int v2; // $a0
  int v3; // $v1
  int v4; // [sp+10h] [-8h]
  int i; // [sp+10h] [-8h]
  int j; // [sp+10h] [-8h]
  int k; // [sp+10h] [-8h]
  int m; // [sp+10h] [-8h]
  int n; // [sp+10h] [-8h]
  int ii; // [sp+10h] [-8h]
  int jj; // [sp+10h] [-8h]
  int kk; // [sp+10h] [-8h]
  int v13; // [sp+14h] [-4h]
  int v14; // [sp+14h] [-4h]
  int v15; // [sp+14h] [-4h]
  int v16; // [sp+14h] [-4h]
  int v17; // [sp+14h] [-4h]
  int v18; // [sp+14h] [-4h]
  int v19; // [sp+14h] [-4h]
  int v20; // [sp+14h] [-4h]
  int v21; // [sp+14h] [-4h]

  MEMORY[0x1F8010F0] |= 0xB0000u;
  MEMORY[0x1F801D80] = 0;
  MEMORY[0x1F801D82] = 0;
  MEMORY[0x1F801DAA] = 0;
  v13 = 13;
  v4 = 0;
  dword_8006F84C = 0;
  dword_8006F850 = 0;
  word_8006F830 = 0;
  do
  {
    v13 *= 3;
    ++v4;
  }
  while ( v4 < 240 );
  MEMORY[0x1F801D80] = 0;
  MEMORY[0x1F801D82] = 0;
  for ( dword_8006F82C = 0; (MEMORY[0x1F801DAE] & 0x7FF) != 0; dword_8006F82C = 1 )
    ;
  dword_8006F854 = 2;
  dword_8006F858 = 3;
  dword_8006F85C = 8;
  dword_8006F860 = 7;
  MEMORY[0x1F801DAC] = 4;
  MEMORY[0x1F801D84] = 0;
  MEMORY[0x1F801D86] = 0;
  MEMORY[0x1F801D8C] = -1;
  MEMORY[0x1F801D8E] = -1;
  MEMORY[0x1F801D98] = 0;
  MEMORY[0x1F801D9A] = 0;
  result = 0;
  if ( !a1 )
  {
    MEMORY[0x1F801D90] = 0;
    MEMORY[0x1F801D92] = 0;
    MEMORY[0x1F801D94] = 0;
    MEMORY[0x1F801D96] = 0;
    MEMORY[0x1F801DB0] = 0;
    MEMORY[0x1F801DB2] = 0;
    MEMORY[0x1F801DB4] = 0;
    MEMORY[0x1F801DB6] = 0;
    word_8006F830 = 512;
    sub_800511C4(dword_8006F870, 0x10u);
    v2 = 0;
    v3 = 528489472;
    do
    {
      *v3 = 0;
      *(v3 + 2) = 0;
      *(v3 + 4) = 0x3FFF;
      *(v3 + 6) = 512;
      *(v3 + 10) = 0;
      ++v2;
      v3 += 16;
    }
    while ( v2 < 24 );
    MEMORY[0x1F801D88] = -1;
    MEMORY[0x1F801D8A] |= 0xFFu;
    v14 = 13;
    for ( i = 0; i < 240; ++i )
      v14 *= 3;
    v15 = 13;
    for ( j = 0; j < 240; ++j )
      v15 *= 3;
    v16 = 13;
    for ( k = 0; k < 240; ++k )
      v16 *= 3;
    v17 = 13;
    for ( m = 0; m < 240; ++m )
      v17 *= 3;
    MEMORY[0x1F801D8C] = -1;
    MEMORY[0x1F801D8E] |= 0xFFu;
    v18 = 13;
    for ( n = 0; n < 240; ++n )
      v18 *= 3;
    v19 = 13;
    for ( ii = 0; ii < 240; ++ii )
      v19 *= 3;
    v20 = 13;
    for ( jj = 0; jj < 240; ++jj )
      v20 *= 3;
    v21 = 13;
    for ( kk = 0; ; ++kk )
    {
      result = 0;
      if ( kk >= 240 )
        break;
      v21 *= 3;
    }
  }
  dword_8006F864 = 1;
  MEMORY[0x1F801DAA] = -16384;
  dword_8006F868 = 0;
  dword_8006F86C = 0;
  return result;
}
// 80050CCC: write access to const memory at 8006F84C has been detected
// 80050CD4: write access to const memory at 8006F850 has been detected
// 80050CDC: write access to const memory at 8006F830 has been detected
// 80050D48: write access to const memory at 8006F82C has been detected
// 80050D6C: write access to const memory at 8006F82C has been detected
// 80050DCC: write access to const memory at 8006F854 has been detected
// 80050DD8: write access to const memory at 8006F858 has been detected
// 80050DE4: write access to const memory at 8006F85C has been detected
// 80050DF0: write access to const memory at 8006F860 has been detected
// 80050E54: write access to const memory at 8006F830 has been detected
// 80051190: write access to const memory at 8006F864 has been detected
// 800511A0: write access to const memory at 8006F868 has been detected
// 800511A8: write access to const memory at 8006F86C has been detected
// 80062BA0: using guessed type int printf(const char *, ...);
// 8006F82C: using guessed type int dword_8006F82C;
// 8006F830: using guessed type __int16 word_8006F830;
// 8006F84C: using guessed type int dword_8006F84C;
// 8006F850: using guessed type int dword_8006F850;
// 8006F854: using guessed type int dword_8006F854;
// 8006F858: using guessed type int dword_8006F858;
// 8006F85C: using guessed type int dword_8006F85C;
// 8006F860: using guessed type int dword_8006F860;
// 8006F864: using guessed type int dword_8006F864;
// 8006F868: using guessed type int dword_8006F868;
// 8006F86C: using guessed type int dword_8006F86C;
// 8006F870: using guessed type int dword_8006F870[4];

//----- (800511C4) --------------------------------------------------------
// write access to const memory has been detected, the output may be wrong!
int __fastcall sub_800511C4(__int16 *a1, unsigned int a2)
{
  unsigned int v2; // $s1
  BOOL v4; // $v0
  int v5; // $s0
  int j; // $v1
  __int16 v7; // $v0
  int i; // [sp+10h] [-10h]
  int k; // [sp+10h] [-10h]
  int m; // [sp+10h] [-10h]
  int n; // [sp+10h] [-10h]
  int v13; // [sp+14h] [-Ch]
  int v14; // [sp+14h] [-Ch]
  int v15; // [sp+14h] [-Ch]
  int v16; // [sp+14h] [-Ch]

  v2 = a2;
  MEMORY[0x1F801DA6] = 0;
  v13 = 13;
  for ( i = 0; i < 240; ++i )
    v13 *= 3;
  v4 = a2 < 0x41;
  if ( a2 )
  {
    do
    {
      v5 = v2;
      if ( !v4 )
        v5 = 64;
      for ( j = 0; j < v5; MEMORY[0x1F801DA8] = v7 )
      {
        v7 = *a1++;
        j += 2;
      }
      MEMORY[0x1F801DAA] = MEMORY[0x1F801DAA] & 0xFFCF | 0x10;
      v14 = 13;
      for ( k = 0; k < 240; ++k )
        v14 *= 3;
      for ( dword_8006F82C = 0; (MEMORY[0x1F801DAE] & 0x400) != 0; dword_8006F82C = 1 )
        ;
      v15 = 13;
      for ( m = 0; m < 240; ++m )
        v15 *= 3;
      v16 = 13;
      for ( n = 0; n < 240; ++n )
        v16 *= 3;
      v2 -= v5;
      v4 = v2 < 0x41;
    }
    while ( v2 );
  }
  MEMORY[0x1F801DAA] &= 0xFFCFu;
  dword_8006F82C = 0;
  return MEMORY[0x1F801DAE] & 0x7FF;
}
// 80051324: write access to const memory at 8006F82C has been detected
// 80051348: write access to const memory at 8006F82C has been detected
// 8005146C: write access to const memory at 8006F82C has been detected
// 80051490: write access to const memory at 8006F82C has been detected
// 80062BA0: using guessed type int printf(const char *, ...);
// 8006F82C: using guessed type int dword_8006F82C;
// 8006F830: using guessed type __int16 word_8006F830;

//----- (80051508) --------------------------------------------------------
void sub_80051508()
{
  int v0; // $v1
  int i; // [sp+10h] [-8h]
  int j; // [sp+10h] [-8h]
  int k; // [sp+10h] [-8h]
  int v4; // [sp+14h] [-4h]
  int v5; // [sp+14h] [-4h]
  int v6; // [sp+14h] [-4h]

  v4 = 13;
  for ( i = 0; i < 240; ++i )
    v4 *= 3;
  v5 = 13;
  for ( j = 0; j < 240; ++j )
    v5 *= 3;
  v6 = 13;
  for ( k = 0; k < 240; ++k )
    v6 *= 3;
  MEMORY[0x1F801DAA] &= 0xFFCFu;
  if ( (MEMORY[0x1F801DAA] & 0x30) != 0 )
  {
    v0 = 1;
    do
    {
      if ( v0 >= 3841 )
        break;
      ++v0;
    }
    while ( (MEMORY[0x1F801DAA] & 0x30) != 0 );
  }
  DeliverEvent();
}
// 80000000: using guessed type int (__fastcall *unk_80000000)(_DWORD, _DWORD);
// 8006F868: using guessed type int dword_8006F868;
// 8006F880: using guessed type int dword_8006F880;

//----- (800518A4) --------------------------------------------------------
// write access to const memory has been detected, the output may be wrong!
int __fastcall sub_800518A4(int a1, unsigned int a2, unsigned int a3)
{
  int result; // $v0
  int v4; // $v1
  int v5; // $v1
  int v6; // $v1

  if ( a1 == 1 )
  {
    dword_8006F880 = 0;
    if ( MEMORY[0x1F801DA6] )
    {
      v4 = 1;
      while ( 1 )
      {
        result = -2;
        if ( v4 >= 3841 )
          break;
        ++v4;
        if ( !MEMORY[0x1F801DA6] )
          goto LABEL_13;
      }
    }
    else
    {
LABEL_13:
      MEMORY[0x1F801DAA] = MEMORY[0x1F801DAA] & 0xFFCF | 0x20;
      return 0;
    }
  }
  else if ( a1 >= 2 )
  {
    if ( a1 == 2 )
    {
      word_8006F830 = a2 >> 3;
      MEMORY[0x1F801DA6] = 0;
      return 0;
    }
    else
    {
      result = 0;
      if ( a1 == 3 )
      {
        v6 = 1;
        if ( (MEMORY[0x1F801DAA] & 0x30) == 32 )
        {
LABEL_22:
          MEMORY[0x1F801014] = MEMORY[0x1F801014] & 0xD0FFFFFF | 0x20000000;
          dword_8006F884 = a2;
          dword_8006F888 = (a3 >> 6) + ((a3 & 0x3F) != 0);
          MEMORY[0x1F8010C0] = 0;
          MEMORY[0x1F8010C4] = 16;
          MEMORY[0x1F8010C8] = 16777729;
          return 0;
        }
        else
        {
          while ( 1 )
          {
            result = -2;
            if ( v6 >= 3841 )
              break;
            ++v6;
            if ( (MEMORY[0x1F801DAA] & 0x30) == 32 )
              goto LABEL_22;
          }
        }
      }
    }
  }
  else
  {
    result = 0;
    if ( !a1 )
    {
      dword_8006F880 = 1;
      if ( MEMORY[0x1F801DA6] )
      {
        v5 = 1;
        while ( 1 )
        {
          result = -2;
          if ( v5 >= 3841 )
            break;
          ++v5;
          if ( !MEMORY[0x1F801DA6] )
            goto LABEL_18;
        }
      }
      else
      {
LABEL_18:
        MEMORY[0x1F801DAA] |= 0x30u;
        return 0;
      }
    }
  }
  return result;
}
// 80051914: write access to const memory at 8006F830 has been detected
// 8005193C: write access to const memory at 8006F880 has been detected
// 800519AC: write access to const memory at 8006F880 has been detected
// 80051AC4: write access to const memory at 8006F884 has been detected
// 80051AEC: write access to const memory at 8006F888 has been detected
// 8006F830: using guessed type __int16 word_8006F830;
// 8006F858: using guessed type int dword_8006F858;
// 8006F880: using guessed type int dword_8006F880;
// 8006F884: using guessed type int dword_8006F884;
// 8006F888: using guessed type int dword_8006F888;

//----- (80051B4C) --------------------------------------------------------
unsigned int __fastcall sub_80051B4C(unsigned int a1, unsigned int a2, unsigned int a3)
{
  unsigned int v5; // $a1
  unsigned int v6; // $a2

  sub_800518A4(2, 0, a3);
  sub_800518A4(1, v5, v6);
  sub_800518A4(3, a1, a2);
  return a2;
}
// 80051B8C: variable 'v5' is possibly undefined
// 80051B8C: variable 'v6' is possibly undefined
// 8006F830: using guessed type __int16 word_8006F830;
// 8006F84C: using guessed type int dword_8006F84C;
// 8006F858: using guessed type int dword_8006F858;

//----- (80051C3C) --------------------------------------------------------
int __fastcall sub_80051C3C(int a1, unsigned int a2, int a3)
{
  int result; // $v0

  result = 2 * a1 + 528489472;
  if ( a3 )
    *(2 * a1 + 0x1F801C00) = a2 >> 3;
  else
    *(2 * a1 + 0x1F801C00) = a2;
  return result;
}
// 8006F858: using guessed type int dword_8006F858;

//----- (80051C84) --------------------------------------------------------
unsigned int __fastcall sub_80051C84(int a1, unsigned int a2)
{
  unsigned int result; // $v0

  if ( a2 % 8 )
    a2 = (a2 + 8) & 0xFFFFFFF8;
  if ( a1 == -2 )
    return a2;
  result = a2;
  if ( a1 == -1 )
    return (a2 >> 3);
  *(2 * a1 + 0x1F801C00) = a2 >> 3;
  return result;
}
// 8006F854: using guessed type int dword_8006F854;
// 8006F858: using guessed type int dword_8006F858;
// 8006F85C: using guessed type int dword_8006F85C;
// 8006F860: using guessed type int dword_8006F860;

//----- (80051D64) --------------------------------------------------------
// write access to const memory has been detected, the output may be wrong!
int __fastcall sub_80051D64(int a1)
{
  int result; // $v0

  ResetCallback();
  sub_80050C7C(a1);
  sub_80051E08();
  dword_8006F894 = 0;
  dword_8006F898 = 0;
  dword_8006F8A0 = 0;
  word_8006F8A4 = 0;
  word_8006F8A6 = 0;
  dword_8006F8A8 = 0;
  dword_8006F8AC = 0;
  dword_8006F8B0 = 65534;
  result = sub_80051C3C(209, 0xFFFEu, 0);
  dword_8006F890 = 0;
  dword_8006F84C = 0;
  dword_8006F8E4 = 0;
  return result;
}
// 80051D94: write access to const memory at 8006F894 has been detected
// 80051D9C: write access to const memory at 8006F898 has been detected
// 80051DA4: write access to const memory at 8006F8A0 has been detected
// 80051DAC: write access to const memory at 8006F8A4 has been detected
// 80051DB4: write access to const memory at 8006F8A6 has been detected
// 80051DBC: write access to const memory at 8006F8A8 has been detected
// 80051DC4: write access to const memory at 8006F8AC has been detected
// 80051DCC: write access to const memory at 8006F8B0 has been detected
// 80051DDC: write access to const memory at 8006F890 has been detected
// 80051DE4: write access to const memory at 8006F84C has been detected
// 80051DEC: write access to const memory at 8006F8E4 has been detected
// 8006F84C: using guessed type int dword_8006F84C;
// 8006F890: using guessed type int dword_8006F890;
// 8006F894: using guessed type int dword_8006F894;
// 8006F898: using guessed type int dword_8006F898;
// 8006F8A0: using guessed type int dword_8006F8A0;
// 8006F8A4: using guessed type __int16 word_8006F8A4;
// 8006F8A6: using guessed type __int16 word_8006F8A6;
// 8006F8A8: using guessed type int dword_8006F8A8;
// 8006F8AC: using guessed type int dword_8006F8AC;
// 8006F8B0: using guessed type int dword_8006F8B0;
// 8006F8E4: using guessed type int dword_8006F8E4;
// 8006FCF0: using guessed type int dword_8006FCF0[];

//----- (80051E08) --------------------------------------------------------
// write access to const memory has been detected, the output may be wrong!
void sub_80051E08()
{
  int v0; // $v0

  dword_8006FCEC = 1;
  EnterCriticalSection();
  dword_8006F88C = 0;
  sub_80051E8C(sub_80051508);
  OpenEvent();
  dword_8006F8E8 = v0;
  EnableEvent();
  ExitCriticalSection();
}
// 80051E20: write access to const memory at 8006FCEC has been detected
// 80051E38: write access to const memory at 8006F88C has been detected
// 80051E64: write access to const memory at 8006F8E8 has been detected
// 80051E64: variable 'v0' is possibly undefined
// 8006F88C: using guessed type int dword_8006F88C;
// 8006F8E8: using guessed type int dword_8006F8E8;
// 8006FCEC: using guessed type int dword_8006FCEC;

//----- (80051E8C) --------------------------------------------------------
int __fastcall sub_80051E8C(int a1)
{
  return DMACallback();
}

//----- (80051EB0) --------------------------------------------------------
// write access to const memory has been detected, the output may be wrong!
int __fastcall sub_80051EB0(unsigned int a1, unsigned int a2, __int16 a3)
{
  int v5; // $s1
  int v6; // $v0
  unsigned int v7; // $s0
  unsigned int v9; // $a2

  if ( a3 < 0x11u
    && (v5 = a3, g_SPUVoiceActive[a3] == 2)
    && (v6 = dword_801DEF5C[a3],
        word_8006FFEC = a3,
        dword_8006FFE8 = v6,
        sub_8005201C(0),
        sub_80052050(dword_801DEFA4[v5]),
        v7 = a2,
        v5 == -1) )
  {
    if ( a2 )
      v7 = 0;
    sub_8005208C(1);
    sub_800520C8(a1, v7, v9);
    dword_8006FFE8 = 0;
    word_8006FFEC = -1;
    HIBYTE(word_8019E6EE) = 1;
    return -1;
  }
  else
  {
    sub_8005208C(0);
    return -1;
  }
}
// 80051F2C: write access to const memory at 8006FFEC has been detected
// 80051F34: write access to const memory at 8006FFE8 has been detected
// 80051FC0: write access to const memory at 8006FFE8 has been detected
// 80051FD0: write access to const memory at 8006FFE8 has been detected
// 80051FDC: write access to const memory at 8006FFEC has been detected
// 80051FA8: variable 'v9' is possibly undefined
// 8006FFE8: using guessed type int dword_8006FFE8;
// 8006FFEC: using guessed type __int16 word_8006FFEC;
// 8019E6EE: using guessed type __int16 word_8019E6EE;
// 8019E6F0: using guessed type _BYTE g_SPUVoiceActive[16];
// 801DEF5C: using guessed type _DWORD dword_801DEF5C[16];
// 801DEFA4: using guessed type _DWORD dword_801DEFA4[16];

//----- (8005201C) --------------------------------------------------------
// write access to const memory has been detected, the output may be wrong!
BOOL __fastcall sub_8005201C(int a1)
{
  BOOL result; // $v0

  if ( a1 )
    result = a1 == 1;
  else
    result = 0;
  dword_8006F890 = a1;
  dword_8006F84C = result;
  return result;
}
// 80052038: write access to const memory at 8006F890 has been detected
// 80052040: write access to const memory at 8006F84C has been detected
// 8006F84C: using guessed type int dword_8006F84C;
// 8006F890: using guessed type int dword_8006F890;

//----- (80052050) --------------------------------------------------------
// write access to const memory has been detected, the output may be wrong!
unsigned int __fastcall sub_80052050(unsigned int a1)
{
  word_8006F830 = sub_80051C84(-1, a1);
  return a1;
}
// 8005206C: write access to const memory at 8006F830 has been detected
// 8006F830: using guessed type __int16 word_8006F830;

//----- (8005208C) --------------------------------------------------------
// write access to const memory has been detected, the output may be wrong!
int __fastcall sub_8005208C(int a1)
{
  int result; // $v0

  result = 1;
  dword_8006F864 = a1 != 1;
  return result;
}
// 80052098: write access to const memory at 8006F864 has been detected
// 800520A8: write access to const memory at 8006F864 has been detected
// 8006F864: using guessed type int dword_8006F864;

//----- (800520B8) --------------------------------------------------------
int sub_800520B8()
{
  return 0;
}
// 8006F864: using guessed type int dword_8006F864;

//----- (800520C8) --------------------------------------------------------
// write access to const memory has been detected, the output may be wrong!
unsigned int __fastcall sub_800520C8(unsigned int a1, unsigned int a2, unsigned int a3)
{
  unsigned int v3; // $s1
  unsigned int result; // $v0

  v3 = a2;
  if ( a2 > 0x7F000 )
    v3 = 520192;
  sub_80051B4C(a1, v3, a3);
  word_8006F830 = sub_80051C84(-1, v3);
  result = v3;
  dword_8006F864 = 0;
  return result;
}
// 80052124: write access to const memory at 8006F830 has been detected
// 80052134: write access to const memory at 8006F864 has been detected
// 8006F830: using guessed type __int16 word_8006F830;
// 8006F858: using guessed type int dword_8006F858;
// 8006F864: using guessed type int dword_8006F864;
// 8006F868: using guessed type int dword_8006F868;

//----- (80052154) --------------------------------------------------------
int __fastcall sub_80052154(__int16 a1, int a2, __int16 a3, __int16 a4)
{
  return sub_80057C6C((a2 << 16 >> 8) | a1, a3, a4, 0);
}

//----- (80052198) --------------------------------------------------------
int __fastcall CDAudio_SetVolume(__int16 a1, __int16 a2, __int16 a3)
{
  return sub_80052154(a1, 0, a2, a3);
}

//----- (80052244) --------------------------------------------------------
int __fastcall sub_80052244(int a1)
{
  int v2; // $a2
  int i; // $a0
  int v4; // $a1
  int *v5; // $v1
  __int16 v6; // $v0
  int v7; // $a2
  int v8; // $a0
  int *v9; // $v1
  __int16 v10; // $v0
  int v11; // $a1
  _DWORD *v12; // $v1
  int v13; // $a0
  _DWORD *v14; // $v0
  int result; // $v0

  ResetCallback();
  if ( a1 )
    sub_80052398();
  else
    sub_800523B8();
  v2 = 528489472;
  for ( i = 0; i < 24; ++i )
  {
    v4 = 0;
    v5 = &dword_8006FFF0;
    do
    {
      v6 = *v5;
      v5 = (v5 + 2);
      ++v4;
      *v2 = v6;
      v2 += 2;
    }
    while ( v4 < 8 );
  }
  v7 = 528489856;
  v8 = 0;
  v9 = dword_80070000;
  do
  {
    v10 = *v9;
    v9 = (v9 + 2);
    ++v8;
    *v7 = v10;
    v7 += 2;
  }
  while ( v8 < 16 );
  sub_800568CC(0x18u);
  v11 = 0;
  v12 = dword_801DDE38;
  do
  {
    v13 = 15;
    v14 = v12 + 15;
    do
    {
      *v14 = 0;
      --v13;
      --v14;
    }
    while ( v13 >= 0 );
    ++v11;
    v12 += 16;
  }
  while ( v11 < 32 );
  result = 60;
  dword_801BA2D0 = 60;
  dword_8019E6C8 = 0;
  dword_8016DA90 = 0;
  return result;
}
// 8006FFF0: using guessed type int dword_8006FFF0;
// 80070000: using guessed type int dword_80070000[8];
// 8016DA90: using guessed type int dword_8016DA90;
// 8019E6C8: using guessed type int dword_8019E6C8;
// 801BA2D0: using guessed type int dword_801BA2D0;
// 801DDE38: using guessed type _DWORD dword_801DDE38[512];

//----- (80052358) --------------------------------------------------------
int sub_80052358()
{
  return sub_80052244(0);
}

//----- (80052398) --------------------------------------------------------
int sub_80052398()
{
  return sub_80051D64(1);
}

//----- (800523B8) --------------------------------------------------------
int sub_800523B8()
{
  return sub_80051D64(0);
}

//----- (800523D8) --------------------------------------------------------
int __fastcall SpuVoice_Trigger(int a1, __int16 a2)
{
  _DWORD *v2; // $a0
  int v3; // $a1
  int v4; // $a2
  int v5; // $v1
  int result; // $v0
  bool v7; // dc
  struct_v8 *v8; // $v1

  //      (172 )
  v2 = (dword_801DDDB8 + (a1 << 16 >> 14));     // (a1 << 16 >> 14) = a1 * 4   
  v3 = 172 * a2;
  v4 = v3 + *v2;
  v5 = *(v4 + 0x90);
  result = v5 & 0x100;
  if ( (v5 & 516) == 0 )
  {
    v7 = result != 0;
    result = -3;
    if ( !v7 )
    {
      *(v4 + 0x90) = v5 & 0xFFFFFFFD;
      *(v3 + *v2 + 0x90) |= 8u;
      v8 = (v3 + *v2);
      result = v8->flag | 1;
      v8->flag = result;
    }
  }
  return result;
}
// 801DDDB8: using guessed type _DWORD dword_801DDDB8[32];

//----- (8005247C) --------------------------------------------------------
int __fastcall Music_PlayTrack(__int16 a1)
{
  return SpuVoice_Trigger(a1, 0);
}

//----- (800524D0) --------------------------------------------------------
int sub_800524D0()
{
  return sub_80053364(1);
}

//----- (800524F0) --------------------------------------------------------
int sub_800524F0()
{
  return sub_80053364(0);
}

//----- (80052510) --------------------------------------------------------
int __fastcall sub_80052510(int a1)
{
  int v1; // $a1
  int v2; // $v1
  int v3; // $v0
  int v4; // $s0

  v1 = 0;
  v2 = a1;
  if ( (a1 & 0x8000) != 0 )
  {
    v1 = 1;
    v2 = -a1;
  }
  if ( v2 >= 0xAu )
    return -1;
  dword_8009DE44 = 1;
  if ( v1 )
    v3 = (v2 | 0x100) << 16;
  else
    v3 = v2 << 16;
  dword_8009DE48 = v3 >> 16;
  v4 = v2;
  if ( !v2 )
    sub_80053364(0);
  sub_800526FC(&dword_8009DE44);
  return v4;
}
// 8009DE44: using guessed type int dword_8009DE44;
// 8009DE48: using guessed type int dword_8009DE48;

//----- (800525C0) --------------------------------------------------------
int __fastcall sub_800525C0(__int16 a1, __int16 a2)
{
  dword_8009DE44 = 6;
  word_8009DE4C = 0x7FFF * a1 / 127;
  word_8009DE4E = 0x7FFF * a2 / 127;
  return sub_800526FC(&dword_8009DE44);
}
// 8009DE44: using guessed type int dword_8009DE44;
// 8009DE4C: using guessed type __int16 word_8009DE4C;
// 8009DE4E: using guessed type __int16 word_8009DE4E;

//----- (8005267C) --------------------------------------------------------
int __fastcall sub_8005267C(__int16 a1)
{
  dword_8009DE44 = 16;
  dword_8009DE54 = a1;
  return sub_800526FC(&dword_8009DE44);
}
// 8009DE44: using guessed type int dword_8009DE44;
// 8009DE54: using guessed type int dword_8009DE54;

//----- (800526BC) --------------------------------------------------------
int __fastcall sub_800526BC(__int16 a1)
{
  dword_8009DE44 = 8;
  dword_8009DE50 = a1;
  return sub_800526FC(&dword_8009DE44);
}
// 8009DE44: using guessed type int dword_8009DE44;
// 8009DE50: using guessed type int dword_8009DE50;

//----- (800526FC) --------------------------------------------------------
// write access to const memory has been detected, the output may be wrong!
int __fastcall sub_800526FC(int *a1)
{
  int v2; // $fp
  int v3; // $s4
  int v4; // $s3
  BOOL v5; // $s5
  bool v6; // dc
  unsigned int v7; // $s0
  int result; // $v0
  int *v9; // $a2
  int v10; // $a1
  int *v11; // $v1
  char v12; // $v0
  int v13; // [sp+10h] [-58h] BYREF
  int v14; // [sp+58h] [-10h]

  v2 = 0;
  v3 = 0;
  v4 = *a1;
  v5 = *a1 == 0;
  v6 = *a1 == 0;
  v13 = 0;
  if ( v6 || (v4 & 1) != 0 )
  {
    v7 = a1[1];
    if ( (v7 & 0x100) != 0 )
    {
      v7 &= ~0x100u;
      v2 = 1;
    }
    if ( v7 >= 0xA )
      return -1;
    v3 = 1;
    if ( sub_8005314C(dword_8006FCF0[v7]) )
      return -1;
    v9 = &v13;
    v10 = 67;
    dword_8006F8A0 = v7;
    v11 = dword_8006FD40;
    dword_8006F8B0 = 65534;
    do
    {
      v12 = *v11;
      v11 = (v11 + 1);
      --v10;
      *v9 = v12;
      v9 = (v9 + 1);
    }
    while ( v10 != -1 );
    dword_8006F8AC = 0;
    dword_8006F8A8 = 0;
  }
  if ( v5 || (v4 & 8) != 0 )
    dword_8006F8A8 = 0;
  if ( v5 || (v4 & 0x10) != 0 )
    dword_8006F8AC = 0;
  if ( v3 )
  {
    v14 = (MEMORY[0x1F801DAA] >> 7) & 1;
    if ( v14 )
      MEMORY[0x1F801DAA] &= ~0x80u;
    MEMORY[0x1F801D84] = 0;
    MEMORY[0x1F801D86] = 0;
    word_8006F8A4 = 0;
    word_8006F8A6 = 0;
  }
  else
  {
    if ( v5 || (v4 & 2) != 0 )
    {
      MEMORY[0x1F801D84] = *(a1 + 4);
      word_8006F8A4 = *(a1 + 4);
    }
    if ( v5 || (v4 & 4) != 0 )
    {
      MEMORY[0x1F801D86] = *(a1 + 5);
      word_8006F8A6 = *(a1 + 5);
    }
  }
  if ( v3 )
    spu_setReverbAttr(&v13);
  if ( v2 )
    SpuClearReverbWorkArea(0);
  if ( v3 )
  {
    sub_80051C3C(209, 0, 0);
    result = 0;
    if ( !v14 )
      return result;
    MEMORY[0x1F801DAA] |= 0x80u;
  }
  return 0;
}
// 800527B8: write access to const memory at 8006F8A0 has been detected
// 800527F0: write access to const memory at 8006F8B0 has been detected
// 80052838: write access to const memory at 8006F8AC has been detected
// 80052840: write access to const memory at 8006F8A8 has been detected
// 80052850: write access to const memory at 8006F8AC has been detected
// 80052858: write access to const memory at 8006F8A8 has been detected
// 80052868: write access to const memory at 8006F8AC has been detected
// 80052870: write access to const memory at 8006F8A8 has been detected
// 80052920: write access to const memory at 8006F8A8 has been detected
// 80052998: write access to const memory at 8006F8A8 has been detected
// 80052A54: write access to const memory at 8006F8AC has been detected
// 80052A78: write access to const memory at 8006F8AC has been detected
// 80052AF0: write access to const memory at 8006F8A4 has been detected
// 80052B24: write access to const memory at 8006F8A6 has been detected
// 80052B48: write access to const memory at 8006F8A4 has been detected
// 80052B50: write access to const memory at 8006F8A6 has been detected
// 80052B60: conditional instruction was optimized away because $s6.4==0
// 80052B68: conditional instruction was optimized away because $s7.4==0
// 80052C0C: using guessed type int __fastcall spu_setReverbAttr(_DWORD);
// 800531C4: using guessed type int __fastcall SpuClearReverbWorkArea(_DWORD);
// 8006F8A0: using guessed type int dword_8006F8A0;
// 8006F8A4: using guessed type __int16 word_8006F8A4;
// 8006F8A6: using guessed type __int16 word_8006F8A6;
// 8006F8A8: using guessed type int dword_8006F8A8;
// 8006F8AC: using guessed type int dword_8006F8AC;
// 8006F8B0: using guessed type int dword_8006F8B0;
// 8006FCF0: using guessed type int dword_8006FCF0[];
// 8006FD40: using guessed type int dword_8006FD40[18];

//----- (8005314C) --------------------------------------------------------
int __fastcall sub_8005314C(int a1)
{
  _DWORD *v1; // $a1
  unsigned int v2; // $a0
  unsigned int v3; // $v1
  int result; // $v0

  v1 = 0;
  v2 = 8 * a1;
  while ( 1 )
  {
    if ( (*v1 & 0x80000000) != 0 )
      goto LABEL_6;
    v3 = *v1 & 0xFFFFFFF;
    if ( (*v1 & 0x40000000) != 0 )
      return 0;
    result = 1;
    if ( v3 >= v2 )
      return result;
    result = 1;
    if ( v2 < v3 + v1[1] )
      return result;
LABEL_6:
    v1 += 2;
  }
}
// 8006F858: using guessed type int dword_8006F858;

//----- (80053364) --------------------------------------------------------
// write access to const memory has been detected, the output may be wrong!
int __fastcall sub_80053364(int a1)
{
  __int16 v1; // $v1

  if ( a1 )
  {
    if ( a1 != 1 )
      return 0;
    if ( sub_8005314C(0) )
    {
      dword_8006F894 = 0;
      v1 = MEMORY[0x1F801DAA] & 0xFF7F;
    }
    else
    {
      dword_8006F894 = 1;
      v1 = MEMORY[0x1F801DAA] | 0x80;
    }
  }
  else
  {
    dword_8006F894 = 0;
    v1 = MEMORY[0x1F801DAA] & 0xFF7F;
  }
  MEMORY[0x1F801DAA] = v1;
  return 0;
}
// 8005339C: write access to const memory at 8006F894 has been detected
// 800533E8: write access to const memory at 8006F894 has been detected
// 80053408: write access to const memory at 8006F894 has been detected
// 8006F894: using guessed type int dword_8006F894;
// 8006F898: using guessed type int dword_8006F898;
// 8006F8B0: using guessed type int dword_8006F8B0;

//----- (80053F00) --------------------------------------------------------
// write access to const memory has been detected, the output may be wrong!
int sub_80053F00()
{
  int result; // $v0

  result = 1;
  dword_80070040 = 1;
  return result;
}
// 80053F18: write access to const memory at 80070040 has been detected
// 80053F30: write access to const memory at 80070040 has been detected
// 80070040: using guessed type int dword_80070040;

//----- (80053F50) --------------------------------------------------------
// write access to const memory has been detected, the output may be wrong!
int sub_80053F50()
{
  int v0; // $v1
  bool v1; // dc

  v0 = 3;
  do
  {
    v1 = v0 < 3000;
    v0 += 3;
  }
  while ( v1 );
  byte_8007003C = 0;
  byte_8007003D = 0;
  dword_80070038 = 0;
  byte_8007003E = 6;
  return 1;
}
// 80053F80: write access to const memory at 8007003D has been detected
// 80053F88: write access to const memory at 80070038 has been detected
// 80053F94: write access to const memory at 8007003E has been detected
// 80053FEC: write access to const memory at 8007003E has been detected
// 80053FFC: write access to const memory at 8007003E has been detected
// 8005415C: write access to const memory at 80070038 has been detected
// 80053F7C: write access to const memory at 8007003C has been detected
// 80054010: write access to const memory at 8007003C has been detected
// 80061B84: using guessed type int __fastcall InterruptCallback(_DWORD, _DWORD);
// 80061BE4: using guessed type int __fastcall VSyncCallback(_DWORD);
// 8007002C: using guessed type int dword_8007002C;
// 80070030: using guessed type int dword_80070030;
// 80070038: using guessed type int dword_80070038;
// 8007003C: using guessed type char byte_8007003C;
// 8007003D: using guessed type char byte_8007003D;
// 8007003E: using guessed type char byte_8007003E;

//----- (800541F4) --------------------------------------------------------
int sub_800541F4()
{
  return sub_80053F50();
}

//----- (80054214) --------------------------------------------------------
// write access to const memory has been detected, the output may be wrong!
int __fastcall sub_80054214(int a1)
{
  int result; // $v0

  GsGetWorkBase();
  if ( (a1 & 0x1000) != 0 )
  {
    dword_80070030 = 1;
    dword_8007002C = a1 & 0xFFF;
  }
  else
  {
    dword_80070030 = 0;
    dword_8007002C = a1;
  }
  result = 5;
  dword_801BA2D0 = 60;
  return result;
}
// 80054238: write access to const memory at 80070030 has been detected
// 80054244: write access to const memory at 8007002C has been detected
// 80054254: write access to const memory at 80070030 has been detected
// 8005425C: write access to const memory at 8007002C has been detected
// 8007002C: using guessed type int dword_8007002C;
// 80070030: using guessed type int dword_80070030;
// 801BA2D0: using guessed type int dword_801BA2D0;

//----- (80054388) --------------------------------------------------------
int __fastcall SetMasterVolume(__int16 left, __int16 right, int unused1, __int16 unused2)
{
  int v5; // [sp+10h] [-28h] BYREF
  __int16 v6; // [sp+14h] [-24h]
  __int16 v7; // [sp+16h] [-22h]

  v5 = 3;
  v6 = 129 * left;
  v7 = 129 * right;
  return SpuSetCommonAttr(&v5, right, unused1, unused2);
}

//----- (800543D8) --------------------------------------------------------
int __fastcall SpuSetCommonAttr(int *a1, int a2, int a3, __int16 a4)
{
  __int16 v4; // $t2
  int v5; // $t0
  BOOL v6; // $t1
  int v7; // $a1
  __int16 v8; // $v0
  int v9; // $a2
  __int16 v10; // $a3
  int v11; // $a1
  __int16 v12; // $v0
  int v13; // $a2
  __int16 v14; // $t2
  __int16 v15; // $v1
  __int16 v16; // $v1
  __int16 v17; // $v1
  int result; // $v0
  __int16 v19; // $v1

  v5 = *a1;
  v6 = *a1 == 0;
  if ( !*a1 )
    goto LABEL_4;
  if ( (v5 & 1) != 0 )
  {
    if ( (v5 & 4) == 0 )
    {
LABEL_12:
      a4 = *(a1 + 2);
      v7 = 0;
LABEL_13:
      v8 = a4 & 0x7FFF;
      if ( v7 )
      {
        v9 = *(a1 + 2);
        if ( v9 < 128 )
        {
          v10 = *(a1 + 2);
          if ( v9 < 0 )
            v10 = 0;
        }
        else
        {
          v10 = 127;
        }
        v8 = v10 & 0x7FFF;
      }
      MEMORY[0x1F801D80] = v8 | v7;
      goto LABEL_20;
    }
LABEL_4:
    switch ( *(a1 + 4) )
    {
      case 1:
        v7 = 0x8000;
        break;
      case 2:
        v7 = 36864;
        break;
      case 3:
        v7 = 40960;
        break;
      case 4:
        v7 = 45056;
        break;
      case 5:
        v7 = 49152;
        break;
      case 6:
        v7 = 53248;
        break;
      case 7:
        v7 = 57344;
        break;
      default:
        goto LABEL_12;
    }
    goto LABEL_13;
  }
LABEL_20:
  if ( v6 )
    goto LABEL_23;
  if ( (v5 & 2) == 0 )
    goto LABEL_39;
  if ( (v5 & 8) != 0 )
  {
LABEL_23:
    switch ( *(a1 + 5) )
    {
      case 1:
        v11 = 0x8000;
        break;
      case 2:
        v11 = 36864;
        break;
      case 3:
        v11 = 40960;
        break;
      case 4:
        v11 = 45056;
        break;
      case 5:
        v11 = 49152;
        break;
      case 6:
        v11 = 53248;
        break;
      case 7:
        v11 = 57344;
        break;
      default:
        goto LABEL_31;
    }
  }
  else
  {
LABEL_31:
    v4 = *(a1 + 3);
    v11 = 0;
  }
  v12 = v4 & 0x7FFF;
  if ( v11 )
  {
    v13 = *(a1 + 3);
    if ( v13 < 128 )
    {
      v14 = *(a1 + 3);
      if ( v13 < 0 )
        v14 = 0;
    }
    else
    {
      v14 = 127;
    }
    v12 = v14 & 0x7FFF;
  }
  MEMORY[0x1F801D82] = v12 | v11;
LABEL_39:
  if ( v6 || (v5 & 0x40) != 0 )
    MEMORY[0x1F801DB0] = *(a1 + 8);
  if ( v6 || (v5 & 0x80) != 0 )
    MEMORY[0x1F801DB2] = *(a1 + 9);
  if ( v6 || (v5 & 0x100) != 0 )
  {
    if ( a1[5] )
      v15 = MEMORY[0x1F801DAA] | 4;
    else
      v15 = MEMORY[0x1F801DAA] & 0xFFFB;
    MEMORY[0x1F801DAA] = v15;
  }
  if ( v6 || (v5 & 0x200) != 0 )
  {
    if ( a1[6] )
      v16 = MEMORY[0x1F801DAA] | 1;
    else
      v16 = MEMORY[0x1F801DAA] & 0xFFFE;
    MEMORY[0x1F801DAA] = v16;
  }
  if ( v6 || (v5 & 0x400) != 0 )
    MEMORY[0x1F801DB4] = *(a1 + 14);
  if ( v6 || (v5 & 0x800) != 0 )
    MEMORY[0x1F801DB6] = *(a1 + 15);
  if ( v6 || (v5 & 0x1000) != 0 )
  {
    if ( a1[8] )
      v17 = MEMORY[0x1F801DAA] | 8;
    else
      v17 = MEMORY[0x1F801DAA] & 0xFFF7;
    MEMORY[0x1F801DAA] = v17;
  }
  result = v5 & 0x2000;
  if ( v6 || (v5 & 0x2000) != 0 )
  {
    result = 528489472;
    if ( a1[9] )
      v19 = MEMORY[0x1F801DAA] | 2;
    else
      v19 = MEMORY[0x1F801DAA] & 0xFFFD;
    MEMORY[0x1F801DAA] = v19;
  }
  return result;
}
// 80054540: variable 'v4' is possibly undefined

//----- (8005476C) --------------------------------------------------------
int sub_8005476C()
{
  unsigned __int8 v0; // $s0
  unsigned __int16 v1; // $t3
  char v2; // $t2
  int v3; // $t0
  unsigned __int16 v4; // $t4
  char v5; // $t1
  unsigned __int8 v6; // $a3
  int v7; // $v0
  int v8; // $v1
  _BYTE *v9; // $at
  int v10; // $v0
  unsigned __int16 *v11; // $at
  int v12; // $a2
  unsigned int v13; // $a1
  unsigned int v14; // $a0
  int v15; // $a3
  int v16; // $v1
  int v17; // $v0
  int v18; // $a0
  int result; // $v0

  v0 = 99;
  v1 = -1;
  v2 = 0;
  v3 = 0;
  v4 = byte_8019E6DF;
  v5 = 99;
  v6 = 0;
  if ( byte_8019B628 )
  {
    v7 = 0;
    while ( 1 )
    {
      v8 = 52 * v7;
      v9 = &unk_80078A6B + 52 * v7;
      v10 = v6;
      if ( !*v9 )
      {
        v10 = v6;
        if ( !*(&unk_80078A56 + v8) )
          break;
      }
      v11 = (&unk_80078A68 + 52 * v10);
      v12 = *v11;
      if ( v12 >= v4 )
      {
        if ( v12 == v4 )
        {
          v13 = *(&unk_80078A56 + 26 * v10);
          ++v2;
          if ( v13 >= v1 )
          {
            if ( v13 == v1 && v3 < *(&unk_80078A52 + 26 * v10) )
            {
              v3 = *(&unk_80078A52 + 26 * v10);
              v5 = v6;
            }
          }
          else
          {
            v1 = *(&unk_80078A56 + 26 * v10);
            v3 = *(&unk_80078A52 + 26 * v10);
            v5 = v6;
          }
        }
      }
      else
      {
        v4 = *v11;
        v1 = *(&unk_80078A56 + 26 * v10);
        v3 = *(&unk_80078A52 + 26 * v10);
        v5 = v6;
        v2 = 1;
      }
      v7 = ++v6;
      if ( v6 >= byte_8019B628 )
        goto LABEL_15;
    }
    v0 = v6;
  }
LABEL_15:
  if ( v0 == 99 )
  {
    v0 = v5;
    if ( !v2 )
      v0 = byte_8019B628;
  }
  v14 = byte_8019B628;
  if ( v0 >= byte_8019B628 )
    return v0;
  v15 = 0;
  if ( byte_8019B628 )
  {
    v16 = 0;
    do
    {
      ++v15;
      *(&unk_80078A50 + 26 * v16 + 1) = *(&unk_80078A52 + 26 * v16) + 1;
      v16 = v15;
    }
    while ( v15 < v14 );
  }
  v17 = 52 * v0;
  *(&unk_80078A52 + v17) = 0;
  v18 = *(&unk_80078A6B + v17);
  *(&unk_80078A68 + v17) = byte_8019E6DF;
  result = v0;
  if ( v18 == 2 )
  {
    sub_80059720(0, 0xFFFFFF);
    return v0;
  }
  return result;
}
// 8019B628: using guessed type char byte_8019B628;
// 8019E6DF: using guessed type char byte_8019E6DF;

//----- (80054A10) --------------------------------------------------------
int __fastcall sub_80054A10(int a1, __int16 a2)
{
  unsigned int v2; // $a2
  unsigned int v4; // $a0
  unsigned int v5; // $a3
  unsigned int v6; // $a1
  unsigned int v7; // $lo
  unsigned int v8; // $v1
  int v9; // $a3
  int v10; // $a2
  int result; // $v0

  v2 = byte_8019E6D4 * 0x3FFF * *(dword_8016DAB0 + 24) / 16129 * byte_8019E6DA * byte_8019E6DD / 0x3F01;
  v4 = 172 * ((word_8019E6E6 << 16) >> 24) + dword_801DDDB8[word_8019E6E6];
  v5 = v2;
  if ( word_8019E6E6 != 33 )
  {
    v5 = byte_8019E6D4
       * 0x3FFF
       * *(dword_8016DAB0 + 24)
       / 16129
       * byte_8019E6DA
       * byte_8019E6DD
       / 0x3F01
       * *(v4 + 116)
       / 0x7F;
    v2 = v2 * *(v4 + 118) / 0x7F;
  }
  if ( byte_8019E6DE >= 0x40u )
  {
    v6 = v5 * (127 - byte_8019E6DE) / 0x3F;
  }
  else
  {
    v2 = v2 * byte_8019E6DE / 0x3F;
    v6 = v5;
  }
  if ( byte_8019E6DB >= 0x40u )
    v6 = v6 * (127 - byte_8019E6DB) / 0x3F;
  else
    v2 = v2 * byte_8019E6DB / 0x3F;
  if ( byte_8019E6D5 >= 0x40u )
    v6 = v6 * (127 - byte_8019E6D5) / 0x3F;
  else
    v2 = v2 * byte_8019E6D5 / 0x3F;
  v7 = v6 * v6;
  if ( word_80130A88 == 1 )
  {
    if ( v6 >= v2 )
      v2 = v6;
    else
      v6 = v2;
    v7 = v6 * v6;
  }
  v8 = 2 * (8 * word_8019E6EA);
  *(&unk_800788BC + v8) = a2;
  word_800788B8[v8 / 2] = v7 / 0x3FFF;
  *(&unk_800788BA + v8) = v2 * v2 / 0x3FFF;
  byte_80078A38[word_8019E6EA] |= 7u;
  *(&unk_80078A54 + 26 * word_8019E6EA) = a2;
  *(&unk_80078A6B + 52 * word_8019E6EA) = 1;
  if ( word_8019E6EA >= 16 )
  {
    LOWORD(v9) = 0;
    v10 = 1 << (word_8019E6EA - 16);
  }
  else
  {
    v9 = 1 << word_8019E6EA;
    LOWORD(v10) = 0;
  }
  if ( (byte_8019E6E4 & 4) != 0 )
  {
    word_80079170 |= v9;
    word_80079178 |= v10;
  }
  else
  {
    word_80079170 &= ~v9;
    word_80079178 &= ~v10;
  }
  word_80079160 |= v9;
  word_80079168 |= v10;
  result = (word_801DF028 & ~word_80079160);
  word_801DF028 &= ~word_80079160;
  word_801DF030 &= ~word_80079168;
  return result;
}
// 800788B8: using guessed type _WORD word_800788B8[1];
// 80078A38: using guessed type _BYTE byte_80078A38[24];
// 80079160: using guessed type __int16 word_80079160;
// 80079168: using guessed type __int16 word_80079168;
// 80079170: using guessed type __int16 word_80079170;
// 80079178: using guessed type __int16 word_80079178;
// 80130A88: using guessed type __int16 word_80130A88;
// 8016DAB0: using guessed type int dword_8016DAB0;
// 8019E6D4: using guessed type char byte_8019E6D4;
// 8019E6D5: using guessed type char byte_8019E6D5;
// 8019E6DA: using guessed type char byte_8019E6DA;
// 8019E6DB: using guessed type char byte_8019E6DB;
// 8019E6DD: using guessed type char byte_8019E6DD;
// 8019E6DE: using guessed type char byte_8019E6DE;
// 8019E6E4: using guessed type char byte_8019E6E4;
// 8019E6E6: using guessed type __int16 word_8019E6E6;
// 8019E6EA: using guessed type __int16 word_8019E6EA;
// 801DDDB8: using guessed type _DWORD dword_801DDDB8[32];
// 801DF028: using guessed type __int16 word_801DF028;
// 801DF030: using guessed type __int16 word_801DF030;

//----- (80054EFC) --------------------------------------------------------
int sub_80054EFC()
{
  int v0; // $v1
  int v1; // $a3
  int v2; // $a2
  int result; // $v0

  v0 = word_8019E6EA;
  if ( word_8019E6EA >= 0x10u )
  {
    LOWORD(v1) = 0;
    v2 = 1 << (word_8019E6EA - 16);
    v0 = word_8019E6EA;
  }
  else
  {
    v1 = 1 << word_8019E6EA;
    LOWORD(v2) = 0;
  }
  *(&unk_80078A6B + 52 * v0) = 0;
  *(&unk_80078A54 + 26 * v0) = 0;
  *(&unk_80078A50 + 26 * v0) = 0;
  word_801DF028 |= v1;
  word_801DF030 |= v2;
  result = (word_80079160 & ~word_801DF028);
  word_80079160 &= ~word_801DF028;
  word_80079168 &= ~word_801DF030;
  return result;
}
// 80079160: using guessed type __int16 word_80079160;
// 80079168: using guessed type __int16 word_80079168;
// 8019E6EA: using guessed type __int16 word_8019E6EA;
// 801DF028: using guessed type __int16 word_801DF028;
// 801DF030: using guessed type __int16 word_801DF030;

//----- (80054FD8) --------------------------------------------------------
int __fastcall sub_80054FD8(int a1, int a2)
{
  unsigned __int8 v3; // $a3
  unsigned __int8 v4; // $a2
  unsigned __int8 *v5; // $a0
  int v6; // $v0
  unsigned __int8 v7; // $v1

  v3 = 0;
  v4 = 0;
  if ( byte_8019E6D0 )
  {
    do
    {
      v5 = (32 * (16 * byte_8019E6D7 + v4) + dword_8016E5F8);
      if ( byte_8019E6D2 >= v5[6] )
      {
        v6 = v3;
        if ( v5[7] >= byte_8019E6D2 )
        {
          v7 = v3++;
          *(a2 + v6) = v5[22];
          *(a1 + v7) = v4;
        }
      }
      ++v4;
    }
    while ( v4 < byte_8019E6D0 );
  }
  return v3;
}
// 8016E5F8: using guessed type int dword_8016E5F8;
// 8019E6D0: using guessed type char byte_8019E6D0;
// 8019E6D2: using guessed type char byte_8019E6D2;
// 8019E6D7: using guessed type char byte_8019E6D7;

//----- (80055088) --------------------------------------------------------
int sub_80055088()
{
  int v0; // $t0
  _DWORD *v1; // $a3
  __int16 v2; // $v0
  int v3; // $a0
  int result; // $v0

  v0 = 0;
  v1 = &unk_80078F38;
  word_8019E6EC = 8 * word_8019E6EA;
  word_8019E6EE = byte_8019E6DC + 16 * byte_8019E6D7;
  *(&unk_80078A56 + 26 * word_8019E6EA) = 0x7FFF;
  do
  {
    ++v0;
    *v1++ &= ~(1 << word_8019E6EA);
  }
  while ( v0 < 16 );
  if ( (word_8019E6E8 & 1) != 0 )
    v2 = *(16 * ((word_8019E6E8 - 1) / 2) + dword_8016DAA0 + 12);
  else
    v2 = *(16 * ((word_8019E6E8 - 1) / 2) + dword_8016DAA0 + 14);
  word_800788BE[word_8019E6EC] = v2;
  byte_80078A38[word_8019E6EA] |= 8u;
  v3 = dword_8016E5F8;
  word_800788C0[word_8019E6EC] = *(32 * (16 * byte_8019E6D7 + byte_8019E6DC) + dword_8016E5F8 + 16);
  word_800788C2[word_8019E6EC] = *(32 * (16 * byte_8019E6D7 + byte_8019E6DC) + v3 + 18) + word_8009E0CC;
  result = byte_80078A38[word_8019E6EA] | 0x30;
  byte_80078A38[word_8019E6EA] = result;
  return result;
}
// 800788BE: using guessed type _WORD word_800788BE[1];
// 800788C0: using guessed type _WORD word_800788C0[1];
// 800788C2: using guessed type _WORD word_800788C2[187];
// 80078A38: using guessed type _BYTE byte_80078A38[24];
// 8009E0CC: using guessed type __int16 word_8009E0CC;
// 8016DAA0: using guessed type int dword_8016DAA0;
// 8016E5F8: using guessed type int dword_8016E5F8;
// 8019E6D7: using guessed type char byte_8019E6D7;
// 8019E6DC: using guessed type char byte_8019E6DC;
// 8019E6E8: using guessed type __int16 word_8019E6E8;
// 8019E6EA: using guessed type __int16 word_8019E6EA;
// 8019E6EC: using guessed type __int16 word_8019E6EC;
// 8019E6EE: using guessed type __int16 word_8019E6EE;

//----- (800552C0) --------------------------------------------------------
int __fastcall sub_800552C0(unsigned __int8 a1)
{
  int v2; // $v1
  unsigned int v3; // $a2
  unsigned int v4; // $a1
  int v5; // $v1
  char v6; // $v0
  int v7; // $a3
  int v8; // $a2
  int v9; // $a0
  int v10; // $a1
  int v11; // $v1
  int result; // $v0

  v2 = 172 * HIBYTE(word_8019E6E6) + dword_801DDDB8[word_8019E6E6];
  if ( byte_8019E6DE >= 0x40u )
  {
    v3 = 129 * *(v2 + 118) * byte_8019E6DA / 0x7F * byte_8019E6DD / 0x7F;
    v4 = 129 * *(v2 + 116) * byte_8019E6DA / 0x7F * byte_8019E6DD / 0x7F * (127 - byte_8019E6DE) / 0x3F;
  }
  else
  {
    v3 = 129 * *(v2 + 118) * byte_8019E6DA / 0x7F * byte_8019E6DD / 0x7F * byte_8019E6DE / 0x3F;
    v4 = 129 * *(v2 + 116) * byte_8019E6DA / 0x7F * byte_8019E6DD / 0x7F;
  }
  if ( byte_8019E6DB >= 0x40u )
    v4 = v4 * (127 - byte_8019E6DB) / 0x3F;
  else
    v3 = v3 * byte_8019E6DB / 0x3F;
  if ( byte_8019E6D5 >= 0x40u )
    v4 = v4 * (127 - byte_8019E6D5) / 0x3F;
  else
    v3 = byte_8019E6D5 * v3 / 0x3F;
  if ( word_80130A88 == 1 )
  {
    if ( v4 >= v3 )
      LOWORD(v3) = v4;
    else
      LOWORD(v4) = v3;
  }
  MEMORY[0x1F801DAA] = MEMORY[0x1F801DAA] & 0xC0FF | (((byte_8019E6D2 - byte_8019E6E0) & 0x3F) << 8);
  v5 = 8 * a1;
  *(&unk_800788BA + v5 * 2) = v3;
  v6 = byte_80078A38[a1];
  word_800788B8[v5] = v4;
  byte_80078A38[a1] = v6 | 3;
  if ( a1 >= 0x10u )
  {
    LOWORD(v7) = 0;
    v8 = 1 << (a1 - 16);
  }
  else
  {
    v7 = 1 << a1;
    LOWORD(v8) = 0;
  }
  v9 = byte_8019B628;
  *(&unk_80078A54 + 26 * a1) = 10;
  v10 = 0;
  if ( v9 )
  {
    v11 = 0;
    do
    {
      ++v10;
      *(&unk_80078A6B + 52 * (v11 >> 16)) &= 1u;
      v11 = v10 << 16;
    }
    while ( v10 < byte_8019B628 );
  }
  *(&unk_80078A6B + 52 * a1) = 2;
  word_80079160 |= v7;
  word_80079168 |= v8;
  word_801DF028 &= ~word_80079160;
  word_801DF030 &= ~word_80079168;
  if ( (byte_8019E6E4 & 4) != 0 )
  {
    word_80079170 |= v7;
    word_80079178 |= v8;
  }
  else
  {
    word_80079170 &= ~v7;
    word_80079178 &= ~v8;
  }
  result = 528489472;
  MEMORY[0x1F801D94] = v7;
  MEMORY[0x1F801D96] = v8;
  return result;
}
// 800788B8: using guessed type _WORD word_800788B8[1];
// 80078A38: using guessed type _BYTE byte_80078A38[24];
// 80079160: using guessed type __int16 word_80079160;
// 80079168: using guessed type __int16 word_80079168;
// 80079170: using guessed type __int16 word_80079170;
// 80079178: using guessed type __int16 word_80079178;
// 80130A88: using guessed type __int16 word_80130A88;
// 8019B628: using guessed type char byte_8019B628;
// 8019E6D2: using guessed type char byte_8019E6D2;
// 8019E6D5: using guessed type char byte_8019E6D5;
// 8019E6DA: using guessed type char byte_8019E6DA;
// 8019E6DB: using guessed type char byte_8019E6DB;
// 8019E6DD: using guessed type char byte_8019E6DD;
// 8019E6DE: using guessed type char byte_8019E6DE;
// 8019E6E0: using guessed type char byte_8019E6E0;
// 8019E6E4: using guessed type char byte_8019E6E4;
// 8019E6E6: using guessed type __int16 word_8019E6E6;
// 801DDDB8: using guessed type _DWORD dword_801DDDB8[32];
// 801DF028: using guessed type __int16 word_801DF028;
// 801DF030: using guessed type __int16 word_801DF030;

//----- (80055790) --------------------------------------------------------
int __fastcall sub_80055790(unsigned __int8 a1, __int16 a2, __int16 a3)
{
  char v4; // $v1
  int v5; // $t0
  int v6; // $a2
  int v7; // $a0
  int v8; // $a1
  int v9; // $v1
  int v10; // $v0
  int result; // $v0

  *(&unk_800788BA + 8 * a1) = a3;
  v4 = byte_80078A38[a1];
  word_800788B8[8 * a1] = a2;
  byte_80078A38[a1] = v4 | 3;
  if ( a1 >= 0x10u )
  {
    LOWORD(v5) = 0;
    v6 = 1 << (a1 - 16);
  }
  else
  {
    v5 = 1 << a1;
    LOWORD(v6) = 0;
  }
  v7 = byte_8019B628;
  *(&unk_80078A54 + 26 * a1) = 10;
  v8 = 0;
  if ( v7 )
  {
    v9 = 0;
    do
    {
      *(&unk_80078A6B + 52 * v9) &= 1u;
      v9 = ++v8;
    }
    while ( v8 < byte_8019B628 );
  }
  v10 = 52 * a1;
  *(&unk_80078A6B + v10) = 2;
  *(&unk_80078A52 + v10) = 0;
  word_80079160 |= v5;
  word_80079168 |= v6;
  word_801DF028 &= ~word_80079160;
  result = (word_801DF030 & ~word_80079168);
  word_801DF030 &= ~word_80079168;
  MEMORY[0x1F801D94] = v5;
  MEMORY[0x1F801D96] = v6;
  return result;
}
// 800788B8: using guessed type _WORD word_800788B8[1];
// 80078A38: using guessed type _BYTE byte_80078A38[24];
// 80079160: using guessed type __int16 word_80079160;
// 80079168: using guessed type __int16 word_80079168;
// 8019B628: using guessed type char byte_8019B628;
// 801DF028: using guessed type __int16 word_801DF028;
// 801DF030: using guessed type __int16 word_801DF030;

//----- (80055950) --------------------------------------------------------
int __fastcall sub_80055950(unsigned __int8 a1)
{
  int result; // $v0

  result = 52 * a1;
  *(&unk_80078A6B + result) = 0;
  *(&unk_80078A54 + result) = 0;
  MEMORY[0x1F801D94] = 0;
  MEMORY[0x1F801D96] = 0;
  return result;
}

//----- (8005599C) --------------------------------------------------------
int sub_8005599C()
{
  int v0; // $v1
  int v1; // $lo
  int v2; // $hi
  unsigned int v3; // $v1
  int v4; // $v1
  int v5; // $v0

  v0 = byte_8019E6D2 + 60 - byte_8019E6E0;
  v2 = v0 % 12;
  v1 = v0 / 12;
  v3 = byte_8019E6E1 >> 3;
  if ( v3 >= 0x10 )
    LOWORD(v3) = 15;
  v4 = *(&dword_80070048[8 * v2] + v3);
  v5 = v1 - 5;
  if ( v1 - 5 <= 0 )
  {
    if ( v5 < 0 )
      return v4 >> (5 - v1);
  }
  else
  {
    v4 <<= v5;
  }
  return v4;
}
// 80070048: using guessed type int dword_80070048[97];
// 8019E6D2: using guessed type char byte_8019E6D2;
// 8019E6E0: using guessed type char byte_8019E6E0;
// 8019E6E1: using guessed type char byte_8019E6E1;

//----- (80055A58) --------------------------------------------------------
int __fastcall sub_80055A58(__int16 a1, unsigned __int16 a2)
{
  int v3; // $v1
  __int16 v4; // $a2
  int v5; // $a1
  __int16 v6; // $a0
  int v7; // $v0
  int v8; // $v1
  int v9; // $v0

  v3 = 32 * (byte_8019E6DC + 16 * byte_8019E6D7) + dword_8016E5F8;
  v4 = 0;
  v5 = (a2 + *(v3 + 5)) / 8;
  v6 = v5;
  if ( v5 >= 16 )
  {
    v4 = 1;
    v6 = v5 - 16;
  }
  v7 = (v4 + a1 + 60 - *(v3 + 4));
  v8 = *(&dword_80070048[8 * (v7 % 12)] + v6);
  v9 = (v7 / 12 - 5);
  if ( v9 <= 0 )
  {
    if ( v9 < 0 )
      return v8 >> -v9;
  }
  else
  {
    v8 <<= v9;
  }
  return v8;
}
// 80070048: using guessed type int dword_80070048[97];
// 8016E5F8: using guessed type int dword_8016E5F8;
// 8019E6D7: using guessed type char byte_8019E6D7;
// 8019E6DC: using guessed type char byte_8019E6DC;

//----- (80055D90) --------------------------------------------------------
void __fastcall sub_80055D90(__int16 a1, int a2, __int16 a3, int a4)
{
  int v5; // $v0
  int v6; // $a0
  int v7; // $a0
  int v8; // $a0
  int v9; // $v1
  int v10; // $lo
  int v11; // $v0
  int v12; // $a0
  int v13; // $v0

  if ( a2 == a3 )
    return;
  v5 = 52 * a1;
  *(&unk_80078A6C + v5) = 1;
  *(&unk_80078A74 + v5) = a2;
  *(&unk_80078A76 + v5) = a3;
  if ( a2 - a3 < 0 )
  {
    v6 = a4 << 16;
    if ( a3 - a2 >= a4 )
    {
      v7 = a2 << 16;
      goto LABEL_13;
    }
  }
  else
  {
    v6 = a4 << 16;
    if ( a2 - a3 >= a4 )
    {
      v7 = a2 << 16;
LABEL_13:
      v12 = (v7 >> 16) - a3;
      if ( !a4 )
        _break(7u, 0);
      if ( a4 == -1 && v12 == 0x80000000 )
        _break(6u, 0);
      v13 = 52 * a1;
      *(&unk_80078A70 + v13) = 0;
      *(&unk_80078A6E + v13) = v12 / a4;
      return;
    }
  }
  v8 = v6 >> 16;
  v9 = a2 - a3;
  v10 = v8 / v9;
  if ( a2 == a3 )
    _break(7u, 0);
  if ( v9 == -1 && v8 == 0x80000000 )
    _break(6u, 0);
  v11 = 52 * a1;
  *(&unk_80078A6E + v11) = 1;
  *(&unk_80078A70 + v11) = v10;
  *(&unk_80078A72 + v11) = v10;
}

//----- (80055F60) --------------------------------------------------------
int __fastcall sub_80055F60(int a1)
{
  int v1; // $a1
  int v2; // $t0
  int v4; // $v0
  int result; // $v0
  __int16 v6; // $v1
  int v7; // $a0
  __int16 v8; // $v0
  int v9; // $a0
  int v10; // $v1
  __int16 v11; // $v1
  unsigned int v12; // $v1
  unsigned int v13; // $a1
  unsigned int v14; // $a2
  int v15; // $v0
  int v16; // $v0
  int v17; // $v0
  int v18; // $v0
  int v19; // $a0
  int v20; // $v0

  v1 = 52 * a1;
  v2 = 8 * a1;
  if ( *(&unk_80078A70 + v1) )
  {
    v4 = *(&unk_80078A72 + 26 * a1);
    *(&unk_80078A72 + 26 * a1) = v4 - 1;
    result = v4 << 16;
    if ( result > 0 )
      return result;
    *(&unk_80078A72 + 26 * a1) = *(&unk_80078A70 + 26 * a1);
  }
  v6 = *(&unk_80078A74 + 26 * a1);
  v7 = *(&unk_80078A6E + 26 * a1);
  v8 = v6 + *(&unk_80078A6E + v1);
  *(&unk_80078A74 + v1) = v8;
  if ( v7 > 0 )
  {
    LOWORD(v9) = *(&unk_80078A76 + v1);
    if ( v8 < v9 )
    {
LABEL_10:
      v10 = a1 << 16;
      goto LABEL_11;
    }
LABEL_9:
    *(&unk_80078A74 + v1) = v9;
    *(&unk_80078A6C + v1) = 0;
    goto LABEL_10;
  }
  v10 = a1 << 16;
  if ( v7 < 0 )
  {
    v9 = *(&unk_80078A76 + v1);
    v10 = a1 << 16;
    if ( v9 >= v8 )
      goto LABEL_9;
  }
LABEL_11:
  v11 = *(&unk_80078A74 + 26 * (v10 >> 16));
  byte_8019E6D4 = v11;
  v12 = v11 * 0x3FFF * *(dword_8016DAB0 + 24) / 16129 * byte_8019E6DA * byte_8019E6DD / 0x3F01;
  if ( byte_8019E6DE >= 0x40u )
  {
    LOWORD(v14) = v12;
    v13 = (v12 * (127 - byte_8019E6DE)) >> 6;
  }
  else
  {
    LOWORD(v13) = v12;
    v14 = (v12 * byte_8019E6DE) >> 6;
  }
  if ( byte_8019E6DB >= 0x40u )
  {
    v16 = v13 * (127 - byte_8019E6DB);
    v13 = v16 >> 6;
    if ( v16 < 0 )
      v13 = (v16 + 63) >> 6;
  }
  else
  {
    v15 = v14 * byte_8019E6DB;
    v14 = v15 >> 6;
    if ( v15 < 0 )
      v14 = (v15 + 63) >> 6;
  }
  if ( byte_8019E6D5 >= 0x40u )
  {
    v18 = v13 * (127 - byte_8019E6D5);
    v13 = v18 >> 6;
    if ( v18 < 0 )
      v13 = (v18 + 63) >> 6;
  }
  else
  {
    v17 = v14 * byte_8019E6D5;
    v14 = v17 >> 6;
    if ( v17 < 0 )
      v14 = (v17 + 63) >> 6;
  }
  if ( word_80130A88 == 1 )
  {
    if ( v13 >= v14 )
      LOWORD(v14) = v13;
    else
      LOWORD(v13) = v14;
  }
  v19 = v2 << 16 >> 15;
  *(&unk_800788BA + v19) = v14;
  v20 = byte_80078A38[a1];
  *(word_800788B8 + v19) = v13;
  result = v20 | 3;
  byte_80078A38[a1] = result;
  return result;
}
// 800788B8: using guessed type _WORD word_800788B8[1];
// 80078A38: using guessed type _BYTE byte_80078A38[24];
// 80130A88: using guessed type __int16 word_80130A88;
// 8016DAB0: using guessed type int dword_8016DAB0;
// 8019E6D4: using guessed type char byte_8019E6D4;
// 8019E6D5: using guessed type char byte_8019E6D5;
// 8019E6DA: using guessed type char byte_8019E6DA;
// 8019E6DB: using guessed type char byte_8019E6DB;
// 8019E6DD: using guessed type char byte_8019E6DD;
// 8019E6DE: using guessed type char byte_8019E6DE;

//----- (80056334) --------------------------------------------------------
void __fastcall sub_80056334(__int16 a1, int a2, __int16 a3, int a4)
{
  int v5; // $v0
  int v6; // $a0
  int v7; // $a0
  int v8; // $a0
  int v9; // $v1
  int v10; // $lo
  int v11; // $v0
  int v12; // $a0
  int v13; // $v0

  if ( a2 == a3 )
    return;
  v5 = 52 * a1;
  *(&unk_80078A78 + v5) = 1;
  *(&unk_80078A80 + v5) = a2;
  *(&unk_80078A82 + v5) = a3;
  if ( a2 - a3 < 0 )
  {
    v6 = a4 << 16;
    if ( a3 - a2 >= a4 )
    {
      v7 = a2 << 16;
      goto LABEL_13;
    }
  }
  else
  {
    v6 = a4 << 16;
    if ( a2 - a3 >= a4 )
    {
      v7 = a2 << 16;
LABEL_13:
      v12 = (v7 >> 16) - a3;
      if ( !a4 )
        _break(7u, 0);
      if ( a4 == -1 && v12 == 0x80000000 )
        _break(6u, 0);
      v13 = 52 * a1;
      *(&unk_80078A7C + v13) = 0;
      *(&unk_80078A7A + v13) = v12 / a4;
      return;
    }
  }
  v8 = v6 >> 16;
  v9 = a2 - a3;
  v10 = v8 / v9;
  if ( a2 == a3 )
    _break(7u, 0);
  if ( v9 == -1 && v8 == 0x80000000 )
    _break(6u, 0);
  v11 = 52 * a1;
  *(&unk_80078A7A + v11) = 1;
  *(&unk_80078A7C + v11) = v10;
  *(&unk_80078A7E + v11) = v10;
}

//----- (80056504) --------------------------------------------------------
int __fastcall sub_80056504(int a1)
{
  int v1; // $a1
  int v2; // $t1
  int v4; // $v0
  int result; // $v0
  __int16 v6; // $v1
  int v7; // $a0
  __int16 v8; // $v0
  int v9; // $a0
  int v10; // $v1
  char *v11; // $at
  unsigned int v12; // $a3
  unsigned int v13; // $v1
  unsigned int v14; // $a1
  unsigned int v15; // $a2
  int v16; // $v0
  int v17; // $v0
  int v18; // $a0
  int v19; // $v0

  v1 = 52 * a1;
  v2 = 8 * a1;
  if ( *(&unk_80078A7C + v1) )
  {
    v4 = *(&unk_80078A7E + 26 * a1);
    *(&unk_80078A7E + 26 * a1) = v4 - 1;
    result = v4 << 16;
    if ( result > 0 )
      return result;
    *(&unk_80078A7E + 26 * a1) = *(&unk_80078A7C + 26 * a1);
  }
  v6 = *(&unk_80078A80 + 26 * a1);
  v7 = *(&unk_80078A7A + 26 * a1);
  v8 = v6 + *(&unk_80078A7A + v1);
  *(&unk_80078A80 + v1) = v8;
  if ( v7 > 0 )
  {
    LOWORD(v9) = *(&unk_80078A82 + v1);
    if ( v8 < v9 )
    {
LABEL_10:
      v10 = a1 << 16;
      goto LABEL_11;
    }
LABEL_9:
    *(&unk_80078A80 + v1) = v9;
    *(&unk_80078A78 + v1) = 0;
    goto LABEL_10;
  }
  v10 = a1 << 16;
  if ( v7 < 0 )
  {
    v9 = *(&unk_80078A82 + v1);
    v10 = a1 << 16;
    if ( v9 >= v8 )
      goto LABEL_9;
  }
LABEL_11:
  v11 = &unk_80078A80 + 52 * (v10 >> 16);
  v12 = *v11;
  byte_8019E6D5 = *v11;
  v13 = byte_8019E6D4 * 0x3FFF * *(dword_8016DAB0 + 24) / 16129 * byte_8019E6DA * byte_8019E6DD / 0x3F01;
  if ( byte_8019E6DE >= 0x40u )
  {
    v15 = byte_8019E6D4 * 0x3FFF * *(dword_8016DAB0 + 24) / 16129 * byte_8019E6DA * byte_8019E6DD / 0x3F01;
    v14 = (v13 * (127 - byte_8019E6DE)) >> 6;
  }
  else
  {
    v14 = byte_8019E6D4 * 0x3FFF * *(dword_8016DAB0 + 24) / 16129 * byte_8019E6DA * byte_8019E6DD / 0x3F01;
    v15 = (v13 * byte_8019E6DE) >> 6;
  }
  if ( byte_8019E6DB >= 0x40u )
    v14 = (v14 * (127 - byte_8019E6DB) + (v14 * (127 - byte_8019E6DB) < 0 ? 0x3F : 0)) >> 6;
  else
    v15 = (v15 * byte_8019E6DB + (v15 * byte_8019E6DB < 0 ? 0x3F : 0)) >> 6;
  if ( v12 >= 0x40 )
  {
    v17 = v14 * (127 - v12);
    v14 = v17 >> 6;
    if ( v17 < 0 )
      v14 = (v17 + 63) >> 6;
  }
  else
  {
    v16 = v15 * v12;
    v15 = v16 >> 6;
    if ( v16 < 0 )
      v15 = (v16 + 63) >> 6;
  }
  if ( word_80130A88 == 1 )
  {
    if ( v14 >= v15 )
      LOWORD(v15) = v14;
    else
      LOWORD(v14) = v15;
  }
  v18 = v2 << 16 >> 15;
  *(&unk_800788BA + v18) = v15;
  v19 = byte_80078A38[a1];
  *(word_800788B8 + v18) = v14;
  result = v19 | 3;
  byte_80078A38[a1] = result;
  return result;
}
// 800788B8: using guessed type _WORD word_800788B8[1];
// 80078A38: using guessed type _BYTE byte_80078A38[24];
// 80130A88: using guessed type __int16 word_80130A88;
// 8016DAB0: using guessed type int dword_8016DAB0;
// 8019E6D4: using guessed type char byte_8019E6D4;
// 8019E6D5: using guessed type char byte_8019E6D5;
// 8019E6DA: using guessed type char byte_8019E6DA;
// 8019E6DB: using guessed type char byte_8019E6DB;
// 8019E6DD: using guessed type char byte_8019E6DD;
// 8019E6DE: using guessed type char byte_8019E6DE;

//----- (800568CC) --------------------------------------------------------
int __fastcall sub_800568CC(unsigned __int8 a1)
{
  int v2; // $s0
  int v3; // $v0
  int v4; // $s0
  int v5; // $v0
  int v6; // $s0
  int v7; // $v0
  unsigned __int16 v8; // $s0
  int v9; // $v1
  int v10; // $v0
  _WORD *v11; // $a1

  sub_8005208C(0);
  word_8019E6C0 = 0;
  word_8009E0CC = 0;
  SpuInitMalloc(32, &unk_80078F80);
  v2 = 0;
  v3 = 0;
  do
  {
    word_800788B8[v3] = 0;
    v3 = ++v2;
  }
  while ( v2 < 0xC0u );
  v4 = 0;
  v5 = 0;
  do
  {
    byte_80078A38[v5] = 0;
    v5 = ++v4;
  }
  while ( v4 < 0x18u );
  g_ActiveVoiceCount = 0;
  v6 = 0;
  v7 = 0;
  do
  {
    g_SPUVoiceActive[v7] = 0;
    v7 = ++v6;
  }
  while ( v6 < 0x10u );
  if ( a1 < 0x18u )
    byte_8019B628 = a1;
  else
    byte_8019B628 = 24;
  v8 = 0;
  if ( byte_8019B628 )
  {
    v9 = 0;
    do
    {
      v10 = 52 * v9;
      *(&unk_80078A52 + v10) = 24;
      *(&unk_80078A50 + 26 * v9) = 255;
      *(&unk_80078A6B + 52 * v9) = 0;
      *(&unk_80078A54 + 26 * v9) = 0;
      *(&unk_80078A56 + 26 * v9) = 0;
      *(&unk_80078A5E + v10) = -1;
      *(&unk_80078A60 + 26 * v9) = 0;
      *(&unk_80078A62 + 26 * v9) = 0;
      *(&unk_80078A64 + 26 * v9) = 255;
      *(&unk_80078A58 + 26 * v9) = 0;
      byte_80078A5A[v10] = 64;
      *(&unk_80078A6C + v10) = 0;
      *(&unk_80078A6E + v10) = 0;
      *(&unk_80078A70 + v10) = 0;
      *(&unk_80078A72 + v10) = 0;
      *(&unk_80078A78 + v10) = 0;
      *(&unk_80078A7A + v10) = 0;
      *(&unk_80078A7C + v10) = 0;
      *(&unk_80078A7E + v10) = 0;
      *(&unk_80078A80 + v10) = 0;
      *(&unk_80078A74 + v10) = 0;
      v11 = (2 * (8 * v9) + 528489472);
      *v11 = 0;
      v11[1] = 0;
      v11[3] = 512;
      v11[2] = 4096;
      v11[4] = -32513;
      v11[5] = 0x4000;
      word_8019E6EA = v8;
      sub_80054EFC();
      v9 = ++v8;
    }
    while ( v8 < byte_8019B628 );
  }
  word_80079160 = 0;
  word_80079168 = 0;
  word_801DF028 = 0;
  word_80079170 = 0;
  word_80079178 = 0;
  dword_8009DE44 = 0;
  word_8009DE4C = 0x3FFF;
  word_8009DE4E = 0x3FFF;
  dword_8009DE48 = 0;
  byte_801B5190 = 0;
  word_80130A88 = 0;
  word_8016DA98 = 128;
  return sub_800570D0();
}
// 80059744: using guessed type int __fastcall SpuInitMalloc(_DWORD, _DWORD);
// 800788B8: using guessed type _WORD word_800788B8[1];
// 80078A38: using guessed type _BYTE byte_80078A38[24];
// 80078A5A: using guessed type _BYTE byte_80078A5A[2];
// 80079160: using guessed type __int16 word_80079160;
// 80079168: using guessed type __int16 word_80079168;
// 80079170: using guessed type __int16 word_80079170;
// 80079178: using guessed type __int16 word_80079178;
// 8009DE44: using guessed type int dword_8009DE44;
// 8009DE48: using guessed type int dword_8009DE48;
// 8009DE4C: using guessed type __int16 word_8009DE4C;
// 8009DE4E: using guessed type __int16 word_8009DE4E;
// 8009E0CC: using guessed type __int16 word_8009E0CC;
// 80130A88: using guessed type __int16 word_80130A88;
// 8016DA98: using guessed type __int16 word_8016DA98;
// 8019B628: using guessed type char byte_8019B628;
// 8019E6C0: using guessed type __int16 word_8019E6C0;
// 8019E6EA: using guessed type __int16 word_8019E6EA;
// 8019E6F0: using guessed type _BYTE g_SPUVoiceActive[16];
// 801B5190: using guessed type char byte_801B5190;
// 801DEF9C: using guessed type __int16 g_ActiveVoiceCount;
// 801DF028: using guessed type __int16 word_801DF028;

//----- (80056C3C) --------------------------------------------------------
int __fastcall sub_80056C3C(__int16 a1, __int16 a2, int a3, unsigned __int16 a4)
{
  int v7; // $v0
  unsigned __int8 v8; // $a0
  bool v9; // dc
  int result; // $v0

  byte_8019E6DF = 127;
  v7 = sub_8005476C();
  word_8019E6EA = v7;
  v8 = v7;
  v9 = v7 >= byte_8019B628;
  result = a4;
  if ( !v9 )
    return sub_80055790(v8, a1, a2);
  return result;
}
// 8019B628: using guessed type char byte_8019B628;
// 8019E6DF: using guessed type char byte_8019E6DF;
// 8019E6EA: using guessed type __int16 word_8019E6EA;

//----- (80056D94) --------------------------------------------------------
int __fastcall sub_80056D94(__int16 a1, __int16 a2, __int16 a3, __int16 a4, __int16 a5)
{
  int v7; // $a0
  __int16 v8; // $a2
  int result; // $v0
  __int16 v10; // $v1
  int v11; // $a0
  int v12; // $v0
  int v13; // $a1
  int v14; // $v1
  char v15; // $v0

  v7 = 52 * a1;
  v8 = a5 - 64;
  result = 0;
  if ( *(&unk_80078A5E + v7) == a2 )
  {
    result = 0;
    if ( *(&unk_80078A66 + v7) == a3 )
    {
      result = 0;
      if ( *(&unk_80078A62 + v7) == a4 )
      {
        v10 = *(&unk_80078A64 + v7);
        v11 = *(&unk_80078A5C + v7);
        if ( v8 <= 0 )
        {
          if ( v8 >= 0 )
          {
            LOWORD(v13) = 0;
          }
          else
          {
            v14 = v8 * *(32 * (v10 + 16 * byte_8019E6D7) + dword_8016E5F8 + 12);
            v11 = v11 + v14 / 64 - 1;
            v13 = 2 * (v14 % 64) + 127;
          }
        }
        else
        {
          v12 = v8 * *(32 * (v10 + 16 * byte_8019E6D7) + dword_8016E5F8 + 13);
          LOWORD(v11) = v11 + v12 / 63;
          LOWORD(v13) = 2 * (v12 % 63);
        }
        v15 = *(&unk_80078A64 + 52 * a1);
        word_8019E6EA = a1;
        byte_8019E6DC = v15;
        *(&unk_800788BC + 8 * a1) = sub_80055A58(v11, v13);
        byte_80078A38[a1] |= 4u;
        return 1;
      }
    }
  }
  return result;
}
// 80078A38: using guessed type _BYTE byte_80078A38[24];
// 8016E5F8: using guessed type int dword_8016E5F8;
// 8019E6D7: using guessed type char byte_8019E6D7;
// 8019E6DC: using guessed type char byte_8019E6DC;
// 8019E6EA: using guessed type __int16 word_8019E6EA;

//----- (80056FE4) --------------------------------------------------------
int __fastcall sub_80056FE4(__int16 a1, __int16 a2, __int16 a3, __int16 a4)
{
  int v8; // $s1
  __int16 v9; // $s0
  __int16 v10; // $v0

  sub_8005984C(a2, a3);
  v8 = 0;
  word_8019E6E6 = a1;
  v9 = 0;
  if ( byte_8019B628 )
  {
    v10 = a4;
    do
    {
      v8 += sub_80056D94(v9++, a1, a2, a3, v10);
      v10 = a4;
    }
    while ( v9 < byte_8019B628 );
  }
  return v8;
}
// 8019B628: using guessed type char byte_8019B628;
// 8019E6E6: using guessed type __int16 word_8019E6E6;

//----- (800570D0) --------------------------------------------------------
int sub_800570D0()
{
  int v0; // $s0
  int v1; // $a0
  _DWORD *v2; // $v0
  bool v3; // dc
  _DWORD *v4; // $a2
  int v5; // $a3
  _WORD *v6; // $a0
  int v7; // $a1
  int v8; // $v0
  int v9; // $s0
  int v10; // $s2
  _DWORD *v11; // $v1
  int v12; // $s0
  int v13; // $s1
  int v14; // $s1
  int v15; // $v0
  _WORD *v16; // $a0
  _BYTE *v17; // $a1
  _WORD *v18; // $t1
  _WORD *v19; // $t0
  _WORD *v20; // $a3
  _WORD *v21; // $a2
  __int16 v22; // $t0
  int result; // $v0
  __int16 v24; // $v1
  __int16 v25; // $a0
  __int16 v26; // $a1

  v0 = 0;
  v1 = byte_8019B628;
  dword_80078F30 = (dword_80078F30 + 1) & 0xF;
  v2 = (&unk_80078F38 + 4 * dword_80078F30);
  v3 = byte_8019B628 == 0;
  *v2 = 0;
  if ( !v3 )
  {
    v4 = v2;
    v5 = v1;
    v6 = &unk_80078A56;
    v7 = 528489472;
    do
    {
      *v6 = *(v7 + 12);
      v8 = *v6;
      v6 += 26;
      if ( !v8 )
        *v4 |= 1 << v0;
      ++v0;
      v7 += 16;
    }
    while ( v0 < v5 );
  }
  v9 = 0;
  if ( !byte_801B5190 )
  {
    v10 = -1;
    v11 = &unk_80078F38;
    do
    {
      ++v9;
      v10 &= *v11++;
    }
    while ( v9 < 15 );
    v12 = 0;
    if ( byte_8019B628 )
    {
      v13 = 0;
      do
      {
        if ( (v10 & (1 << v12)) != 0 )
        {
          if ( *(&unk_80078A6B + v13) == 2 )
            sub_80059720(0, 0xFFFFFF);
          *(&unk_80078A6B + v13) = 0;
        }
        ++v12;
        v13 += 52;
      }
      while ( v12 < byte_8019B628 );
    }
    v9 = 0;
  }
  v14 = 0;
  word_80079160 &= ~word_801DF028;
  word_80079168 &= ~word_801DF030;
  do
  {
    if ( *(&unk_80078A6C + v14) )
      sub_80055F60(v9);
    v15 = *(&unk_80078A78 + v14);
    v14 += 52;
    if ( v15 )
      sub_80056504(v9);
    ++v9;
    v16 = 0;
  }
  while ( v9 < 24 );
  v17 = byte_80078A38;
  v18 = word_800788C2;
  v19 = word_800788C0;
  v20 = &unk_800788BA;
  v21 = word_800788B8;
  do
  {
    if ( (*v17 & 1) != 0 )
    {
      v16[264244736] = *v21;
      v16[264244737] = *v20;
    }
    if ( (*v17 & 4) != 0 )
      v16[264244738] = *(&unk_800788BC + v16);
    if ( (*v17 & 8) != 0 )
      v16[264244739] = *(word_800788BE + v16);
    v20 += 8;
    if ( (*v17 & 0x10) != 0 )
    {
      v16[264244740] = *v19;
      v16[264244741] = *v18;
    }
    *v17++ = 0;
    v18 += 8;
    v19 += 8;
    v16 += 8;
    v21 += 8;
  }
  while ( v17 < &unk_80078A50 );
  v22 = word_801DF028;
  result = 528489472;
  v24 = word_801DF030;
  v25 = word_80079160;
  v26 = word_80079168;
  word_801DF028 = 0;
  word_801DF030 = 0;
  word_80079160 = 0;
  word_80079168 = 0;
  MEMORY[0x1F801D8C] = v22;
  MEMORY[0x1F801D8E] = v24;
  MEMORY[0x1F801D88] = v25;
  MEMORY[0x1F801D8A] = v26;
  MEMORY[0x1F801D98] = word_80079170;
  MEMORY[0x1F801D9A] = word_80079178;
  return result;
}
// 800788B8: using guessed type _WORD word_800788B8[1];
// 800788BE: using guessed type _WORD word_800788BE[1];
// 800788C0: using guessed type _WORD word_800788C0[1];
// 800788C2: using guessed type _WORD word_800788C2[187];
// 80078A38: using guessed type _BYTE byte_80078A38[24];
// 80078F30: using guessed type int dword_80078F30;
// 80079160: using guessed type __int16 word_80079160;
// 80079168: using guessed type __int16 word_80079168;
// 80079170: using guessed type __int16 word_80079170;
// 80079178: using guessed type __int16 word_80079178;
// 8019B628: using guessed type char byte_8019B628;
// 801B5190: using guessed type char byte_801B5190;
// 801DF028: using guessed type __int16 word_801DF028;
// 801DF030: using guessed type __int16 word_801DF030;

//----- (80057484) --------------------------------------------------------
int __fastcall sub_80057484(int a1, __int16 a2, __int16 a3, unsigned __int16 a4, unsigned __int16 a5, char a6)
{
  int v6; // $s2
  int v8; // $s1
  __int16 v9; // $s5
  __int16 v11; // $s3
  unsigned int v12; // $s0
  bool v13; // dc
  int result; // $v0
  int v15; // $lo
  char *v16; // $v0
  unsigned __int8 v17; // $s3
  int v18; // $s1
  int v19; // $v1
  char *v20; // $v1
  int v21; // $v0
  __int16 v22; // $v0
  _BYTE v23[16]; // [sp+0h] [-120h] BYREF
  char v24[128]; // [sp+10h] [-110h] BYREF
  char v25[128]; // [sp+90h] [-90h] BYREF
  __int16 v26; // [sp+110h] [-10h]

  v6 = 0;
  v8 = a3;
  v9 = a1;
  v26 = a3;
  v11 = a1;
  v12 = 172 * ((a1 << 16) >> 24) + dword_801DDDB8[a1];
  v13 = sub_8005984C(a2, a3) != 0;
  result = -1;
  if ( !v13 )
  {
    word_8019E6E6 = v9;
    byte_8019E6D2 = a4;
    byte_8019E6D3 = 0;
    v15 = a5 * *(2 * *(v12 + 18) + v12 + 78) / 127;
    byte_8019E6D5 = a6;
    v16 = (16 * v8 + dword_8016DAA0);
    byte_8019E6D4 = v15;
    byte_8019E6DA = v16[1];
    byte_8019E6DB = v16[4];
    byte_8019E6D0 = *v16;
    result = -1;
    if ( byte_8019E6D7 < *(dword_8016DAB0 + 18) )
    {
      if ( !a5 )
        return sub_800579E4(v11, a2, v8, a4);
      v17 = sub_80054FD8(v25, v24);
      v18 = 0;
      if ( v17 )
      {
        v19 = 0;
        do
        {
          word_8019E6E8 = v23[v19 + 16];
          byte_8019E6DC = v25[v19];
          v20 = (32 * (byte_8019E6DC + 16 * byte_8019E6D7) + dword_8016E5F8);
          byte_8019E6DF = *v20;
          byte_8019E6DD = v20[2];
          byte_8019E6DE = v20[3];
          byte_8019E6E0 = v20[4];
          byte_8019E6E1 = v20[5];
          byte_8019E6E4 = v20[1];
          byte_8019E6E2 = v20[6];
          byte_8019E6E3 = v20[7];
          v21 = sub_8005476C();
          word_8019E6EA = v21;
          if ( v21 >= byte_8019B628 )
          {
            v6 = -1;
          }
          else
          {
            *(&unk_80078A6B + 52 * v21) = 1;
            *(&unk_80078A52 + 26 * word_8019E6EA) = 0;
            *(&unk_80078A5E + 26 * word_8019E6EA) = v9;
            *(&unk_80078A66 + 26 * word_8019E6EA) = byte_8019E6D1;
            *(&unk_80078A60 + 26 * word_8019E6EA) = byte_8019E6D7;
            *(&unk_80078A62 + 26 * word_8019E6EA) = v26;
            if ( v9 != 33 )
              *(&unk_80078A58 + 26 * word_8019E6EA) = a5;
            byte_80078A5A[52 * word_8019E6EA] = a6;
            *(&unk_80078A64 + 26 * word_8019E6EA) = byte_8019E6DC;
            *(&unk_80078A5C + 26 * word_8019E6EA) = a4;
            *(&unk_80078A68 + 26 * word_8019E6EA) = byte_8019E6DF;
            *(&unk_80078A50 + 26 * word_8019E6EA) = word_8019E6E8;
            sub_80055088();
            if ( word_8019E6E8 == 255 )
            {
              sub_800552C0(word_8019E6EA);
            }
            else
            {
              v22 = sub_8005599C();
              sub_80054A10(v17, v22);
            }
            v6 |= 1 << word_8019E6EA;
          }
          v19 = ++v18;
        }
        while ( v18 < v17 );
      }
      return v6;
    }
  }
  return result;
}
// 80078A5A: using guessed type _BYTE byte_80078A5A[2];
// 8016DAA0: using guessed type int dword_8016DAA0;
// 8016DAB0: using guessed type int dword_8016DAB0;
// 8016E5F8: using guessed type int dword_8016E5F8;
// 8019B628: using guessed type char byte_8019B628;
// 8019E6D0: using guessed type char byte_8019E6D0;
// 8019E6D1: using guessed type char byte_8019E6D1;
// 8019E6D2: using guessed type char byte_8019E6D2;
// 8019E6D3: using guessed type char byte_8019E6D3;
// 8019E6D4: using guessed type char byte_8019E6D4;
// 8019E6D5: using guessed type char byte_8019E6D5;
// 8019E6D7: using guessed type char byte_8019E6D7;
// 8019E6DA: using guessed type char byte_8019E6DA;
// 8019E6DB: using guessed type char byte_8019E6DB;
// 8019E6DC: using guessed type char byte_8019E6DC;
// 8019E6DD: using guessed type char byte_8019E6DD;
// 8019E6DE: using guessed type char byte_8019E6DE;
// 8019E6DF: using guessed type char byte_8019E6DF;
// 8019E6E0: using guessed type char byte_8019E6E0;
// 8019E6E1: using guessed type char byte_8019E6E1;
// 8019E6E2: using guessed type char byte_8019E6E2;
// 8019E6E3: using guessed type char byte_8019E6E3;
// 8019E6E4: using guessed type char byte_8019E6E4;
// 8019E6E6: using guessed type __int16 word_8019E6E6;
// 8019E6E8: using guessed type __int16 word_8019E6E8;
// 8019E6EA: using guessed type __int16 word_8019E6EA;
// 801DDDB8: using guessed type _DWORD dword_801DDDB8[32];
// 80057484: using guessed type char var_90[128];
// 80057484: using guessed type char var_110[128];

//----- (800579E4) --------------------------------------------------------
int __fastcall sub_800579E4(__int16 a1, __int16 a2, __int16 a3, unsigned __int16 a4)
{
  unsigned __int8 v4; // $s0
  int v5; // $s1
  int v7; // $s4
  int v8; // $s3
  int v9; // $s2

  v4 = 0;
  v5 = 0;
  if ( byte_8019B628 )
  {
    v7 = a3;
    v8 = a1;
    v9 = a2;
    do
    {
      if ( *(&unk_80078A5C + 26 * v4) == a4
        && *(&unk_80078A62 + 26 * v4) == v7
        && *(&unk_80078A5E + 26 * v4) == v8
        && *(&unk_80078A66 + 26 * v4) == v9 )
      {
        if ( *(&unk_80078A50 + 26 * v4) == 255 )
        {
          ++v5;
          sub_80055950(v4);
        }
        else
        {
          word_8019E6EA = v4;
          sub_80054EFC();
          ++v5;
        }
      }
      ++v4;
    }
    while ( v4 < byte_8019B628 );
  }
  return v5;
}
// 8019B628: using guessed type char byte_8019B628;
// 8019E6EA: using guessed type __int16 word_8019E6EA;

//----- (80057C6C) --------------------------------------------------------
int __fastcall sub_80057C6C(int a1, __int16 a2, __int16 a3, __int16 a4)
{
  int v4; // $v0
  int v5; // $v1
  bool v6; // dc
  __int16 v7; // $t2
  int v8; // $a1
  int v9; // $t1
  int v10; // $v0
  int v11; // $a0
  unsigned __int16 *v12; // $at
  int v13; // $v0
  int v14; // $v0

  v4 = dword_801DDDB8[a1];
  word_8019E6E6 = a1;
  v5 = 172 * ((a1 << 16) >> 24) + v4;
  *(v5 + 116) = a2;
  v6 = *(v5 + 116) < 128u;
  *(v5 + 118) = a3;
  if ( !v6 )
    *(v5 + 116) = 127;
  if ( *(v5 + 118) >= 128u )
    *(v5 + 118) = 127;
  v7 = 129 * a2;
  if ( a4 == 1 )
  {
    v8 = 0;
    if ( byte_8019B628 )
    {
      v9 = a1;
      v10 = 0;
      do
      {
        v11 = v10 >> 16;
        v12 = (&unk_80078A5E + 52 * (v10 >> 16));
        v13 = v8 + 1;
        if ( *v12 == v9 )
        {
          v14 = v11 << 19 >> 15;
          *(word_800788B8 + v14) = v7;
          *(&unk_800788BA + v14) = 129 * a3;
          byte_80078A38[v11] |= 3u;
          v13 = v8 + 1;
        }
        v8 = v13;
        v6 = v13 < byte_8019B628;
        v10 = v13 << 16;
      }
      while ( v6 );
    }
  }
  return word_8019E6E6;
}
// 800788B8: using guessed type _WORD word_800788B8[1];
// 80078A38: using guessed type _BYTE byte_80078A38[24];
// 8019B628: using guessed type char byte_8019B628;
// 8019E6E6: using guessed type __int16 word_8019E6E6;
// 801DDDB8: using guessed type _DWORD dword_801DDDB8[32];

//----- (80057DEC) --------------------------------------------------------
int __fastcall sub_80057DEC(__int16 a1, _WORD *a2, _WORD *a3)
{
  int v3; // $v1
  int v4; // $v0

  v3 = dword_801DDDB8[a1];
  word_8019E6E6 = a1;
  v4 = 172 * ((a1 & 0xFF00) >> 8) + v3;
  *a2 = *(v4 + 116);
  *a3 = *(v4 + 118);
  return word_8019E6E6;
}
// 8019E6E6: using guessed type __int16 word_8019E6E6;
// 801DDDB8: using guessed type _DWORD dword_801DDDB8[32];

//----- (80057F04) --------------------------------------------------------
int __fastcall sub_80057F04(__int16 a1)
{
  int result; // $v0
  unsigned __int8 v2; // $s0
  int v3; // $s1

  result = byte_8019B628;
  v2 = 0;
  if ( byte_8019B628 )
  {
    v3 = a1;
    result = 0;
    do
    {
      if ( *(&unk_80078A5E + 26 * result) == v3 )
      {
        word_8019E6EA = v2;
        sub_80054EFC();
      }
      result = ++v2;
    }
    while ( v2 < byte_8019B628 );
  }
  return result;
}
// 8019B628: using guessed type char byte_8019B628;
// 8019E6EA: using guessed type __int16 word_8019E6EA;

//----- (80057FA0) --------------------------------------------------------
int __fastcall sub_80057FA0(unsigned __int16 a1, __int16 a2, char a3)
{
  int v4; // $s0
  bool v5; // dc
  int result; // $v0

  v4 = a2;
  v5 = sub_8005984C(a1, a2) != 0;
  result = -1;
  if ( !v5 )
  {
    *(16 * v4 + dword_8016DAA0 + 1) = a3;
    return *(16 * v4 + dword_8016DAA0 + 1);
  }
  return result;
}
// 8016DAA0: using guessed type int dword_8016DAA0;

//----- (80058120) --------------------------------------------------------
int __fastcall sub_80058120(int a1, signed __int16 a2, __int16 a3, unsigned __int16 a4, unsigned __int8 a5)
{
  __int16 v5; // $s0
  int v8; // $s2
  int v9; // $s1
  unsigned int v10; // $s3
  int v11; // $s4
  unsigned __int8 v12; // $t2
  int v13; // $v0
  unsigned int v14; // $a0
  int v15; // $v0
  int v16; // $a0
  unsigned int v17; // $v1
  unsigned int v18; // $a3
  unsigned int v19; // $t1
  unsigned int v20; // $v1
  unsigned int v21; // $a1
  unsigned int v22; // $v1
  unsigned int v23; // $lo
  int v24; // $v1

  v5 = a1;
  v8 = a1;
  v9 = a3;
  v10 = 172 * ((a1 << 16) >> 24) + dword_801DDDB8[a1];
  sub_8005984C(a2, a3);
  v11 = 0;
  word_8019E6E6 = v5;
  v12 = 0;
  if ( byte_8019B628 )
  {
    v13 = 0;
    while ( *(&unk_80078A5E + 26 * v13) != v8 || *(&unk_80078A62 + 26 * v13) != v9 || *(&unk_80078A66 + 26 * v13) != a2 )
    {
LABEL_25:
      v13 = ++v12;
      if ( v12 >= byte_8019B628 )
        return v11;
    }
    v14 = 2 * *(v10 + 18) + v10;
    if ( *(v14 + 78) != a4 )
    {
      v15 = v12;
      if ( *(v14 + 78) )
      {
LABEL_10:
        v16 = *(&unk_80078A64 + 26 * v15);
        v17 = *(&unk_80078A58 + 26 * v15)
            * a4
            / 127
            * 0x3FFF
            * *(dword_8016DAB0 + 24)
            / 16129
            * *(16 * v9 + dword_8016DAA0 + 1)
            * *(32 * (16 * v9 + v16) + dword_8016E5F8 + 2)
            / 0x3F01;
        v18 = v17 * *(v10 + 116) / 0x7F;
        v19 = v17 * *(v10 + 118) / 0x7F;
        v20 = *(32 * v16 + dword_8016E5F8 + 3);
        if ( v20 >= 0x40 )
        {
          v21 = v18 * (127 - v20) / 0x3F;
        }
        else
        {
          v19 = v19 * v20 / 0x3F;
          v21 = v18;
        }
        v22 = *(16 * *(&unk_80078A60 + 26 * v12) + dword_8016DAA0 + 4);
        if ( v22 >= 0x40 )
          v21 = v21 * (127 - v22) / 0x3F;
        else
          v19 = v19 * v22 / 0x3F;
        if ( a5 >= 0x40u )
          v21 = v21 * (127 - a5) / 0x3F;
        else
          v19 = v19 * a5 / 0x3F;
        v23 = v21 * v21;
        if ( word_80130A88 == 1 )
        {
          if ( v21 >= v19 )
            v19 = v21;
          else
            v21 = v19;
          v23 = v21 * v21;
        }
        v24 = 8 * v12;
        word_800788B8[v24] = v23 / 0x3FFF;
        *(&unk_800788BA + v24 * 2) = v19 * v19 / 0x3FFF;
        ++v11;
        byte_80078A38[v12] |= 3u;
        goto LABEL_25;
      }
      *(v14 + 78) = 1;
    }
    v15 = v12;
    goto LABEL_10;
  }
  return v11;
}
// 800788B8: using guessed type _WORD word_800788B8[1];
// 80078A38: using guessed type _BYTE byte_80078A38[24];
// 80130A88: using guessed type __int16 word_80130A88;
// 8016DAA0: using guessed type int dword_8016DAA0;
// 8016DAB0: using guessed type int dword_8016DAB0;
// 8016E5F8: using guessed type int dword_8016E5F8;
// 8019B628: using guessed type char byte_8019B628;
// 8019E6E6: using guessed type __int16 word_8019E6E6;
// 801DDDB8: using guessed type _DWORD dword_801DDDB8[32];

//----- (80058698) --------------------------------------------------------
int __fastcall SPU_PlayVoice(
        unsigned __int16 a1,
        int a2,
        char a3,
        __int16 a4,
        unsigned __int16 a5,
        __int16 a6,
        __int16 a7)
{
  int v12; // $v0
  char *v13; // $v0
  int v14; // $v0
  int v15; // $s1
  int v16; // $v0
  __int16 v17; // $v1
  __int16 v18; // $a0
  __int16 v19; // $v0

  if ( dword_8016DA90 == 1 )
    return -1;
  dword_8016DA90 = 1;
  if ( sub_8005984C(a1, a2) )
    goto LABEL_21;
  word_8019E6E6 = 33;
  byte_8019E6D2 = a4;
  byte_8019E6D3 = a5;
  byte_8019E6DC = a3;
  if ( a6 == a7 )
  {
    byte_8019E6D5 = 64;
    byte_8019E6D4 = a6;
  }
  else
  {
    v12 = a7 << 6;
    if ( a7 >= a6 )
    {
      if ( !a7 )
        _break(7u, 0);
      if ( a7 == -1 && a6 << 6 == 0x80000000 )
        _break(6u, 0);
      byte_8019E6D4 = a7;
      byte_8019E6D5 = 127 - (a6 << 6) / a7;
    }
    else
    {
      if ( !a6 )
        _break(7u, 0);
      if ( a6 == -1 && v12 == 0x80000000 )
        _break(6u, 0);
      byte_8019E6D4 = a6;
      byte_8019E6D5 = v12 / a6;
    }
  }
  v13 = ((a2 << 16 >> 12) + dword_8016DAA0);
  byte_8019E6DA = v13[1];
  byte_8019E6DB = v13[4];
  byte_8019E6D0 = *v13;
  v14 = 32 * (byte_8019E6DC + 16 * byte_8019E6D7) + dword_8016E5F8;
  byte_8019E6DF = *v14;
  word_8019E6E8 = *(v14 + 22);
  byte_8019E6DD = *(v14 + 2);
  byte_8019E6DE = *(v14 + 3);
  byte_8019E6E0 = *(v14 + 4);
  byte_8019E6E1 = *(v14 + 5);
  byte_8019E6E4 = *(v14 + 1);
  byte_8019E6E2 = *(v14 + 6);
  byte_8019E6E3 = *(v14 + 7);
  if ( !word_8019E6E8 || (v15 = sub_8005476C(), v15 == byte_8019B628) )
  {
LABEL_21:
    dword_8016DA90 = 0;
    return -1;
  }
  else
  {
    word_8019E6EA = v15;
    v16 = 52 * v15;
    *(&unk_80078A5E + v16) = 33;
    *(&unk_80078A66 + v16) = a1;
    v17 = byte_8019E6D7;
    *(&unk_80078A62 + v16) = a2;
    *(&unk_80078A60 + v16) = v17;
    *(&unk_80078A50 + v16) = word_8019E6E8;
    v18 = byte_8019E6DC;
    *(&unk_80078A5C + v16) = a4;
    *(&unk_80078A6B + v16) = 1;
    *(&unk_80078A52 + v16) = 0;
    *(&unk_80078A64 + v16) = v18;
    sub_80055088();
    if ( word_8019E6E8 == 255 )
    {
      sub_800552C0(v15);
    }
    else
    {
      v19 = sub_80055A58(a4, a5);
      sub_80054A10(1, v19);
    }
    dword_8016DA90 = 0;
    return v15;
  }
}
// 8016DA90: using guessed type int dword_8016DA90;
// 8016DAA0: using guessed type int dword_8016DAA0;
// 8016E5F8: using guessed type int dword_8016E5F8;
// 8019B628: using guessed type char byte_8019B628;
// 8019E6D0: using guessed type char byte_8019E6D0;
// 8019E6D2: using guessed type char byte_8019E6D2;
// 8019E6D3: using guessed type char byte_8019E6D3;
// 8019E6D4: using guessed type char byte_8019E6D4;
// 8019E6D5: using guessed type char byte_8019E6D5;
// 8019E6D7: using guessed type char byte_8019E6D7;
// 8019E6DA: using guessed type char byte_8019E6DA;
// 8019E6DB: using guessed type char byte_8019E6DB;
// 8019E6DC: using guessed type char byte_8019E6DC;
// 8019E6DD: using guessed type char byte_8019E6DD;
// 8019E6DE: using guessed type char byte_8019E6DE;
// 8019E6DF: using guessed type char byte_8019E6DF;
// 8019E6E0: using guessed type char byte_8019E6E0;
// 8019E6E1: using guessed type char byte_8019E6E1;
// 8019E6E2: using guessed type char byte_8019E6E2;
// 8019E6E3: using guessed type char byte_8019E6E3;
// 8019E6E4: using guessed type char byte_8019E6E4;
// 8019E6E6: using guessed type __int16 word_8019E6E6;
// 8019E6E8: using guessed type __int16 word_8019E6E8;
// 8019E6EA: using guessed type __int16 word_8019E6EA;

//----- (80058A90) --------------------------------------------------------
int __fastcall sub_80058A90(__int16 a1, __int16 a2, __int16 a3, __int16 a4, __int16 a5)
{
  if ( dword_8016DA90 == 1 )
    return -1;
  dword_8016DA90 = 1;
  if ( a1 >= 0x18u
    || *(&unk_80078A66 + 26 * a1) != a2
    || *(&unk_80078A62 + 26 * a1) != a3
    || *(&unk_80078A64 + 26 * a1) != a4
    || *(&unk_80078A5C + 26 * a1) != a5 )
  {
    dword_8016DA90 = 0;
    return -1;
  }
  if ( *(&unk_80078A50 + 26 * a1) == 255 )
  {
    sub_80055950(a1);
  }
  else
  {
    word_8019E6EA = a1;
    sub_80054EFC();
  }
  dword_8016DA90 = 0;
  return 0;
}
// 8016DA90: using guessed type int dword_8016DA90;
// 8019E6EA: using guessed type __int16 word_8019E6EA;

//----- (80059720) --------------------------------------------------------
int __fastcall sub_80059720(int a1, int a2)
{
  return sub_80059798(a1, a2, 202, 203);
}
// 80059798: using guessed type int __fastcall sub_80059798(_DWORD, _DWORD, _DWORD, _DWORD);

//----- (8005984C) --------------------------------------------------------
int __fastcall sub_8005984C(unsigned __int16 a1, __int16 a2)
{
  char v2; // $a2
  int result; // $v0
  int v4; // $v0
  int v5; // $v1
  int v6; // $a0
  int v7; // $v0

  v2 = a1;
  if ( a1 >= 0x10u )
    return -1;
  result = -1;
  if ( g_SPUVoiceActive[a1] != 1 )
    return result;
  v4 = 4 * a1;
  if ( a2 >= word_8016DA98 )
    return -1;
  v5 = dword_8009E08C[a1];
  v6 = dword_8009DEF0[a1];
  v7 = *(&unk_8009E0D4 + v4);
  byte_8019E6D1 = v2;
  byte_8019E6D6 = a2;
  dword_8016DAB0 = v5;
  dword_8016DAA0 = v6;
  dword_8016E5F8 = v7;
  result = 0;
  byte_8019E6D7 = *(16 * a2 + v6 + 8);
  return result;
}
// 8009DEF0: using guessed type _DWORD dword_8009DEF0[16];
// 8009E08C: using guessed type _DWORD dword_8009E08C[16];
// 8016DA98: using guessed type __int16 word_8016DA98;
// 8016DAA0: using guessed type int dword_8016DAA0;
// 8016DAB0: using guessed type int dword_8016DAB0;
// 8016E5F8: using guessed type int dword_8016E5F8;
// 8019E6D1: using guessed type char byte_8019E6D1;
// 8019E6D6: using guessed type char byte_8019E6D6;
// 8019E6D7: using guessed type char byte_8019E6D7;
// 8019E6F0: using guessed type _BYTE g_SPUVoiceActive[16];

//----- (80059920) --------------------------------------------------------
int __fastcall sub_80059920(int a1, __int16 a2, __int16 a3)
{
  int v3; // $a3
  int v4; // $t0
  _DWORD *v5; // $a2
  int v6; // $v1
  int result; // $v0
  int v8; // $a3
  _DWORD *v9; // $t1
  int v10; // $a2
  int v11; // $a0
  int v12; // $v1

  word_801DE638 = a2;
  word_801DE640 = a3;
  v3 = 0;
  if ( a2 > 0 )
  {
    v4 = a3;
    v5 = dword_801DDDB8;
    v6 = 0;
    do
    {
      *v5++ = a1 + 172 * v6;
      ++v3;
      v6 += v4;
    }
    while ( v3 < a2 );
  }
  result = word_801DE638;
  v8 = 0;
  if ( word_801DE638 > 0 )
  {
    v9 = dword_801DDDB8;
    do
    {
      v10 = 0;
      if ( word_801DE640 > 0 )
      {
        v11 = 0;
        do
        {
          *(v11 + *v9 + 144) = 0;
          *(v11 + *v9 + 60) = -1;
          *(v11 + *v9) = 0;
          *(v11 + *v9 + 62) = 0;
          *(v11 + *v9 + 64) = 0;
          *(v11 + *v9 + 148) = 0;
          *(v11 + *v9 + 152) = 0;
          *(v11 + *v9 + 66) = 0;
          *(v11 + *v9 + 164) = 0;
          *(v11 + *v9 + 160) = 0;
          *(v11 + *v9 + 156) = 0;
          *(v11 + *v9 + 68) = 0;
          *(v11 + *v9 + 116) = 127;
          *(v11 + *v9 + 118) = 127;
          v12 = word_801DE640;
          *(v11 + *v9 + 120) = 127;
          ++v10;
          *(v11 + *v9 + 122) = 127;
          v11 += 172;
        }
        while ( v10 < v12 );
      }
      result = ++v8 < word_801DE638;
      ++v9;
    }
    while ( v8 < word_801DE638 );
  }
  return result;
}
// 801DDDB8: using guessed type _DWORD dword_801DDDB8[32];
// 801DE638: using guessed type __int16 word_801DE638;
// 801DE640: using guessed type __int16 word_801DE640;

//----- (80059AFC) --------------------------------------------------------
int __fastcall SEQ_InitData(int playerID, __int16 vabID, unsigned __int8 *seqData)
{
  __int16 v3; // $t2
  int v4; // $a3
  struct_v5 *v5; // $s0
  struct_v5 *v6; // $a0
  struct_v5 *v7; // $v1
  int v8; // $v1
  int result; // $v0
  __int16 v10; // $v1
  unsigned __int8 *punsigned___int84; // $a1
  int v12; // $v0
  int v13; // $a0
  int v14; // $lo
  unsigned __int8 *v15; // $v0
  int v16; // $v0
  unsigned int v17; // $lo
  int v18; // $a2
  unsigned __int8 *v19; // $v1
  unsigned int v20; // $a0
  unsigned int v21; // $a1
  unsigned int v22; // $lo
  unsigned int v23; // $lo
  unsigned int v24; // $hi

  v3 = playerID;
  v4 = 0;
  v5 = *(dword_801DDDB8 + (playerID << 16 >> 14));
  v5->word4C = vabID;
  v5->int164A = 0;
  v5->byte13 = 0;
  v5->byte14 = 0;
  v5->byte29 = 0;
  v5->byte15 = 0;
  v5->byte16 = 0;
  v5->byte2A = 0;
  v5->byte12 = 0;
  v5->dword7C = 0;
  v5->dword80 = 0;
  v5->dword84 = 0;
  v5->word72 = 0;
  v5->word48 = 0;
  v5->byte2B = 0;
  v5->dword88 = 0;
  v5->byte27 = 0;
  v5->byte28 = 0;
  v5->byte10 = 0;
  v5->byte11 = 0;
  v5->dwordA8 = 127;
  v6 = v5;
  v7 = v5;
  do
  {
    v7->gap2C[0] = v4;
    v7->gap17[0] = 64;
    *v6->gap4E = 127;
    v6 = (v6 + 2);
    ++v4;
    v7 = (v7 + 1);
  }
  while ( v4 < 16 );
  v5->word6E = 1;
  v5->punsigned___int84 = seqData;
  v8 = *seqData;
  if ( v8 == 0x53 || v8 == 0x70 )
  {
    v5->punsigned___int84 = seqData + 8;
    if ( seqData[7] == 1 )
    {
      v5->punsigned___int84 = seqData + 9;
      v10 = seqData[8];
      v5->punsigned___int84 = seqData + 10;
      punsigned___int84 = v5->punsigned___int84;
      v5->int164A = seqData[9] | (v10 << 8);
      v5->punsigned___int84 = punsigned___int84 + 1;
      v12 = *punsigned___int84;
      v5->punsigned___int84 = punsigned___int84 + 2;
      v13 = punsigned___int84[1];
      v5->punsigned___int84 = punsigned___int84 + 3;
      v14 = 60000000 / ((v12 << 16) | (v13 << 8) | punsigned___int84[2]);
      v5->dword84 = -1;
      v5->dword84 = v14;
      v15 = v5->punsigned___int84;
      v5->dword8C = v5->dword84;
      v5->punsigned___int84 = v15 + 2;
      v16 = sub_8005BB50(v3, 0);
      v17 = v5->int164A * v5->dword84;
      v18 = dword_801BA2D0;
      v19 = v5->punsigned___int84;
      v5->dword7C = v16;
      v5->dword88 = v16;
      v5->dwordC = v19;
      v20 = v17;
      v21 = 60 * v18;
      v5->dword8 = v19;
      if ( 10 * v17 >= 60 * v18 )
      {
        v23 = 10 * v5->int164A * v5->dword84 / v21;
        v24 = 10 * v5->int164A * v5->dword84 % v21;
        v5->word6E = -1;
        v5->word70 = v23;
        if ( 30 * v18 < v24 )
          v5->word70 = v23 + 1;
      }
      else
      {
        v22 = 600 * v18 / v17;
        if ( !v20 )
          _break(7u, 0);
        v5->word6E = v22;
        v5->word70 = v22;
      }
      result = 0;
      v5->word72 = v5->word70;
    }
    else
    {
      printf("This is not SEQ Data.\n");
      return -1;
    }
  }
  else
  {
    printf("This is an old SEQ Data Format.\n");
    return 0;
  }
  return result;
}
// 80059C84: conditional instruction was optimized away because $v0.4!=0
// 80059DB0: conditional instruction was optimized away because $a1.4!=0
// 80059DEC: conditional instruction was optimized away because $a1.4!=0
// 80062BA0: using guessed type int printf(const char *, ...);
// 801BA2D0: using guessed type int dword_801BA2D0;
// 801DDDB8: using guessed type _DWORD dword_801DDDB8[32];

//----- (80059E38) --------------------------------------------------------
int __fastcall SEQ_Open(unsigned __int8 *a1, __int16 a2)
{
  __int16 v2; // $t0
  int result; // $v0
  __int16 v5; // $v1
  unsigned __int8 v6; // $a0
  int v7; // $v0
  int v8; // $s0
  bool v9; // dc

  if ( dword_8019E6C8 == -1 )
  {
    printf("Can't Open Sequence data any more\n\n");
    return -1;
  }
  else
  {
    v5 = 0;
    v6 = 0;
    do
    {
      v7 = v6;
      if ( ((1 << v5) & dword_8019E6C8) == 0 )
      {
        v2 = v5;
        v6 = 1;
        v7 = 1;
      }
      ++v5;
    }
    while ( !v7 );
    v8 = v2;
    dword_8019E6C8 |= 1 << v2;
    v9 = SEQ_InitData(v2, a2, a1) != -1;
    result = v8;
    if ( !v9 )
      return -1;
  }
  return result;
}
// 80059EA4: variable 'v2' is possibly undefined
// 80062BA0: using guessed type int printf(const char *, ...);
// 8019E6C8: using guessed type int dword_8019E6C8;

//----- (80059EFC) --------------------------------------------------------
int __fastcall sub_80059EFC(int a1, int a2)
{
  int v2; // $a3
  int v3; // $a0
  int v4; // $s1
  int v5; // $v0
  int v6; // $v1
  int v7; // $a1
  int result; // $v0
  int v9; // $v0
  int v10; // $s0
  int v11; // $s3
  int v12; // $s2
  int v13; // $a0
  int v14; // $v0
  int v15; // $v1

  v2 = a2 << 16;
  v3 = a1 << 16;
  v4 = 172 * a2 + *(dword_801DDDB8 + (v3 >> 14));
  v5 = *(v4 + 112);
  v6 = *(v4 + 136);
  v7 = v6 - v5;
  if ( v6 - v5 <= 0 )
  {
    result = v5 < v6;
    v10 = *(v4 + 136);
    if ( result )
      return result;
    v11 = v3;
    v12 = v2;
    v13 = v3 >> 16;
    do
    {
      do
      {
        sub_8005A00C(v13, v12 >> 16);
        v14 = *(v4 + 136);
        v13 = v11 >> 16;
      }
      while ( !v14 );
      v15 = *(v4 + 112);
      v10 += v14;
      result = v10 - v15;
    }
    while ( v10 < v15 );
  }
  else
  {
    result = *(v4 + 110);
    if ( result > 0 )
    {
      *(v4 + 110) = --result;
      return result;
    }
    if ( *(v4 + 110) )
    {
      *(v4 + 136) = v7;
      return result;
    }
    v9 = *(v4 + 136);
    *(v4 + 110) = *(v4 + 112);
    result = v9 - 1;
  }
  *(v4 + 136) = result;
  return result;
}
// 801DDDB8: using guessed type _DWORD dword_801DDDB8[32];

//----- (8005A00C) --------------------------------------------------------
int __fastcall sub_8005A00C(__int16 a1, int a2)
{
  int v2; // $a1
  int v3; // $s2
  int v4; // $s3
  int v5; // $s1
  char *v6; // $a3
  unsigned __int8 v7; // $s0
  char v8; // $a0
  int v9; // $a2
  int result; // $v0
  unsigned __int8 *v11; // $v1
  unsigned __int8 v12; // $s4
  int v13; // $a0
  unsigned __int8 *v14; // $v0
  char *v15; // $v0
  char *v16; // $v0
  int v17; // $v1

  v2 = a2 << 16;
  v3 = v2 >> 16;
  v4 = a1;
  v5 = 172 * (v2 >> 16) + dword_801DDDB8[a1];
  v6 = *(v5 + 4);
  *(v5 + 4) = v6 + 1;
  v7 = *v6;
  v8 = *v6 & 0xF;
  if ( (*v6 & 0x80) != 0 )
  {
    v9 = v7 & 0xF0;
    *(v5 + 18) = v8;
    if ( v9 == 192 )
    {
      v15 = *(v5 + 4);
      *(v5 + 17) = -64;
      *(v5 + 4) = v15 + 1;
      return sub_8005A388(v4, SHIWORD(v2), *v15);
    }
    if ( (v7 & 0xF0u) < 0xC1 )
    {
      result = 176;
      if ( v9 != 144 )
      {
        if ( v9 == 176 )
        {
          v14 = *(v5 + 4);
          *(v5 + 17) = -80;
          *(v5 + 4) = v14 + 1;
          return sub_8005A400(v4, SHIWORD(v2), *v14);
        }
        return result;
      }
      v11 = *(v5 + 4);
      *(v5 + 17) = -112;
      *(v5 + 4) = v11 + 1;
      v7 = *v11;
      *(v5 + 4) = v11 + 2;
      v12 = v11[1];
      v13 = v4;
LABEL_24:
      *(v5 + 136) = sub_8005BB50(v13, SHIWORD(v2));
      return sub_8005A2A4(v4, v3, v7, v12);
    }
    result = 240;
    if ( v9 == 224 )
    {
      *(v5 + 17) = -32;
      ++*(v5 + 4);
      return sub_8005B73C(v4, SHIWORD(v2));
    }
    else if ( v9 == 240 )
    {
      v16 = *(v5 + 4);
      *(v5 + 17) = -1;
      *(v5 + 18) = v8;
      *(v5 + 4) = v16 + 1;
      return sub_8005B7E8(v4, SHIWORD(v2), *v16);
    }
  }
  else
  {
    v17 = *(v5 + 17);
    if ( v17 == 192 )
      return sub_8005A388(v4, SHIWORD(v2), *v6);
    if ( *(v5 + 17) >= 0xC1u )
    {
      result = 255;
      if ( v17 == 224 )
      {
        return sub_8005B73C(v4, SHIWORD(v2));
      }
      else if ( v17 == 255 )
      {
        return sub_8005B7E8(v4, SHIWORD(v2), *v6);
      }
    }
    else
    {
      result = 176;
      if ( v17 == 144 )
      {
        *(v5 + 4) = v6 + 2;
        v12 = v6[1];
        v13 = v4;
        goto LABEL_24;
      }
      if ( v17 == 176 )
        return sub_8005A400(v4, SHIWORD(v2), *v6);
    }
  }
  return result;
}
// 801DDDB8: using guessed type _DWORD dword_801DDDB8[32];

//----- (8005A2A4) --------------------------------------------------------
int __fastcall sub_8005A2A4(__int16 a1, __int16 a2, unsigned __int8 a3, unsigned __int8 a4)
{
  int v4; // $t1
  int v5; // $s0
  int v6; // $v1
  int v7; // $a0
  int result; // $v0
  __int16 v9; // $s1

  v4 = a1;
  v5 = 172 * a2 + dword_801DDDB8[a1];
  v6 = *(v5 + 18);
  v7 = v5 + v6;
  result = (*(v5 + 170) >> v6) & 1;
  v9 = a4;
  if ( !result )
  {
    result = a4;
    if ( *(v5 + 116) )
    {
      if ( a4 )
      {
        result = sub_80057484((a2 << 8) | v4, *(v5 + 76), *(v7 + 44), a3, a4, *(v5 + v6 + 23));
        *(v5 + 168) = v9;
      }
      else
      {
        return sub_800579E4((a2 << 8) | v4, *(v5 + 76), *(v7 + 44), a3);
      }
    }
  }
  return result;
}
// 801DDDB8: using guessed type _DWORD dword_801DDDB8[32];

//----- (8005A388) --------------------------------------------------------
int __fastcall sub_8005A388(__int16 a1, __int16 a2, char a3)
{
  int v3; // $s0
  int result; // $v0

  v3 = 172 * a2 + dword_801DDDB8[a1];
  *(v3 + *(v3 + 18) + 44) = a3;
  result = sub_8005BB50(a1, a2);
  *(v3 + 136) = result;
  return result;
}
// 801DDDB8: using guessed type _DWORD dword_801DDDB8[32];

//----- (8005A400) --------------------------------------------------------
int __fastcall sub_8005A400(int a1, __int16 a2, unsigned __int8 a3)
{
  int v3; // $s5
  int result; // $v0

  v3 = 172 * a2 + *(dword_801DDDB8 + (a1 << 16 >> 14));
  ++*(v3 + 4);
  if ( a3 <= 0x79u )
    __asm { jr      $v0 }
  result = sub_8005BB50(a1, a2);
  *(v3 + 136) = result;
  return result;
}
// 801DDDB8: using guessed type _DWORD dword_801DDDB8[32];

//----- (8005A964) --------------------------------------------------------
int __fastcall sub_8005A964(int a1, __int16 a2, unsigned __int8 a3)
{
  int v4; // $s1
  int v5; // $s2
  __int16 v6; // $s5
  int v8; // $s0
  int result; // $v0
  char v10[16]; // [sp+10h] [-38h] BYREF
  char v11; // [sp+20h] [-28h] BYREF
  char v12; // [sp+21h] [-27h]

  v4 = 172 * a2 + *(dword_801DDDB8 + (a1 << 16 >> 14));
  v5 = v4 + *(v4 + 18);
  v6 = a1;
  sub_8005C214(*(v4 + 76), *(v5 + 44), v10);
  v8 = 0;
  if ( v10[0] )
  {
    do
    {
      sub_8005BCF4(*(v4 + 76), *(v5 + 44), v8, &v11);
      if ( a3 >= 0x40u )
      {
        if ( (a3 - 64) < 0x40u )
          v12 = 0;
      }
      else
      {
        v12 = 2;
      }
      sub_8005BF30(*(v4 + 76), *(v5 + 44), v8++, &v11);
    }
    while ( v8 < v10[0] );
  }
  result = sub_8005BB50(v6, a2);
  *(v4 + 136) = result;
  return result;
}
// 801DDDB8: using guessed type _DWORD dword_801DDDB8[32];
// 8005A964: using guessed type char var_38[16];

//----- (8005AAB0) --------------------------------------------------------
int __fastcall sub_8005AAB0(__int16 a1, __int16 a2)
{
  int v3; // $s2
  int v4; // $s0
  int v5; // $v0
  int result; // $v0

  v3 = a1;
  v4 = 172 * a2 + dword_801DDDB8[a1];
  sub_800524F0();
  SsVmDamperOff();
  *(v4 + *(v4 + 18) + 44) = *(v4 + 18);
  v5 = *(v4 + 18);
  *(v4 + 19) = 0;
  *(v4 + 20) = 0;
  *(2 * v5 + v4 + 78) = 127;
  *(v4 + *(v4 + 18) + 23) = 64;
  result = sub_8005BB50(v3, a2);
  *(v4 + 136) = result;
  return result;
}
// 8005C31C: using guessed type int SsVmDamperOff(void);
// 801DDDB8: using guessed type _DWORD dword_801DDDB8[32];

//----- (8005AB78) --------------------------------------------------------
int __fastcall sub_8005AB78(int a1, __int16 a2, unsigned __int8 a3)
{
  int v4; // $s0
  int v6; // $v1
  char v7; // $v0
  int v8; // $a0
  void (__fastcall *v9)(_DWORD, _DWORD, _DWORD); // $v0
  int result; // $v0

  v4 = 172 * a2 + *(dword_801DDDB8 + (a1 << 16 >> 14));
  if ( *(v4 + 39) == 1 && !*(v4 + 16) )
  {
    *(v4 + 40) = a3;
    *(v4 + 16) = 1;
LABEL_7:
    v6 = *(v4 + 22);
    goto LABEL_8;
  }
  v6 = *(v4 + 22);
  if ( v6 != 30 && v6 != 20 )
  {
    v7 = *(v4 + 42);
    *(v4 + 21) = a3;
    *(v4 + 42) = v7 + 1;
    goto LABEL_7;
  }
LABEL_8:
  v8 = a1 << 16;
  if ( v6 == 40 )
  {
    v9 = dword_801DDE38[16 * a1 + a2];
    if ( v9 )
      v9(a1, a2, a3);
    v8 = a1 << 16;
  }
  result = sub_8005BB50(v8 >> 16, a2);
  *(v4 + 136) = result;
  return result;
}
// 801DDDB8: using guessed type _DWORD dword_801DDDB8[32];
// 801DDE38: using guessed type _DWORD dword_801DDE38[512];

//----- (8005ACA4) --------------------------------------------------------
int __fastcall sub_8005ACA4(__int16 a1, __int16 a2, char a3)
{
  int v3; // $s0
  int v4; // $v1
  unsigned int v5; // $v0
  int v6; // $v1
  int result; // $v0

  v3 = 172 * a2 + dword_801DDDB8[a1];
  if ( a3 == 20 )
  {
    *(v3 + 22) = a3;
    *(v3 + 39) = 1;
    result = sub_8005BB50(a1, a2);
    v4 = *(v3 + 4);
    *(v3 + 136) = result;
    *(v3 + 12) = v4;
  }
  else if ( a3 == 30 )
  {
    v5 = *(v3 + 40);
    *(v3 + 22) = a3;
    if ( v5 )
    {
      if ( v5 >= 0x7F )
      {
        sub_8005BB50(a1, a2);
        result = *(v3 + 12);
        *(v3 + 136) = 0;
        *(v3 + 4) = result;
      }
      else
      {
        --*(v3 + 40);
        result = sub_8005BB50(a1, a2);
        v6 = *(v3 + 40);
        *(v3 + 136) = result;
        if ( v6 )
        {
          result = *(v3 + 12);
          *(v3 + 4) = result;
        }
        else
        {
          *(v3 + 16) = 0;
        }
      }
    }
    else
    {
      *(v3 + 16) = 0;
      result = sub_8005BB50(a1, a2);
      *(v3 + 136) = result;
    }
  }
  else
  {
    *(v3 + 22) = a3;
    ++*(v3 + 42);
    result = sub_8005BB50(a1, a2);
    *(v3 + 136) = result;
  }
  return result;
}
// 801DDDB8: using guessed type _DWORD dword_801DDDB8[32];

//----- (8005ADF0) --------------------------------------------------------
int __fastcall sub_8005ADF0(__int16 a1, __int16 a2, char a3)
{
  int v3; // $s0
  char v4; // $v0
  int result; // $v0

  v3 = 172 * a2 + dword_801DDDB8[a1];
  v4 = *(v3 + 41);
  *(v3 + 19) = a3;
  *(v3 + 41) = v4 + 1;
  result = sub_8005BB50(a1, a2);
  *(v3 + 136) = result;
  return result;
}
// 801DDDB8: using guessed type _DWORD dword_801DDDB8[32];

//----- (8005AE68) --------------------------------------------------------
int __fastcall sub_8005AE68(__int16 a1, __int16 a2, char a3)
{
  int v3; // $s0
  char v4; // $v0
  int result; // $v0

  v3 = 172 * a2 + dword_801DDDB8[a1];
  v4 = *(v3 + 41);
  *(v3 + 20) = a3;
  *(v3 + 41) = v4 + 1;
  result = sub_8005BB50(a1, a2);
  *(v3 + 136) = result;
  return result;
}
// 801DDDB8: using guessed type _DWORD dword_801DDDB8[32];

//----- (8005AEE0) --------------------------------------------------------
int __fastcall sub_8005AEE0(int a1, __int16 a2, unsigned __int8 a3)
{
  int v4; // $s2
  int v6; // $s1
  int v7; // $s6
  int result; // $v0
  int v11; // $s0
  int v12; // $s3
  int v13; // $v1
  int v14; // $s0
  int v15; // $s3
  int v16; // $a0
  int v17; // $a0
  int v18; // $s0
  int v19; // $s3
  int v20; // $a0
  int v21; // $t0
  int v22; // $s0
  int v23; // [sp+3Ch] [-94h]
  char v24[16]; // [sp+48h] [-88h] BYREF
  unsigned __int16 v25; // [sp+58h] [-78h] BYREF
  unsigned __int16 v26; // [sp+5Ah] [-76h]
  int v27; // [sp+5Ch] [-74h]
  int v28; // [sp+60h] [-70h]
  int v29; // [sp+64h] [-6Ch]
  int v30; // [sp+68h] [-68h]
  int v31; // [sp+6Ch] [-64h]
  int v32; // [sp+70h] [-60h]
  int v33; // [sp+74h] [-5Ch]
  int v34; // [sp+78h] [-58h]
  int v35; // [sp+7Ch] [-54h]
  int v36; // [sp+80h] [-50h]
  int v37; // [sp+84h] [-4Ch]
  __int16 v38; // [sp+88h] [-48h]

  v4 = a1;
  v6 = 172 * a2 + dword_801DDDB8[a1];
  v7 = *(v6 + 18);
  sub_8005C214(*(v6 + 76), *(v7 + v6 + 44), v24);
  if ( *(v6 + 39) == 1 && !*(v6 + 16) )
  {
    *(v6 + 40) = a3;
    *(v6 + 16) = 1;
    result = sub_8005BB50(v4, a2);
    *(v6 + 136) = result;
    return result;
  }
  if ( *(v6 + 41) == 2 )
  {
    if ( !*(v6 + 19) && !*(v6 + 20) )
    {
      v11 = 0;
      if ( v24[0] )
      {
        v12 = v7 + v6;
        do
        {
          sub_8005BCF4(*(v6 + 76), *(v12 + 44), v11, &v25);
          BYTE1(v29) = a3 & 0x7F;
          LOBYTE(v29) = a3 & 0x7F;
          sub_8005BF30(*(v6 + 76), *(v12 + 44), v11++, &v25);
        }
        while ( v11 < v24[0] );
      }
    }
    v13 = *(v6 + 19);
    if ( v13 == 1 && !*(v6 + 20) )
    {
      v14 = 0;
      if ( v24[0] )
      {
        v15 = v7 + v6;
        do
        {
          sub_8005BCF4(*(v6 + 76), *(v15 + 44), v14, &v25);
          sub_8005BF30(*(v6 + 76), *(v15 + 44), v14++, &v25);
        }
        while ( v14 < v24[0] );
      }
      v13 = *(v6 + 19);
    }
    v16 = a1 << 16;
    if ( v13 == 2 )
    {
      v17 = a1;
      if ( *(v6 + 20) )
      {
LABEL_23:
        result = sub_8005BB50(v17, a2);
        *(v6 + 136) = result;
        *(v6 + 41) = 0;
        return result;
      }
      v18 = 0;
      if ( v24[0] )
      {
        v19 = v7 + v6;
        do
        {
          sub_8005BCF4(*(v6 + 76), *(v19 + 44), v18, &v25);
          sub_8005BF30(*(v6 + 76), *(v19 + 44), v18++, &v25);
        }
        while ( v18 < v24[0] );
      }
      v16 = a1 << 16;
    }
    v17 = v16 >> 16;
    goto LABEL_23;
  }
  v20 = a1 << 16;
  if ( *(v6 + 42) == 2 )
  {
    v21 = *(v6 + 22);
    if ( v21 == 16 )
    {
      v22 = 0;
      if ( v24[0] )
      {
        do
        {
          LOWORD(v23) = v38;
          sub_8005B468(
            *(v6 + 76),
            *(v7 + v6 + 44),
            v22++,
            v25 | (v26 << 16),
            v27,
            v28,
            v29,
            v30,
            v31,
            v32,
            v33,
            v34,
            v35,
            v36,
            v37,
            v23,
            *(v6 + 21),
            a3);
          v20 = a1 << 16;
        }
        while ( v22 < v24[0] );
      }
    }
    else
    {
      sub_8005B468(
        *(v6 + 76),
        *(v7 + v6 + 44),
        v21,
        v25 | (v26 << 16),
        v27,
        v28,
        v29,
        v30,
        v31,
        v32,
        v33,
        v34,
        v35,
        v36,
        v37,
        v38,
        *(v6 + 21),
        a3);
      v20 = a1 << 16;
    }
    result = sub_8005BB50(v20 >> 16, a2);
    *(v6 + 136) = result;
    *(v6 + 42) = 0;
  }
  else
  {
    result = sub_8005BB50(a1, a2);
    *(v6 + 136) = result;
  }
  return result;
}
// 8005B2F4: variable 'v23' is possibly undefined
// 801DDDB8: using guessed type _DWORD dword_801DDDB8[32];
// 8005AEE0: using guessed type char var_88[16];

//----- (8005B468) --------------------------------------------------------
int sub_8005B468(signed __int16 a1, __int16 a2, __int16 a3, ...)
{
  __int16 v3; // $s0
  int result; // $v0
  int v5; // [sp+3Ch] [+2Ch] BYREF
  va_list va; // [sp+3Ch] [+2Ch]
  int v7; // [sp+40h] [+30h]
  int v8; // [sp+44h] [+34h]
  int v9; // [sp+48h] [+38h]
  int v10; // [sp+4Ch] [+3Ch]
  int v11; // [sp+50h] [+40h]
  int v12; // [sp+54h] [+44h]
  int v13; // [sp+58h] [+48h]
  int v14; // [sp+5Ch] [+4Ch]
  int v15; // [sp+60h] [+50h]
  int v16; // [sp+64h] [+54h]
  int v17; // [sp+68h] [+58h]
  int v18; // [sp+6Ch] [+5Ch]
  int v19; // [sp+70h] [+60h]
  va_list va1; // [sp+74h] [+64h] BYREF

  va_start(va1, a3);
  va_start(va, a3);
  v5 = va_arg(va1, _DWORD);
  v7 = va_arg(va1, _DWORD);
  v8 = va_arg(va1, _DWORD);
  v9 = va_arg(va1, _DWORD);
  v10 = va_arg(va1, _DWORD);
  v11 = va_arg(va1, _DWORD);
  v12 = va_arg(va1, _DWORD);
  v13 = va_arg(va1, _DWORD);
  v14 = va_arg(va1, _DWORD);
  v15 = va_arg(va1, _DWORD);
  v16 = va_arg(va1, _DWORD);
  v17 = va_arg(va1, _DWORD);
  v18 = va_arg(va1, _DWORD);
  v19 = va_arg(va1, _DWORD);
  v3 = v19;
  sub_8005BCF4(a1, a2, a3, va);
  result = 4 * v3;
  if ( v3 <= 0x16 )
    __asm { jr      $v0 }
  return result;
}

//----- (8005B73C) --------------------------------------------------------
int __fastcall sub_8005B73C(__int16 a1, __int16 a2)
{
  int v3; // $s2
  int v4; // $s0
  __int16 v5; // $a1
  unsigned __int8 *v6; // $a0
  int v7; // $v0
  int result; // $v0

  v3 = a1;
  v4 = 172 * a2 + dword_801DDDB8[a1];
  v5 = *(v4 + 76);
  v6 = *(v4 + 4);
  v7 = *(v4 + 18);
  *(v4 + 4) = v6 + 1;
  sub_80056FE4((a2 << 8) | v3, v5, *(v7 + v4 + 44), *v6);
  result = sub_8005BB50(v3, a2);
  *(v4 + 136) = result;
  return result;
}
// 801DDDB8: using guessed type _DWORD dword_801DDDB8[32];

//----- (8005B7E8) --------------------------------------------------------
int __fastcall sub_8005B7E8(__int16 a1, __int16 a2, char a3)
{
  _DWORD *v6; // $a3
  int v8; // $a1
  unsigned __int8 *v9; // $s0
  int result; // $v0
  unsigned __int8 *v11; // $a0
  int v12; // $v0
  int v13; // $a1
  int v14; // $a2
  unsigned int v15; // $lo
  int v16; // $v1
  unsigned int v17; // $a1
  int v18; // $a3
  unsigned int v19; // $a0
  bool v20; // dc
  unsigned int v21; // $lo
  unsigned int v22; // $lo
  unsigned int v23; // $hi
  int v24; // $v1
  __int16 v25; // $v0
  int v26; // $v0
  int v27; // $v1
  int v28; // $a0
  __int16 v29; // $a1

  v6 = &dword_801DDDB8[a1];
  v8 = 172 * a2;
  v9 = (v8 + *v6);
  if ( a3 == 47 )
  {
    v24 = *(v9 + 35);
    v25 = *(v9 + 36) + 1;
    *(v9 + 36) = v25;
    if ( v24 )
    {
      if ( v25 >= v24 )
      {
        *(v8 + *v6 + 144) &= ~1u;
        *(v8 + *v6 + 144) &= ~8u;
        *(v8 + *v6 + 144) &= ~2u;
        *(v8 + *v6 + 144) |= 0x200u;
        *(v8 + *v6 + 144) |= 4u;
        v26 = *(v9 + 2);
        v27 = v9[60];
        v9[43] = 0;
        *(v9 + 3) = v26;
        if ( v27 != 255 )
        {
          v28 = v9[60];
          v29 = *v9;
          v9[43] = 0;
          sub_8005C10C(v28, v29);
          sub_80057F04((a2 << 8) | a1);
        }
        sub_80057F04((a2 << 8) | a1);
        result = *(v9 + 56);
        *(v9 + 34) = result;
      }
      else
      {
        result = *(v9 + 2);
        *(v9 + 32) = 0;
        v9[39] = 0;
        *(v9 + 34) = 0;
        *(v9 + 1) = result;
        *(v9 + 3) = result;
      }
    }
    else
    {
      result = *(v9 + 2);
      *(v9 + 32) = 0;
      v9[39] = 0;
      *(v9 + 34) = 0;
      *(v9 + 1) = result;
    }
  }
  else
  {
    result = 81;
    if ( a3 == 81 )
    {
      v11 = *(v9 + 1);
      *(v9 + 1) = v11 + 1;
      v12 = *v11;
      *(v9 + 1) = v11 + 2;
      v13 = v11[1];
      *(v9 + 1) = v11 + 3;
      v14 = 60000000 / ((v12 << 16) | (v13 << 8) | v11[2]);
      v15 = *(v9 + 37) * v14;
      v16 = dword_801BA2D0;
      v17 = v15;
      v18 = 15 * dword_801BA2D0;
      v19 = 60 * dword_801BA2D0;
      v20 = 10 * v15 >= 60 * dword_801BA2D0;
      *(v9 + 35) = v14;
      if ( v20 )
      {
        v22 = 10 * *(v9 + 37) * *(v9 + 35) / v19;
        v23 = 10 * *(v9 + 37) * *(v9 + 35) % v19;
        *(v9 + 55) = -1;
        *(v9 + 56) = v22;
        if ( 2 * v18 < v23 )
          *(v9 + 56) = v22 + 1;
      }
      else
      {
        v21 = 600 * v16 / v15;
        if ( !v17 )
          _break(7u, 0);
        *(v9 + 55) = v21;
        *(v9 + 56) = v21;
      }
      result = sub_8005BB50(a1, a2);
      *(v9 + 34) = result;
    }
  }
  return result;
}
// 8005B8A4: conditional instruction was optimized away because $v0.4!=0
// 8005B974: conditional instruction was optimized away because $a0.4!=0
// 8005B9B0: conditional instruction was optimized away because $a0.4!=0
// 801BA2D0: using guessed type int dword_801BA2D0;
// 801DDDB8: using guessed type _DWORD dword_801DDDB8[32];

//----- (8005BB50) --------------------------------------------------------
int __fastcall sub_8005BB50(int a1, __int16 a2)
{
  int v2; // $a1
  _BYTE *v3; // $v1
  int v4; // $a0
  int result; // $v0
  int v6; // $v0
  _BYTE *v7; // $v1

  v2 = 172 * a2 + *(dword_801DDDB8 + (a1 << 16 >> 14));
  v3 = *(v2 + 4);
  *(v2 + 4) = v3 + 1;
  v4 = *v3;
  if ( !*v3 )
    return 0;
  v6 = 4 * v4;
  if ( (v4 & 0x80) != 0 )
  {
    v4 &= 0x7Fu;
    do
    {
      v7 = *(v2 + 4);
      *(v2 + 4) = v7 + 1;
      LOBYTE(v7) = *v7;
      v4 = (v4 << 7) + (v7 & 0x7F);
    }
    while ( (v7 & 0x80) != 0 );
    v6 = 4 * v4;
  }
  result = 2 * (v6 + v4);
  *(v2 + 128) += result;
  return result;
}
// 801DDDB8: using guessed type _DWORD dword_801DDDB8[32];

//----- (8005BC0C) --------------------------------------------------------
unsigned int __fastcall sub_8005BC0C(__int16 a1, unsigned int a2, _WORD *a3)
{
  unsigned int result; // $v0

  a3[5] = a1 & 0x8000;
  a3[6] = a2 & 0x8000;
  a3[8] = a2 & 0x4000;
  a3[7] = a2 & 0x20;
  *a3 = HIBYTE(a1) & 0x7F;
  a3[1] = a1 >> 4;
  a3[2] = a1 & 0xF;
  result = (a2 >> 6) & 0x7F;
  a3[3] = result;
  a3[4] = a2 & 0x1F;
  return result;
}

//----- (8005BC68) --------------------------------------------------------
unsigned int __fastcall sub_8005BC68(unsigned __int16 *a1, _WORD *a2, _WORD *a3)
{
  unsigned int v4; // $t0
  unsigned int v5; // $v1
  unsigned __int16 v6; // $a0
  unsigned int result; // $v0

  v4 = a1[6] != 0 ? 0xFFFF8000 : 0;
  if ( a1[8] )
    v4 = (a1[6] != 0 ? 0xFFFF8000 : 0) | 0x4000;
  v5 = (a1[5] != 0 ? 0xFFFF8000 : 0) | (*a1 << 8) & 0x7F00 | (16 * a1[1]) & 0xF0 | a1[2] & 0xF;
  v6 = a1[4];
  result = v4 | (a1[3] << 6) & 0x1FC0;
  *a2 = v5;
  *a3 = result | v6 & 0x1F;
  return result;
}

//----- (8005BCF4) --------------------------------------------------------
int __fastcall sub_8005BCF4(signed __int16 a1, __int16 a2, int a3, int a4)
{
  int result; // $v0
  int v7; // $v1
  _WORD *v8; // $v1

  if ( g_SPUVoiceActive[a1] != 1 )
    return -1;
  sub_8005984C(a1, a2);
  v7 = (a3 + 16 * byte_8019E6D7) << 16 >> 11;
  *a4 = *(v7 + dword_8016E5F8);
  *(a4 + 1) = *(v7 + dword_8016E5F8 + 1);
  *(a4 + 2) = *(v7 + dword_8016E5F8 + 2);
  *(a4 + 3) = *(v7 + dword_8016E5F8 + 3);
  *(a4 + 4) = *(v7 + dword_8016E5F8 + 4);
  *(a4 + 5) = *(v7 + dword_8016E5F8 + 5);
  *(a4 + 7) = *(v7 + dword_8016E5F8 + 7);
  *(a4 + 6) = *(v7 + dword_8016E5F8 + 6);
  *(a4 + 8) = *(v7 + dword_8016E5F8 + 8);
  *(a4 + 9) = *(v7 + dword_8016E5F8 + 9);
  *(a4 + 10) = *(v7 + dword_8016E5F8 + 10);
  *(a4 + 11) = *(v7 + dword_8016E5F8 + 11);
  *(a4 + 12) = *(v7 + dword_8016E5F8 + 12);
  *(a4 + 13) = *(v7 + dword_8016E5F8 + 13);
  v8 = (v7 + dword_8016E5F8);
  *(a4 + 16) = v8[8];
  *(a4 + 18) = v8[9];
  *(a4 + 20) = v8[10];
  result = 0;
  *(a4 + 22) = v8[11];
  return result;
}
// 8016E5F8: using guessed type int dword_8016E5F8;
// 8019E6D7: using guessed type char byte_8019E6D7;
// 8019E6F0: using guessed type _BYTE g_SPUVoiceActive[16];

//----- (8005BF30) --------------------------------------------------------
int __fastcall sub_8005BF30(signed __int16 a1, __int16 a2, int a3, int a4)
{
  int result; // $v0
  int v7; // $v1
  _WORD *v8; // $v1

  if ( g_SPUVoiceActive[a1] != 1 )
    return -1;
  sub_8005984C(a1, a2);
  v7 = (a3 + 16 * byte_8019E6D7) << 16 >> 11;
  *(v7 + dword_8016E5F8) = *a4;
  *(v7 + dword_8016E5F8 + 1) = *(a4 + 1);
  *(v7 + dword_8016E5F8 + 2) = *(a4 + 2);
  *(v7 + dword_8016E5F8 + 3) = *(a4 + 3);
  *(v7 + dword_8016E5F8 + 4) = *(a4 + 4);
  *(v7 + dword_8016E5F8 + 5) = *(a4 + 5);
  *(v7 + dword_8016E5F8 + 7) = *(a4 + 7);
  *(v7 + dword_8016E5F8 + 6) = *(a4 + 6);
  *(v7 + dword_8016E5F8 + 8) = *(a4 + 8);
  *(v7 + dword_8016E5F8 + 9) = *(a4 + 9);
  *(v7 + dword_8016E5F8 + 10) = *(a4 + 10);
  *(v7 + dword_8016E5F8 + 11) = *(a4 + 11);
  *(v7 + dword_8016E5F8 + 12) = *(a4 + 12);
  *(v7 + dword_8016E5F8 + 13) = *(a4 + 13);
  v8 = (v7 + dword_8016E5F8);
  v8[8] = *(a4 + 16);
  v8[9] = *(a4 + 18);
  v8[10] = *(a4 + 20);
  result = 0;
  v8[11] = *(a4 + 22);
  return result;
}
// 8016E5F8: using guessed type int dword_8016E5F8;
// 8019E6D7: using guessed type char byte_8019E6D7;
// 8019E6F0: using guessed type _BYTE g_SPUVoiceActive[16];

//----- (8005C0F8) --------------------------------------------------------
int sub_8005C0F8()
{
  int result; // $v0

  result = 2;
  word_8009E0CC = 2;
  return result;
}
// 8009E0CC: using guessed type __int16 word_8009E0CC;

//----- (8005C10C) --------------------------------------------------------
int __fastcall sub_8005C10C(int a1, __int16 a2)
{
  _DWORD *v2; // $a0
  int v3; // $a2
  int v4; // $a3
  int v5; // $v1
  int v6; // $a2
  int result; // $v0

  v2 = (dword_801DDDB8 + (a1 << 16 >> 14));
  v3 = 172 * a2;
  v4 = v3 + *v2;
  *(v4 + 70) = 1;
  *(v4 + 72) = 0;
  *(v3 + *v2 + 144) &= ~0x100u;
  *(v3 + *v2 + 144) &= ~8u;
  *(v3 + *v2 + 144) &= ~2u;
  *(v3 + *v2 + 144) &= ~4u;
  *(v3 + *v2 + 144) &= ~0x200u;
  v5 = *(v4 + 8);
  *(v4 + 43) = 1;
  *(v4 + 4) = v5;
  v6 = v3 + *v2;
  result = *(v6 + 144) | 1;
  *(v6 + 144) = result;
  return result;
}
// 801DDDB8: using guessed type _DWORD dword_801DDDB8[32];

//----- (8005C214) --------------------------------------------------------
int __fastcall sub_8005C214(signed __int16 a1, __int16 a2, int a3)
{
  int result; // $v0
  int v5; // $s0

  if ( g_SPUVoiceActive[a1] != 1 )
    return -1;
  v5 = a2;
  sub_8005984C(a1, a2);
  v5 *= 16;
  *a3 = *(v5 + dword_8016DAA0);
  *(a3 + 1) = *(v5 + dword_8016DAA0 + 1);
  *(a3 + 2) = *(v5 + dword_8016DAA0 + 2);
  *(a3 + 3) = *(v5 + dword_8016DAA0 + 3);
  *(a3 + 4) = *(v5 + dword_8016DAA0 + 4);
  result = 0;
  *(a3 + 6) = *(v5 + dword_8016DAA0 + 6);
  return result;
}
// 8016DAA0: using guessed type int dword_8016DAA0;
// 8019E6F0: using guessed type _BYTE g_SPUVoiceActive[16];

//----- (8005C32C) --------------------------------------------------------
int __fastcall sub_8005C32C(__int16 a1, __int16 a2, int a3, __int16 a4)
{
  int v4; // $t2
  _DWORD *v5; // $t1
  int v6; // $a1
  int v7; // $t0
  int result; // $v0
  __int16 v9; // $a1
  __int16 v10; // $a2
  int v11; // $v1

  v4 = a2;
  v5 = &dword_801DDDB8[a1];
  v6 = 172 * a2;
  v7 = v6 + *v5;
  *(v7 + 144) &= 0xFFFFFDFF;
  a3 = a3;
  *(v6 + *v5 + 144) &= ~4u;
  result = 1;
  *(v7 + 70) = a4;
  if ( a3 == 1 )
  {
    *(v6 + *v5 + 144) |= 1u;
    v9 = *(v7 + 116);
    v10 = *(v7 + 118);
    *(v7 + 72) = 0;
    *(v7 + 43) = 1;
    return sub_80057C6C((v4 << 8) | a1, v9, v10, 0);
  }
  else if ( !a3 )
  {
    v11 = v6 + *v5;
    result = *(v11 + 144) | 2;
    *(v11 + 144) = result;
  }
  return result;
}
// 801DDDB8: using guessed type _DWORD dword_801DDDB8[32];

//----- (8005C42C) --------------------------------------------------------
int __fastcall SEQ_Play(__int16 treckID, unsigned __int8 a2, __int16 a3)
{
  return sub_8005C32C(treckID, 0, a2, a3);
}

//----- (8005C58C) --------------------------------------------------------
// write access to const memory has been detected, the output may be wrong!
int sub_8005C58C()
{
  return 1;
}
// 8005C614: write access to const memory at 8006F864 has been detected
// 8006F864: using guessed type int dword_8006F864;
// 8006F890: using guessed type int dword_8006F890;
// 8006F8E8: using guessed type int dword_8006F8E8;

//----- (8005C634) --------------------------------------------------------
int __fastcall sub_8005C634(__int16 a1, __int16 a2)
{
  _DWORD *v2; // $t0
  int v3; // $v1
  int v4; // $s0
  int v5; // $t0
  int v6; // $v1
  __int16 v7; // $a0
  int v8; // $a1
  int v9; // $t1
  int v10; // $a3
  int result; // $v0

  v2 = &dword_801DDDB8[a1];
  v3 = 172 * a2;
  v4 = v3 + *v2;
  *(v4 + 144) &= ~1u;
  *(v3 + *v2 + 144) &= ~2u;
  *(v3 + *v2 + 144) &= ~8u;
  *(v3 + *v2 + 144) |= 4u;
  sub_80057F04((a2 << 8) | a1);
  *(v4 + 43) = 0;
  *(v4 + 128) = 0;
  *(v4 + 39) = 0;
  *(v4 + 19) = 0;
  *(v4 + 20) = 0;
  *(v4 + 41) = 0;
  *(v4 + 21) = 0;
  *(v4 + 22) = 0;
  *(v4 + 42) = 0;
  *(v4 + 18) = 0;
  *(v4 + 72) = 0;
  *(v4 + 39) = 0;
  *(v4 + 40) = 0;
  *(v4 + 16) = 0;
  *(v4 + 17) = 0;
  v5 = 0;
  v6 = *(v4 + 132);
  v7 = *(v4 + 114);
  v8 = *(v4 + 8);
  v9 = v4;
  v10 = v4;
  *(v4 + 136) = *(v4 + 124);
  *(v4 + 140) = v6;
  *(v4 + 112) = v7;
  *(v4 + 4) = v8;
  *(v4 + 12) = v8;
  do
  {
    *(v10 + 44) = v5;
    *(v10 + 23) = 64;
    *(v9 + 78) = 127;
    v9 += 2;
    ++v5;
    ++v10;
  }
  while ( v5 < 16 );
  result = 127;
  *(v4 + 120) = 127;
  *(v4 + 122) = 127;
  return result;
}
// 801DDDB8: using guessed type _DWORD dword_801DDDB8[32];

//----- (8005C7A4) --------------------------------------------------------
int __fastcall CDAudio_Stop(__int16 a1)
{
  return sub_8005C634(a1, 0);
}

//----- (8005C7F8) --------------------------------------------------------
int sub_8005C7F8()
{
  int result; // $v0
  int v1; // $s2
  _DWORD *v2; // $s4
  int v3; // $s0
  int v4; // $s1

  result = dword_8016DA90;
  if ( dword_8016DA90 != 1 )
  {
    dword_8016DA90 = 1;
    v1 = 0;
    sub_800570D0();
    result = word_801DE638;
    if ( word_801DE638 > 0 )
    {
      v2 = dword_801DDDB8;
      do
      {
        if ( ((1 << v1) & dword_8019E6C8) != 0 )
        {
          v3 = 0;
          if ( word_801DE640 > 0 )
          {
            v4 = 0;
            do
            {
              if ( (*(v4 + *v2 + 144) & 1) != 0 )
              {
                sub_8005D34C(v1, v3);
                if ( (*(v4 + *v2 + 144) & 0x10) != 0 )
                  sub_8005D538(v1, v3);
                if ( (*(v4 + *v2 + 144) & 0x20) != 0 )
                  sub_8005CD18(v1, v3);
                if ( (*(v4 + *v2 + 144) & 0x40) != 0 )
                  sub_8005CB30(v1, v3);
                if ( (*(v4 + *v2 + 144) & 0x80) != 0 )
                  sub_8005CB30(v1, v3);
              }
              if ( (*(v4 + *v2 + 144) & 2) != 0 )
                sub_8005CA30(v1, v3);
              if ( (*(v4 + *v2 + 144) & 8) != 0 )
                sub_8005CFA8(v1, v3);
              if ( (*(v4 + *v2 + 144) & 4) != 0 )
              {
                sub_8005C634(v1, v3);
                *(v4 + *v2 + 144) = 0;
              }
              ++v3;
              v4 += 172;
            }
            while ( v3 < word_801DE640 );
          }
        }
        result = ++v1 < word_801DE638;
        ++v2;
      }
      while ( v1 < word_801DE638 );
    }
    dword_8016DA90 = 0;
  }
  return result;
}
// 8016DA90: using guessed type int dword_8016DA90;
// 8019E6C8: using guessed type int dword_8019E6C8;
// 801DDDB8: using guessed type _DWORD dword_801DDDB8[32];
// 801DE638: using guessed type __int16 word_801DE638;
// 801DE640: using guessed type __int16 word_801DE640;

//----- (8005CA30) --------------------------------------------------------
unsigned int __fastcall sub_8005CA30(__int16 a1, __int16 a2)
{
  _DWORD *v2; // $s2
  int v3; // $s0
  int v4; // $s1
  int v5; // $s0
  unsigned int result; // $v0

  v2 = &dword_801DDDB8[a1];
  v3 = 172 * a2;
  v4 = v3 + *v2;
  sub_80057F04((a2 << 8) | a1);
  *(v4 + 43) = 0;
  v5 = v3 + *v2;
  result = *(v5 + 144) & 0xFFFFFFFD;
  *(v5 + 144) = result;
  return result;
}
// 801DDDB8: using guessed type _DWORD dword_801DDDB8[32];

//----- (8005CB30) --------------------------------------------------------
unsigned int __fastcall sub_8005CB30(int a1, __int16 a2)
{
  int v3; // $a3
  int v4; // $t0
  unsigned int v5; // $v0
  unsigned int result; // $v0
  unsigned int v7; // $v1
  unsigned int v8; // $a0
  unsigned int v9; // $v0
  unsigned int v10; // $v1
  unsigned int v11; // $a0
  unsigned int v12; // $v0
  BOOL v13; // $v0
  unsigned int v14; // $v0
  unsigned int v15; // $lo
  int v16; // $a2
  _DWORD *v17; // $a2
  int v18; // $v0

  v3 = 172 * a2 + *(dword_801DDDB8 + (a1 << 16 >> 14));
  v4 = *(v3 + 68);
  v5 = *(v3 + 160) - 1;
  *(v3 + 160) = v5;
  if ( v4 <= 0 )
  {
    v10 = *(v3 + 140);
    v11 = *(v3 + 164);
    v12 = v4 + v10;
    if ( v11 >= v10 )
    {
      v14 = v10 - v4;
      if ( v10 >= v11 )
        goto LABEL_12;
      v11 = *(v3 + 164);
      *(v3 + 140) = v14;
      v13 = v11 < v14;
    }
    else
    {
      *(v3 + 140) = v12;
      v13 = v12 < v11;
    }
    if ( v13 )
      *(v3 + 140) = v11;
    goto LABEL_12;
  }
  result = v5 % v4;
  if ( result )
    return result;
  v7 = *(v3 + 140);
  v8 = *(v3 + 164);
  v9 = v7 - 1;
  if ( v8 < v7 || (v9 = v7 + 1, v7 < v8) )
    *(v3 + 140) = v9;
LABEL_12:
  v15 = 10 * *(v3 + 74) * *(v3 + 140) / (60 * dword_801BA2D0);
  if ( !(60 * dword_801BA2D0) )
    _break(7u, 0);
  *(v3 + 112) = v15;
  if ( (v15 << 16) <= 0 )
    *(v3 + 112) = 1;
  v16 = a1 << 16;
  if ( !*(v3 + 160) || (result = *(v3 + 164), *(v3 + 140) == result) )
  {
    v17 = (dword_801DDDB8 + (v16 >> 14));
    v18 = 172 * a2;
    *(v18 + *v17 + 144) &= ~0x40u;
    result = v18 + *v17;
    *(result + 144) &= ~0x80u;
  }
  return result;
}
// 8005CB8C: conditional instruction was optimized away because $t0.4 is in (1..7FFF)
// 801BA2D0: using guessed type int dword_801BA2D0;
// 801DDDB8: using guessed type _DWORD dword_801DDDB8[32];

//----- (8005CD18) --------------------------------------------------------
int __fastcall sub_8005CD18(int a1, int a2)
{
  _DWORD *v2; // $t1
  int v3; // $t0
  int v5; // $s0
  int v6; // $a2
  unsigned int v8; // $v0
  int v9; // $hi
  int v10; // $v0
  int v11; // $v0
  bool v12; // dc
  int v13; // $v0
  int v14; // $s1
  int v15; // $v1
  int v16; // $v0
  int v17; // $a0
  __int16 v18; // $a1
  __int16 v19; // $a2
  int v20; // $v0
  int v21; // $v0
  int v22; // $s1
  int v23; // $t0
  int v24; // $v0
  unsigned __int16 v26; // [sp+10h] [-10h] BYREF
  __int16 v27[7]; // [sp+12h] [-Eh] BYREF

  v2 = &dword_801DDDB8[a1];
  v3 = 172 * a2;
  v5 = v3 + *v2;
  v6 = *(v5 + 66);
  v8 = *(v5 + 152) - 1;
  *(v5 + 152) = v8;
  if ( v6 > 0 )
  {
    v9 = v8 % v6;
    v10 = a2 << 16;
    if ( v9 )
      return sub_80057DEC((v10 >> 8) | a1, (v5 + 120), (v5 + 122));
    v11 = *(v5 + 64) - 1;
    *(v5 + 64) = v11;
    v12 = v11 << 16 <= 0;
    v13 = a2 << 8;
    if ( !v12 )
    {
      v14 = v13 | a1;
      sub_80057DEC(v13 | a1, &v26, v27);
      v15 = *(v5 + 64);
      v16 = a2 << 16;
      if ( v26 - v15 > 0 )
      {
        if ( v27[0] - v15 > 0 )
        {
          v17 = v14;
          if ( v26 != 1 )
          {
            v18 = v26 - 1;
            v19 = v27[0] - 1;
LABEL_14:
            sub_80057C6C(v17, v18, v19, 0);
            goto LABEL_16;
          }
        }
        goto LABEL_12;
      }
LABEL_13:
      v17 = (v16 >> 8) | a1;
      v18 = 1;
      v19 = 1;
      goto LABEL_14;
    }
LABEL_15:
    *(v3 + *v2 + 144) &= ~0x20u;
    goto LABEL_16;
  }
  v20 = *(v5 + 64) + v6;
  *(v5 + 64) = v20;
  v12 = v20 << 16 <= 0;
  v21 = a2 << 8;
  if ( v12 )
    goto LABEL_15;
  v22 = v21 | a1;
  sub_80057DEC(v21 | a1, &v26, v27);
  v23 = *(v5 + 66);
  v16 = a2 << 16;
  if ( *(v5 + 62) < ((*(v5 + 148) - *(v5 + 152)) * -v23) )
    goto LABEL_13;
  if ( -v23 >= v26 )
  {
LABEL_12:
    v16 = a2 << 16;
    goto LABEL_13;
  }
  sub_80057C6C(v22, v26 + v23, v27[0] + v23, 0);
LABEL_16:
  if ( !*(v5 + 152) || (v10 = a2 << 16, !*(v5 + 64)) )
  {
    v24 = 172 * a2 + *(dword_801DDDB8 + (a1 << 16 >> 14));
    *(v24 + 144) &= ~0x20u;
    v10 = a2 << 16;
  }
  return sub_80057DEC((v10 >> 8) | a1, (v5 + 120), (v5 + 122));
}
// 8005CD98: conditional instruction was optimized away because $a2.4 is in (1..7FFF)
// 801DDDB8: using guessed type _DWORD dword_801DDDB8[32];

//----- (8005CFA8) --------------------------------------------------------
int __fastcall sub_8005CFA8(int a1, __int16 a2)
{
  _DWORD *v2; // $a0
  int v3; // $v0
  int result; // $v0

  v2 = (dword_801DDDB8 + (a1 << 16 >> 14));
  v3 = 172 * a2;
  *(v3 + *v2 + 43) = 1;
  result = v3 + *v2;
  *(result + 144) &= ~8u;
  return result;
}
// 801DDDB8: using guessed type _DWORD dword_801DDDB8[32];

//----- (8005D010) --------------------------------------------------------
int __fastcall FreeSPUVoice(unsigned __int16 a1)
{
  int result; // $v0
  int v2; // $s0

  result = a1 < 16u;
  if ( a1 < 16u )                               //  16  SPU
  {
    v2 = a1;
    result = 4 * a1;
    if ( g_SPUVoiceActive[a1] == 1 )            //  
    {
      SpuFree(dword_801DEFA4[a1]);              // OS  SPU!
      g_SPUVoiceActive[v2] = 0;                 //   
      return g_ActiveVoiceCount-- - 1;          //   
    }
  }
  return result;
}
// 8005D0F8: using guessed type int __fastcall SpuFree(_DWORD);
// 8019E6F0: using guessed type _BYTE g_SPUVoiceActive[16];
// 801DEF9C: using guessed type __int16 g_ActiveVoiceCount;
// 801DEFA4: using guessed type _DWORD dword_801DEFA4[16];

//----- (8005D174) --------------------------------------------------------
int __fastcall sub_8005D174(unsigned int a1, unsigned __int16 a2)
{
  int v3; // $s2
  int v4; // $s1
  unsigned int v5; // $s0
  unsigned int v6; // $a2

  if ( a2 < 0x11u && (v3 = a2, v4 = a2, g_SPUVoiceActive[a2] == 2) )
  {
    v5 = dword_801DEFA4[a2];
    sub_8005201C(0);
    sub_80052050(v5);
    sub_8005D23C(a1, dword_801DEF5C[v4], v6);
    g_SPUVoiceActive[v3] = 1;
    return v3;
  }
  else
  {
    sub_8005208C(0);
    return -1;
  }
}
// 8005D1F0: variable 'v6' is possibly undefined
// 8019E6F0: using guessed type _BYTE g_SPUVoiceActive[16];
// 801DEF5C: using guessed type _DWORD dword_801DEF5C[16];
// 801DEFA4: using guessed type _DWORD dword_801DEFA4[16];

//----- (8005D23C) --------------------------------------------------------
// write access to const memory has been detected, the output may be wrong!
unsigned int __fastcall sub_8005D23C(unsigned int a1, unsigned int a2, unsigned int a3)
{
  unsigned int v3; // $s0
  unsigned int result; // $v0

  v3 = a2;
  if ( a2 > 0x7F000 )
    v3 = 520192;
  sub_80051B4C(a1, v3, a3);
  result = v3;
  dword_8006F864 = 0;
  return result;
}
// 8005D280: write access to const memory at 8006F864 has been detected
// 8006F864: using guessed type int dword_8006F864;
// 8006F868: using guessed type int dword_8006F868;

//----- (8005D29C) --------------------------------------------------------
// write access to const memory has been detected, the output may be wrong!
int sub_8005D29C()
{
  return 1;
}
// 8005D2B0: write access to const memory at 8007003D has been detected
// 8005D2DC: write access to const memory at 8007003C has been detected
// 8005D310: write access to const memory at 80070038 has been detected
// 8005D334: write access to const memory at 8007003E has been detected
// 80061B84: using guessed type int __fastcall InterruptCallback(_DWORD, _DWORD);
// 80061BE4: using guessed type int __fastcall VSyncCallback(_DWORD);
// 80070030: using guessed type int dword_80070030;
// 80070038: using guessed type int dword_80070038;
// 8007003C: using guessed type char byte_8007003C;
// 8007003D: using guessed type char byte_8007003D;
// 8007003E: using guessed type char byte_8007003E;

//----- (8005D34C) --------------------------------------------------------
int __fastcall sub_8005D34C(__int16 a1, __int16 a2)
{
  return sub_80059EFC(a1, a2);
}

//----- (8005D378) --------------------------------------------------------
int __fastcall SpuVoice_Clear(__int16 a1)
{
  int v1; // $s0
  int result; // $v0
  int v3; // $a2
  _DWORD *v4; // $a1
  int v5; // $a0
  int v6; // $v1

  v1 = a1;
  sub_80057C6C(a1, 0, 0, 1);
  sub_80057F04(v1);
  result = ~(1 << v1) & dword_8019E6C8;
  dword_8019E6C8 = result;
  v3 = 0;
  if ( word_801DE640 > 0 )
  {
    v4 = &dword_801DDDB8[v1];
    v5 = 0;
    do
    {
      *(v5 + *v4 + 144) = 0;
      *(v5 + *v4 + 60) = -1;
      *(v5 + *v4) = 0;
      *(v5 + *v4 + 62) = 0;
      *(v5 + *v4 + 64) = 0;
      *(v5 + *v4 + 148) = 0;
      *(v5 + *v4 + 152) = 0;
      *(v5 + *v4 + 66) = 0;
      *(v5 + *v4 + 164) = 0;
      *(v5 + *v4 + 160) = 0;
      *(v5 + *v4 + 156) = 0;
      *(v5 + *v4 + 68) = 0;
      v6 = word_801DE640;
      *(v5 + *v4 + 116) = 127;
      ++v3;
      result = v5 + *v4;
      *(result + 118) = 127;
      v5 += 172;
    }
    while ( v3 < v6 );
  }
  return result;
}
// 8019E6C8: using guessed type int dword_8019E6C8;
// 801DDDB8: using guessed type _DWORD dword_801DDDB8[32];
// 801DE640: using guessed type __int16 word_801DE640;

//----- (8005D4F0) --------------------------------------------------------
int __fastcall SpuVoice_StopAll(__int16 a1)
{
  return SpuVoice_Clear(a1);
}

//----- (8005D538) --------------------------------------------------------
int __fastcall sub_8005D538(int a1, int a2)
{
  _DWORD *v2; // $s2
  int v3; // $s1
  int v5; // $s0
  int v6; // $a2
  unsigned int v8; // $v0
  int v9; // $hi
  int v10; // $v0
  __int16 v11; // $v0
  bool v12; // dc
  int v13; // $v0
  int v14; // $s1
  int v15; // $v1
  __int16 v16; // $v0
  int v17; // $v0
  int v18; // $s1
  int v19; // $v1
  int v20; // $t0
  int v21; // $v0
  unsigned __int16 v23; // [sp+10h] [-10h] BYREF
  __int16 v24[7]; // [sp+12h] [-Eh] BYREF

  v2 = &dword_801DDDB8[a1];
  v3 = 172 * a2;
  v5 = v3 + *v2;
  v6 = *(v5 + 66);
  v8 = *(v5 + 152) - 1;
  *(v5 + 152) = v8;
  if ( v6 <= 0 )
  {
    v10 = a2 << 16;
    if ( v6 >= 0 )
      return sub_80057DEC((v10 >> 8) | a1, (v5 + 120), (v5 + 122));
    v16 = *(v5 + 64) + v6;
    *(v5 + 64) = v16;
    v12 = (v16 & 0x8000) != 0;
    v17 = a2 << 8;
    if ( !v12 )
    {
      v18 = v17 | a1;
      sub_80057DEC(v17 | a1, &v23, v24);
      v19 = *(v5 + 66);
      if ( v23 - v19 >= 127 && v24[0] - v19 >= 127 )
        sub_80057C6C(v18, 127, 127, 0);
      v20 = *(v5 + 66);
      if ( (*(v5 + 148) - *(v5 + 152)) * -v20 < *(v5 + 62) )
        sub_80057C6C((a2 << 16 >> 8) | a1, v23 - v20, v24[0] - v20, 0);
      goto LABEL_17;
    }
  }
  else
  {
    v9 = v8 % v6;
    v10 = a2 << 16;
    if ( v9 )
      return sub_80057DEC((v10 >> 8) | a1, (v5 + 120), (v5 + 122));
    v11 = *(v5 + 64) - 1;
    *(v5 + 64) = v11;
    v12 = (v11 & 0x8000) != 0;
    v13 = a2 << 8;
    if ( !v12 )
    {
      v14 = v13 | a1;
      sub_80057DEC(v13 | a1, &v23, v24);
      v15 = *(v5 + 64);
      if ( v23 + v15 >= 127 && v24[0] + v15 >= 127 )
        sub_80057C6C(v14, 127, 127, 0);
      if ( v23 + *(v5 + 64) < *(v5 + 62) )
        sub_80057C6C((a2 << 16 >> 8) | a1, v23 + 1, v24[0] + 1, 0);
      goto LABEL_17;
    }
  }
  sub_80057C6C((a2 << 8) | a1, 127, 127, 0);
  *(v3 + *v2 + 144) &= ~0x10u;
LABEL_17:
  if ( !*(v5 + 152) || (v10 = a2 << 16, !*(v5 + 64)) )
  {
    v21 = 172 * a2 + *(dword_801DDDB8 + (a1 << 16 >> 14));
    *(v21 + 144) &= ~0x10u;
    v10 = a2 << 16;
  }
  return sub_80057DEC((v10 >> 8) | a1, (v5 + 120), (v5 + 122));
}
// 8005D5BC: conditional instruction was optimized away because $a2.4 is in (1..7FFF)
// 801DDDB8: using guessed type _DWORD dword_801DDDB8[32];

//----- (8005D854) --------------------------------------------------------
int __fastcall sub_8005D854(__int16 a1, __int16 a2)
{
  _DWORD *v2; // $s1
  int v3; // $s0
  int v4; // $s0
  int result; // $v0

  v2 = &dword_801DDDB8[a1];
  v3 = 172 * a2;
  sub_80057DEC((a2 << 8) | a1, (v3 + *v2 + 120), (v3 + *v2 + 122));
  *(v3 + *v2 + 144) &= ~1u;
  *(v3 + *v2 + 144) &= ~8u;
  v4 = v3 + *v2;
  result = *(v4 + 144) | 2;
  *(v4 + 144) = result;
  return result;
}
// 801DDDB8: using guessed type _DWORD dword_801DDDB8[32];

//----- (8005D924) --------------------------------------------------------
int __fastcall PlayTrack(__int16 a1)
{
  return sub_8005D854(a1, 0);
}

//----- (8005D978) --------------------------------------------------------
int __fastcall Math_CORDIC_Atan(int a1)
{
  int v1; // $a2
  char *v2; // $t1
  int *v3; // $t0
  char *v4; // $a3
  int *v5; // $a1
  int v6; // $a0
  int v7; // $v0
  int v9[15]; // [sp+0h] [-A8h] BYREF
  char v10; // [sp+3Ch] [-6Ch] BYREF
  int v11; // [sp+70h] [-38h]
  char v12; // [sp+74h] [-34h] BYREF
  int v13; // [sp+A0h] [-8h]

  v1 = 0;
  v2 = &v12;
  v3 = g_CORDIC_AtanTable;
  v4 = &v10;
  v5 = v9;
  v9[0] = 4096;
  v9[14] = a1;
  v11 = 0;
  do
  {
    v6 = v5[14];
    if ( v6 >= 0 )
    {
      v5[1] = (v6 >> v1) + *v5;
      *v4 = v5[14] - (*v5 >> v1);
      v7 = v5[28] + *v3;
    }
    else
    {
      v5[1] = *v5 - (v6 >> v1);
      *v4 = (*v5 >> v1) + v5[14];
      v7 = v5[28] - *v3;
    }
    *v2 = v7;
    v2 += 4;
    ++v3;
    v4 += 4;
    ++v1;
    ++v5;
  }
  while ( v1 < 12 );
  return v13;
}
// 800701CC: using guessed type int g_CORDIC_AtanTable[12];

//----- (8005DB84) --------------------------------------------------------
void __fastcall sub_8005DB84(int a1, int a2)
{
  _$A0 = a1 << 16;
  _$A1 = a2 << 16;
  __asm
  {
    ctc2    $a0, $24
    ctc2    $a1, $25
  }
}

//----- (8005DB9C) --------------------------------------------------------
void __fastcall sub_8005DB9C(int _$A0)
{
  __asm { ctc2    $a0, $26 }
}

//----- (8005DBA8) --------------------------------------------------------
void __fastcall sub_8005DBA8(int _$A0)
{
  __asm { ctc2    $a0, $27 }
}

//----- (8005DCEC) --------------------------------------------------------
int *__fastcall sub_8005DCEC(int *a1, unsigned __int16 *a2)
{
  _$T0 = *a1;
  _$T1 = a1[1];
  _$T2 = a1[2];
  _$T3 = a1[3];
  _$T4 = a1[4];
  __asm
  {
    ctc2    $t0, $0
    ctc2    $t1, $1
    ctc2    $t2, $2
    ctc2    $t3, $3
    ctc2    $t4, $4
  }
  _$T2 = *(a2 + 3);
  _$T0 = *a2 | *(a2 + 1) & 0xFFFF0000;
  __asm
  {
    mtc2    $t0, $0
    mtc2    $t2, $1
    cop2    0x486012
  }
  _$T2 = a2[7];
  _$T0 = a2[1] | (*(a2 + 2) << 16);
  __asm
  {
    mfc2    $t3, $9
    mfc2    $t4, $10
    mfc2    $t5, $11
    mtc2    $t0, $0
    mtc2    $t2, $1
    cop2    0x486012
  }
  _$T2 = *(a2 + 4);
  _$T0 = a2[2] | *(a2 + 2) & 0xFFFF0000;
  __asm
  {
    mfc2    $t6, $9
    mfc2    $t7, $10
    mfc2    $t8, $11
    mtc2    $t0, $0
    mtc2    $t2, $1
    cop2    0x486012
  }
  *a1 = (_$T6 << 16) | _$T3;
  a1[3] = (_$T8 << 16) | _$T5;
  __asm
  {
    mfc2    $t0, $9
    mfc2    $t1, $10
  }
  a1[1] = _$T0 | (_$T4 << 16);
  a1[2] = (_$T1 << 16) | _$T7;
  __asm { swc2    $11, 0x10($a0) }
  return a1;
}

//----- (8005DDF8) --------------------------------------------------------
unsigned __int16 *__fastcall sub_8005DDF8(int *a1, unsigned __int16 *a2)
{
  _$T0 = *a1;
  _$T1 = a1[1];
  _$T2 = a1[2];
  _$T3 = a1[3];
  _$T4 = a1[4];
  __asm
  {
    ctc2    $t0, $0
    ctc2    $t1, $1
    ctc2    $t2, $2
    ctc2    $t3, $3
    ctc2    $t4, $4
  }
  _$T2 = *(a2 + 3);
  _$T0 = *a2 | *(a2 + 1) & 0xFFFF0000;
  __asm
  {
    mtc2    $t0, $0
    mtc2    $t2, $1
    cop2    0x486012
  }
  _$T2 = a2[7];
  _$T0 = a2[1] | (*(a2 + 2) << 16);
  __asm
  {
    mfc2    $t3, $9
    mfc2    $t4, $10
    mfc2    $t5, $11
    mtc2    $t0, $0
    mtc2    $t2, $1
    cop2    0x486012
  }
  _$T2 = *(a2 + 4);
  _$T0 = a2[2] | *(a2 + 2) & 0xFFFF0000;
  __asm
  {
    mfc2    $t6, $9
    mfc2    $t7, $10
    mfc2    $t8, $11
    mtc2    $t0, $0
    mtc2    $t2, $1
    cop2    0x486012
  }
  *a2 = (_$T6 << 16) | _$T3;
  *(a2 + 3) = (_$T8 << 16) | _$T5;
  __asm
  {
    mfc2    $t0, $9
    mfc2    $t1, $10
  }
  *(a2 + 1) = _$T0 | (_$T4 << 16);
  *(a2 + 2) = (_$T1 << 16) | _$T7;
  __asm { swc2    $11, 0x10($a1) }
  return a2;
}

//----- (8005E1AC) --------------------------------------------------------
int __fastcall sub_8005E1AC(int *a1, int *a2, int *a3, __int16 *a4, __int16 *a5, __int16 *a6, int *a7)
{
  int *v7; // $s1
  int v8; // $s0
  int result; // $v0
  int v10; // $s2
  int v11; // $a0
  int v12[4]; // [sp+20h] [-10h] BYREF

  v7 = a7;
  v8 = 0;
  result = sub_8005E2CC(a1, a2, a3, a4, a5, a6, a7);
  v10 = result;
  if ( result > 0 )
  {
    do
    {
      v11 = *v7++;
      ++v8;
      sub_8005F2C8(v11, v11 + 24, v11 + 20, v12);
    }
    while ( v8 < v10 );
    return v10;
  }
  return result;
}
// 8005E1AC: using guessed type int var_10[4];

//----- (8005E234) --------------------------------------------------------
int __fastcall sub_8005E234(
        int *a1,
        int *a2,
        int *a3,
        int *a4,
        __int16 *a5,
        __int16 *a6,
        __int16 *a7,
        __int16 *a8,
        int *a9)
{
  int *v9; // $s0
  int v10; // $s1
  int result; // $v0
  int v12; // $s2
  int v13; // $a0
  int v14[4]; // [sp+28h] [-10h] BYREF

  v9 = a9;
  v10 = 0;
  result = sub_8005E43C(a1, a2, a3, a4, a5, a6, a7, a8, a9);
  v12 = result;
  if ( result > 0 )
  {
    do
    {
      v13 = *v9++;
      ++v10;
      sub_8005F2C8(v13, v13 + 24, v13 + 20, v14);
    }
    while ( v10 < v12 );
    return v12;
  }
  return result;
}
// 8005E234: using guessed type int var_10[4];

//----- (8005E2CC) --------------------------------------------------------
int __fastcall sub_8005E2CC(int *a1, int *a2, int *a3, __int16 *a4, __int16 *a5, __int16 *a6, int *a7)
{
  int v7; // $t2
  int v8; // $a0
  int v9; // $a0
  int v10; // $s1
  int v11; // $s0
  int *v12; // $s2
  int *v13; // $v1
  int v15; // [sp+10h] [-8h] BYREF

  v7 = a1[1];
  dword_801BA2E8[0] = *a1;
  dword_801BA2EC = v7;
  v8 = a2[1];
  dword_801BA314 = *a2;
  dword_801BA318 = v8;
  v9 = a3[1];
  dword_801BA340 = *a3;
  dword_801BA344 = v9;
  v10 = 0;
  word_801BA308 = *a4;
  v11 = 0;
  word_801BA334 = *a5;
  v12 = a7;
  word_801BA360 = *a6;
  do
  {
    sub_8005F348(&dword_801BA2E8[v11], &dword_801BA2E8[v11 + 2], &v15);
    v13 = &dword_801BA2E8[v11];
    ++v10;
    v11 += 11;
    v13[9] = 0;
    v13[10] = 0;
    *v12++ = v13;
  }
  while ( v10 < 3 );
  return sub_8005E5E8(v10, a7);
}
// 801BA2E8: using guessed type int dword_801BA2E8[];
// 801BA2EC: using guessed type int dword_801BA2EC;
// 801BA308: using guessed type __int16 word_801BA308;
// 801BA314: using guessed type int dword_801BA314;
// 801BA318: using guessed type int dword_801BA318;
// 801BA334: using guessed type __int16 word_801BA334;
// 801BA340: using guessed type int dword_801BA340;
// 801BA344: using guessed type int dword_801BA344;
// 801BA360: using guessed type __int16 word_801BA360;

//----- (8005E43C) --------------------------------------------------------
int __fastcall sub_8005E43C(
        int *a1,
        int *a2,
        int *a3,
        int *a4,
        __int16 *a5,
        __int16 *a6,
        __int16 *a7,
        __int16 *a8,
        int *a9)
{
  int v9; // $t4
  int v10; // $a0
  int v11; // $a0
  int v12; // $a0
  int v13; // $s1
  int v14; // $s0
  int *v15; // $s2
  int *v16; // $v1
  int v18; // [sp+10h] [-8h] BYREF

  v9 = a1[1];
  dword_801BA2E8[0] = *a1;
  dword_801BA2EC = v9;
  v10 = a2[1];
  dword_801BA314 = *a2;
  dword_801BA318 = v10;
  v11 = a4[1];
  dword_801BA340 = *a4;
  dword_801BA344 = v11;
  v12 = a3[1];
  dword_801BA36C = *a3;
  dword_801BA370 = v12;
  word_801BA308 = *a5;
  v13 = 0;
  word_801BA334 = *a6;
  v14 = 0;
  word_801BA360 = *a8;
  v15 = a9;
  word_801BA38C = *a7;
  do
  {
    sub_8005F348(&dword_801BA2E8[v14], &dword_801BA2E8[v14 + 2], &v18);
    v16 = &dword_801BA2E8[v14];
    ++v13;
    v14 += 11;
    v16[9] = 0;
    v16[10] = 0;
    *v15++ = v16;
  }
  while ( v13 < 4 );
  return sub_8005E5E8(v13, a9);
}
// 801BA2E8: using guessed type int dword_801BA2E8[];
// 801BA2EC: using guessed type int dword_801BA2EC;
// 801BA308: using guessed type __int16 word_801BA308;
// 801BA314: using guessed type int dword_801BA314;
// 801BA318: using guessed type int dword_801BA318;
// 801BA334: using guessed type __int16 word_801BA334;
// 801BA340: using guessed type int dword_801BA340;
// 801BA344: using guessed type int dword_801BA344;
// 801BA360: using guessed type __int16 word_801BA360;
// 801BA36C: using guessed type int dword_801BA36C;
// 801BA370: using guessed type int dword_801BA370;
// 801BA38C: using guessed type __int16 word_801BA38C;

//----- (8005E5E8) --------------------------------------------------------
int __fastcall sub_8005E5E8(int a1, int *a2)
{
  int v4; // $s3
  int v5; // $s4
  int v6; // $s2
  int *v7; // $fp
  int *v8; // $s5
  int v9; // $s1
  int *v10; // $s0
  int v11; // $t0
  int v12; // $a1
  int v13; // $a2
  int v14; // $v1
  int v15; // $a0
  int v16; // $a3
  int *v17; // $a2
  int v18; // $v1
  int *v19; // $v0
  int v20; // $s6
  int v21; // $s4
  bool v22; // dc
  int v23; // $s2
  int *v24; // $s5
  int v25; // $s1
  int *v26; // $s0
  int v27; // $t0
  int v28; // $a1
  int v29; // $a2
  int v30; // $v1
  int v31; // $a0
  int v32; // $a3
  int *v33; // $a2
  int v34; // $v1
  int *v35; // $v0
  int v36; // $s6
  int v37; // $s4
  int v38; // $s2
  int *v39; // $s5
  int v40; // $s1
  int **v41; // $s0
  int *v42; // $t0
  int *v43; // $a1
  int v44; // $a0
  int *v45; // $a2
  int v46; // $v1
  int v47; // $a3
  int *v48; // $v0
  int v49; // $s6
  int v50; // $s4
  int v51; // $s2
  int *v52; // $s5
  int v53; // $s1
  int *v54; // $s0
  _DWORD *v55; // $t0
  _DWORD *v56; // $a1
  int v57; // $a0
  int *v58; // $a2
  int v59; // $v1
  int v60; // $a3
  int *v61; // $v0
  int v62; // $s6
  int v63; // $s4
  int v64; // $s2
  int *v65; // $s5
  int v66; // $s1
  int **v67; // $s0
  int *v68; // $t0
  int *v69; // $a1
  int v70; // $a0
  int *v71; // $a2
  int v72; // $v1
  int v73; // $a3
  int *v74; // $v0
  int v75; // $s6
  int v76; // $s4
  int v77; // $s2
  int *v78; // $s5
  int v79; // $s1
  int *v80; // $s0
  _DWORD *v81; // $t0
  _DWORD *v82; // $a1
  int v83; // $a0
  int *v84; // $a2
  int v85; // $v1
  int v86; // $a3
  int *v87; // $v0
  int v89; // [sp+10h] [-38h]
  int v90; // [sp+10h] [-38h]

  v4 = a1;
  v5 = 0;
  v6 = 0;
  v7 = a2 + 10;
  if ( a1 > 0 )
  {
    v8 = a2;
    v9 = 11 * a1;
    v10 = a2 + 10;
    do
    {
      v11 = *v8;
      if ( v5 + 1 == a1 )
        v12 = *a2;
      else
        v12 = v8[1];
      v13 = *(v11 + 16);
      if ( v13 >= 0 )
      {
        v18 = *(v12 + 16);
        if ( v18 < 0 )
        {
          v15 = *v8;
          v16 = -v13;
          ++v4;
          v89 = v18 - v13;
          v17 = &dword_801BA2E8[v9];
          goto LABEL_11;
        }
      }
      else
      {
        *v10++ = v11;
        v14 = *(v12 + 16);
        ++v6;
        if ( v14 >= 0 )
        {
          v15 = v12;
          v12 = v11;
          v16 = -v14;
          ++v4;
          v17 = &dword_801BA2E8[v9];
          v89 = *(v11 + 16) - v14;
LABEL_11:
          ++v6;
          sub_8005EE1C(v15, v12, v17, v16, v89);
          v19 = &dword_801BA2E8[v9];
          v9 += 11;
          *v10++ = v19;
        }
      }
      ++v5;
      ++v8;
    }
    while ( v5 < a1 );
  }
  v20 = v6;
  v21 = 0;
  v22 = v6 <= 0;
  v23 = 0;
  if ( !v22 )
  {
    v24 = v7;
    v25 = 11 * v4;
    v26 = a2;
    do
    {
      v27 = *v24;
      if ( v21 + 1 == v20 )
        v28 = *v7;
      else
        v28 = v24[1];
      v29 = *(v27 + 16);
      if ( v29 < 0 )
      {
        v34 = *(v28 + 16);
        if ( v34 >= 0 )
        {
          v31 = *v24;
          v32 = -v29;
          ++v4;
          v90 = v34 - v29;
          v33 = &dword_801BA2E8[v25];
          goto LABEL_23;
        }
      }
      else
      {
        *v26++ = v27;
        v30 = *(v28 + 16);
        ++v23;
        if ( v30 < 0 )
        {
          v31 = v28;
          v28 = v27;
          v32 = -v30;
          ++v4;
          v33 = &dword_801BA2E8[v25];
          v90 = *(v27 + 16) - v30;
LABEL_23:
          ++v23;
          sub_8005EE1C(v31, v28, v33, v32, v90);
          v35 = &dword_801BA2E8[v25];
          v25 += 11;
          *v26++ = v35;
        }
      }
      ++v21;
      ++v24;
    }
    while ( v21 < v20 );
  }
  v36 = v23;
  v37 = 0;
  v22 = v23 <= 0;
  v38 = 0;
  if ( !v22 )
  {
    v39 = a2;
    v40 = 11 * v4;
    v41 = v7;
    do
    {
      v42 = *v39;
      if ( v37 + 1 == v36 )
        v43 = *a2;
      else
        v43 = v39[1];
      if ( v42[3] < -v42[10] )
      {
        if ( v43[3] >= -v43[10] )
        {
          ++v4;
          v45 = &dword_801BA2E8[v40];
          v44 = *v39;
          v47 = v42[4];
          v46 = v43[4];
          goto LABEL_35;
        }
      }
      else
      {
        *v41++ = v42;
        ++v38;
        if ( v43[3] < -v43[10] )
        {
          ++v4;
          v44 = v43;
          v43 = v42;
          v45 = &dword_801BA2E8[v40];
          v46 = v42[4];
          v47 = *(v44 + 16);
LABEL_35:
          sub_8005EE1C(v44, v43, v45, v47, v47 - v46);
          ++v38;
          v48 = &dword_801BA2E8[v40];
          v40 += 11;
          *v41++ = v48;
        }
      }
      ++v37;
      ++v39;
    }
    while ( v37 < v36 );
  }
  v49 = v38;
  v50 = 0;
  v22 = v38 <= 0;
  v51 = 0;
  if ( !v22 )
  {
    v52 = v7;
    v53 = 11 * v4;
    v54 = a2;
    do
    {
      v55 = *v52;
      if ( v50 + 1 == v49 )
        v56 = *v7;
      else
        v56 = v52[1];
      if ( v55[10] < v55[3] )
      {
        if ( v56[10] >= v56[3] )
        {
          ++v4;
          v58 = &dword_801BA2E8[v53];
          v57 = *v52;
          v60 = v55[4];
          v59 = v56[4];
          goto LABEL_47;
        }
      }
      else
      {
        *v54++ = v55;
        ++v51;
        if ( v56[10] < v56[3] )
        {
          ++v4;
          v57 = v56;
          v56 = v55;
          v58 = &dword_801BA2E8[v53];
          v59 = v55[4];
          v60 = *(v57 + 16);
LABEL_47:
          sub_8005EE1C(v57, v56, v58, v60, v60 - v59);
          ++v51;
          v61 = &dword_801BA2E8[v53];
          v53 += 11;
          *v54++ = v61;
        }
      }
      ++v50;
      ++v52;
    }
    while ( v50 < v49 );
  }
  v62 = v51;
  v63 = 0;
  v22 = v51 <= 0;
  v64 = 0;
  if ( !v22 )
  {
    v65 = a2;
    v66 = 11 * v4;
    v67 = v7;
    do
    {
      v68 = *v65;
      if ( v63 + 1 == v62 )
        v69 = *a2;
      else
        v69 = v65[1];
      if ( v68[2] < -v68[9] )
      {
        if ( v69[2] >= -v69[9] )
        {
          ++v4;
          v71 = &dword_801BA2E8[v66];
          v70 = *v65;
          v73 = v68[4];
          v72 = v69[4];
          goto LABEL_59;
        }
      }
      else
      {
        *v67++ = v68;
        ++v64;
        if ( v69[2] < -v69[9] )
        {
          ++v4;
          v70 = v69;
          v69 = v68;
          v71 = &dword_801BA2E8[v66];
          v72 = v68[4];
          v73 = *(v70 + 16);
LABEL_59:
          sub_8005EE1C(v70, v69, v71, v73, v73 - v72);
          ++v64;
          v74 = &dword_801BA2E8[v66];
          v66 += 11;
          *v67++ = v74;
        }
      }
      ++v63;
      ++v65;
    }
    while ( v63 < v62 );
  }
  v75 = v64;
  v76 = 0;
  v22 = v64 <= 0;
  v77 = 0;
  if ( !v22 )
  {
    v78 = v7;
    v79 = 11 * v4;
    v80 = a2;
    do
    {
      v81 = *v78;
      if ( v76 + 1 == v75 )
        v82 = *v7;
      else
        v82 = v78[1];
      if ( v81[9] < v81[2] )
      {
        if ( v82[9] >= v82[2] )
        {
          v84 = &dword_801BA2E8[v79];
          v83 = *v78;
          v86 = v81[4];
          v85 = v82[4];
          goto LABEL_71;
        }
      }
      else
      {
        *v80++ = v81;
        ++v77;
        if ( v82[9] < v82[2] )
        {
          v83 = v82;
          v82 = v81;
          v84 = &dword_801BA2E8[v79];
          v85 = v81[4];
          v86 = *(v83 + 16);
LABEL_71:
          sub_8005EE1C(v83, v82, v84, v86, v86 - v85);
          ++v77;
          v87 = &dword_801BA2E8[v79];
          v79 += 11;
          *v80++ = v87;
        }
      }
      ++v76;
      ++v78;
    }
    while ( v76 < v75 );
  }
  return v77;
}
// 801BA2E8: using guessed type int dword_801BA2E8[];

//----- (8005EE1C) --------------------------------------------------------
int __fastcall sub_8005EE1C(int a1, int a2, int a3, int a4, int a5)
{
  int v8; // $s2
  int v9; // $v0
  int result; // $v0
  int v11; // [sp+18h] [-8h] BYREF

  if ( a5 )
  {
    v9 = a4 << 12;
    if ( a5 == -1 && v9 == 0x80000000 )
      _break(6u, 0);
    v8 = v9 / a5;
  }
  else
  {
    v8 = 0;
  }
  LoadAverageShort12(a1, a2, 4096 - v8, v8, a3);
  LoadAverageByte(a1 + 32, a2 + 32, 4096 - v8, v8, a3 + 32);
  sub_8005F348(a3, a3 + 8, &v11);
  *(a3 + 36) = 0;
  result = 0;
  *(a3 + 40) = 0;
  return result;
}
// 8005EE60: conditional instruction was optimized away because %arg_10.4!=0
// 8005F1E8: using guessed type int __fastcall LoadAverageByte(_DWORD, _DWORD, _DWORD, _DWORD, _DWORD);

//----- (8005EF38) --------------------------------------------------------
int __fastcall sub_8005EF38(int a1, int a2, int a3, int a4, int a5, int a6)
{
  _DWORD *v6; // $gp
  int v7; // $v1
  int v8; // $a1
  int v9; // $t0
  int v10; // $v0
  int v11; // $a1
  int v12; // $v1
  int v13; // $v1
  int v14; // $v0
  int v15; // $lo
  int result; // $v0

  v7 = a2 / 2;
  v8 = a4 << 12;
  if ( !v7 )
    _break(7u, 0);
  if ( v7 == -1 && v8 == 0x80000000 )
    _break(6u, 0);
  v9 = (a4 << 12) / v7;
  v10 = a3 / 2;
  if ( !(a3 / 2) )
    _break(7u, 0);
  if ( v10 == -1 && v8 == 0x80000000 )
    _break(6u, 0);
  v11 = v8 / (a3 / 2);
  v12 = v7 << 12;
  if ( !a4 )
    _break(7u, 0);
  if ( a4 == -1 && v12 == 0x80000000 )
    _break(6u, 0);
  v13 = v12 / a4;
  v14 = v10 << 12;
  v15 = v14 / a4;
  if ( a4 == -1 && v14 == 0x80000000 )
    _break(6u, 0);
  result = v14 / a4;
  v6[59] = a1;
  v6[103] = a5;
  v6[102] = a6;
  v6[99] = v9;
  v6[101] = v11;
  v6[98] = v13;
  v6[100] = v15;
  return result;
}
// 8005EFE4: conditional instruction was optimized away because $a3.4!=0
// 8005F014: variable 'v6' is possibly undefined

//----- (8005F2C8) --------------------------------------------------------
int __fastcall sub_8005F2C8(int _$A0, int a2, int a3, _DWORD *a4)
{
  __asm
  {
    lwc2    $0, 0($a0)
    lwc2    $1, 4($a0)
    cop2    0x180001
    swc2    $14, 0($a1)
    swc2    $8, 0($a2)
    cfc2    $v1, $31
    mfc2    $v0, $19
  }
  *a4 = _$V1;
  return _$V0 >> 2;
}

//----- (8005F348) --------------------------------------------------------
int __fastcall sub_8005F348(int _$A0, int a2, _DWORD *a3)
{
  int result; // $v0

  __asm
  {
    lwc2    $0, 0($a0)
    lwc2    $1, 4($a0)
    cop2    0x480012
    swc2    $25, 0($a1)
    swc2    $26, 4($a1)
    swc2    $27, 8($a1)
    cfc2    $v0, $31
  }
  *a3 = result;
  return result;
}

//----- (8005F578) --------------------------------------------------------
// write access to const memory has been detected, the output may be wrong!
void sub_8005F578()
{
  int v0; // $ra
  unsigned __int32 v1; // $v0

  dword_8007037C = v0;
  patch_gte();
  v1 = _mfc0(0xCu, 0);
  _mtc0(0xCu, 0, v1 | 0x40000000);
  _$T0 = 341;
  __asm { ctc2    $t0, $29 }
  _$T0 = 256;
  __asm { ctc2    $t0, $30 }
  _$T0 = 1000;
  __asm { ctc2    $t0, $26 }
  _$T0 = -4194;
  __asm { ctc2    $t0, $27 }
  _$T0 = 20971520;
  __asm
  {
    ctc2    $t0, $28
    ctc2    $zero, $24
    ctc2    $zero, $25
  }
  JUMPOUT(0);
}
// 8005F578: write access to const memory at 8007037C has been detected
// 8005F5F0: control flows out of bounds to 0
// 8005F578: variable 'v0' is possibly undefined
// 8005F5F8: using guessed type int patch_gte(void);
// 8007037C: using guessed type int dword_8007037C;

//----- (800602D0) --------------------------------------------------------
int __fastcall FixedCos(int a1)
{
  int v1; // $a0

  if ( a1 < 0 )
    a1 = -a1;
  v1 = a1 & 0xFFF;
  if ( v1 >= 2049 )
  {
    if ( v1 < 3073 )
      return -*(dword_8007438C + 3072 - v1);
    else
      return *(dword_80072B8C + v1);
  }
  else if ( v1 >= 1025 )
  {
    return -*(dword_80073B8C + v1);
  }
  else
  {
    return *(dword_8007438C + 1024 - v1);
  }
}
// 80072B8C: using guessed type int dword_80072B8C[512];
// 80073B8C: using guessed type int dword_80073B8C[512];
// 8007438C: using guessed type int dword_8007438C[512];

//----- (800611CC) --------------------------------------------------------
int *__fastcall sub_800611CC(int *a1, unsigned __int16 *a2, int *a3)
{
  _$T0 = *a1;
  _$T1 = a1[1];
  _$T2 = a1[2];
  _$T3 = a1[3];
  _$T4 = a1[4];
  __asm
  {
    ctc2    $t0, $0
    ctc2    $t1, $1
    ctc2    $t2, $2
    ctc2    $t3, $3
    ctc2    $t4, $4
  }
  _$T2 = *(a2 + 3);
  _$T0 = *a2 | *(a2 + 1) & 0xFFFF0000;
  __asm
  {
    mtc2    $t0, $0
    mtc2    $t2, $1
    cop2    0x486012
  }
  _$T2 = a2[7];
  _$T0 = a2[1] | (*(a2 + 2) << 16);
  __asm
  {
    mfc2    $t3, $9
    mfc2    $t4, $10
    mfc2    $t5, $11
    mtc2    $t0, $0
    mtc2    $t2, $1
    cop2    0x486012
  }
  _$T2 = *(a2 + 4);
  _$T0 = a2[2] | *(a2 + 2) & 0xFFFF0000;
  __asm
  {
    mfc2    $t6, $9
    mfc2    $t7, $10
    mfc2    $t8, $11
    mtc2    $t0, $0
    mtc2    $t2, $1
    cop2    0x486012
  }
  *a3 = (_$T6 << 16) | _$T3;
  a3[3] = (_$T8 << 16) | _$T5;
  __asm
  {
    mfc2    $t0, $9
    mfc2    $t1, $10
  }
  a3[1] = _$T0 | (_$T4 << 16);
  a3[2] = (_$T1 << 16) | _$T7;
  __asm { swc2    $11, 0x10($a2) }
  return a3;
}

//----- (8006223C) --------------------------------------------------------
int __fastcall sub_8006223C(_DWORD *a1, int a2)
{
  int result; // $v0

  result = a2 - 1;
  if ( a2 )
  {
    do
    {
      *a1 = 0;
      --result;
      ++a1;
    }
    while ( result != -1 );
  }
  return result;
}

//----- (80062268) --------------------------------------------------------
int (__fastcall *sub_80062268())(int a1, int a2)
{
  sub_800624E4(dword_800760E4, 8);
  MEMORY[0x1F8010F4] = 0;
  InterruptCallback(3, sub_800622B8);
  return sub_8006243C;
}
// 80061B84: using guessed type int __fastcall InterruptCallback(_DWORD, _DWORD);
// 800760E4: using guessed type int dword_800760E4[8];

//----- (800622B8) --------------------------------------------------------
int sub_800622B8()
{
  unsigned int i; // $s1
  int v1; // $s0
  void (**v2)(void); // $s2
  int result; // $v0
  int v4; // $s0
  int v5; // $a1
  int v6; // $a2

  for ( i = HIBYTE(MEMORY[0x1F8010F4]) & 0x7F; i; i = HIBYTE(MEMORY[0x1F8010F4]) & 0x7F )
  {
    v1 = 0;
    v2 = dword_800760E4;
    do
    {
      if ( v1 >= 7 )
        break;
      if ( (i & 1) != 0 )
      {
        MEMORY[0x1F8010F4] &= (1 << (v1 + 24)) | 0xFFFFFF;
        if ( *v2 )
          (*v2)();
      }
      ++v2;
      i >>= 1;
      ++v1;
    }
    while ( i );
  }
  if ( (MEMORY[0x1F8010F4] & 0xFF000000) == 0x80000000
    || (result = MEMORY[0x1F8010F4] & 0x8000, (MEMORY[0x1F8010F4] & 0x8000) != 0) )
  {
    v4 = 0;
    printf("DMA bus error: code=%08x\n", MEMORY[0x1F8010F4]);
    do
    {
      v5 = v4;
      v6 = *(16 * v4++ + 0x1F801080);
      printf("MADR[%d]=%08x\n", v5, v6);
      result = v4 < 7;
    }
    while ( v4 < 7 );
  }
  return result;
}
// 8006230C: conditional instruction was optimized away because $s1.4 is in (1..7F)
// 80062BA0: using guessed type int printf(const char *, ...);
// 800760E4: using guessed type int dword_800760E4[8];

//----- (8006243C) --------------------------------------------------------
int __fastcall sub_8006243C(int a1, int a2)
{
  int *v2; // $v1
  int v3; // $a3

  v2 = &dword_800760E4[a1];
  v3 = *v2;
  if ( a2 != *v2 )
  {
    if ( a2 )
    {
      *v2 = a2;
      MEMORY[0x1F8010F4] = MEMORY[0x1F8010F4] & 0xFFFFFF | (1 << (a1 + 16)) | 0x800000;
    }
    else
    {
      *v2 = 0;
      MEMORY[0x1F8010F4] = (MEMORY[0x1F8010F4] & 0x7FFFFF | 0x800000) & ~(1 << (a1 + 16));
    }
  }
  return v3;
}
// 800760E4: using guessed type int dword_800760E4[8];

//----- (800624E4) --------------------------------------------------------
int __fastcall sub_800624E4(_DWORD *a1, int a2)
{
  int result; // $v0

  result = a2 - 1;
  if ( a2 )
  {
    do
    {
      *a1 = 0;
      --result;
      ++a1;
    }
    while ( result != -1 );
  }
  return result;
}

//----- (80062510) --------------------------------------------------------
// write access to const memory has been detected, the output may be wrong!
int (__fastcall *sub_80062510())(int a1, int a2)
{
  MEMORY[0x1F801114] = 263;
  dword_80076128 = 0;
  sub_80062610(dword_80076108, 8);
  InterruptCallback(0, sub_80062568);
  return sub_800625E4;
}
// 80062530: write access to const memory at 80076128 has been detected
// 80061B84: using guessed type int __fastcall InterruptCallback(_DWORD, _DWORD);
// 80076108: using guessed type int dword_80076108[8];
// 80076128: using guessed type int dword_80076128;

//----- (80062568) --------------------------------------------------------
// write access to const memory has been detected, the output may be wrong!
BOOL sub_80062568()
{
  int v0; // $s1
  void (**v1)(void); // $s0
  void (*v2)(void); // $v0
  BOOL result; // $v0

  v0 = 0;
  v1 = dword_80076108;
  dword_80076128 = 1;
  do
  {
    v2 = *v1;
    if ( *v1++ != 0 )
      v2();
    result = ++v0 < 8;
  }
  while ( v0 < 8 );
  return result;
}
// 80062590: write access to const memory at 80076128 has been detected
// 80076108: using guessed type int dword_80076108[8];
// 80076128: using guessed type int dword_80076128;

//----- (800625E4) --------------------------------------------------------
int __fastcall sub_800625E4(int a1, int a2)
{
  int *v2; // $a0
  int result; // $v0

  v2 = &dword_80076108[a1];
  result = *v2;
  if ( a2 != *v2 )
    *v2 = a2;
  return result;
}
// 80076108: using guessed type int dword_80076108[8];

//----- (80062610) --------------------------------------------------------
int __fastcall sub_80062610(_DWORD *a1, int a2)
{
  int result; // $v0

  result = a2 - 1;
  if ( a2 )
  {
    do
    {
      *a1 = 0;
      --result;
      ++a1;
    }
    while ( result != -1 );
  }
  return result;
}

//----- (800628B0) --------------------------------------------------------
int __fastcall sub_800628B0(unsigned __int16 a1, __int16 a2, __int16 a3)
{
  __int16 v3; // $a3
  int result; // $v0
  int v5; // $v1
  int v6; // $v0

  v3 = 72;
  if ( a1 >= 3u )
    return 0;
  v5 = 16 * a1 + 528486656;
  *(v5 + 4) = 0;
  *(v5 + 8) = a2;
  if ( a1 >= 2u )
  {
    v6 = a3 & 0x1000;
    if ( a1 == 2 )
    {
      v6 = a3 & 0x1000;
      if ( (a3 & 1) == 0 )
        v3 = 584;
    }
  }
  else
  {
    if ( (a3 & 0x10) != 0 )
      v3 = 73;
    v6 = a3 & 0x1000;
    if ( (a3 & 1) == 0 )
      v3 |= 0x100u;
  }
  if ( v6 )
    v3 |= 0x10u;
  result = 1;
  *(16 * a1 + 0x1F801104) = v3;
  return result;
}

//----- (800629F8) --------------------------------------------------------
int __fastcall sub_800629F8(unsigned __int16 a1)
{
  int result; // $v0

  result = 1;
  if ( a1 >= 3u )
    return 0;
  *(16 * a1 + 0x1F801100) = 0;
  return result;
}

//----- (80062B20) --------------------------------------------------------
void sub_80062B20()
{
  JUMPOUT(0xA0);
}
// 80062B24: control flows out of bounds to A0

//----- (80062C20) --------------------------------------------------------
void sub_80062C20()
{
  JUMPOUT(0xB0);
}
// 80062C24: control flows out of bounds to B0

//----- (80062C30) --------------------------------------------------------
// write access to const memory has been detected, the output may be wrong!
int __fastcall ResetGraph(int a1)
{
  char v1; // $s1

  v1 = a1;
  if ( (a1 & 7) != 0 )
    return ResetGraph_Internal(1);
  printf("ResetGraph:jtb=%08x,env=%08x\n", &off_80076158, &byte_800761A0);
  memset_1(&byte_800761A0, 0, 128);
  ResetCallback();
  GPU_cw();
  byte_800761A0 = ResetGraph_Internal(v1);
  byte_800761A1 = 1;
  word_800761A4 = 1024;
  word_800761A6 = 512;
  memset_1(dword_800761B0, -1, sizeof(dword_800761B0));
  memset_1(&dword_8007620C, -1, 20);
  return 0;
}
// 80062CB4: write access to const memory at 800761A1 has been detected
// 80062CDC: write access to const memory at 800761A4 has been detected
// 80062CF8: write access to const memory at 800761A6 has been detected
// 80062CA8: write access to const memory at 800761A0 has been detected
// 80062BA0: using guessed type int printf(const char *, ...);
// 80076158: using guessed type char *off_80076158;
// 800761A0: using guessed type char byte_800761A0;
// 800761A1: using guessed type char byte_800761A1;
// 800761A4: using guessed type __int16 word_800761A4;
// 800761A6: using guessed type __int16 word_800761A6;
// 800761B0: using guessed type int dword_800761B0[23];
// 8007620C: using guessed type int dword_8007620C;

//----- (80062FB8) --------------------------------------------------------
int sub_80062FB8()
{
  return 0;
}
// 800761A0: using guessed type char byte_800761A0;

//----- (80062FC8) --------------------------------------------------------
int sub_80062FC8()
{
  return 0;
}

//----- (80063034) --------------------------------------------------------
unsigned int __fastcall sub_80063034(int a1)
{
  unsigned int v2; // $a0

  if ( !a1 )
    memset_1(&dword_8007620C, -1, 20);
  v2 = 50331649;
  if ( a1 )
    v2 = 50331648;
  return sub_80064BE8(v2);
}
// 80062BA0: using guessed type int printf(const char *, ...);
// 8007620C: using guessed type int dword_8007620C;

//----- (800630D0) --------------------------------------------------------
int __fastcall WaitForDmaComplete(int a1)
{
  return sub_80065460(a1);
}
// 80062BA0: using guessed type int printf(const char *, ...);

//----- (8006313C) --------------------------------------------------------
int JustReturn2()
{
  return 2;
}
// 80062BA0: using guessed type int printf(const char *, ...);
// 800761A4: using guessed type __int16 word_800761A4;
// 800761A6: using guessed type __int16 word_800761A6;

//----- (80063264) --------------------------------------------------------
int __fastcall ApplyVideoSettings(int a1, unsigned __int8 a2, unsigned __int8 a3, unsigned __int8 a4)
{
  JustReturn2();
  return GPU_SafeExecute(sub_800644D8, a1, 8, (a4 << 16) | (a3 << 8) | a2);
}

//----- (800632F8) --------------------------------------------------------
int __fastcall SubmitCdDmaTransfer(int a1, int a2)
{
  JustReturn2();                                // just return 2;
  return GPU_SafeExecute(sub_800646F8, a1, 8, a2);
}

//----- (8006335C) --------------------------------------------------------
int __fastcall GPU_SetTransferRect(int a1, int a2)
{
  JustReturn2();
  return GPU_SafeExecute(sub_8006494C, a1, 8, a2);
}

//----- (800633C0) --------------------------------------------------------
// write access to const memory has been detected, the output may be wrong!
int __fastcall sub_800633C0(int a1, unsigned __int16 a2, int a3)
{
  int result; // $v0
  int v7; // $a0

  JustReturn2();
  result = -1;
  if ( *(a1 + 4) )
  {
    if ( *(a1 + 6) )
    {
      v7 = *a1;
      dword_80076254 = (a3 << 16) | a2;
      dword_80076250 = v7;
      dword_80076258 = *(a1 + 4);
      return GPU_SafeExecute(TriggerGpuDma, dword_80076248, 20, 0);
    }
    else
    {
      return -1;
    }
  }
  return result;
}
// 80063438: write access to const memory at 80076254 has been detected
// 8006344C: write access to const memory at 80076258 has been detected
// 80063440: write access to const memory at 80076250 has been detected
// 80076248: using guessed type int dword_80076248[2];
// 80076250: using guessed type int dword_80076250;
// 80076254: using guessed type int dword_80076254;
// 80076258: using guessed type int dword_80076258;

//----- (8006353C) --------------------------------------------------------
unsigned int *__fastcall sub_8006353C(unsigned int *a1, int a2)
{
  unsigned int *result; // $v0

  sub_800643F0(a1, a2);
  result = a1;
  *a1 = dword_8007625C & 0xFFFFFF;
  return result;
}
// 80062BA0: using guessed type int printf(const char *, ...);
// 8007625C: using guessed type int dword_8007625C[5];

//----- (80063634) --------------------------------------------------------
int __fastcall QueueGpuDmaTransfer(int a1)
{
  return GPU_SafeExecute(TriggerGpuDma, a1, 0, 0);
}
// 80062BA0: using guessed type int printf(const char *, ...);

//----- (800636A8) --------------------------------------------------------
int *__fastcall sub_800636A8(int *a1)
{
  BuildRenderCommand((a1 + 7), a1);
  a1[7] |= 0xFFFFFFu;
  GPU_SafeExecute(TriggerGpuDma, (a1 + 7), 64, 0);
  memcpy(dword_800761B0, a1, sizeof(dword_800761B0));
  return a1;
}
// 80062BA0: using guessed type int printf(const char *, ...);
// 80065864: using guessed type int __fastcall memcpy(_DWORD, _DWORD, _DWORD);
// 800761B0: using guessed type int dword_800761B0[23];

//----- (800637A4) --------------------------------------------------------
int __fastcall sub_800637A4(int a1)
{
  unsigned int v2; // $s2
  char WorkBase; // $v0
  int v4; // $v1
  int v5; // $a1
  int v6; // $a0
  int v7; // $s1
  int v8; // $a2
  int v9; // $s3
  int v10; // $a0
  __int16 v11; // $v1
  __int16 v12; // $a2
  int v13; // $a0
  __int16 v14; // $s1
  __int16 v15; // $v1
  __int16 v16; // $s3
  int v17; // $v1
  int v18; // $v1
  BOOL v19; // $v0

  v2 = 0x8000000;
  sub_80064BE8(((*(a1 + 2) & 0x3FF) << 10) | *a1 & 0x3FF | 0x5000000);
  if ( *(a1 + 8) || *(a1 + 12) )
  {
    WorkBase = GsGetWorkBase();
    v4 = *(a1 + 8);
    *(a1 + 18) = WorkBase;
    v5 = 10 * v4 + 608;
    v6 = *(a1 + 10);
    v7 = v6 + 19;
    if ( !*(a1 + 18) )
      v7 = v6 + 16;
    if ( *(a1 + 12) )
      v8 = v5 + 10 * *(a1 + 12);
    else
      v8 = 10 * v4 + 3168;
    v9 = v7 + *(a1 + 14);
    if ( !*(a1 + 14) )
      v9 = v7 + 240;
    v10 = 500;
    if ( v5 >= 500 )
    {
      if ( v5 < 3291 )
      {
LABEL_14:
        v11 = v5 + 80;
        if ( v8 >= v5 + 80 )
        {
          v11 = v8;
          if ( v8 >= 3291 )
            v11 = 3290;
        }
        v12 = v11;
        if ( v7 < 0 )
        {
          v13 = 0;
        }
        else
        {
          if ( *(a1 + 18) )
          {
            if ( v7 < 311 )
            {
              v13 = v7;
              goto LABEL_26;
            }
          }
          else if ( v7 < 255 )
          {
            v13 = v7;
            goto LABEL_26;
          }
          v13 = 254;
          if ( *(a1 + 18) )
            v13 = 310;
        }
LABEL_26:
        v14 = v13;
        v15 = v13 + 1;
        if ( v9 >= v13 + 1 )
        {
          if ( *(a1 + 18) )
          {
            if ( v9 < 313 )
            {
              v15 = v9;
              goto LABEL_34;
            }
          }
          else if ( v9 < 257 )
          {
            v15 = v9;
            goto LABEL_34;
          }
          v15 = 256;
          if ( *(a1 + 18) )
            v15 = 312;
        }
LABEL_34:
        v16 = v15;
        sub_80064BE8(((v12 & 0xFFF) << 12) | v5 & 0xFFF | 0x6000000);
        sub_80064BE8(((v16 & 0x3FF) << 10) | v14 & 0x3FF | 0x7000000);
        goto LABEL_35;
      }
      v10 = 3290;
    }
    v5 = v10;
    goto LABEL_14;
  }
LABEL_35:
  if ( *(a1 + 16) || *a1 || *(a1 + 4) )
  {
    *(a1 + 18) = GsGetWorkBase();
    if ( *(a1 + 18) == 1 )
      v2 = 134217736;
    if ( *(a1 + 17) )
      v2 |= 0x10u;
    if ( *(a1 + 16) )
      v2 |= 0x20u;
    v17 = *(a1 + 4);
    if ( v17 >= 281 )
    {
      if ( v17 >= 353 )
      {
        if ( v17 >= 401 )
        {
          if ( v17 >= 561 )
            v2 |= 3u;
          else
            v2 |= 2u;
        }
        else
        {
          v2 |= 0x40u;
        }
      }
      else
      {
        v2 |= 1u;
      }
    }
    v18 = *(a1 + 6);
    v19 = v18 < 289;
    if ( !*(a1 + 18) )
      v19 = v18 < 257;
    if ( !v19 )
      v2 |= 0x24u;
    sub_80064BE8(v2);
  }
  memcpy(&dword_8007620C, a1, 20);
  return a1;
}
// 80062BA0: using guessed type int printf(const char *, ...);
// 80065864: using guessed type int __fastcall memcpy(_DWORD, _DWORD, _DWORD);
// 800761A0: using guessed type char byte_800761A0;
// 8007620C: using guessed type int dword_8007620C;

//----- (80063DB8) --------------------------------------------------------
int __fastcall BuildRenderCommand(RenderCommand *out, RenderPrimitive *prim)
{
  int v4; // $t0
  __int16 v5; // $v0
  __int16 v6; // $v0
  int result; // $v0
  int v8; // [sp+10h] [-8h]
  int v9; // [sp+14h] [-4h]

  out->vertex[0] = PackVertex10(prim->x0, prim->y0);
  out->vertex[1] = PackVertex10B(prim->x1 + prim->x0 - 1, prim->y0 + prim->y0 - 1);
  out->vertex[2] = PackVertex11(prim->x2, prim->y2);
  out->material = PackMaterialFlags(prim->texId, prim->unsigned___int816, prim->word14);
  out->color = PackColorPSX(&prim->unsigned___int8C);
  out->terminator = TAG_TERMINATOR;
  v4 = 7;
  if ( prim->useLighting )
  {
    v8 = *&prim->x0;
    v9 = *&prim->x1;
    v5 = 0;
    if ( (v9 & 0x8000u) == 0 )
    {
      v5 = *&prim->x1;
      if ( v9 > -1 )
        v5 = -1;
    }
    LOWORD(v9) = v5;
    if ( v9 < 0 )
    {
      v6 = 0;
    }
    else
    {
      v6 = HIWORD(*&prim->x1);
      if ( SHIWORD(v9) > -1 )
        v6 = -1;
    }
    HIWORD(v9) = v6;
    if ( (v8 & 0x3F) != 0 || (v9 & 0x3F) != 0 )
    {
      LOWORD(v8) = v8 - prim->x2;
      HIWORD(v8) -= prim->y2;
      out->dword1C = (prim->unsigned___int81B << 16) | (prim->unsigned___int81A << 8) | 0x60000000 | prim->unsigned___int819;
      out->dword20 = v8;
      out->dword24 = v9;
      v4 = 10;
    }
    else
    {
      v4 = 10;
      out->dword1C = (prim->unsigned___int81B << 16) | (prim->unsigned___int81A << 8) | 0x2000000 | prim->unsigned___int819;
      out->dword20 = v8;
      out->dword24 = v9;
    }
  }
  result = v4 - 1;
  out->byte3 = v4 - 1;
  return result;
}
// 800761A4: using guessed type __int16 word_800761A4;
// 800761A6: using guessed type __int16 word_800761A6;

//----- (8006405C) --------------------------------------------------------
int __fastcall PackMaterialFlags(int a1, int a2, __int16 a3)
{
  int v3; // $v1
  int v4; // $v0

  v3 = -520093696;
  if ( a2 )
    v3 = -520093184;
  v4 = a3 & 0x9FF;
  if ( a1 )
    v4 |= 0x400u;
  return v3 | v4;
}
// 800761A0: using guessed type char byte_800761A0;

//----- (800640B8) --------------------------------------------------------
unsigned int __fastcall PackVertex10(__int16 a1, __int16 a2)
{
  __int16 v2; // $v0
  int v3; // $v1
  bool v4; // dc
  __int16 v5; // $a1

  v2 = 0;
  if ( a1 >= 0 )
  {
    v2 = a1;
    if ( a1 > -1 )
      v2 = -1;
  }
  v3 = a2;
  v4 = a2 < 0;
  v5 = 0;
  if ( !v4 )
  {
    if ( v3 > -1 )
      LOWORD(v3) = -1;
    v5 = v3;
  }
  return ((v5 & 0x3FF) << 10) | v2 & 0x3FF | 0xE3000000;
}
// 800761A0: using guessed type char byte_800761A0;
// 800761A4: using guessed type __int16 word_800761A4;
// 800761A6: using guessed type __int16 word_800761A6;

//----- (80064184) --------------------------------------------------------
unsigned int __fastcall PackVertex10B(__int16 a1, __int16 a2)
{
  __int16 v2; // $v0
  int v3; // $v1
  bool v4; // dc
  __int16 v5; // $a1

  v2 = 0;
  if ( a1 >= 0 )
  {
    v2 = a1;
    if ( a1 > -1 )
      v2 = -1;
  }
  v3 = a2;
  v4 = a2 < 0;
  v5 = 0;
  if ( !v4 )
  {
    if ( v3 > -1 )
      LOWORD(v3) = -1;
    v5 = v3;
  }
  return ((v5 & 0x3FF) << 10) | v2 & 0x3FF | 0xE4000000;
}
// 800761A0: using guessed type char byte_800761A0;
// 800761A4: using guessed type __int16 word_800761A4;
// 800761A6: using guessed type __int16 word_800761A6;

//----- (80064250) --------------------------------------------------------
unsigned int __fastcall PackVertex11(__int16 a1, __int16 a2)
{
  return ((a2 & 0x7FF) << 11) | a1 & 0x7FF | 0xE5000000;
}
// 800761A0: using guessed type char byte_800761A0;

//----- (80064298) --------------------------------------------------------
unsigned int __fastcall PackColorPSX(unsigned __int8 *a1)
{
  if ( a1 )
    return (a1[2] >> 3 << 15) | (*a1 >> 3 << 10) | 0xE2000000 | (32 * (-*(a1 + 3) >> 3)) | (-*(a1 + 2) >> 3);
  else
    return 0;
}

//----- (8006431C) --------------------------------------------------------
int __fastcall sub_8006431C(__int16 *a1)
{
  return *a1;
}
// 800761A0: using guessed type char byte_800761A0;

//----- (800643D8) --------------------------------------------------------
int sub_800643D8()
{
  return MEMORY[0x1F801814];
}

//----- (800643F0) --------------------------------------------------------
int __fastcall sub_800643F0(int a1, int a2)
{
  int result; // $v0
  bool v4; // dc

  MEMORY[0x1F8010F0] |= 0x8000000u;
  MEMORY[0x1F8010E0] = a1 + 4 * a2 - 4;
  MEMORY[0x1F8010E4] = a2;
  MEMORY[0x1F8010E8] = 285212674;
  SyncVSyncStatus();
  for ( result = a2; (MEMORY[0x1F8010E8] & 0x1000000) != 0; result = a2 )
  {
    v4 = sub_800655DC() != 0;
    result = -1;
    if ( v4 )
      break;
  }
  return result;
}

//----- (800644D8) --------------------------------------------------------
int __fastcall sub_800644D8(_WORD *a1, int a2)
{
  __int16 v2; // $v0
  int v3; // $v1
  __int16 v4; // $v1
  int v5; // $v0
  int v6; // $v0

  if ( a1[2] < 0 )
    v2 = 0;
  else
    v2 = -1;
  v3 = a1[3];
  a1[2] = v2;
  if ( v3 < 0 )
    v4 = 0;
  else
    v4 = -1;
  v5 = *a1 & 0x3F;
  a1[3] = v4;
  if ( v5 || (a1[2] & 0x3F) != 0 )
  {
    dword_8007900C = &dword_8007902C & 0xFFFFFF | 0x7000000;
    dword_8007901C = -436207616;
    dword_80079010 = -486539264;
    dword_80079014 = -452984833;
    dword_80079018 = -452984832;
    dword_80079020 = a2 & 0xFFFFFF | 0x60000000;
    dword_80079024 = *a1;
    v6 = *(a1 + 1);
    dword_8007902C = 0x3FFFFFF;
    dword_80079028 = v6;
    dword_80079030 = sub_80064CC8(3) | 0xE3000000;
    dword_80079034 = sub_80064CC8(4) | 0xE4000000;
    dword_80079038 = sub_80064CC8(5) | 0xE5000000;
  }
  else
  {
    dword_8007900C = 83886079;
    dword_80079010 = -436207616;
    dword_80079014 = a2 & 0xFFFFFF | 0x2000000;
    dword_80079018 = *a1;
    dword_8007901C = *(a1 + 1);
  }
  TriggerGpuDma(&dword_8007900C);
  return 0;
}
// 8006451C: conditional instruction was optimized away because $v1.4<8000u
// 80064564: conditional instruction was optimized away because $v1.4<8000u
// 800761A4: using guessed type __int16 word_800761A4;
// 800761A6: using guessed type __int16 word_800761A6;
// 8007900C: using guessed type int dword_8007900C;
// 80079010: using guessed type int dword_80079010;
// 80079014: using guessed type int dword_80079014;
// 80079018: using guessed type int dword_80079018;
// 8007901C: using guessed type int dword_8007901C;
// 80079020: using guessed type int dword_80079020;
// 80079024: using guessed type int dword_80079024;
// 80079028: using guessed type int dword_80079028;
// 8007902C: using guessed type int dword_8007902C;
// 80079030: using guessed type int dword_80079030;
// 80079034: using guessed type int dword_80079034;
// 80079038: using guessed type int dword_80079038;

//----- (800646F8) --------------------------------------------------------
int __fastcall sub_800646F8(int a1, int *a2)
{
  int v4; // $a0
  __int16 v5; // $v1
  int v6; // $a1
  int v7; // $a0
  int v8; // $v0
  int v9; // $lo
  signed int v10; // $v0
  int v11; // $a0
  int result; // $v0
  int v13; // $s0
  int v14; // $s4
  bool v15; // dc
  int v16; // $s0
  int v17; // $v1

  SyncVSyncStatus();
  v4 = *(a1 + 4);
  v5 = *(a1 + 4);
  if ( v4 < 0 )
  {
    v5 = 0;
  }
  else if ( v4 > 0 )
  {
    v5 = 0;
  }
  v6 = *(a1 + 6);
  *(a1 + 4) = v5;
  if ( v6 < 0 )
  {
    v7 = 0;
  }
  else
  {
    v7 = v6;
    if ( v6 > 0 )
    {
      LOWORD(v7) = 0;
      v8 = 0;
      goto LABEL_10;
    }
  }
  v8 = v7 << 16;
LABEL_10:
  v9 = *(a1 + 4) * (v8 >> 16);
  *(a1 + 6) = v7;
  v10 = v9 + 1 + ((v9 + 1) >> 31);
  v11 = (v9 + 1) / 2;
  if ( v11 <= 0 )
    return -1;
  v13 = v11 - 16 * (v10 >> 5);
  v14 = v10 >> 5;
  if ( (MEMORY[0x1F801814] & 0x4000000) != 0 )
  {
LABEL_15:
    MEMORY[0x1F801814] = 0x4000000;
    MEMORY[0x1F801810] = -1610612736;
    MEMORY[0x1F801810] = *a1;
    v16 = v13 - 1;
    for ( MEMORY[0x1F801810] = *(a1 + 4); v16 != -1; MEMORY[0x1F801810] = v17 )
    {
      v17 = *a2++;
      --v16;
    }
    if ( v14 )
    {
      MEMORY[0x1F801814] = 67108866;
      MEMORY[0x1F8010A0] = a2;
      MEMORY[0x1F8010A4] = (v14 << 16) | 0x10;
      MEMORY[0x1F8010A8] = 16777729;
    }
    return 0;
  }
  else
  {
    while ( 1 )
    {
      v15 = sub_800655DC() != 0;
      result = -1;
      if ( v15 )
        break;
      if ( (MEMORY[0x1F801814] & 0x4000000) != 0 )
        goto LABEL_15;
    }
  }
  return result;
}
// 800761A4: using guessed type __int16 word_800761A4;
// 800761A6: using guessed type __int16 word_800761A6;

//----- (8006494C) --------------------------------------------------------
int __fastcall sub_8006494C(int a1, _DWORD *a2)
{
  int v4; // $a0
  __int16 v5; // $v1
  int v6; // $a1
  int v7; // $a0
  int v8; // $v0
  int v9; // $lo
  signed int v10; // $v0
  int v11; // $a0
  int result; // $v0
  int v13; // $s0
  int v14; // $s4
  bool v15; // dc
  int i; // $s0

  SyncVSyncStatus();
  v4 = *(a1 + 4);
  v5 = *(a1 + 4);
  if ( v4 < 0 )
  {
    v5 = 0;
  }
  else if ( v4 > 0 )
  {
    v5 = 0;
  }
  v6 = *(a1 + 6);
  *(a1 + 4) = v5;
  if ( v6 < 0 )
  {
    v7 = 0;
  }
  else
  {
    v7 = v6;
    if ( v6 > 0 )
    {
      LOWORD(v7) = 0;
      v8 = 0;
      goto LABEL_10;
    }
  }
  v8 = v7 << 16;
LABEL_10:
  v9 = *(a1 + 4) * (v8 >> 16);
  *(a1 + 6) = v7;
  v10 = v9 + 1 + ((v9 + 1) >> 31);
  v11 = (v9 + 1) / 2;
  if ( v11 <= 0 )
    return -1;
  v13 = v11 - 16 * (v10 >> 5);
  v14 = v10 >> 5;
  if ( (MEMORY[0x1F801814] & 0x4000000) != 0 )
  {
LABEL_15:
    MEMORY[0x1F801814] = 0x4000000;
    MEMORY[0x1F801810] = -1073741824;
    MEMORY[0x1F801810] = *a1;
    MEMORY[0x1F801810] = *(a1 + 4);
    while ( 1 )
    {
      v15 = sub_800655DC() != 0;
      result = -1;
      if ( v15 )
        break;
      if ( (MEMORY[0x1F801814] & 0x8000000) != 0 )
      {
        for ( i = v13 - 1; i != -1; ++a2 )
        {
          --i;
          *a2 = MEMORY[0x1F801810];
        }
        if ( v14 )
        {
          MEMORY[0x1F801814] = 67108867;
          MEMORY[0x1F8010A0] = a2;
          MEMORY[0x1F8010A4] = (v14 << 16) | 0x10;
          MEMORY[0x1F8010A8] = 16777728;
        }
        return 0;
      }
    }
  }
  else
  {
    while ( 1 )
    {
      v15 = sub_800655DC() != 0;
      result = -1;
      if ( v15 )
        break;
      if ( (MEMORY[0x1F801814] & 0x4000000) != 0 )
        goto LABEL_15;
    }
  }
  return result;
}
// 800761A4: using guessed type __int16 word_800761A4;
// 800761A6: using guessed type __int16 word_800761A6;

//----- (80064BE8) --------------------------------------------------------
unsigned int __fastcall sub_80064BE8(unsigned int a1)
{
  unsigned int result; // $v0

  MEMORY[0x1F801814] = a1;
  result = HIBYTE(a1);
  byte_8007904C[HIBYTE(a1)] = a1;
  return result;
}
// 8007904C: using guessed type _BYTE byte_8007904C[256];

//----- (80064C14) --------------------------------------------------------
int __fastcall sub_80064C14(int a1)
{
  return byte_8007904C[a1];
}
// 8007904C: using guessed type _BYTE byte_8007904C[256];

//----- (80064C2C) --------------------------------------------------------
int __fastcall sub_80064C2C(int *a1, int a2)
{
  int v2; // $a2
  int result; // $v0
  int v4; // $v1

  v2 = a2 - 1;
  MEMORY[0x1F801814] = 0x4000000;
  result = 0;
  if ( a2 )
  {
    do
    {
      v4 = *a1++;
      --v2;
      MEMORY[0x1F801810] = v4;
      result = 0;
    }
    while ( v2 != -1 );
  }
  return result;
}

//----- (80064C7C) --------------------------------------------------------
int __fastcall TriggerGpuDma(int a1)
{
  int result; // $v0

  MEMORY[0x1F801814] = 67108866;
  MEMORY[0x1F8010A0] = a1;
  MEMORY[0x1F8010A4] = 0;
  result = 528486568;
  MEMORY[0x1F8010A8] = 16778241;
  return result;
}

//----- (80064CC8) --------------------------------------------------------
int __fastcall sub_80064CC8(int a1)
{
  MEMORY[0x1F801814] = a1 | 0x10000000;
  return MEMORY[0x1F801810] & 0xFFFFFF;
}

//----- (80064CF8) --------------------------------------------------------
int __fastcall GPU_SafeExecuteWrap(void (__fastcall *a1)(int, int), int a2, int a3)
{
  return GPU_SafeExecute(a1, a2, 0, a3);
}

//----- (80064D1C) --------------------------------------------------------
// write access to const memory has been detected, the output may be wrong!
int __fastcall GPU_SafeExecute(void (__fastcall *gpuFunc)(int, int), int a2, int a3, int a4)
{
  int oldMask; // $v0

  SyncVSyncStatus();
  oldMask = SetIntrMask(0);
  g_GpuLockFlag = 1;
  dword_800762AC = oldMask;
  while ( (MEMORY[0x1F801814] & 0x4000000) == 0 )// while ( (GPU_REG_STAT & 0x4000000) == 0 ) 
    ;
  gpuFunc(a2, a4);
  g_LastGpuCmd = gpuFunc;
  dword_80076298 = a2;
  dword_8007629C = a4;
  SetIntrMask(0);
  return 0;
}
// 80064DA8: write access to const memory at 800762AC has been detected
// 80064E48: write access to const memory at 80076298 has been detected
// 80064E50: write access to const memory at 8007629C has been detected
// 80064FBC: write access to const memory at 800762A4 has been detected
// 80064D9C: write access to const memory at 800761A8 has been detected
// 80064E44: write access to const memory at 80076294 has been detected
// 800761A1: using guessed type char byte_800761A1;
// 800761A8: using guessed type int g_GpuLockFlag;
// 80076294: using guessed type int g_LastGpuCmd;
// 80076298: using guessed type int dword_80076298;
// 8007629C: using guessed type int dword_8007629C;
// 800762A4: using guessed type int dword_800762A4;
// 800762A8: using guessed type int dword_800762A8;
// 800762AC: using guessed type int dword_800762AC;
// 801B8AD0: using guessed type int (__fastcall *byte_801B8AD0)(_DWORD, _DWORD);

//----- (80065010) --------------------------------------------------------
// write access to const memory has been detected, the output may be wrong!
int sub_80065010()
{
  int result; // $v0

  result = 1;
  if ( (MEMORY[0x1F8010A8] & 0x1000000) == 0 )
  {
    dword_800762B0 = SetIntrMask(0);
    SetIntrMask(0);
    return 0;
  }
  return result;
}
// 80065050: write access to const memory at 800762B0 has been detected
// 80065220: write access to const memory at 800762A8 has been detected
// 80000000: using guessed type int (__fastcall *unk_80000000)(_DWORD, _DWORD);
// 800761A8: using guessed type int g_GpuLockFlag;
// 800762A4: using guessed type int dword_800762A4;
// 800762A8: using guessed type int dword_800762A8;
// 800762B0: using guessed type int dword_800762B0;
// 801B8AD0: using guessed type int (__fastcall *byte_801B8AD0)(_DWORD, _DWORD);

//----- (80065324) --------------------------------------------------------
// write access to const memory has been detected, the output may be wrong!
int __fastcall ResetGraph_Internal(char a1)
{
  int v2; // $v0
  int result; // $v0

  v2 = SetIntrMask(0);
  dword_800762A8 = 0;
  dword_800762B4 = v2;
  dword_800762A4 = 0;
  if ( (a1 & 7) != 0 )
  {
    if ( (a1 & 7) == 1 )
    {
      MEMORY[0x1F8010A8] = 1025;
      MEMORY[0x1F8010F0] |= 0x800u;
      MEMORY[0x1F801814] = 0x1000000;
    }
  }
  else
  {
    MEMORY[0x1F8010A8] = 1025;
    MEMORY[0x1F8010F0] |= 0x800u;
    MEMORY[0x1F801814] = 0;
    memset_1(byte_8007904C, 0, sizeof(byte_8007904C));
    memset_1(&byte_801B8AD0, 0, 6144);
  }
  SetIntrMask(0);
  result = 0;
  if ( (a1 & 7) == 0 )
    return sub_80065748(a1);
  return result;
}
// 8006533C: write access to const memory at 800762A8 has been detected
// 8006534C: write access to const memory at 800762B4 has been detected
// 80065354: write access to const memory at 800762A4 has been detected
// 800762A4: using guessed type int dword_800762A4;
// 800762A8: using guessed type int dword_800762A8;
// 800762B4: using guessed type int dword_800762B4;
// 8007904C: using guessed type _BYTE byte_8007904C[256];
// 801B8AD0: using guessed type int (__fastcall *byte_801B8AD0)(_DWORD, _DWORD);

//----- (80065460) --------------------------------------------------------
int __fastcall sub_80065460(int a1)
{
  bool v1; // dc
  int result; // $v0

  if ( a1 )
    return (MEMORY[0x1F8010A8] & 0x1000000) != 0 || (MEMORY[0x1F801814] & 0x4000000) == 0;
  SyncVSyncStatus();
  do
  {
    if ( (MEMORY[0x1F8010A8] & 0x1000000) == 0 )
    {
      result = 0;
      if ( (MEMORY[0x1F801814] & 0x4000000) != 0 )
        break;
    }
    v1 = sub_800655DC() != 0;
    result = -1;
  }
  while ( !v1 );
  return result;
}
// 800762A4: using guessed type int dword_800762A4;
// 800762A8: using guessed type int dword_800762A8;

//----- (800655A8) --------------------------------------------------------
// write access to const memory has been detected, the output may be wrong!
int SyncVSyncStatus()
{
  int result; // $v0

  result = VSync(-1) + 240;
  dword_800762B8 = result;
  dword_800762BC = 0;
  return result;
}
// 800655BC: write access to const memory at 800762B8 has been detected
// 800655C4: write access to const memory at 800762BC has been detected
// 800762B8: using guessed type int dword_800762B8;
// 800762BC: using guessed type int dword_800762BC;

//----- (800655DC) --------------------------------------------------------
// write access to const memory has been detected, the output may be wrong!
int sub_800655DC()
{
  int v0; // $v0

  if ( VSync(-1) > 0 )
  {
    printf(
      "GPU timeout:que=%d,stat=%08x,chcr=%08x,madr=%08x,",
      0,
      MEMORY[0x1F801814],
      MEMORY[0x1F8010A8],
      MEMORY[0x1F8010A0]);
    printf("func=(%08x)(%08x,%08x)\n", 0, 0, 0);
    v0 = SetIntrMask(0);
    dword_800762A8 = 0;
    dword_800762B4 = v0;
    dword_800762A4 = 0;
    MEMORY[0x1F8010A8] = 1025;
    MEMORY[0x1F8010F0] |= 0x800u;
    MEMORY[0x1F801814] = 0x1000000;
    SetIntrMask(0);
    return -1;
  }
  else
  {
    dword_800762BC = 1;
    return 0;
  }
}
// 80065614: write access to const memory at 800762BC has been detected
// 800656B0: write access to const memory at 800762A8 has been detected
// 800656C0: write access to const memory at 800762B4 has been detected
// 800656C8: write access to const memory at 800762A4 has been detected
// 80062BA0: using guessed type int printf(const char *, ...);
// 80076294: using guessed type int g_LastGpuCmd;
// 80076298: using guessed type int dword_80076298;
// 8007629C: using guessed type int dword_8007629C;
// 800762A4: using guessed type int dword_800762A4;
// 800762A8: using guessed type int dword_800762A8;
// 800762B4: using guessed type int dword_800762B4;
// 800762B8: using guessed type int dword_800762B8;
// 800762BC: using guessed type int dword_800762BC;

//----- (80065748) --------------------------------------------------------
int __fastcall sub_80065748(char a1)
{
  int result; // $v0

  MEMORY[0x1F801814] = 268435463;
  if ( (MEMORY[0x1F801810] & 0xFFFFFF) == 2 )
  {
    if ( (a1 & 8) != 0 )
    {
      result = 4;
      MEMORY[0x1F801814] = 150994945;
    }
    else
    {
      return 3;
    }
  }
  else
  {
    MEMORY[0x1F801810] = MEMORY[0x1F801814] & 0x2FFF | 0xE1001000;
    if ( (MEMORY[0x1F801814] & 0x1000) != 0 )
    {
      if ( (a1 & 8) != 0 )
      {
        MEMORY[0x1F801814] = 536872196;
        return 2;
      }
      else
      {
        return 1;
      }
    }
    else
    {
      return 0;
    }
  }
  return result;
}

//----- (80065828) --------------------------------------------------------
int __fastcall memset_1(_BYTE *a1, char a2, int a3)
{
  int result; // $v0

  result = a3 - 1;
  if ( a3 )
  {
    do
    {
      *a1 = a2;
      --result;
      ++a1;
    }
    while ( result != -1 );
  }
  return result;
}

//----- (800679B8) --------------------------------------------------------
int __fastcall sub_800679B8(int a1, __int16 a2, __int16 a3, __int16 a4, __int16 a5)
{
  int result; // $v0

  result = a1;
  *a1 = a2;
  *(a1 + 2) = a3;
  *(a1 + 4) = a4;
  *(a1 + 8) = 0;
  *(a1 + 10) = 0;
  *(a1 + 12) = 0;
  *(a1 + 14) = 0;
  *(a1 + 17) = 0;
  *(a1 + 16) = 0;
  *(a1 + 19) = 0;
  *(a1 + 18) = 0;
  *(a1 + 6) = a5;
  return result;
}

// nfuncs=967 queued=722 decompiled=722 lumina nreq=0 worse=0 better=0
#error "There were 1 decompilation failure(s) on 722 function(s)"
